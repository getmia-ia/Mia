{"createdAt":"2025-08-04T03:04:47.043Z","updatedAt":"2025-09-24T17:31:47.020Z","id":"lj1KfYOuvntfYvEo","name":"1.3 - Finamob - Journal - Post Instagram","active":false,"isArchived":true,"nodes":[{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $('Instagram params').item.json.instagram_business_account_id }}","edge":"media_publish","options":{"queryParameters":{"parameter":[{"name":"creation_id","value":"={{ $json.id }}"}]}}},"id":"b4f53ce0-d316-4ea7-ad8b-b00298f3efd0","name":"Instagram publish media","type":"n8n-nodes-base.facebookGraphApi","position":[2672,1888],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"content":"Add your credential","height":782,"width":2738},"id":"36137b7e-6362-4b5d-a847-0717548be4bc","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[1184,1648],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"68b89233-2740-4afd-a95c-72ed537d12e5","name":"noticia_id","value":"={{ $json.noticia_id }}","type":"string"},{"id":"225df266-bf29-4415-b04c-2750cef4506a","name":"image_url","type":"string","value":"={{ $json.imagem_url }}"},{"id":"42e44a66-490d-453f-8746-87e201e58f6c","name":"image_url2","value":"={{ $json.imagem_url2 }}","type":"string"},{"id":"1e380c14-e908-4eeb-90e0-957a422829d0","name":"instagram_business_account_id","type":"string","value":"17841476909595854"},{"id":"f35e3093-1bff-4cc6-a6c4-909dca314cc7","name":"instagram_post_caption","type":"string","value":"={{ $json.legenda }}"}]},"options":{}},"id":"2c2f0ae7-6b3a-42a8-b6b8-d68af415d2b9","name":"Instagram params","type":"n8n-nodes-base.set","position":[1008,1856],"typeVersion":3.4},{"parameters":{"graphApiVersion":"v20.0","node":"=me","options":{"fields":{"field":[{"name":"name"},{"name":"connected_instagram_account"}]}}},"id":"929c9f84-01e9-45a9-a76a-90e9fb36dfef","name":"Node just for retrive id of instagram page","type":"n8n-nodes-base.facebookGraphApi","position":[576,1520],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}},"disabled":true},{"parameters":{"content":"You can use this node if you want to retrieve the instagram id. \n\nAdd it to the workflow ore use manually","height":289,"width":318},"id":"5ead00a0-aa6f-4ced-98f2-25dd7432b551","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[464,1408],"typeVersion":1},{"parameters":{"content":"Here we have all parameters for posting in instagram image url, caption and instagram business profile id","height":310,"width":188,"color":3},"id":"1d21b05c-e5be-4235-98ed-1cb74c3bad62","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[960,1712],"typeVersion":1},{"parameters":{"content":"## Permissions\nPublishing relies on a combination of the following permissions. The exact combination depends on which endpoints your app uses. Refer to our endpoint references to determine which permissions each endpoint requires.\n\nads_management\nbusiness_management\ninstagram_basic\ninstagram_content_publish\npages_read_engagement\nIf your app will be used by app users who do not have a role on your app or a role in a Business that has claimed your app, you must request approval for each permission via App Review before non-role app users can grant them to your app.\n\n## Limitations\nJPEG is the only image format supported. Extended JPEG formats such as MPO and JPS are not supported.\nShopping tags are not supported.\nBranded content tags are not supported.\nFilters are not supported.\nPublishing to Instagram TV is not supported.\nFor additional limitations, refer to each endpoint's reference.\n\n## Rate Limit\nInstagram accounts are limited to 50 API-published posts within a rolling 24-hour period. Carousels count as a single post. This limit is enforced on the POST /{ig-user-id}/media_publish endpoint when attempting to publish a media container. We recommend that your app also enforce the publishing rate limit, especially if your app allows app users to schedule posts to be published in the future.\n\nTo check an Instagram Professional account's current rate limit usage, query the GET /{ig-user-id}/content_publishing_limit endpoint.","height":792,"width":439.10253951549294,"color":7},"id":"1fd5fb3b-d8ea-4721-86df-098dd1db6e8c","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[496,2064],"typeVersion":1},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"FINISHED"}],"combinator":"and"},"options":{}},"id":"b44f1352-c613-41a9-92e1-715d8eb41e31","name":"If media status is finished","type":"n8n-nodes-base.if","position":[2400,1760],"typeVersion":2.2,"disabled":true},{"parameters":{"graphApiVersion":"v20.0","node":"={{ $('Instagram check status of media uploaded before').item.json.id }}","options":{"fields":{"field":[{"name":"id"},{"name":"status"},{"name":"status_code"}]}}},"id":"6e461636-203e-4613-9eed-0a4d87cc38c2","name":"Instagram check status of media published before","type":"n8n-nodes-base.facebookGraphApi","position":[2880,1888],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"PUBLISHED"}]},"options":{}},"id":"76c0a54e-067c-4607-8dbd-af2ee35e6e04","name":"If media status is finished1","type":"n8n-nodes-base.if","position":[3072,1888],"typeVersion":2.2},{"parameters":{"content":"You can send email for unsuccessful upload or what you want, you can trigger another workflow or another node","height":102.11100456713636,"color":3},"id":"10c141b8-1252-44a9-af22-8f0781bb880c","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[2208,2240],"typeVersion":1},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"54fa4546-8262-4651-9b0e-ce3a2f66416f","leftValue":"={{ $json.status }}","rightValue":"aprovado","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[688,1872],"id":"c6ae8de5-20ca-49bd-bc83-00fc0385371a","name":"If8"},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post Finamob falhou!","message":"Post Finamob falhou!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2672,2096],"id":"abd82829-5c85-4b60-a361-5577c3ae5e5e","name":"Send a message","webhookId":"ed315a96-2581-4e78-b460-507c13922276","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post Finamob deu certo!","message":"Post Finamob deu certo!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[3296,1856],"id":"d45241ed-179e-4ec9-9543-fb592b68c65f","name":"Send a message1","webhookId":"f8699069-f40a-43b1-bbd3-95d40ed6f8fa","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post Finamob falhou 2!","message":"Post Finamob falhou 2!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[3296,2032],"id":"b64f26c6-98e1-4818-b759-4375146e2cab","name":"Send a message2","webhookId":"142a261a-24af-492a-94a8-f9066b4882f6","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"content":"# Ação de postar no Instagram\n\n### Aqui cadastramos os tokens necessários para a API do Meta\n### O post é realizado no mesmo momento em que a aprovação acontece","height":1696,"width":3936,"color":5},"type":"n8n-nodes-base.stickyNote","position":[48,1200],"typeVersion":1,"id":"432aae50-a5ab-48a1-b1aa-10db66706787","name":"Sticky Note14"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[3712,1856],"id":"0eb3b110-b325-43b5-a248-f79c207891b8","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"f2c98e3a-ba6b-4df7-a0c9-96994c91a690","name":"noticia_id","value":"={{ $('Instagram params').item.json.noticia_id }}","type":"string"},{"id":"a95682ad-ea9c-4d88-a370-0ffad2b3eea5","name":"status","value":"postado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,1856],"id":"2a4c3e81-d7ff-4846-bc0c-0d0b48d36214","name":"Edit Fields"},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v22.0","node":"={{ $('Instagram params').item.json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"media_type","value":"=CAROUSEL"},{"name":"children","value":"={{ JSON.stringify([\n  $(\"Instagram prepare media (img1)\").first().json.id,\n  $(\"Instagram prepare media (img2)\").first().json.id\n]) }}\n"},{"name":"caption","value":"={{ $('Instagram params').item.json.instagram_post_caption }}"}]}}},"id":"73355767-7009-490a-b05f-d470b2af8a3d","name":"Instagram create carousel","type":"n8n-nodes-base.facebookGraphApi","position":[1744,1872],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url || $json.imagem_url }}"},{"name":"is_carousel_item","value":"true"}]}}},"id":"7462a97c-cbcc-4ee3-94bd-d9eace1d6429","name":"Instagram prepare media (img1)","type":"n8n-nodes-base.facebookGraphApi","position":[1328,1744],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url2 || $json.imagem_url2 }}"},{"name":"is_carousel_item","value":"true"}]}}},"id":"9b734fe6-9966-48b3-9d17-39e3a5109c76","name":"Instagram prepare media (img2)","type":"n8n-nodes-base.facebookGraphApi","position":[1328,1984],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"mode":"chooseBranch","useDataOfInput":2},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1568,1872],"id":"b5436388-1b3e-42c6-bc71-ec5a6143e3b2","name":"Merge"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[144,1872],"id":"a975be17-16ee-4fd8-8cad-019ee21e260e","name":"Schedule Trigger"},{"parameters":{"documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Finamob - Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"aprovado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[320,1872],"id":"e686cffc-1ca3-40ba-8fe0-c4a4496a0a6c","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"// Garante 1 por execução (pega a primeira \"aprovado\")\nconst rows = items.map(i => i.json);\n\nconst isApproved = (v) =>\n  String(v || '').trim().toLowerCase() === 'aprovado';\n\nconst first = rows.find(r =>\n  isApproved(r.status) &&\n  r.noticia_id &&\n  (r.imagem_url || r.imagem) &&\n  r.legenda\n);\n\nif (!first) return []; // nada a postar neste horário\n\nconst out = { ...first };\nout.imagem_url = first.imagem_url || first.imagem;\nreturn [{ json: out }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[512,1872],"id":"9b6de325-3e92-4e22-8d48-47a1a26b2c04","name":"Code"},{"parameters":{"graphApiVersion":"v20.0","node":"={{ $json.id }}","options":{"fields":{"field":[{"name":"id"},{"name":"status"},{"name":"status_code"}]}}},"id":"49ca8e62-8159-4504-9c63-dc8ca47ac286","name":"Instagram check status of media uploaded before","type":"n8n-nodes-base.facebookGraphApi","position":[2208,1968],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1ac6e4fc-79b5-4afe-995e-667324f0a8cf","leftValue":"={{ $json.id }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1952,1984],"id":"ec720573-eb58-4dd1-9815-2ee78aec1d0b","name":"If","retryOnFail":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status_code }}","rightValue":"FINISHED","operator":{"type":"string","operation":"equals"},"id":"53932f8e-2f9a-40d2-a8bf-2abf93656808"}],"combinator":"and"},"renameOutput":true,"outputKey":"FINISHED"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7089f8c6-8c1c-482e-b30d-47e92e2753bf","leftValue":"={{ $json.status_code }}","rightValue":"IN_PROGRESS","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IN_PROGRESS"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2400,1952],"id":"8425d2c5-e2b4-4866-a8c4-e56f5476c54c","name":"Switch"}],"connections":{"Instagram params":{"main":[[{"node":"Instagram prepare media (img1)","type":"main","index":0},{"node":"Instagram prepare media (img2)","type":"main","index":0}]]},"Instagram publish media":{"main":[[{"node":"Instagram check status of media published before","type":"main","index":0}]]},"If media status is finished":{"main":[[],[]]},"If media status is finished1":{"main":[[{"node":"Send a message1","type":"main","index":0}],[{"node":"Send a message2","type":"main","index":0}]]},"Instagram check status of media published before":{"main":[[{"node":"If media status is finished1","type":"main","index":0}]]},"If8":{"main":[[{"node":"Instagram params","type":"main","index":0}]]},"Send a message1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]},"Instagram create carousel":{"main":[[{"node":"If","type":"main","index":0}]]},"Instagram prepare media (img1)":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Instagram prepare media (img2)":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Instagram create carousel","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"If8","type":"main","index":0}]]},"Instagram check status of media uploaded before":{"main":[[{"node":"Switch","type":"main","index":0}]]},"If":{"main":[[{"node":"Instagram check status of media uploaded before","type":"main","index":0}],[{"node":"Instagram create carousel","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Instagram publish media","type":"main","index":0}],[{"node":"Instagram check status of media uploaded before","type":"main","index":0}],[{"node":"Send a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"Cem9y3zmcggUQhrp"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":1501,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=1501&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger":[{"json":{"timestamp":"2025-09-22T12:40:14.003-03:00","Readable date":"September 22nd 2025, 12:40:14 pm","Readable time":"12:40:14 pm","Day of week":"Monday","Year":"2025","Month":"September","Day of month":"22","Hour":"12","Minute":"40","Second":"14","Timezone":"America/Sao_Paulo (UTC-03:00)"}}]},"versionId":"a024b06d-df4b-4ff3-bf05-9b1dfe9f72e7","triggerCount":1,"tags":[]}