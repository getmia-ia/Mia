{"createdAt":"2025-08-21T22:37:39.414Z","updatedAt":"2025-10-06T14:38:48.652Z","id":"WB2teOTjYdjM8aHe","name":"Finamob - 1.5 - Journal - Resumo Semanal","active":false,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[1],"triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[432,752],"id":"8037f960-abc0-4fe7-a96c-af873c5e18ac","name":"Schedule Trigger1"},{"parameters":{"documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"postado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[752,752],"id":"f98b530f-1fd1-4326-bfb7-fcdc139e0fda","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"// √∫ltimos 7 dias at√© ontem (America/Sao_Paulo)\nconst hoje = new Date();\nconst fim = new Date(hoje);  // ontem\nfim.setDate(fim.getDate() - 1);\nconst ini = new Date(fim);   // 7 dias atr√°s (inclusive)\nini.setDate(ini.getDate() - 6);\n\nconst fmt = d => String(d.getDate()).padStart(2,'0') + '/' +\n                 String(d.getMonth()+1).padStart(2,'0') + '/' +\n                 d.getFullYear();\n\nreturn {\n  data_ini: fmt(ini),\n  data_fim: fmt(fim)\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[592,752],"id":"7c4b64ba-d67c-4fd3-989b-668f46f5724a","name":"Code"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1296,976],"id":"7dd6ebf7-7aca-494a-b8fc-f6a3185b9e29","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"jsCode":"const items = $input.all();\nif (!items.length) {\n  return [{ json: { prompt: \"Nenhuma not√≠cia encontrada no per√≠odo.\" } }];\n}\n\n// datas do 1¬∫ Code\nconst data_ini = $item(0).$node[\"Code\"].json.data_ini;\nconst data_fim = $item(0).$node[\"Code\"].json.data_fim;\n\nconst MAX = 500;\nconst cut = s => (s || '').trim().slice(0, MAX);\nconst contexto = items.map(it => `‚Ä¢ ${(it.json.titulo||'').trim()}\\n${cut(it.json.legenda)}`).join(\"\\n\\n\");\n\n// cabe√ßalhos semanais\nconst header1 = `*Bom dia comunidade EMI!* üì∞\\n\\n`;\nconst header2 = `Segue **resumo da semana** (*${data_ini}‚Äì${data_fim}*):\\n\\n`;\nconst header3 = `Acompanhe a nossa p√°gina no Instagram:\\nhttps://www.instagram.com/escoladomercadoimobiliario\\n\\n`;\n\nconst prompt = `\nVoc√™ √© editor do briefing semanal da comunidade EMI (WhatsApp).\nProduza UMA mensagem concisa, did√°tica e **visual**, com base nas not√≠cias da semana *${data_ini}‚Äì${data_fim}*.\nN√£o liste not√≠cia por not√≠cia. N√£o inclua links (al√©m do Instagram j√° fornecido). N√£o invente fatos.\n\nBASE (refer√™ncia; n√£o copie literalmente):\n${contexto}\n\nFORMATO EXATO DA SA√çDA (mantenha as linhas fixas e a ordem):\n${header1}${header2}${header3}[RESUMO CONECTADO EM BLOCOS]\n- Estruture em **3 a 4 blocos**, cada um com **t√≠tulo em negrito + emoji** \n- Cada bloco com **2 a 3 frases curtas**, explicando *o que aconteceu* e *por que importa para o corretor/incorporador*.\n- Use **1 emoji no t√≠tulo**. Separe os blocos com uma linha em branco.\n\n*Como isso impacta para o incorporador?:*\n- Escreva 1 par√°grafo claro conectando os fatos aos impactos pr√°ticos da semana.\n\n*Manchetes da semana:*\n- liste 5‚Äì8 manchetes com 1Ô∏è‚É£,2Ô∏è‚É£,‚Ä¶\n\nREGRAS:\n- PT-BR, claro e objetivo; sem jarg√£o.\n- Priorize n√∫meros/dados quando existirem; se faltarem, n√£o invente.\n- N√£o adicione se√ß√µes al√©m das especificadas.\n`.trim();\n\nreturn [{ json: { prompt } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1120,752],"id":"8417a452-336e-4e94-9591-b67dc1d513c4","name":"Code1"},{"parameters":{"content":"# Fluxo de Envio do Resumo Semanal para comunidade Whatsapp\n### Esse fluxo roda todo dia de manh√£ as 08am\n### Envia um resumo das not√≠cias processadas no dia anterior","height":640,"width":1216,"color":3},"type":"n8n-nodes-base.stickyNote","position":[384,528],"typeVersion":1,"id":"b675c1ee-f138-4a4d-b740-a87915e5e644","name":"Sticky Note15"},{"parameters":{"content":"## Checa o status do video","height":340,"width":660,"color":2},"id":"8a4be274-cd62-4945-9758-532754a7578c","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[3008,624],"typeVersion":1},{"parameters":{"content":"# Seta os Parametros\n\n   - **Avatar ID** \n   - **Voice ID** \n   - **Texto**","height":400,"width":544,"color":5},"id":"aa90b565-7aee-49ce-994b-b1c16e736f04","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[2400,560],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"dc091aca-844f-404f-ad0c-8ad4b48a505b","name":"avatar_id","type":"string","value":"ceea94f643214661abd336c6bb018018"},{"id":"eb2ed34c-53d2-41e8-ab2f-1b8278bde235","name":"voice_id","type":"string","value":"94ec497104a04c87904a8aa138d6e46c"},{"id":"2c939d6c-73f8-482d-b11f-71bdd7baf04e","name":"texto","type":"string","value":"={{ $json.output }}"},{"id":"60b3b8e2-a578-4957-9178-87934aa2821d","name":"video_id","value":"f62b75875d8644a6ad76cd9cc9e65224","type":"string"}]},"options":{}},"id":"51542c27-1f98-4b29-b8a8-747ab5ac7c5c","name":"Seta Infos","type":"n8n-nodes-base.set","position":[2608,752],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://api.heygen.com/v2/video/generate","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"video_inputs\": [\n    {\n      \"character\": {\n        \"type\": \"avatar\",\n        \"avatar_id\": \"{{ $json.avatar_id }}\",\n        \"avatar_style\": \"normal\"\n      },\n      \"voice\": {\n        \"type\": \"text\",\n        \"input_text\": \"{{ $json.texto }}\",\n        \"voice_id\": \"{{ $json.voice_id }}\",\n        \"speed\": 1\n      }\n    }\n  ],\n  \"caption\": true,\n\"dimension\": {  \n \"width\": 1280,  \n \"height\": 720  \n}\n}","options":{}},"id":"c69b431f-7354-42b9-b15e-5697664a2bd5","name":"Cria Video","type":"n8n-nodes-base.httpRequest","position":[2784,752],"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"W6MrPdRJPc3ONQnr","name":"Heygen (lucas95_souza)"}}},{"parameters":{"amount":1,"unit":"minutes"},"id":"cc697d37-b149-41a3-9fae-1d533d157e8a","name":"Espera 1 min","type":"n8n-nodes-base.wait","position":[3072,752],"webhookId":"602d76c4-6500-42b7-b7d1-0d9bb497d007","typeVersion":1.1},{"parameters":{"url":"https://api.heygen.com/v1/video_status.get","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"video_id","value":"={{ $('Seta Infos').item.json.video_id }}"}]},"options":{}},"id":"de30c514-ce8e-4429-8a86-20e5484038dc","name":"Pega status do video","type":"n8n-nodes-base.httpRequest","position":[3280,752],"typeVersion":4.2,"credentials":{"httpHeaderAuth":{"id":"W6MrPdRJPc3ONQnr","name":"Heygen (lucas95_souza)"}}},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2643b070-cbb2-4562-9269-a61389e0c242","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.data.status }}","rightValue":"completed"}]},"options":{}},"id":"05f4c474-71ed-4090-9ed8-2a6ea3bae519","name":"Valida se est√° no status: Completed","type":"n8n-nodes-base.if","position":[3472,752],"typeVersion":2.2},{"parameters":{"assignments":{"assignments":[{"id":"53226f92-5381-4f9f-9be5-4b25f31db99c","name":"data.video_url","type":"string","value":"={{ $json.data.video_url }}"}]},"options":{}},"id":"3c103012-b6ab-4f5d-a99b-0076e88f0c6a","name":"Seta URL do Video","type":"n8n-nodes-base.set","position":[3728,736],"typeVersion":3.4},{"parameters":{"url":"={{ $('Seta URL do Video').item.json.data.video_url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4160,736],"id":"e21650a3-d8fa-4a14-a44d-19f79b7f1f5c","name":"Faz o Download do Video"},{"parameters":{"content":"## Faz Download e Edita o Video","height":340,"width":1304,"color":4},"id":"725a0fe4-272a-4081-814c-c54c55dbdde2","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[3696,624],"typeVersion":1},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1936,976],"id":"e4824acb-f59a-4583-a6e7-cf601699e251","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"content":"# HeyGen para gera√ß√£o do Avatar","height":880,"width":3856},"type":"n8n-nodes-base.stickyNote","position":[1792,336],"typeVersion":1,"id":"7396ef93-503d-4170-b326-32f293400b0e","name":"Sticky Note2"},{"parameters":{"promptType":"define","text":"={{ $json.prompt }}","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1296,752],"id":"8c72aea3-2ebd-48e6-a0e6-15afe90ff794","name":"AI Agent1","executeOnce":true,"onError":"continueRegularOutput"},{"parameters":{"promptType":"define","text":"=Voc√™ receber√° abaixo um BRIEFING cru com emojis, links e t√≠tulos. Gere um roteiro de locu√ß√£o em PT-BR, tom leve, simp√°tico e informativo. Tem que ser uma linguagem muito simples de entender, evite termos complexos.\n\nRegras de sa√≠da:\n- 100‚Äì140 palavras (‚âà25‚Äì40s).\n- Abra com \"Bom dia, comunidade! Eu sou a Emi, a intelig√™ncia artificial da Escola do Mercado Imobili√°rio. Vamos falar sobre as not√≠cias da semana!.\"\n- Traga 2‚Äì3 frases com os pontos mais relevantes da semana.\n- Adicione 1 frase ‚Äúo que isso significa para o incorporador‚Äù.\n- Feche com um CTA curto para seguir no Instagram e uma mensagem simpatica de bom dia!\n- Remova links, hashtags, emojis e qualquer formata√ß√£o.\n- Sem listas; apenas frases curtas e naturais. N√∫meros leg√≠veis (14% ‚Üí ‚Äúquatorze por cento‚Äù).\n\nSa√≠da: **apenas o roteiro final**, sem t√≠tulos, sem repetir instru√ß√µes.\n\nBRIEFING:\n{{ $json.output }}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1936,752],"id":"feb5f9d3-a630-4f9d-9387-10f571503ffa","name":"Agent HeyGen","executeOnce":true,"onError":"continueRegularOutput"},{"parameters":{"resource":"messages-api","operation":"send-video","instanceName":"social-media-finamob-oficial","remoteJid":"120363418841788220@g.us","media":"={{ 'https://prd.miabuilder.com/webhook/666ac7fd-78ac-44ae-ba3a-f516a140b896/vid/' + $workflow.id + '/' + $execution.id }}","caption":"={{ $item(0).$node[\"AI Agent1\"].json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[5312,752],"id":"9807cf2f-9e52-4f9e-abce-c7b95a7597f7","name":"Enviar video","credentials":{"evolutionApi":{"id":"4JfTThlwBUF4KuNE","name":"Evolution - social-media-finamob-oficial"}}},{"parameters":{"content":"## Envia o video","height":340,"width":584,"color":4},"id":"aae0b03b-f5fe-4d0a-9d8a-632a8971d509","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[5040,624],"typeVersion":1},{"parameters":{"jsCode":"const parseBR = (s) => {\n  if (!s) return NaN;\n  const [dd, mm, yyyy] = s.split('/');\n  return new Date(`${yyyy}-${mm}-${dd}T00:00:00-03:00`).getTime();\n};\n\n// pega o intervalo vindo do primeiro Code\nconst data_ini = $item(0).$node[\"Code\"].json.data_ini;\nconst data_fim = $item(0).$node[\"Code\"].json.data_fim;\nconst tIni = parseBR(data_ini);\nconst tFim = parseBR(data_fim);\n\nconst out = $input.all().filter(it => {\n  const st = (it.json.status || '').toLowerCase();\n  const t  = parseBR(it.json.data_processamento);\n  return st === 'postado' && !Number.isNaN(t) && t >= tIni && t <= tFim;\n});\n\nreturn out;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[944,752],"id":"e222a572-1da2-4bab-ad44-118fb1e768bb","name":"Code2"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      data: {\n        video_url: \"https://files2.heygen.ai/aws_pacific/avatar_tmp/a9aa544acbb146b6a5840d1ef362c9e7/57f41a9d4935419ea64aa4d2c391c2db.mp4?Expires=1756456832&Signature=ic-naL39hFs4zU~UwjOjCsrVQtCQrRB3b49MMIYU3zaLF2AaoasQ5UrlYyAHJftFIrDbKuPIvNjucZi--nKdbUgb~UdsE1whuYgv3bCPv7~2FWNx9o8YQR1MYn6OukgpQ-UqLKDD43InSRhaSBINJ-LyudIITaufOrlo0dEOG2NetVEgDg-iCVPqomnXbh1NluCzSCZWtoaC-16iURRDvC2DeNqPUXy7OjlIdKk6dTiN~EOxpqchFNy64jU0bNIouD25UP9h-E5SgbrqfgQrmcMCVohlXNM~yn51BSjpNvG6lTq7ubl47a7LEtAuK~lvdAW3i2qofEmEFf1Pu~fPOw__&Key-Pair-Id=K38HBHX5LX3X2H\"\n      }\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3344,432],"id":"6d2c9ab1-0013-451a-8050-87780d6a4539","name":"Code4","disabled":true},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[3104,432],"id":"3483e9f7-b1ef-48f5-bc9a-c57fae33be05","name":"When clicking ‚ÄòExecute workflow‚Äô","disabled":true},{"parameters":{"fileSelector":"=/tmp/n8n/{{$workflow.id}}/{{$execution.id}}/out.mp4","options":{}},"type":"n8n-nodes-base.readWriteFile","typeVersion":1,"position":[5104,752],"id":"d07303ed-52bf-48d1-b557-6cc10d8f001a","name":"Pegar o video editado da VPS"},{"parameters":{"operation":"write","fileName":"=/tmp/n8n/{{$workflow.id}}/{{$execution.id}}/in.mp4","dataPropertyName":"=data","options":{"append":false}},"type":"n8n-nodes-base.readWriteFile","typeVersion":1,"position":[4352,736],"id":"17b17f33-6733-4bbb-9368-7cca64cce7f1","name":"Salvar video na VPS"},{"parameters":{"command":"=set -e\n\nWD=\"/tmp/n8n/{{$workflow.id}}/{{$execution.id}}\"\nIN=\"$WD/in.mp4\"\nOUT=\"$WD/out.mp4\"\nSUB=\"$WD/srt.srt\"\nBGM=\"/home/node/.n8n/assets/trilha_finamob.mp3\"\n\nmkdir -p \"$WD\"\n[ -s \"$IN\" ] || { echo \"ERRO: input n√£o encontrado: $IN\"; exit 1; }\n\n# Recorta para 9:16 e d√° upscale para 1080x1920\nVF=\"crop=in_h*9/16:in_h:(in_w-in_h*9/16)/2:0,scale=1080:1920\"\n\n# Embute SRT se existir (escapa path p/ filtro subtitles)\nif [ -s \"$SUB\" ]; then\n  ESC_SUB=\"$(printf \"%s\" \"$SUB\" | sed -e 's/\\\\/\\\\\\\\/g' -e 's/:/\\\\:/g' -e \"s/'/\\\\\\\\'/g\")\"\n  VF=\"$VF,subtitles='$ESC_SUB':charenc=UTF-8\"\n  echo \"Legenda encontrada em $SUB - ser√° embutida.\"\nelse\n  echo \"AVISO: legenda n√£o encontrada em $SUB; seguindo sem SRT.\"\nfi\n\nif [ -s \"$BGM\" ]; then\n  # Com trilha: mixa a voz do v√≠deo (0:a) com a trilha (1:a) em ~18%\n  ffmpeg -hide_banner -y \\\n    -i \"$IN\" \\\n    -stream_loop -1 -i \"$BGM\" \\\n    -vf \"$VF\" \\\n    -filter_complex \"[1:a]volume=0.18[bg];[0:a][bg]amix=inputs=2:duration=shortest:dropout_transition=2[a]\" \\\n    -map 0:v -map \"[a]\" \\\n    -c:v libx264 -preset veryfast -crf 22 -pix_fmt yuv420p \\\n    -c:a aac -b:a 192k -shortest -movflags +faststart \\\n    \"$OUT\"\nelse\n  # Sem trilha: usa s√≥ √°udio do v√≠deo (ou nenhum, se n√£o houver)\n  ffmpeg -hide_banner -y \\\n    -i \"$IN\" \\\n    -vf \"$VF\" \\\n    -map 0:v -map 0:a? \\\n    -c:v libx264 -preset veryfast -crf 22 -pix_fmt yuv420p \\\n    -c:a aac -b:a 192k -shortest -movflags +faststart \\\n    \"$OUT\"\nfi\n\nprintf %s \"$OUT\"\n"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[4832,752],"id":"fad836ab-ca6c-49d5-a6b2-922383de376f","name":"Editar Video - ffmpeg"},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2432,752],"id":"26ca7b29-762e-4385-a46a-e7e28569e856","name":"Code3"},{"parameters":{"operation":"toText","sourceProperty":"=srt","binaryPropertyName":"srt","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3280,1040],"id":"48211b6c-1d29-4201-976d-6c91189ff458","name":"Convert to File"},{"parameters":{"jsCode":"// Code node (n8n) ‚Äî Gera SRT a partir do texto em $json.output (Agent Heygen)\n\nconst RAW =\n  ($json?.output ?? \"\") || // sa√≠da do Agent Heygen (direto)\n  ($json?.script ?? $json?.message ?? \"\"); // fallbacks opcionais\n\nconst textIn = RAW.toString().trim();\nif (!textIn) {\n  throw new Error(\"Faltou texto no $json.output (ou script/message).\");\n}\n\n// --- Sanitiza√ß√£o opcional ---\nlet text = textIn;\n// remover URLs\ntext = text.replace(/https?:\\/\\/\\S+/gi, \"\").trim();\n// remover marcas markdown simples e converter [texto](url) -> texto\ntext = text\n  .replace(/\\[(.*?)\\]\\((.*?)\\)/g, \"$1\")\n  .replace(/[*_~`>#-]/g, \"\")\n  .replace(/\\s{2,}/g, \" \")\n  .trim();\n\n// --- Par√¢metros de timing/legibilidade ---\nconst CPS = 13;      // caracteres por segundo\nconst MIN = 1.2;     // dura√ß√£o m√≠nima por bloco (s)\nconst MAX = 5.0;     // dura√ß√£o m√°xima por bloco (s)\nconst MAX_LINE = 42; // m√°x. de chars por linha (at√© 2 linhas)\n\n// Helpers\nconst pad = (n, p = 2) => String(n).padStart(p, \"0\");\nconst fmt = (t) => {\n  const h = Math.floor(t / 3600);\n  const m = Math.floor((t % 3600) / 60);\n  const s = Math.floor(t % 60);\n  const ms = Math.round((t - Math.floor(t)) * 1000);\n  return `${pad(h)}:${pad(m)}:${pad(s)},${pad(ms, 3)}`;\n};\n\nfunction splitSentences(t) {\n  // quebra por pontua√ß√£o final OU quebras de linha\n  return t\n    .replace(/\\r/g, \"\")\n    .split(/(?<=[\\.\\?\\!])\\s+|\\n+/)\n    .map((s) => s.trim())\n    .filter(Boolean);\n}\n\nfunction breakLines(s, max = MAX_LINE) {\n  const words = s.split(/\\s+/);\n  let lines = [\"\"];\n  for (const w of words) {\n    const put = (lines[lines.length - 1] + \" \" + w).trim();\n    if (put.length > max && lines.length < 2) lines.push(w);\n    else lines[lines.length - 1] = put;\n  }\n  return lines.join(\"\\n\");\n}\n\n// Gera√ß√£o do SRT\nconst sentences = splitSentences(text);\nlet cur = 0;\nlet idx = 1;\nlet srt = \"\";\n\nfor (const s of sentences) {\n  const dur = Math.max(MIN, Math.min(MAX, s.length / CPS));\n  const start = cur;\n  const end = cur + dur;\n  srt += `${idx}\\n${fmt(start)} --> ${fmt(end)}\\n${breakLines(s)}\\n\\n`;\n  cur = end + 0.1; // pequena folga entre blocos\n  idx++;\n}\n\nreturn [\n  {\n    json: {\n      srt,                                  // conte√∫do do arquivo .srt\n      srtFileName: `sub_${$execution.id}.srt`, // nome sugerido\n      textUsed: text                         // (opcional) texto p√≥s-limpeza\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2656,1040],"id":"018cded2-84ea-43d1-a918-4563c40f2cb1","name":"Gerar Legenda"},{"parameters":{"operation":"write","fileName":"=/tmp/n8n/{{$workflow.id}}/{{$execution.id}}/srt.srt","dataPropertyName":"=srt","options":{}},"type":"n8n-nodes-base.readWriteFile","typeVersion":1,"position":[3984,1040],"id":"7f77f4f1-ce19-420c-801b-f5cefb55bbc8","name":"Salvar srt na VPS"},{"parameters":{"content":"## Para testes","height":240,"width":848,"color":5},"type":"n8n-nodes-base.stickyNote","position":[3008,368],"typeVersion":1,"id":"9f8a1089-b2a5-47f8-8bfd-7b5402f3e256","name":"Sticky Note5"},{"parameters":{"command":"set -e\necho \"LISTA /tmp/n8n\"\nls -la /tmp/n8n || true\n\necho \"----- PRIMEIRAS LINHAS DA LEGENDA -----\"\nif [ -f /tmp/n8n/srt.srt ]; then\n  echo \"Arquivo existe: /tmp/n8n/srt.srt\"\n  wc -c /tmp/n8n/srt.srt\n  head -n 12 /tmp/n8n/srt.srt\nelse\n  echo \"NAO ENCONTREI: /tmp/n8n/srt.srt\"\nfi\n"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[3584,432],"id":"30510565-201b-4480-90ae-61574c7b631d","name":"Execute Command","disabled":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[4608,752],"id":"486b10fe-b200-4a1c-a293-4b098ad4d2a9","name":"Merge"},{"parameters":{"command":"=rm -rf \"/tmp/n8n/{{$workflow.id}}/{{$execution.id}}\" || true"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[5504,752],"id":"8ff1568f-505d-4af2-a8ed-92538b7591fa","name":"Execute Command1"},{"parameters":{"command":"=mkdir -p \"/tmp/n8n/{{$workflow.id}}/{{$execution.id}}\""},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[3936,736],"id":"806eaa28-8685-4e86-a22c-4ac0dfdc2a8f","name":"Execute Command2"}],"connections":{"Schedule Trigger1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Code2","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Code1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Seta Infos":{"main":[[{"node":"Cria Video","type":"main","index":0}]]},"Cria Video":{"main":[[{"node":"Espera 1 min","type":"main","index":0}]]},"Espera 1 min":{"main":[[{"node":"Pega status do video","type":"main","index":0}]]},"Pega status do video":{"main":[[{"node":"Valida se est√° no status: Completed","type":"main","index":0}]]},"Valida se est√° no status: Completed":{"main":[[{"node":"Seta URL do Video","type":"main","index":0}],[{"node":"Espera 1 min","type":"main","index":0}]]},"Seta URL do Video":{"main":[[{"node":"Execute Command2","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Agent HeyGen","type":"ai_languageModel","index":0}]]},"AI Agent1":{"main":[[{"node":"Agent HeyGen","type":"main","index":0}]]},"Agent HeyGen":{"main":[[{"node":"Code3","type":"main","index":0},{"node":"Gerar Legenda","type":"main","index":0}]]},"Faz o Download do Video":{"main":[[{"node":"Salvar video na VPS","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code4":{"main":[[]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Code4","type":"main","index":0}]]},"Salvar video na VPS":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Editar Video - ffmpeg":{"main":[[{"node":"Pegar o video editado da VPS","type":"main","index":0}]]},"Enviar video":{"main":[[{"node":"Execute Command1","type":"main","index":0}]]},"Code3":{"main":[[{"node":"Seta Infos","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"Salvar srt na VPS","type":"main","index":0}]]},"Gerar Legenda":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Salvar srt na VPS":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Pegar o video editado da VPS":{"main":[[{"node":"Enviar video","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Editar Video - ffmpeg","type":"main","index":0}]]},"Execute Command2":{"main":[[{"node":"Faz o Download do Video","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"Cem9y3zmcggUQhrp"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"8930cb44-b0ad-4f5f-beef-850ac56016b4","triggerCount":1,"tags":[]}