{"createdAt":"2025-11-03T21:50:36.179Z","updatedAt":"2025-11-03T22:02:14.902Z","id":"YccLaM9IWSOTnAED","name":"BMS - 1.3 - Journal - Post X","active":false,"isArchived":false,"nodes":[{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v22.0","node":"={{ $('Instagram params1').item.json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"media_type","value":"=CAROUSEL"},{"name":"children","value":"={{ JSON.stringify([\n  $(\"Instagram prepare media (img1)\").first().json.id,\n  $(\"Instagram prepare media (img2)\").first().json.id,\n  $(\"Instagram prepare media (img3)\").first().json.id,\n  $(\"Instagram prepare media (img4)\").first().json.id\n]) }}\n"},{"name":"caption","value":"={{ $('Instagram params1').item.json.instagram_post_caption }}"}]}}},"id":"f28f3657-87ba-41c3-9a1c-ec5871c2a6fe","name":"Instagram create carousel","type":"n8n-nodes-base.facebookGraphApi","position":[1472,2736],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url || $json.imagem_url }}"},{"name":"is_carousel_item","value":"true"}]}}},"id":"1f435f56-e96d-4990-9923-1a4ffb6ec51d","name":"Instagram prepare media (img1)","type":"n8n-nodes-base.facebookGraphApi","position":[1056,2432],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url2 || $json.imagem_url2 }}"},{"name":"is_carousel_item","value":"true"}]}}},"id":"3ca9bb91-61f6-48f9-b923-ff45d8e2231e","name":"Instagram prepare media (img2)","type":"n8n-nodes-base.facebookGraphApi","position":[1056,2592],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"mode":"chooseBranch","numberInputs":4,"useDataOfInput":2},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1296,2704],"id":"b782864b-7694-465e-80dd-0e71d9dd900b","name":"Merge"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1ac6e4fc-79b5-4afe-995e-667324f0a8cf","leftValue":"={{ $json.id }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1680,2816],"id":"0d428fb6-98af-4028-828b-2194ea2c01c9","name":"If","retryOnFail":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status_code }}","rightValue":"FINISHED","operator":{"type":"string","operation":"equals"},"id":"53932f8e-2f9a-40d2-a8bf-2abf93656808"}],"combinator":"and"},"renameOutput":true,"outputKey":"FINISHED"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7089f8c6-8c1c-482e-b30d-47e92e2753bf","leftValue":"={{ $json.status_code }}","rightValue":"IN_PROGRESS","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IN_PROGRESS"}]},"options":{"fallbackOutput":"extra"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2128,2784],"id":"dbd7097f-69e6-4a67-a82b-f1bab35fb3cf","name":"Switch"},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url3 || $json.imagem_url3 }}"},{"name":"is_carousel_item","value":"true"}]}}},"id":"49644ad9-fdc6-40e3-8e66-32bbe7130afd","name":"Instagram prepare media (img3)","type":"n8n-nodes-base.facebookGraphApi","position":[1056,2784],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url4 || $json.imagem_url4 }}"},{"name":"is_carousel_item","value":"true"}]}}},"id":"ab06e288-b41e-43af-8bfc-a29621cebc82","name":"Instagram prepare media (img4)","type":"n8n-nodes-base.facebookGraphApi","position":[1056,2976],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $('Instagram params1').item.json.instagram_business_account_id }}","edge":"media_publish","options":{"queryParameters":{"parameter":[{"name":"creation_id","value":"={{ $json.id }}"}]}}},"id":"f802f9de-d53a-4d1f-baf2-1e3e6afabb03","name":"Instagram publish media1","type":"n8n-nodes-base.facebookGraphApi","position":[2400,2720],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"content":"Add your credential","height":910,"width":2738},"id":"9fabe78f-074c-4a01-8e7c-318c6a2c36eb","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[912,2352],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"68b89233-2740-4afd-a95c-72ed537d12e5","name":"noticia_id","value":"={{ $json.noticia_id }}","type":"string"},{"id":"225df266-bf29-4415-b04c-2750cef4506a","name":"image_url","type":"string","value":"={{ $json.imagem_url }}"},{"id":"42e44a66-490d-453f-8746-87e201e58f6c","name":"image_url2","value":"={{ $json.imagem_url2 }}","type":"string"},{"id":"f64af4b7-c2de-4003-9076-51df6440cf84","name":"image_url3","value":"={{ $json.imagem_url3 }}","type":"string"},{"id":"3c87a05d-55a0-4344-9570-4e465d0ce6e7","name":"image_url4","value":"https://raw.githubusercontent.com/getmia-ia/Mia/main/MIA_Final_Post_Fixo.jpg","type":"string"},{"id":"1e380c14-e908-4eeb-90e0-957a422829d0","name":"instagram_business_account_id","type":"string","value":"17841475443525557"},{"id":"f35e3093-1bff-4cc6-a6c4-909dca314cc7","name":"instagram_post_caption","type":"string","value":"={{ $json.legenda }}"}]},"options":{}},"id":"698846f0-a22a-4fee-b5ad-9b120180612f","name":"Instagram params1","type":"n8n-nodes-base.set","position":[736,2688],"typeVersion":3.4},{"parameters":{"graphApiVersion":"v20.0","node":"=me","options":{"fields":{"field":[{"name":"name"},{"name":"connected_instagram_account"}]}}},"id":"d4c7a873-6cdd-4642-a4a2-1ebd52910820","name":"Node just for retrive id of instagram page1","type":"n8n-nodes-base.facebookGraphApi","position":[304,2352],"typeVersion":1,"disabled":true},{"parameters":{"content":"You can use this node if you want to retrieve the instagram id. \n\nAdd it to the workflow ore use manually","height":289,"width":318},"id":"25af3ae3-b4d8-4a1c-8c94-e61ca8b219d2","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[192,2240],"typeVersion":1},{"parameters":{"content":"Here we have all parameters for posting in instagram image url, caption and instagram business profile id","height":310,"width":188,"color":3},"id":"1f102317-6cc0-4aa0-914a-39eee45c21d3","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[688,2544],"typeVersion":1},{"parameters":{"content":"## Permissions\nPublishing relies on a combination of the following permissions. The exact combination depends on which endpoints your app uses. Refer to our endpoint references to determine which permissions each endpoint requires.\n\nads_management\nbusiness_management\ninstagram_basic\ninstagram_content_publish\npages_read_engagement\nIf your app will be used by app users who do not have a role on your app or a role in a Business that has claimed your app, you must request approval for each permission via App Review before non-role app users can grant them to your app.\n\n## Limitations\nJPEG is the only image format supported. Extended JPEG formats such as MPO and JPS are not supported.\nShopping tags are not supported.\nBranded content tags are not supported.\nFilters are not supported.\nPublishing to Instagram TV is not supported.\nFor additional limitations, refer to each endpoint's reference.\n\n## Rate Limit\nInstagram accounts are limited to 50 API-published posts within a rolling 24-hour period. Carousels count as a single post. This limit is enforced on the POST /{ig-user-id}/media_publish endpoint when attempting to publish a media container. We recommend that your app also enforce the publishing rate limit, especially if your app allows app users to schedule posts to be published in the future.\n\nTo check an Instagram Professional account's current rate limit usage, query the GET /{ig-user-id}/content_publishing_limit endpoint.","height":792,"width":439.10253951549294,"color":7},"id":"b95f5eb3-95b7-4132-82e5-db90623622b1","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[224,2896],"typeVersion":1},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"FINISHED"}],"combinator":"and"},"options":{}},"id":"b7c81f1f-7cad-43bf-b201-017b607a26f5","name":"If media status is finished2","type":"n8n-nodes-base.if","position":[2128,2528],"typeVersion":2.2,"disabled":true},{"parameters":{"graphApiVersion":"v20.0","node":"={{ $('Instagram check status of media uploaded before1').item.json.id }}","options":{"fields":{"field":[{"name":"id"},{"name":"status"},{"name":"status_code"}]}}},"id":"e0c99c5c-f487-4c04-b5a2-91a4ab0c0d05","name":"Instagram check status of media published before1","type":"n8n-nodes-base.facebookGraphApi","position":[2608,2720],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"PUBLISHED"}]},"options":{}},"id":"da90b472-3fb9-4aa2-a0a1-00f69d0e8c66","name":"If media status is finished3","type":"n8n-nodes-base.if","position":[2800,2720],"typeVersion":2.2},{"parameters":{"content":"You can send email for unsuccessful upload or what you want, you can trigger another workflow or another node","height":102.11100456713636,"color":3},"id":"da35b3c3-dea6-4a85-b16e-bd64b201b16c","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[1936,3072],"typeVersion":1},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"54fa4546-8262-4651-9b0e-ce3a2f66416f","leftValue":"={{ $json.status }}","rightValue":"aprovado","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[416,2704],"id":"8d2a2ee7-4323-4a30-b4ec-49c2a434d004","name":"If9"},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post MIA falhou!","message":"Post MIA falhou!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2400,2928],"id":"24178b56-bed3-4d6e-bf9a-b0a7bbe38e1f","name":"Send a message3","webhookId":"dab17c09-1c6d-4e1b-91cb-5651c9e0cd08","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post MIA deu certo!","message":"Post MIA deu certo!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[3024,2688],"id":"99d32ad2-bf53-4a75-bbc8-a1419aa014ce","name":"Send a message4","webhookId":"7c204b63-9475-4b0c-aa70-3ef88b0919f2","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post MIA falhou 2!","message":"Post MIA falhou 2!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[3024,2864],"id":"7ba5caba-f60e-4086-9144-ab408a28fcac","name":"Send a message5","webhookId":"ba7390b3-bbbe-4341-b0cb-238080aa9449","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"content":"# Ação de postar no Instagram\n\n### Aqui cadastramos os tokens necessários para a API do Meta\n### O post é realizado no mesmo momento em que a aprovação acontece","height":1696,"width":3936,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-192,2048],"typeVersion":1,"id":"6b95baae-bb10-4f4c-a7f5-d5c91d3c30d6","name":"Sticky Note15"},{"parameters":{"assignments":{"assignments":[{"id":"f2c98e3a-ba6b-4df7-a0c9-96994c91a690","name":"noticia_id","value":"={{ $('Instagram params1').item.json.noticia_id }}","type":"string"},{"id":"a95682ad-ea9c-4d88-a370-0ffad2b3eea5","name":"status","value":"postado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3248,2688],"id":"a053e98b-2eb5-4d04-b472-a45a5be4f0af","name":"Edit Fields1"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-128,2704],"id":"662feafb-7879-49ed-a18a-ded3aa812f02","name":"Schedule Trigger1"},{"parameters":{"documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"aprovado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[48,2704],"id":"e7141f39-733a-4b22-95c5-f41e7f5adb9f","name":"Get row(s) in sheet1","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"// Garante 1 por execução (pega a primeira \"aprovado\")\nconst rows = items.map(i => i.json);\n\nconst isApproved = (v) =>\n  String(v || '').trim().toLowerCase() === 'aprovado';\n\nconst first = rows.find(r =>\n  isApproved(r.status) &&\n  r.noticia_id &&\n  (r.imagem_url || r.imagem) &&\n  r.legenda\n);\n\nif (!first) return []; // nada a postar neste horário\n\nconst out = { ...first };\nout.imagem_url = first.imagem_url || first.imagem;\nreturn [{ json: out }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[240,2704],"id":"6f5e6a29-750e-4da9-94a9-6aaedbcb8f81","name":"Code1"},{"parameters":{"graphApiVersion":"v20.0","node":"={{ $json.id }}","options":{"fields":{"field":[{"name":"id"},{"name":"status"},{"name":"status_code"}]}}},"id":"c34e34ce-eb2b-49a8-a2f4-ecb3cf199d8c","name":"Instagram check status of media uploaded before1","type":"n8n-nodes-base.facebookGraphApi","position":[1936,2800],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"dkFyHSyOCKuDpU6q","name":"Facebook Graph account"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo2_base64","displayName":"arquivo2_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"arquivo3_base64","displayName":"arquivo3_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url2","displayName":"imagem_url2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"imagem_url3","displayName":"imagem_url3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[3440,2688],"id":"5e5cbd6a-87d4-4e46-a5ff-7d89584563fa","name":"Update row in sheet1","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"mode":"url","value":"={{ $json['X image'] }}"},"options":{}},"id":"0b8a8230-c70c-4652-afb4-61369fff16bd","name":"Get image","type":"n8n-nodes-base.googleDrive","position":[2064,4048],"typeVersion":3,"credentials":{"googleDriveOAuth2Api":{"id":"8G4VgOQRG6X5KJnF","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"54fa4546-8262-4651-9b0e-ce3a2f66416f","leftValue":"={{ $json.status }}","rightValue":"aprovado","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1472,4016],"id":"d7b746ce-7596-4d5c-b21a-430bf3b2d3f9","name":"If10"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[928,4016],"id":"f3e0eec6-c09b-47ce-bc83-74dac8832e95","name":"Schedule Trigger"},{"parameters":{"documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"aprovado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1104,4016],"id":"e1faac04-49a5-4257-bdda-7fbfaf2f0cdf","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"// Garante 1 por execução (pega a primeira \"aprovado\")\nconst rows = items.map(i => i.json);\n\nconst isApproved = (v) =>\n  String(v || '').trim().toLowerCase() === 'aprovado';\n\nconst first = rows.find(r =>\n  isApproved(r.status) &&\n  r.noticia_id &&\n  (r.imagem_url || r.imagem) &&\n  r.legenda\n);\n\nif (!first) return []; // nada a postar neste horário\n\nconst out = { ...first };\nout.imagem_url = first.imagem_url || first.imagem;\nreturn [{ json: out }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1296,4016],"id":"0807ef0c-d620-4f10-b09b-f4aa22aa78b1","name":"Code"},{"parameters":{"method":"POST","url":"https://upload.twitter.com/1.1/media/upload.json","authentication":"predefinedCredentialType","nodeCredentialType":"twitterOAuth1Api","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"media","inputDataFieldName":"data"}]},"options":{}},"id":"1f584486-1f4d-4ead-9b9d-c9ece0c940c8","name":"Sobe img no X","type":"n8n-nodes-base.httpRequest","position":[2288,4048],"typeVersion":4.2},{"parameters":{"text":"={{ \n  $('Get valid content').item.json['X post'].length > 280 \n    ? $('Get valid content').item.json['X post']\n        .replace(/(\\s+#\\w+)+$/,'')\n        .slice(0, 280)\n    : $('Get valid content').item.json['X post'] \n}}","additionalFields":{"attachments":"={{ $json.media_id_string }}"}},"id":"6fabb607-e5d9-44da-87fa-54287362b93b","name":"Cria tweet","type":"n8n-nodes-base.twitter","position":[2512,4048],"typeVersion":2},{"parameters":{"assignments":{"assignments":[{"id":"68b89233-2740-4afd-a95c-72ed537d12e5","name":"noticia_id","value":"={{ $json.noticia_id }}","type":"string"},{"id":"225df266-bf29-4415-b04c-2750cef4506a","name":"image_url","type":"string","value":"={{ $json.imagem_url }}"},{"id":"42e44a66-490d-453f-8746-87e201e58f6c","name":"image_url2","value":"={{ $json.imagem_url2 }}","type":"string"},{"id":"f64af4b7-c2de-4003-9076-51df6440cf84","name":"image_url3","value":"={{ $json.imagem_url3 }}","type":"string"},{"id":"3c87a05d-55a0-4344-9570-4e465d0ce6e7","name":"image_url4","value":"https://raw.githubusercontent.com/getmia-ia/BMS/main/BMS-Final.jpg","type":"string"},{"id":"1e380c14-e908-4eeb-90e0-957a422829d0","name":"instagram_business_account_id","type":"string","value":"17841475443525557"},{"id":"f35e3093-1bff-4cc6-a6c4-909dca314cc7","name":"instagram_post_caption","type":"string","value":"={{ $json.legenda }}"}]},"options":{}},"id":"1feb6c9f-23e8-419e-abe8-6c7bf6fc8355","name":"X parametros","type":"n8n-nodes-base.set","position":[1680,4000],"typeVersion":3.4},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA","mode":"list","cachedResultName":"BMS - Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"param_2","displayName":"param_2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"param_3","displayName":"param_3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"param_4","displayName":"param_4","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo2_base64","displayName":"arquivo2_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo3_base64","displayName":"arquivo3_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url2","displayName":"imagem_url2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url3","displayName":"imagem_url3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"X","displayName":"X","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[3392,4016],"id":"cc8e1780-d4ea-46c6-a1cb-7b1daa21c247","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"f2c98e3a-ba6b-4df7-a0c9-96994c91a690","name":"noticia_id","value":"={{ $('X parametros').item.json.noticia_id }}","type":"string"},{"id":"a95682ad-ea9c-4d88-a370-0ffad2b3eea5","name":"status","value":"postado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3216,4016],"id":"a0a9d343-865e-46cf-8b73-568120c91c40","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"PUBLISHED"}]},"options":{}},"id":"fc974fcd-b7ce-4811-ae47-25303a41efed","name":"If media status is finished","type":"n8n-nodes-base.if","position":[2720,4048],"typeVersion":2.2},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post MIA deu certo!","message":"Post BMS X deu certo!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2944,4016],"id":"dc723463-2fa8-4414-bb15-85b846dc3135","name":"Send a message","webhookId":"7c204b63-9475-4b0c-aa70-3ef88b0919f2","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post MIA falhou 2!","message":"Post BMS X falhou 2!","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2944,4192],"id":"3cb0a7e1-1907-4d43-98a8-3b23ddcdf071","name":"Send a message6","webhookId":"ba7390b3-bbbe-4341-b0cb-238080aa9449","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}}],"connections":{"Instagram create carousel":{"main":[[{"node":"If","type":"main","index":0}]]},"Instagram prepare media (img1)":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Instagram prepare media (img2)":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Instagram create carousel","type":"main","index":0}]]},"If":{"main":[[{"node":"Instagram check status of media uploaded before1","type":"main","index":0}],[{"node":"Instagram create carousel","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Instagram publish media1","type":"main","index":0}],[{"node":"Instagram check status of media uploaded before1","type":"main","index":0}],[{"node":"Send a message3","type":"main","index":0}]]},"Instagram prepare media (img3)":{"main":[[{"node":"Merge","type":"main","index":2}]]},"Instagram prepare media (img4)":{"main":[[{"node":"Merge","type":"main","index":3}]]},"Instagram publish media1":{"main":[[{"node":"Instagram check status of media published before1","type":"main","index":0}]]},"Instagram params1":{"main":[[{"node":"Instagram prepare media (img1)","type":"main","index":0},{"node":"Instagram prepare media (img2)","type":"main","index":0},{"node":"Instagram prepare media (img3)","type":"main","index":0},{"node":"Instagram prepare media (img4)","type":"main","index":0}]]},"Instagram check status of media published before1":{"main":[[{"node":"If media status is finished3","type":"main","index":0}]]},"If media status is finished3":{"main":[[{"node":"Send a message4","type":"main","index":0}],[{"node":"Send a message5","type":"main","index":0}]]},"If9":{"main":[[{"node":"Instagram params1","type":"main","index":0}]]},"Send a message4":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Update row in sheet1","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Get row(s) in sheet1","type":"main","index":0}]]},"Get row(s) in sheet1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"If9","type":"main","index":0}]]},"Instagram check status of media uploaded before1":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Get image":{"main":[[{"node":"Sobe img no X","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"If10","type":"main","index":0}]]},"Sobe img no X":{"main":[[{"node":"Cria tweet","type":"main","index":0}]]},"Cria tweet":{"main":[[]]},"If10":{"main":[[{"node":"X parametros","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]},"If media status is finished":{"main":[[{"node":"Send a message","type":"main","index":0}],[{"node":"Send a message6","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"QdC9qh9DPcT2xcoq"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","sheetId":0,"lastRevision":764,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek&revision=764&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"cc2e0b45-06c9-4e95-8bfa-5a87b1fc0e78","triggerCount":1,"tags":[]}