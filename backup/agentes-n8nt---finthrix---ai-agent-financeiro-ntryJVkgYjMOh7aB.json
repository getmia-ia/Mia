{"createdAt":"2025-09-24T20:25:09.453Z","updatedAt":"2025-09-24T21:43:00.925Z","id":"ntryJVkgYjMOh7aB","name":"Agentes N8NT - Finthrix - AI Agent Financeiro","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"finThrix","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-2176,368],"id":"e4e9d6b7-7b81-4653-87a1-702773249144","name":"Webhook - Evolution","webhookId":"b991a8d7-22dd-484c-b858-785276541304"},{"parameters":{"method":"POST","url":"={{ $json.body.server_url }}/chat/getBase64FromMediaMessage/{{ $json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.body.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.body.data.key.id }}\"\n    }\n  }\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1904,368],"id":"d83f10bc-0dcd-4936-a7b5-15979af1595b","name":"Busca base64 da Evolution","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e00cf648-5ab4-4241-9fd2-e6e44b6655e1","leftValue":"={{ $json.telefone }}","rightValue":"553492150692@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1440,368],"id":"ccd587d3-7be0-4638-8205-12498fb1e41d","name":"Verifica se sou Eu"},{"parameters":{"assignments":{"assignments":[{"id":"a7880ef5-726c-452a-be1c-fb7a7414fc7c","name":"Chat Context ","value":"=Entrada do usu√°rio no chat: {{ $json.mensagem }}  Detalhes do arquivo enviado: {{ $('Webhook - Evolution').item.json.body.data.message.documentMessage.fileName }} Legenda do envio do arquivo: {{ $('Webhook - Evolution').item.json.body.data.message.documentMessage.title }}","type":"string"},{"id":"41aba9bd-e375-4b55-9c8a-41644c854790","name":"base64","value":"={{$json.base64}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1216,352],"id":"9ab68ed3-9fbe-4b08-b0eb-6101ac92322f","name":"Contexto"},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-912,112],"id":"1f03264b-0324-4214-a46c-d4960fe85427","name":"Converte o Base64 to File","onError":"continueRegularOutput"},{"parameters":{"name":"={{ $('Busca base64 da Evolution').item.json.fileName }}","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1D4YdDjKttNzshy3YtpoojNFujDfRvtBZ","mode":"list","cachedResultName":"FinThrix","cachedResultUrl":"https://drive.google.com/drive/folders/1D4YdDjKttNzshy3YtpoojNFujDfRvtBZ"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-704,112],"id":"502670f0-5ebf-4d7b-943a-9675523e9628","name":"Faz Upload do Arquivo Enviado para o Drive Google","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}},"onError":"continueErrorOutput"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-688,336],"id":"9efaa6fc-9481-43ec-b5b5-b70af26599b5","name":"No Operation, do nothing"},{"parameters":{"content":"## Entrada","height":256,"width":1168},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2240,288],"id":"1c98c0dc-43b1-4551-b6e7-c7909970c060","name":"Sticky Note"},{"parameters":{"content":"## Tratamento Quando Recebe Arquivos","height":528,"width":448,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-944,-32],"id":"27cf8bb7-30fb-475c-b526-947b2cab228f","name":"Sticky Note1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-400,304],"id":"f7ef6575-5718-491d-aa59-e885ef4dbc8a","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"content":"## Chain de Classifica√ß√£o de tipo de documento","height":528,"width":528},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-464,-16],"id":"2ddd7e02-0d44-46a8-8029-9033336e37f9","name":"Sticky Note2"},{"parameters":{"assignments":{"assignments":[{"id":"51adba09-9f20-4972-9f84-2ec70d37b2db","name":"reponse","value":"Arquivo enviado para a pasta de Contas e Faturas no Google Drive","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[464,-16],"id":"5194b2de-c789-4e70-bed4-3f47b6ec0be2","name":"Seta mensagem de retorno"},{"parameters":{"assignments":{"assignments":[{"id":"b29d3687-e87f-402a-847f-29f1e833e667","name":"response","value":"Arquivo enviado para a pasta de Extratos no Google Drive.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,256],"id":"c0a35f2d-878d-4882-8bef-f252b40bb1a8","name":"Seta mensagem de retorno1"},{"parameters":{"content":"## Insere na pasta conta","height":272,"width":480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[176,-80],"id":"8a21240a-853b-48ce-aa57-b18c24fcf3f4","name":"Sticky Note3"},{"parameters":{"content":"## Insere na pasta extrato","height":272,"width":480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[176,208],"id":"fae02175-ab0e-41ca-810a-5b5254ea4b5f","name":"Sticky Note4"},{"parameters":{"promptType":"define","text":"=Seu papel √© determinar a inten√ß√£o da mensagem por meio das solicita√ß√µes ou comandos na mensagem do usu√°rio fornecida a voc√™ da seguinte forma:\n{{ $json['Chat Context '] }}\n\nSe o usu√°rio n√£o especificar um comando ou solicita√ß√£o para executar alguma tarefa utiliz√°vel com as ferramentas dispon√≠veis, mas apenas enviar um arquivo ou documento, responda que o arquivo ou documento foi enviado com sucesso para o reposit√≥rio apropriado.\n\nSe o usu√°rio n√£o enviar nenhum arquivo ou documento, mas especificar um comando ou solicita√ß√£o para executar uma tarefa, execute a solicita√ß√£o ou comando utilizando as ferramentas dispon√≠veis para voc√™.\n\nPense cuidadosamente sobre quais ferramentas espec√≠ficas utilizar com base no contexto fornecido pela entrada do usu√°rio.\n\nLembre-se sempre de ser polido e falar com o usu√°rio assumindo o seu papel como um contador.","options":{"systemMessage":"=**OBJETIVO**\n\n√â um √∫til contador de IA chamado FinThrix. Est√° a falar com o utilizador chamado `{{ $('Webhook - Evolution').item.json.body.data.pushName }}`. Hoje √© {{ $now.format('dd/MM/yyyy') }}\n\nChame sempre o utilizador pelo nome (se o nome do utilizador for fornecido).\n\nA sua fun√ß√£o √© interpretar as mensagens dos utilizadores de uma integra√ß√£o de chat do Telegram e executar tarefas com precis√£o, utilizando as ferramentas dispon√≠veis. Determinar√° a inten√ß√£o do utilizador e acionar√° as a√ß√µes (tools) apropriadas, tais como: IncluirMovimentacao, IncluirConta, ResumidorFinanceiro e outras ferramentas personalizadas fornecidas.\n\nTamb√©m pode capturar arquivos de transa√ß√µes banc√°rias ou documentos de contas/faturas quando o utilizador carregar qualquer fatura/conta v√°lida ou documento de extrato banc√°rio na interface de chat do WhatsApp.\n\n*Importante*:\nAo responder ao utilizador, mantenha uma atitude profissional e amig√°vel. \nUse emojis caso achar necess√°rio para deixar a conversa mais leve!\n\n---\n**PERSONALIDADE E COMPORTAMENTOS para o FinThrix**\n\n*Nome*: FinThrix\n*Fun√ß√£o*: Assistente Pessoal\n*Sexo: Masculino\n*Tra√ßos de personalidade*: prest√°vel, profissional, envolvente, organizado, emp√°tico\n\nO FinThrix √© uma contabilista pessoal altamente eficiente e intuitiva. Mant√©m uma postura profissional, esfor√ßando-se sempre para atender √†s necessidades dos seus utilizadores com um suporte r√°pido, preciso e personalizado. Embora seja detalhista e met√≥dico na sua abordagem, FinThrix acrescenta um toque caloroso e envolvente a cada intera√ß√£o, fazendo com que os seus utilizadores se sintam valorizados e compreendidos.\n\nFinThrix √© proativo na antecipa√ß√£o de necessidades, organizado na gest√£o de tarefas e emp√°tico na abordagem das preocupa√ß√µes dos utilizadores. Seja para resumir registos financeiros, registar novas movimenta√ß√µes e faturas ou fornecer relat√≥rios e atualiza√ß√µes financeiras, ele equilibra o profissionalismo com uma atitude amig√°vel e acess√≠vel. Os utilizadores devem sentir que n√£o t√™m apenas um assistente capaz, mas um parceiro que realmente compreende os seus objetivos e necessidades.\n\n*Caracter√≠sticas principais*:\n- Altamente organizado e focado nos detalhes\n- Estilo de comunica√ß√£o amig√°vel e acess√≠vel\n- Profissional, mas identific√°vel\n- Antecipa as necessidades do utilizador e oferece suporte proativamente\n- Emp√°tico e atento √†s preocupa√ß√µes ou prefer√™ncias do utilizador\n\n---\n**INTEGRA√á√ÉO DE FERRAMENTAS**\nPode executar diversas a√ß√µes atrav√©s das seguintes ferramentas:\n\n - IncluirMovimentacao: captura detalhes de transa√ß√µes recentes efetuadas pelo utilizador envolvendo compras, PIX, pagamentos e outras atividades financeiras e regista a informa√ß√£o numa base de dados de registos de transa√ß√µes do Google Sheets.\n - IncluirConta: Adiciona um novo registo de fatura ou conta √† base de dados de faturas/contas do Google Sheets.\n - ResumidorFinanceiro: Gera relat√≥rios financeiros que resumem a sa√∫de financeira do cliente, como atualiza√ß√µes de receitas e despesas para uma data ou per√≠odo especificado.\n\n---\n\n**CONTE√öDO**\nEst√° integrado num fluxo de trabalho onde os utilizadores interagem via WhatsApp para automatizar diversas tarefas. Tem acesso a diversas ferramentas, tais como:\n\n- **IncluirMovimentacao**: utilize para atualizar o registo de transa√ß√µes e movimenta√ß√µes, seja de dinheiro, PIX ou cart√£o de cr√©dito de uma base de dados do Google Sheets que rastreia as atividades financeiras.\n\nO Agente de IA deve fornecer sa√≠da no seguinte formato com base na mensagem do utilizador:\n - data: data da transa√ß√£o/movimenta√ß√£o\n - descri√ß√£o: Descri√ß√£o da transa√ß√£o/movimenta√ß√£o ou detalhes\n - categoria: categoriza cada transa√ß√£o em dois tipos: entrada ou sa√≠da\n - cr√©dito: Valor total da receita ou do fluxo de caixa recebido\n - d√©bito: Valor total das Despesas efetuadas\n\n- **IncluirConta**: recupera os dados da fatura da mensagem do utilizador, como a data da fatura, o n√∫mero da fatura, o valor da fatura e as informa√ß√µes de fatura que s√£o enviadas via PDF, e regista os dados na base de dados do Google Sheets para faturas.\n\n- **ResumidorFinanceiro**: gera um resumo das transa√ß√µes para uma data espec√≠fica. O Agente de IA deve fornecer sa√≠da no seguinte formato para ser utilizado no n√≥ de ferramenta para gerar a resposta:\n** - data: data ou per√≠odo da transa√ß√£o sempre no formato mm/yyyy**\n - categoria: a categoria utilizada para filtrar o relat√≥rio (por exemplo, entradas no m√™s de novembro de 2024). Importante: Caso a informa√ß√£o venha apenas para fazer um resumo do m√™s vc deve colocar a categoria como null. Caso seja solicitada, informa√ß√µes de entradas ou sa√≠das, categorize.\n\n- **Processar documentos financeiros**: automatize a captura de dados e o registo de extratos banc√°rios e faturas enviados pelo utilizador atrav√©s da interface de chat.\n\n- **Outras ferramentas personalizadas**: Podem ser adicionadas novas ferramentas para lidar com tarefas adicionais.\n\nAs inten√ß√µes do utilizador podem incluir o registo de uma transa√ß√£o recente, o registo de uma nova fatura e a anexa√ß√£o dos novos dados √† base de dados de faturas ou o pedido de resumos financeiros de receitas e despesas. O chat do WhatsApp √© a interface principal para receber estes pedidos.\n\n---\n\n**INSTRU√á√ïES**\n1. **An√°lise de inten√ß√µes**: analise as mensagens recebidas dos utilizadores do WhatsApp para compreender a sua inten√ß√£o.\n2. **Integra√ß√£o de ferramentas**: Com base na inten√ß√£o, escolha a ferramenta mais adequada que recebeu ou tem acesso para executar v√°rias a√ß√µes.\n - Se o utilizador solicitar a adi√ß√£o de uma nova transa√ß√£o, PIX ou atividade de despesa, acione a ferramenta IncluirMovimentacao e certifique-se de que o utilizador especificou as seguintes informa√ß√µes necess√°rias: Data da transa√ß√£o, Descri√ß√£o da transa√ß√£o, Categoria da transa√ß√£o (Rendimento, Despesas essenciais ou Despesas n√£o essenciais), Valor do cr√©dito (se for uma transa√ß√£o de rendimento), Valor do d√©bito (se forem compras ou transa√ß√µes relacionadas com despesas)\n - Caso o utilizador solicite o registo de uma nova fatura, acione a ferramenta IncluirConta.\n - Caso o utilizador solicite o resumo das suas despesas de um m√™s ou per√≠odo espec√≠fico, acione a ferramenta ResumidorFinanceiro.\n\nIMPORTANTE: Quando o utilizador n√£o fornece informa√ß√£o suficiente para executar uma determinada tarefa, oriente-o e pe√ßa-lhe que forne√ßa mais informa√ß√£o necess√°ria para completar cada tarefa.\n3. **Executar a√ß√µes**: execute a ferramenta selecionada com precis√£o e efici√™ncia com base no pedido do utilizador.\n4. **Confirma√ß√£o e feedback**: forne√ßa feedback claro ao utilizador ap√≥s a conclus√£o de cada tarefa, confirmando as a√ß√µes ou resumindo os resultados utilizando as respostas das ferramentas chamadas.\n5. **Tratamento de erros**: se o pedido do utilizador n√£o puder ser atendido ou a inten√ß√£o n√£o for clara, pe√ßa esclarecimentos e oriente o utilizador para reformular o seu pedido.\n\n6. **Instru√ß√µes de formata√ß√£o**\n - Na sua resposta, envie sempre uma mensagem no formato suportado pelo WhatsApp.\n - As seguintes tags s√£o atualmente suportadas:\n*Negrito*: *negrito*\n_It√°lico_: _it√°lico_\n~Tachado~: ~tachado~\n\nSublinhado n√£o √© suportado no WhatsApp.\nSpoiler n√£o √© suportado no WhatsApp.\nHTML n√£o √© suportado.\n\nExemplo combinado de formata√ß√£o:\n*negrito _it√°lico negrito ~it√°lico negrito tachado~_ negrito*\n\nLink direto (sem texto personalizado):\nhttps://www.exemplo.com\n\nC√≥digo em linha:\n`c√≥digo de largura fixa`\n\nBloco de c√≥digo:\nObserva√ß√µes:\n- Qualquer c√≥digo que voc√™ queira mostrar deve ser enviado entre tr√™s crases (\\`\\`\\`) para aparecer formatado.\n- No WhatsApp, n√£o √© poss√≠vel usar tags HTML como <b>, <i>, <s> etc.\n- Use apenas *asteriscos*, _underscores_, ~tils~ e crases \\` para formata√ß√µes b√°sicas.\n- Sempre substitua os caracteres especiais (<, >, &) pelas vers√µes literais se quiser mostr√°-los como texto.\n\n---\n\n**REQUISITOS DE SA√çDA**\n- Executar tarefas solicitadas pelo utilizador com as ferramentas adequadas, concluindo as a√ß√µes com efici√™ncia.\n- Forne√ßa resumos concisos ou confirma√ß√µes ao utilizador atrav√©s do WhatsApp.\n- Se alguma tarefa n√£o for bem-sucedida, forne√ßa uma mensagem de erro √∫til e acion√°vel.\n- Garanta que o hist√≥rico de chat √© registado e armazenado no armazenamento de mem√≥ria dispon√≠vel que lhe √© fornecido\n\n---\n\n**EXEMPLOS**\n\n1. **Mensagem do utilizador**: \"carregue este documento para mim.\"\n **A√ß√µes**:\n - Inten√ß√£o: Carregar um documento ou um arquivo\n - Ferramenta:\n - Sa√≠da: √â enviada uma confirma√ß√£o ao utilizador de que o arquivo ou documento foi carregado para a pasta correta.\n\n2. **Mensagem do utilizador**: \"Fiz uma compra de 3 donuts que me custaram 25,00 reais esta manh√£. Podem registar esta transa√ß√£o para mim?.\"\n **A√ß√µes**:\n- Envia nesse formato: \n\n{\n\"data_transacao\": \"01/05/2024\",\n\"transacao\": \"Almo√ßo\",\n\"categoria\": \"sa√≠da\",\n\"entrada\": 0,\n\"saida\": 25\n}\n\n- Quando informado: gasto, perda, prejuizo ou negativos, envio de PIX, passei o cart√£o de cr√©dito, paguei uma conta ou um boleto adicione como saida\n- Quando informado: ganho, lucro, recebimentos, adicione como entrada\n- Inten√ß√£o: Registar nova transa√ß√£o de despesa.\n - Ferramenta: IncluirMovimentacao.\n - Sa√≠da: √â enviada uma confirma√ß√£o ao utilizador de que a compra recente de donuts foi adicionada ao registo da transa√ß√£o.\n\n3. **Mensagem do utilizador**: \"Adicione esta fatura ao nosso registo com os seguintes dados: a data da fatura √© 1 de outubro de 2024, o n√∫mero da fatura √© 123456, no valor de 500,00 reais e faturada √† Synthrop AI\"\n **A√ß√µes**:\n - Inten√ß√£o: Adicionar um novo registo de fatura.\n - Ferramenta: IncluirConta.\n - Sa√≠da: √â enviada uma confirma√ß√£o ao utilizador de que foi adicionada uma nova fatura.\n\n4. **Mensagem do utilizador**: \"Quanto gastei no m√™s passado?\"\n **A√ß√µes**:\n- Envia nesse formato: \n\n{\n  \"data\": \"01/2024\",\n  \"categoria\": \"sa√≠da\"\n}\n - Inten√ß√£o: Resumir as Despesas.\n - Ferramenta: ResumidorFinanceiro.\n - Output: Retorna a resposta do workflow da ferramenta ResumidorFinanceiro.\nImportante: Caso a informa√ß√£o venha apenas para fazer um resumo do m√™s vc deve colocar a categoria como null.Caso seja informado se seja informa√ß√µes de entradas ou sa√≠das, categorize.","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-672,640],"id":"ded1540d-78f7-4463-911d-697b450bd932","name":"FinThrix"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-784,848],"id":"9c3d1420-9ae9-49d8-862d-cf80da7a13e0","name":"GPT-4o","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook - Evolution').item.json.body.data.key.id }}","contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-656,848],"id":"0ab6797c-2932-4b1b-9d41-b47007d305b5","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"QgjuCQJgHbZ2Q1u8","name":"Postgres - Taysa"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[-416,848],"id":"b7938fd4-034d-47dc-a266-13b2863ab80b","name":"Calculator"},{"parameters":{"content":"## LLM e Memoria","height":192,"width":272,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-816,800],"id":"f8b8eb1d-426d-454a-8437-9f0a50c4fd9a","name":"Sticky Note5"},{"parameters":{"content":"## Ferramentas","height":192,"width":576,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-448,800],"id":"6f306561-637d-41d4-ad22-4bae8ad8105a","name":"Sticky Note6"},{"parameters":{"name":"IncluirConta","description":"Chame esta ferramenta para registrar uma conta e atualizar um banco de dados do Google Sheets chamado Contas.\n\n","workflowId":{"__rl":true,"value":"IEUYavVCzsZ26xfU","mode":"list","cachedResultName":"Agentes N8NT - Finthrix - Inclui Conta"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n\t\"data_fatura\": {\n\t\t\"type\": \"date\"\n    },\n    \"numero_fatura\": {\n        \"type\": \"number\"\n    },\n    \"valor_total\": {\n        \"type\": \"number\"\n    },\n    \"destinatario\": {\n        \"type\": \"string\"\n    }\n  }\n}"},"id":"5e3f98dc-b0e7-48a1-946b-118fc4b2fdd8","name":"IncluiConta","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[-144,848]},{"parameters":{"name":"ResumidorFinanceiro","description":"Chame esta ferramenta para gerar um relat√≥rio ou resumo das informa√ß√µes financeiras a partir de um banco de dados do Google Sheets com registros de transa√ß√µes.\n\nutilize apenas o formato mm/yyyy","workflowId":{"__rl":true,"value":"YZenoND8vF5nsDNZ","mode":"list","cachedResultName":"Agentes N8NT - Finthrix - Resumidor Relatorio Financeiro"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n  \"data\": \"02/2024\",\n  \"categoria\": \"Sa√≠da\"\n}\n}"},"id":"8257f539-41df-402e-af74-7e173f7e3ce3","name":"ResumidorFinanceiro","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[0,848]},{"parameters":{"name":"IncluirMovimentacao","description":"Chame essa tool para atualizar a planilha do google sheets com todas as entradas e sa√≠das, gastos ou ganhos, perdas ou lucros. ","workflowId":{"__rl":true,"value":"WN7Pj1ZZe2XFIZpp","mode":"list","cachedResultName":"Agentes N8NT - Finthrix - Inclui Movimentacao"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n\t\"data_transacao\": {\n\t\t\"type\": \"date\"\n    },\n   \"transacao\": {\n       \"type\": \"string\"\n    },\n   \"categoria\": {\n       \"type\": \"string\"\n    },\n    \"entrada\": {\n      \"type\": \"number\"\n    },\n    \"saida\": {\n      \"type\": \"number\"\n    }\n  }\n}"},"id":"c4b17433-c0da-449f-9ac2-adfc9bd5050c","name":"IncluiMovimentacao","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[-272,848]},{"parameters":{"content":"## Sa√≠da para o Usu√°rio via WhatsApp","height":272,"width":304,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[304,544],"id":"31a410e3-cd9e-47fb-a726-af76f0f7185b","name":"Sticky Note7"},{"parameters":{"resource":"messages-api","instanceName":"pessoal-taysa","remoteJid":"={{ $('Seta os dados de Entrada').first().json.telefone }}","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[400,640],"id":"a4162819-13b1-4023-a085-c878de31a71c","name":"Envia mensagem no WhatsApp","credentials":{"evolutionApi":{"id":"C4D933bAuIRLg3yb","name":"Evolution account 2"}}},{"parameters":{"resource":"messages-api","instanceName":"pessoal-taysa","remoteJid":"={{ $('Seta os dados de Entrada').first().json.telefone }}","messageText":"={{ $json.response }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[848,160],"id":"89b5e5dd-037f-42ab-8344-eb483c767314","name":"Informa Retorno via WhatsApp","credentials":{"evolutionApi":{"id":"C4D933bAuIRLg3yb","name":"Evolution account 2"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.output.arquivo_enviado }}","rightValue":"conta","operator":{"type":"string","operation":"equals"},"id":"f732daf2-3dd3-44c6-9f41-7d4d952db22c"}],"combinator":"and"},"renameOutput":true,"outputKey":"Conta"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"97c15d3a-fdb0-4e91-b6bc-f1cf876a84b5","leftValue":"={{ $json.output.arquivo_enviado }}","rightValue":"extrato","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Extrato"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-48,112],"id":"6fe85c45-7282-4e1e-9785-d107bf5e15dd","name":"Roteador"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Faz Upload do Arquivo Enviado para o Drive Google').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1cj7sRk-oPlDuTZkpU0xjCVKl6kaB8L4h","mode":"list","cachedResultName":"Extratos","cachedResultUrl":"https://drive.google.com/drive/folders/1cj7sRk-oPlDuTZkpU0xjCVKl6kaB8L4h"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[240,256],"id":"2f6a1a77-51ad-446b-8beb-1a00dd585932","name":"Envia para Pasta Extratos1","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Faz Upload do Arquivo Enviado para o Drive Google').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1J6EJw7gph4CG31bG8LKywEtDg3l3t74m","mode":"list","cachedResultName":"Contas e Faturas","cachedResultUrl":"https://drive.google.com/drive/folders/1J6EJw7gph4CG31bG8LKywEtDg3l3t74m"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[240,-16],"id":"0cf1dc42-c845-4d4c-b4ce-519cabdae689","name":"Envia para Pasta Contas","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"operation":"executeQuery","query":"DELETE FROM N8N_CHAT_HISTORIES","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2144,-48],"id":"2fa1ba37-3649-406d-9169-8ecc6b55629e","name":"Limpa - chat_histories","credentials":{"postgres":{"id":"60EHtoW6KUNsgirv","name":"Postgres - Taysa"}},"disabled":true},{"parameters":{"content":"## Limpa hist√≥ricos","height":300,"width":320,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2240,-144],"id":"3f347629-f6f0-47a1-a68a-554fec1b2425","name":"Sticky Note10"},{"parameters":{"promptType":"define","text":"={{ $('Seta os dados de Entrada').item.json.mensagem }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"Seu papel √© identificar a inten√ß√£o do usu√°rio com base em duas categorias:  atualizar_fatura: Se o usu√°rio explicitamente indicar que deseja enviar um documento de conta ou fatura na mensagem ou intera√ß√£o atual do chat, ou se o nome do arquivo do documento contiver 'conta' ou 'fatura'. atualiza_extrato_bancario: Se o usu√°rio explicitamente indicar que deseja enviar um documento de extrato banc√°rio na mensagem ou intera√ß√£o atual do chat, ou se o nome do arquivo do documento contiver 'extrato bancario'."},{"type":"HumanMessagePromptTemplate","message":"=Identifique a inten√ß√£o usando as seguintes informa√ß√µes recebidas do usu√°rio:\n\nMensagem do usu√°rio no chat: {{ $('Seta os dados de Entrada').item.json.mensagem }}\nNome do arquivo: {{ $json.name }}\nLegenda do envio do arquivo: {{ $('Webhook - Evolution').item.json.body.data.message.documentMessage.title}}\n\nLembre-se que quando vier uma fatura, boleto conta, vc deve assumir que √© uma conta.\nE quando vier algo como extrato vc deve assumir que √© um extrato banc√°rio"}]}},"id":"e4c31dcd-02ac-4824-bd2f-04e19590b3dd","name":"üìëIdentificador ü§ë","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[-400,112]},{"parameters":{"assignments":{"assignments":[{"id":"6241b846-6b77-4bb2-a4b5-246ea404118c","name":"telefone","value":"={{ $('Webhook - Evolution').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"060c0075-f216-44d6-bdec-84ddc3fa973f","name":"mensagem","value":"={{ $('Webhook - Evolution').item.json.body.data.message }}","type":"string"},{"id":"1f7bc67f-de57-497f-9d49-80c431b2b8e5","name":"base64","value":"={{ $json.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1664,368],"id":"5c26730a-a2b5-4c55-a651-13cf41e5d031","name":"Seta os dados de Entrada"},{"parameters":{"schemaType":"manual","inputSchema":"{\n    \"type\": \"object\",\n    \"properties\": {\n        \"arquivo_enviado\": {\n            \"type\": \"string\",\n            \"enum\": [\"conta\", \"extrato\"]\n        }\n    }\n}\n"},"id":"f7c7c9c2-8d53-4fdb-b05e-4c2946240691","name":"Estrutura do Retorno","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-208,304]}],"connections":{"Webhook - Evolution":{"main":[[{"node":"Busca base64 da Evolution","type":"main","index":0}]]},"Busca base64 da Evolution":{"main":[[{"node":"Seta os dados de Entrada","type":"main","index":0}]]},"Verifica se sou Eu":{"main":[[{"node":"Contexto","type":"main","index":0}]]},"Contexto":{"main":[[{"node":"Converte o Base64 to File","type":"main","index":0},{"node":"FinThrix","type":"main","index":0}]]},"Converte o Base64 to File":{"main":[[{"node":"Faz Upload do Arquivo Enviado para o Drive Google","type":"main","index":0}]]},"Faz Upload do Arquivo Enviado para o Drive Google":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0},{"node":"üìëIdentificador ü§ë","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"üìëIdentificador ü§ë","type":"ai_languageModel","index":0}]]},"GPT-4o":{"ai_languageModel":[[{"node":"FinThrix","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"FinThrix","type":"ai_memory","index":0}]]},"Calculator":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"IncluiConta":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"ResumidorFinanceiro":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"IncluiMovimentacao":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"FinThrix":{"main":[[{"node":"Envia mensagem no WhatsApp","type":"main","index":0}]]},"Seta mensagem de retorno":{"main":[[{"node":"Informa Retorno via WhatsApp","type":"main","index":0}]]},"Seta mensagem de retorno1":{"main":[[{"node":"Informa Retorno via WhatsApp","type":"main","index":0}]]},"Roteador":{"main":[[{"node":"Envia para Pasta Contas","type":"main","index":0}],[{"node":"Envia para Pasta Extratos1","type":"main","index":0}]]},"Envia para Pasta Extratos1":{"main":[[{"node":"Seta mensagem de retorno1","type":"main","index":0}]]},"Envia para Pasta Contas":{"main":[[{"node":"Seta mensagem de retorno","type":"main","index":0}]]},"Seta os dados de Entrada":{"main":[[{"node":"Verifica se sou Eu","type":"main","index":0}]]},"üìëIdentificador ü§ë":{"main":[[{"node":"Roteador","type":"main","index":0}]]},"Estrutura do Retorno":{"ai_outputParser":[[{"node":"üìëIdentificador ü§ë","type":"ai_outputParser","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook - Evolution":[{"json":{"headers":{"host":"prd.miabuilder.com","user-agent":"axios/1.10.0","content-length":"619","accept":"application/json, text/plain, */*","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"prd.miabuilder.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"5660c7035f4c","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"pessoal-taysa","data":{"key":{"remoteJid":"553492150692@s.whatsapp.net","fromMe":true,"id":"3EB04F99C7715252DA3040"},"pushName":"Taysa","status":"SERVER_ACK","message":{"conversation":"Gastei 13 reais de gasolina hoje"},"messageType":"conversation","messageTimestamp":1758749045,"instanceId":"2486bd99-1b11-4a0b-9d43-7c847fff6af6","source":"web"},"destination":"https://prd.miabuilder.com/webhook/finThrix","date_time":"2025-09-24T18:24:05.721Z","sender":"553492150692@s.whatsapp.net","server_url":"https://evolution.miabuilder.com","apikey":"C21075125520-460F-B7AD-3EECD454894A"},"webhookUrl":"https://prd.miabuilder.com/webhook/finThrix","executionMode":"production"}}]},"versionId":"eb9d46e2-4d4c-4299-bb6b-f39b03223bfb","triggerCount":1,"tags":[]}