{"createdAt":"2025-09-24T20:25:09.453Z","updatedAt":"2025-09-24T21:43:00.925Z","id":"ntryJVkgYjMOh7aB","name":"Agentes N8NT - Finthrix - AI Agent Financeiro","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"finThrix","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-2176,368],"id":"e4e9d6b7-7b81-4653-87a1-702773249144","name":"Webhook - Evolution","webhookId":"b991a8d7-22dd-484c-b858-785276541304"},{"parameters":{"method":"POST","url":"={{ $json.body.server_url }}/chat/getBase64FromMediaMessage/{{ $json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.body.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.body.data.key.id }}\"\n    }\n  }\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1904,368],"id":"d83f10bc-0dcd-4936-a7b5-15979af1595b","name":"Busca base64 da Evolution","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e00cf648-5ab4-4241-9fd2-e6e44b6655e1","leftValue":"={{ $json.telefone }}","rightValue":"553492150692@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1440,368],"id":"ccd587d3-7be0-4638-8205-12498fb1e41d","name":"Verifica se sou Eu"},{"parameters":{"assignments":{"assignments":[{"id":"a7880ef5-726c-452a-be1c-fb7a7414fc7c","name":"Chat Context ","value":"=Entrada do usuário no chat: {{ $json.mensagem }}  Detalhes do arquivo enviado: {{ $('Webhook - Evolution').item.json.body.data.message.documentMessage.fileName }} Legenda do envio do arquivo: {{ $('Webhook - Evolution').item.json.body.data.message.documentMessage.title }}","type":"string"},{"id":"41aba9bd-e375-4b55-9c8a-41644c854790","name":"base64","value":"={{$json.base64}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1216,352],"id":"9ab68ed3-9fbe-4b08-b0eb-6101ac92322f","name":"Contexto"},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-912,112],"id":"1f03264b-0324-4214-a46c-d4960fe85427","name":"Converte o Base64 to File","onError":"continueRegularOutput"},{"parameters":{"name":"={{ $('Busca base64 da Evolution').item.json.fileName }}","driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1D4YdDjKttNzshy3YtpoojNFujDfRvtBZ","mode":"list","cachedResultName":"FinThrix","cachedResultUrl":"https://drive.google.com/drive/folders/1D4YdDjKttNzshy3YtpoojNFujDfRvtBZ"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-704,112],"id":"502670f0-5ebf-4d7b-943a-9675523e9628","name":"Faz Upload do Arquivo Enviado para o Drive Google","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}},"onError":"continueErrorOutput"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-688,336],"id":"9efaa6fc-9481-43ec-b5b5-b70af26599b5","name":"No Operation, do nothing"},{"parameters":{"content":"## Entrada","height":256,"width":1168},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2240,288],"id":"1c98c0dc-43b1-4551-b6e7-c7909970c060","name":"Sticky Note"},{"parameters":{"content":"## Tratamento Quando Recebe Arquivos","height":528,"width":448,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-944,-32],"id":"27cf8bb7-30fb-475c-b526-947b2cab228f","name":"Sticky Note1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-400,304],"id":"f7ef6575-5718-491d-aa59-e885ef4dbc8a","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"content":"## Chain de Classificação de tipo de documento","height":528,"width":528},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-464,-16],"id":"2ddd7e02-0d44-46a8-8029-9033336e37f9","name":"Sticky Note2"},{"parameters":{"assignments":{"assignments":[{"id":"51adba09-9f20-4972-9f84-2ec70d37b2db","name":"reponse","value":"Arquivo enviado para a pasta de Contas e Faturas no Google Drive","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[464,-16],"id":"5194b2de-c789-4e70-bed4-3f47b6ec0be2","name":"Seta mensagem de retorno"},{"parameters":{"assignments":{"assignments":[{"id":"b29d3687-e87f-402a-847f-29f1e833e667","name":"response","value":"Arquivo enviado para a pasta de Extratos no Google Drive.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,256],"id":"c0a35f2d-878d-4882-8bef-f252b40bb1a8","name":"Seta mensagem de retorno1"},{"parameters":{"content":"## Insere na pasta conta","height":272,"width":480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[176,-80],"id":"8a21240a-853b-48ce-aa57-b18c24fcf3f4","name":"Sticky Note3"},{"parameters":{"content":"## Insere na pasta extrato","height":272,"width":480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[176,208],"id":"fae02175-ab0e-41ca-810a-5b5254ea4b5f","name":"Sticky Note4"},{"parameters":{"promptType":"define","text":"=Seu papel é determinar a intenção da mensagem por meio das solicitações ou comandos na mensagem do usuário fornecida a você da seguinte forma:\n{{ $json['Chat Context '] }}\n\nSe o usuário não especificar um comando ou solicitação para executar alguma tarefa utilizável com as ferramentas disponíveis, mas apenas enviar um arquivo ou documento, responda que o arquivo ou documento foi enviado com sucesso para o repositório apropriado.\n\nSe o usuário não enviar nenhum arquivo ou documento, mas especificar um comando ou solicitação para executar uma tarefa, execute a solicitação ou comando utilizando as ferramentas disponíveis para você.\n\nPense cuidadosamente sobre quais ferramentas específicas utilizar com base no contexto fornecido pela entrada do usuário.\n\nLembre-se sempre de ser polido e falar com o usuário assumindo o seu papel como um contador.","options":{"systemMessage":"=**OBJETIVO**\n\nÉ um útil contador de IA chamado FinThrix. Está a falar com o utilizador chamado `{{ $('Webhook - Evolution').item.json.body.data.pushName }}`. Hoje é {{ $now.format('dd/MM/yyyy') }}\n\nChame sempre o utilizador pelo nome (se o nome do utilizador for fornecido).\n\nA sua função é interpretar as mensagens dos utilizadores de uma integração de chat do Telegram e executar tarefas com precisão, utilizando as ferramentas disponíveis. Determinará a intenção do utilizador e acionará as ações (tools) apropriadas, tais como: IncluirMovimentacao, IncluirConta, ResumidorFinanceiro e outras ferramentas personalizadas fornecidas.\n\nTambém pode capturar arquivos de transações bancárias ou documentos de contas/faturas quando o utilizador carregar qualquer fatura/conta válida ou documento de extrato bancário na interface de chat do WhatsApp.\n\n*Importante*:\nAo responder ao utilizador, mantenha uma atitude profissional e amigável. \nUse emojis caso achar necessário para deixar a conversa mais leve!\n\n---\n**PERSONALIDADE E COMPORTAMENTOS para o FinThrix**\n\n*Nome*: FinThrix\n*Função*: Assistente Pessoal\n*Sexo: Masculino\n*Traços de personalidade*: prestável, profissional, envolvente, organizado, empático\n\nO FinThrix é uma contabilista pessoal altamente eficiente e intuitiva. Mantém uma postura profissional, esforçando-se sempre para atender às necessidades dos seus utilizadores com um suporte rápido, preciso e personalizado. Embora seja detalhista e metódico na sua abordagem, FinThrix acrescenta um toque caloroso e envolvente a cada interação, fazendo com que os seus utilizadores se sintam valorizados e compreendidos.\n\nFinThrix é proativo na antecipação de necessidades, organizado na gestão de tarefas e empático na abordagem das preocupações dos utilizadores. Seja para resumir registos financeiros, registar novas movimentações e faturas ou fornecer relatórios e atualizações financeiras, ele equilibra o profissionalismo com uma atitude amigável e acessível. Os utilizadores devem sentir que não têm apenas um assistente capaz, mas um parceiro que realmente compreende os seus objetivos e necessidades.\n\n*Características principais*:\n- Altamente organizado e focado nos detalhes\n- Estilo de comunicação amigável e acessível\n- Profissional, mas identificável\n- Antecipa as necessidades do utilizador e oferece suporte proativamente\n- Empático e atento às preocupações ou preferências do utilizador\n\n---\n**INTEGRAÇÃO DE FERRAMENTAS**\nPode executar diversas ações através das seguintes ferramentas:\n\n - IncluirMovimentacao: captura detalhes de transações recentes efetuadas pelo utilizador envolvendo compras, PIX, pagamentos e outras atividades financeiras e regista a informação numa base de dados de registos de transações do Google Sheets.\n - IncluirConta: Adiciona um novo registo de fatura ou conta à base de dados de faturas/contas do Google Sheets.\n - ResumidorFinanceiro: Gera relatórios financeiros que resumem a saúde financeira do cliente, como atualizações de receitas e despesas para uma data ou período especificado.\n\n---\n\n**CONTEÚDO**\nEstá integrado num fluxo de trabalho onde os utilizadores interagem via WhatsApp para automatizar diversas tarefas. Tem acesso a diversas ferramentas, tais como:\n\n- **IncluirMovimentacao**: utilize para atualizar o registo de transações e movimentações, seja de dinheiro, PIX ou cartão de crédito de uma base de dados do Google Sheets que rastreia as atividades financeiras.\n\nO Agente de IA deve fornecer saída no seguinte formato com base na mensagem do utilizador:\n - data: data da transação/movimentação\n - descrição: Descrição da transação/movimentação ou detalhes\n - categoria: categoriza cada transação em dois tipos: entrada ou saída\n - crédito: Valor total da receita ou do fluxo de caixa recebido\n - débito: Valor total das Despesas efetuadas\n\n- **IncluirConta**: recupera os dados da fatura da mensagem do utilizador, como a data da fatura, o número da fatura, o valor da fatura e as informações de fatura que são enviadas via PDF, e regista os dados na base de dados do Google Sheets para faturas.\n\n- **ResumidorFinanceiro**: gera um resumo das transações para uma data específica. O Agente de IA deve fornecer saída no seguinte formato para ser utilizado no nó de ferramenta para gerar a resposta:\n** - data: data ou período da transação sempre no formato mm/yyyy**\n - categoria: a categoria utilizada para filtrar o relatório (por exemplo, entradas no mês de novembro de 2024). Importante: Caso a informação venha apenas para fazer um resumo do mês vc deve colocar a categoria como null. Caso seja solicitada, informações de entradas ou saídas, categorize.\n\n- **Processar documentos financeiros**: automatize a captura de dados e o registo de extratos bancários e faturas enviados pelo utilizador através da interface de chat.\n\n- **Outras ferramentas personalizadas**: Podem ser adicionadas novas ferramentas para lidar com tarefas adicionais.\n\nAs intenções do utilizador podem incluir o registo de uma transação recente, o registo de uma nova fatura e a anexação dos novos dados à base de dados de faturas ou o pedido de resumos financeiros de receitas e despesas. O chat do WhatsApp é a interface principal para receber estes pedidos.\n\n---\n\n**INSTRUÇÕES**\n1. **Análise de intenções**: analise as mensagens recebidas dos utilizadores do WhatsApp para compreender a sua intenção.\n2. **Integração de ferramentas**: Com base na intenção, escolha a ferramenta mais adequada que recebeu ou tem acesso para executar várias ações.\n - Se o utilizador solicitar a adição de uma nova transação, PIX ou atividade de despesa, acione a ferramenta IncluirMovimentacao e certifique-se de que o utilizador especificou as seguintes informações necessárias: Data da transação, Descrição da transação, Categoria da transação (Rendimento, Despesas essenciais ou Despesas não essenciais), Valor do crédito (se for uma transação de rendimento), Valor do débito (se forem compras ou transações relacionadas com despesas)\n - Caso o utilizador solicite o registo de uma nova fatura, acione a ferramenta IncluirConta.\n - Caso o utilizador solicite o resumo das suas despesas de um mês ou período específico, acione a ferramenta ResumidorFinanceiro.\n\nIMPORTANTE: Quando o utilizador não fornece informação suficiente para executar uma determinada tarefa, oriente-o e peça-lhe que forneça mais informação necessária para completar cada tarefa.\n3. **Executar ações**: execute a ferramenta selecionada com precisão e eficiência com base no pedido do utilizador.\n4. **Confirmação e feedback**: forneça feedback claro ao utilizador após a conclusão de cada tarefa, confirmando as ações ou resumindo os resultados utilizando as respostas das ferramentas chamadas.\n5. **Tratamento de erros**: se o pedido do utilizador não puder ser atendido ou a intenção não for clara, peça esclarecimentos e oriente o utilizador para reformular o seu pedido.\n\n6. **Instruções de formatação**\n - Na sua resposta, envie sempre uma mensagem no formato suportado pelo WhatsApp.\n - As seguintes tags são atualmente suportadas:\n*Negrito*: *negrito*\n_Itálico_: _itálico_\n~Tachado~: ~tachado~\n\nSublinhado não é suportado no WhatsApp.\nSpoiler não é suportado no WhatsApp.\nHTML não é suportado.\n\nExemplo combinado de formatação:\n*negrito _itálico negrito ~itálico negrito tachado~_ negrito*\n\nLink direto (sem texto personalizado):\nhttps://www.exemplo.com\n\nCódigo em linha:\n`código de largura fixa`\n\nBloco de código:\nObservações:\n- Qualquer código que você queira mostrar deve ser enviado entre três crases (\\`\\`\\`) para aparecer formatado.\n- No WhatsApp, não é possível usar tags HTML como <b>, <i>, <s> etc.\n- Use apenas *asteriscos*, _underscores_, ~tils~ e crases \\` para formatações básicas.\n- Sempre substitua os caracteres especiais (<, >, &) pelas versões literais se quiser mostrá-los como texto.\n\n---\n\n**REQUISITOS DE SAÍDA**\n- Executar tarefas solicitadas pelo utilizador com as ferramentas adequadas, concluindo as ações com eficiência.\n- Forneça resumos concisos ou confirmações ao utilizador através do WhatsApp.\n- Se alguma tarefa não for bem-sucedida, forneça uma mensagem de erro útil e acionável.\n- Garanta que o histórico de chat é registado e armazenado no armazenamento de memória disponível que lhe é fornecido\n\n---\n\n**EXEMPLOS**\n\n1. **Mensagem do utilizador**: \"carregue este documento para mim.\"\n **Ações**:\n - Intenção: Carregar um documento ou um arquivo\n - Ferramenta:\n - Saída: É enviada uma confirmação ao utilizador de que o arquivo ou documento foi carregado para a pasta correta.\n\n2. **Mensagem do utilizador**: \"Fiz uma compra de 3 donuts que me custaram 25,00 reais esta manhã. Podem registar esta transação para mim?.\"\n **Ações**:\n- Envia nesse formato: \n\n{\n\"data_transacao\": \"01/05/2024\",\n\"transacao\": \"Almoço\",\n\"categoria\": \"saída\",\n\"entrada\": 0,\n\"saida\": 25\n}\n\n- Quando informado: gasto, perda, prejuizo ou negativos, envio de PIX, passei o cartão de crédito, paguei uma conta ou um boleto adicione como saida\n- Quando informado: ganho, lucro, recebimentos, adicione como entrada\n- Intenção: Registar nova transação de despesa.\n - Ferramenta: IncluirMovimentacao.\n - Saída: É enviada uma confirmação ao utilizador de que a compra recente de donuts foi adicionada ao registo da transação.\n\n3. **Mensagem do utilizador**: \"Adicione esta fatura ao nosso registo com os seguintes dados: a data da fatura é 1 de outubro de 2024, o número da fatura é 123456, no valor de 500,00 reais e faturada à Synthrop AI\"\n **Ações**:\n - Intenção: Adicionar um novo registo de fatura.\n - Ferramenta: IncluirConta.\n - Saída: É enviada uma confirmação ao utilizador de que foi adicionada uma nova fatura.\n\n4. **Mensagem do utilizador**: \"Quanto gastei no mês passado?\"\n **Ações**:\n- Envia nesse formato: \n\n{\n  \"data\": \"01/2024\",\n  \"categoria\": \"saída\"\n}\n - Intenção: Resumir as Despesas.\n - Ferramenta: ResumidorFinanceiro.\n - Output: Retorna a resposta do workflow da ferramenta ResumidorFinanceiro.\nImportante: Caso a informação venha apenas para fazer um resumo do mês vc deve colocar a categoria como null.Caso seja informado se seja informações de entradas ou saídas, categorize.","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-672,640],"id":"ded1540d-78f7-4463-911d-697b450bd932","name":"FinThrix"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-784,848],"id":"9c3d1420-9ae9-49d8-862d-cf80da7a13e0","name":"GPT-4o","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook - Evolution').item.json.body.data.key.id }}","contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-656,848],"id":"0ab6797c-2932-4b1b-9d41-b47007d305b5","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"QgjuCQJgHbZ2Q1u8","name":"Postgres - Taysa"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[-416,848],"id":"b7938fd4-034d-47dc-a266-13b2863ab80b","name":"Calculator"},{"parameters":{"content":"## LLM e Memoria","height":192,"width":272,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-816,800],"id":"f8b8eb1d-426d-454a-8437-9f0a50c4fd9a","name":"Sticky Note5"},{"parameters":{"content":"## Ferramentas","height":192,"width":576,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-448,800],"id":"6f306561-637d-41d4-ad22-4bae8ad8105a","name":"Sticky Note6"},{"parameters":{"name":"IncluirConta","description":"Chame esta ferramenta para registrar uma conta e atualizar um banco de dados do Google Sheets chamado Contas.\n\n","workflowId":{"__rl":true,"value":"IEUYavVCzsZ26xfU","mode":"list","cachedResultName":"Agentes N8NT - Finthrix - Inclui Conta"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n\t\"data_fatura\": {\n\t\t\"type\": \"date\"\n    },\n    \"numero_fatura\": {\n        \"type\": \"number\"\n    },\n    \"valor_total\": {\n        \"type\": \"number\"\n    },\n    \"destinatario\": {\n        \"type\": \"string\"\n    }\n  }\n}"},"id":"5e3f98dc-b0e7-48a1-946b-118fc4b2fdd8","name":"IncluiConta","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[-144,848]},{"parameters":{"name":"ResumidorFinanceiro","description":"Chame esta ferramenta para gerar um relatório ou resumo das informações financeiras a partir de um banco de dados do Google Sheets com registros de transações.\n\nutilize apenas o formato mm/yyyy","workflowId":{"__rl":true,"value":"YZenoND8vF5nsDNZ","mode":"list","cachedResultName":"Agentes N8NT - Finthrix - Resumidor Relatorio Financeiro"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n  \"data\": \"02/2024\",\n  \"categoria\": \"Saída\"\n}\n}"},"id":"8257f539-41df-402e-af74-7e173f7e3ce3","name":"ResumidorFinanceiro","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[0,848]},{"parameters":{"name":"IncluirMovimentacao","description":"Chame essa tool para atualizar a planilha do google sheets com todas as entradas e saídas, gastos ou ganhos, perdas ou lucros. ","workflowId":{"__rl":true,"value":"WN7Pj1ZZe2XFIZpp","mode":"list","cachedResultName":"Agentes N8NT - Finthrix - Inclui Movimentacao"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n\t\"data_transacao\": {\n\t\t\"type\": \"date\"\n    },\n   \"transacao\": {\n       \"type\": \"string\"\n    },\n   \"categoria\": {\n       \"type\": \"string\"\n    },\n    \"entrada\": {\n      \"type\": \"number\"\n    },\n    \"saida\": {\n      \"type\": \"number\"\n    }\n  }\n}"},"id":"c4b17433-c0da-449f-9ac2-adfc9bd5050c","name":"IncluiMovimentacao","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[-272,848]},{"parameters":{"content":"## Saída para o Usuário via WhatsApp","height":272,"width":304,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[304,544],"id":"31a410e3-cd9e-47fb-a726-af76f0f7185b","name":"Sticky Note7"},{"parameters":{"resource":"messages-api","instanceName":"pessoal-taysa","remoteJid":"={{ $('Seta os dados de Entrada').first().json.telefone }}","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[400,640],"id":"a4162819-13b1-4023-a085-c878de31a71c","name":"Envia mensagem no WhatsApp","credentials":{"evolutionApi":{"id":"C4D933bAuIRLg3yb","name":"Evolution account 2"}}},{"parameters":{"resource":"messages-api","instanceName":"pessoal-taysa","remoteJid":"={{ $('Seta os dados de Entrada').first().json.telefone }}","messageText":"={{ $json.response }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[848,160],"id":"89b5e5dd-037f-42ab-8344-eb483c767314","name":"Informa Retorno via WhatsApp","credentials":{"evolutionApi":{"id":"C4D933bAuIRLg3yb","name":"Evolution account 2"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.output.arquivo_enviado }}","rightValue":"conta","operator":{"type":"string","operation":"equals"},"id":"f732daf2-3dd3-44c6-9f41-7d4d952db22c"}],"combinator":"and"},"renameOutput":true,"outputKey":"Conta"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"97c15d3a-fdb0-4e91-b6bc-f1cf876a84b5","leftValue":"={{ $json.output.arquivo_enviado }}","rightValue":"extrato","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Extrato"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-48,112],"id":"6fe85c45-7282-4e1e-9785-d107bf5e15dd","name":"Roteador"},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Faz Upload do Arquivo Enviado para o Drive Google').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1cj7sRk-oPlDuTZkpU0xjCVKl6kaB8L4h","mode":"list","cachedResultName":"Extratos","cachedResultUrl":"https://drive.google.com/drive/folders/1cj7sRk-oPlDuTZkpU0xjCVKl6kaB8L4h"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[240,256],"id":"2f6a1a77-51ad-446b-8beb-1a00dd585932","name":"Envia para Pasta Extratos1","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"operation":"move","fileId":{"__rl":true,"value":"={{ $('Faz Upload do Arquivo Enviado para o Drive Google').item.json.id }}","mode":"id"},"driveId":{"__rl":true,"mode":"list","value":"My Drive"},"folderId":{"__rl":true,"value":"1J6EJw7gph4CG31bG8LKywEtDg3l3t74m","mode":"list","cachedResultName":"Contas e Faturas","cachedResultUrl":"https://drive.google.com/drive/folders/1J6EJw7gph4CG31bG8LKywEtDg3l3t74m"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[240,-16],"id":"0cf1dc42-c845-4d4c-b4ce-519cabdae689","name":"Envia para Pasta Contas","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"operation":"executeQuery","query":"DELETE FROM N8N_CHAT_HISTORIES","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2144,-48],"id":"2fa1ba37-3649-406d-9169-8ecc6b55629e","name":"Limpa - chat_histories","credentials":{"postgres":{"id":"60EHtoW6KUNsgirv","name":"Postgres - Taysa"}},"disabled":true},{"parameters":{"content":"## Limpa históricos","height":300,"width":320,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2240,-144],"id":"3f347629-f6f0-47a1-a68a-554fec1b2425","name":"Sticky Note10"},{"parameters":{"promptType":"define","text":"={{ $('Seta os dados de Entrada').item.json.mensagem }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"Seu papel é identificar a intenção do usuário com base em duas categorias:  atualizar_fatura: Se o usuário explicitamente indicar que deseja enviar um documento de conta ou fatura na mensagem ou interação atual do chat, ou se o nome do arquivo do documento contiver 'conta' ou 'fatura'. atualiza_extrato_bancario: Se o usuário explicitamente indicar que deseja enviar um documento de extrato bancário na mensagem ou interação atual do chat, ou se o nome do arquivo do documento contiver 'extrato bancario'."},{"type":"HumanMessagePromptTemplate","message":"=Identifique a intenção usando as seguintes informações recebidas do usuário:\n\nMensagem do usuário no chat: {{ $('Seta os dados de Entrada').item.json.mensagem }}\nNome do arquivo: {{ $json.name }}\nLegenda do envio do arquivo: {{ $('Webhook - Evolution').item.json.body.data.message.documentMessage.title}}\n\nLembre-se que quando vier uma fatura, boleto conta, vc deve assumir que é uma conta.\nE quando vier algo como extrato vc deve assumir que é um extrato bancário"}]}},"id":"e4c31dcd-02ac-4824-bd2f-04e19590b3dd","name":"📑Identificador 🤑","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[-400,112]},{"parameters":{"assignments":{"assignments":[{"id":"6241b846-6b77-4bb2-a4b5-246ea404118c","name":"telefone","value":"={{ $('Webhook - Evolution').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"060c0075-f216-44d6-bdec-84ddc3fa973f","name":"mensagem","value":"={{ $('Webhook - Evolution').item.json.body.data.message }}","type":"string"},{"id":"1f7bc67f-de57-497f-9d49-80c431b2b8e5","name":"base64","value":"={{ $json.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1664,368],"id":"5c26730a-a2b5-4c55-a651-13cf41e5d031","name":"Seta os dados de Entrada"},{"parameters":{"schemaType":"manual","inputSchema":"{\n    \"type\": \"object\",\n    \"properties\": {\n        \"arquivo_enviado\": {\n            \"type\": \"string\",\n            \"enum\": [\"conta\", \"extrato\"]\n        }\n    }\n}\n"},"id":"f7c7c9c2-8d53-4fdb-b05e-4c2946240691","name":"Estrutura do Retorno","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-208,304]}],"connections":{"Webhook - Evolution":{"main":[[{"node":"Busca base64 da Evolution","type":"main","index":0}]]},"Busca base64 da Evolution":{"main":[[{"node":"Seta os dados de Entrada","type":"main","index":0}]]},"Verifica se sou Eu":{"main":[[{"node":"Contexto","type":"main","index":0}]]},"Contexto":{"main":[[{"node":"Converte o Base64 to File","type":"main","index":0},{"node":"FinThrix","type":"main","index":0}]]},"Converte o Base64 to File":{"main":[[{"node":"Faz Upload do Arquivo Enviado para o Drive Google","type":"main","index":0}]]},"Faz Upload do Arquivo Enviado para o Drive Google":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0},{"node":"📑Identificador 🤑","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"📑Identificador 🤑","type":"ai_languageModel","index":0}]]},"GPT-4o":{"ai_languageModel":[[{"node":"FinThrix","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"FinThrix","type":"ai_memory","index":0}]]},"Calculator":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"IncluiConta":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"ResumidorFinanceiro":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"IncluiMovimentacao":{"ai_tool":[[{"node":"FinThrix","type":"ai_tool","index":0}]]},"FinThrix":{"main":[[{"node":"Envia mensagem no WhatsApp","type":"main","index":0}]]},"Seta mensagem de retorno":{"main":[[{"node":"Informa Retorno via WhatsApp","type":"main","index":0}]]},"Seta mensagem de retorno1":{"main":[[{"node":"Informa Retorno via WhatsApp","type":"main","index":0}]]},"Roteador":{"main":[[{"node":"Envia para Pasta Contas","type":"main","index":0}],[{"node":"Envia para Pasta Extratos1","type":"main","index":0}]]},"Envia para Pasta Extratos1":{"main":[[{"node":"Seta mensagem de retorno1","type":"main","index":0}]]},"Envia para Pasta Contas":{"main":[[{"node":"Seta mensagem de retorno","type":"main","index":0}]]},"Seta os dados de Entrada":{"main":[[{"node":"Verifica se sou Eu","type":"main","index":0}]]},"📑Identificador 🤑":{"main":[[{"node":"Roteador","type":"main","index":0}]]},"Estrutura do Retorno":{"ai_outputParser":[[{"node":"📑Identificador 🤑","type":"ai_outputParser","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook - Evolution":[{"json":{"headers":{"host":"prd.miabuilder.com","user-agent":"axios/1.10.0","content-length":"619","accept":"application/json, text/plain, */*","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"prd.miabuilder.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"5660c7035f4c","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"pessoal-taysa","data":{"key":{"remoteJid":"553492150692@s.whatsapp.net","fromMe":true,"id":"3EB04F99C7715252DA3040"},"pushName":"Taysa","status":"SERVER_ACK","message":{"conversation":"Gastei 13 reais de gasolina hoje"},"messageType":"conversation","messageTimestamp":1758749045,"instanceId":"2486bd99-1b11-4a0b-9d43-7c847fff6af6","source":"web"},"destination":"https://prd.miabuilder.com/webhook/finThrix","date_time":"2025-09-24T18:24:05.721Z","sender":"553492150692@s.whatsapp.net","server_url":"https://evolution.miabuilder.com","apikey":"C21075125520-460F-B7AD-3EECD454894A"},"webhookUrl":"https://prd.miabuilder.com/webhook/finThrix","executionMode":"production"}}]},"versionId":"eb9d46e2-4d4c-4299-bb6b-f39b03223bfb","triggerCount":1,"tags":[]}