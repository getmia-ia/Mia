{"createdAt":"2025-07-19T20:57:50.861Z","updatedAt":"2025-09-24T17:31:43.317Z","id":"L3udNHYCNIDauP7G","name":"1.1 - Finamob - Journal - RSS","active":false,"isArchived":true,"nodes":[{"parameters":{"url":"https://feeds.folha.uol.com.br/mercado/rss091.xml","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-1216],"id":"f9755edf-4776-48e1-b1c8-b5e7a15d833c","name":"RSS Folha","onError":"continueRegularOutput"},{"parameters":{"url":"https://br.investing.com/rss/news_301.rss","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-1408],"id":"c4a11f2c-a9b4-4d0e-8450-f76b718b3c32","name":"RSS Investing","onError":"continueRegularOutput"},{"parameters":{"url":"https://metroquadrado.com/feed","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-1056],"id":"a3fb11a6-02ed-4087-9b1d-30566a93885a","name":"RSS Metro Quadrado","onError":"continueRegularOutput"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-9872,976],"id":"55aa8fb0-a277-4d73-a4ff-62bc29f11ea9","name":"Schedule Trigger"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-9616,976],"id":"ec5e1425-6a10-4157-a8ce-6eae2d4e8e08","name":"No Operation, do nothing","alwaysOutputData":false},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-3360,896],"id":"4b0d262f-456f-46ca-87da-3d36d71af02b","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const binaryData = $input.item.binary?.[\"imagem_final\"];\n\nif (!binaryData || !binaryData.data) {\n  throw new Error(\"Campo 'imagem_final' não encontrado no binário.\");\n}\n\nconst base64 = Buffer.from(binaryData.data, 'base64').toString(\"base64\");\n\nreturn {\n  json: {\n    base64Image: base64\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1536,576],"id":"461ba905-14da-4bc4-bfc4-6f8acfb5a129","name":"Binary > base64"},{"parameters":{"content":"# Portais de notícias\n\n### Portais de notícias que o fluxo irá consultar para gerar os posts","height":4528,"width":1648},"type":"n8n-nodes-base.stickyNote","position":[-8816,-1568],"typeVersion":1,"id":"40d1541c-f173-4e7a-bf41-b89ebb316edf","name":"Sticky Note"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-7808,-800],"id":"ee24682d-d318-421c-be88-3a2a505a9097","name":"Notícias Consolidadas"},{"parameters":{"numberInputs":4},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-3568,672],"id":"73be5248-5cf7-4014-a470-c2d1a4621327","name":"Unificar imagem final"},{"parameters":{"content":"# Definição da Imagem do Post\n\n### Primeiro busca imagem na notícia, se não encontra gera uma via IA","height":992,"width":2656},"type":"n8n-nodes-base.stickyNote","position":[-6400,352],"typeVersion":1,"id":"deef516d-c4c7-4997-96d6-cff409d0a3e4","name":"Sticky Note6"},{"parameters":{"content":"# Custos totais da Infra + Manut.\n\n### VPS - BRL 60 / mês\n### Open Router e Open AI API - USD 25 / month\n### hcti.io - HTML/CSS to Image API - USD 14 / month\n### Evolution API - BRL 40 / mês?\n### Telera - Número Whatsapp - BRL 11 / mês?\n### Conta Google - BRL 60 / mês\n### Manutenção e melhorias - BRL 500 / mês\n\n## Total ~ 900 / mês","height":528,"width":560,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-9392,-1744],"typeVersion":1,"id":"41beba42-be80-44f5-ba3d-b80cf506a788","name":"Sticky Note9"},{"parameters":{"promptType":"define","text":"=Você é um social media especialista e autoridade em conteúdo imobiliário no Instagram. Sua comunicação é informativa, objetiva e valorizada por profissionais do setor — como incorporadores, construtores, investidores e gestores de fundos — que acompanham suas publicações para se manter atualizados com o que realmente importa.\n\nVocê recebe uma lista de notícias (que pode conter itens repetidos de diferentes fontes).\n\nSua missão:\n\nAnalise profundamente todas as notícias.\n\nPara cada notícia, atribua uma nota de relevância de 0 a 10, representando o quanto ela é relevante para o setor imobiliário brasileiro.\n\nA nota deve refletir o interesse para empresários, incorporadores, construtores, investidores, gestores de fundos ou loteadores.\n\nConsidere impacto direto no setor, novidades, dados, tendências, decisões legais, mudanças em crédito, urbanismo, mercado de capitais, etc.\n\nPara cada notícia única:\n\nCrie um título original e curto (até 15 palavras), nunca copiando o título publicado pelos portais. Sempre busque um titulo chamativo, trazendo algo polemico sobre a noticia. Nunca em linguagem informal e nunca deve adicionar emoji no titulo.\n\nEscreva uma legenda com até 1000 caracteres, dividida em 5 blocos, bem explicados.\nEla deve ser clara, simples e com tom didático, como se estivesse explicando para alguém de 18 anos que nunca ouviu falar do assunto.\n\nA legenda deve conter cinco blocos separados com \\n\\n, mas sem escrever os nomes dos blocos. Siga a estrutura abaixo apenas como orientação interna (não inclua esses títulos no texto final):\n\nEstrutura da legenda:\n\n1. Conte o que aconteceu, com as informações principais e números relevantes (sem termos técnicos difíceis). Nao seja superficial, nao escreva coisas como \"pode impactar\", \"talvez ajude\", entregue as informacoes da noticia de forma completa. Se a noticia fala sobre 3 dicas para vender melhor, entregue as 3 dicas na legenda. Nunca fale da noticia como se ela viesse de outro canal, tudo o que tiver na noticia tem que estar de forma resumida na nossa legenda. Esse bloco precisa entregar as informacoes da noticia de forma muito completa.\n\n2. Explique com clareza e simplicidade o que é esse tema (ex: o que é FII? como funciona o financiamento? O que sao fundos de investimento, etc..). Imagine que está falando com alguém de 18 anos que nunca ouviu falar disso.\n\n3. Mostre como ele pode usar essa informação impacta na vida do incorporador. Por exemplo, como aumento da taxa selic impacta no financiamento da sua obra? ou vai impactar na venda do produto para o cliente final? Como a reforma tributaria esbarra nas incorporadoras? O que um lucro de uma grande incorporadora pode trazer de tendencia para outros incorporadores? Sempre trazendo a relacao da noticia com o mundo dos incorporadores.\n\n4. Inclua uma pergunta ou convite leve para o Incorporador refletir ou comentar, algo trazendo uma discussao pelos comentarios, pedindo opiniao, trazendo alguma polemica, etc..\n\n5. Acrescente **exatamente uma** linha final, separada por \\n\\n, com o texto:\n\"Siga @imobjournal.ia para ficar por dentro das principais notícias do mercado imobiliário!\"\"\n\nUse esta estrutura apenas como referência interna para construir a legenda (não escreva os títulos dos blocos na legenda final).\n\nA legenda não deve parecer um convite para acessar a matéria completa. Ela já entrega o que importa.\n\nRetorne no seguinte formato JSON (precisa retornar exatamente nesse formato com todos esses campos)\n\n\n[\n  {\n    \"titulo\": \"Seu título original aqui\",\n    \"legenda\": \"Legenda estruturada\",\n    \"imagem\": \"{{ $json.imagem }}\",\n    \"fonte\": \"{{ $json.link }}\",\n    \"nota\": 0-10 (número inteiro)\n  }\n]\n\nGaranta que cada item do array corresponde a uma notícia realmente única, com título e legenda originais, prontos para capturar e engajar o público do Instagram imobiliário.\n\n**Lista de notícias:**\nLink: {{ $json.link }}\nTitulo: {{ $json.title }}\nConteudo: {{ $json.content }}\nConteudo2: {{ $json.contentSnippet }}\n\nRetorne diretamente como JSON válido (não como string). Sem aspas no array completo.\n\nNa legenda, utilize \"\\n\\n\" para representar quebras de linha, separando claramente os blocos de conteúdo (gancho, contexto, CTA).","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-3360,704],"id":"d35da0f1-7a7b-485a-884c-68d38e159346","name":"AI Agent - Estrutura dos Posts","onError":"continueRegularOutput"},{"parameters":{"jsCode":"const allNoticias = items.flatMap(item => JSON.parse(item.json.output));\n\nreturn allNoticias.map((noticia, index) => {\n  return {\n    json: {\n      ...noticia\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2992,704],"id":"ea1c9060-5528-43e0-9d9e-c60b449eda14","name":"Estruturação do JSON de saída","onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"6cb1827b-7e9b-4c1d-9553-704a28bc6cff","name":"html","value":"=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n\n    html, body {\n      width: 1080px;\n      height: 1350px;\n      overflow: hidden;\n      background: black;\n      font-family: Arial, sans-serif;\n    }\n\n    .container {\n      position: relative;\n      width: 1080px;\n      height: 1350px;\n      background-image: url(\"{{$json['imagem']}}\");\n      background-size: cover;\n      background-position: center center;\n      background-repeat: no-repeat;\n    }\n\n    .overlay-gradient {\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      width: 100%;\n      height: 40%;\n      background: linear-gradient(to top, rgba(0,0,0,0.85), transparent);\n      z-index: 1;\n    }\n\n    .logo {\n      position: absolute;\n      top: 40px;\n      right: 50px;\n      width: 168px;\n      z-index: 2;\n    }\n\n    .text-block {\n      position: absolute;\n      bottom: 200px;\n      left: 50px;\n      right: 50px;\n      max-width: calc(100% - 100px);\n      z-index: 2;\n      color: white;\n    }\n\n    .tag {\n      display: inline-block;\n      background-color: #f37021; /* laranja do logo */\n      color: white;\n      font-size: 28px;\n      font-weight: bold;\n      padding: 10px 20px;\n      margin-bottom: 20px;\n    }\n\n    .text-block h2 {\n      margin: 0;\n      font-size: 56px;\n      font-weight: bold;\n      line-height: 1.2;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"overlay-gradient\"></div>\n    <img class=\"logo\" src=\"https://i.ibb.co/XfPKQQ9v/imgjournal-removebg-preview.png\" />\n    <div class=\"text-block\">\n      <div class=\"tag\">MERCADO IMOBILIÁRIO</div>\n      <h2>{{$json[\"titulo\"]}}</h2>\n    </div>\n  </div>\n</body>\n</html>","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2448,688],"id":"cc73a1a8-0cf3-4421-978a-9c2c1982d9d2","name":"Criação do HTML da Imagem"},{"parameters":{"content":"# Estruturação dos Posts\n\n### Lógica para definir estrutura dos posts. Escolhe o que é mais relevante e reescreve título, legenda e prepara JSON para etapas seguintes.","height":576,"width":1040},"type":"n8n-nodes-base.stickyNote","position":[-3648,464],"typeVersion":1,"id":"77d83326-cebf-49e9-a0c7-5423fab6147c","name":"Sticky Note10"},{"parameters":{"content":"# Edição das Imagens\n\n### Todas as transformações necessárias para ter a imagem final. \n### Publicação da imagem no Github, geração do link público da imagem e transformação para base64 (para envio no whatsapp).","height":1296,"width":1456},"type":"n8n-nodes-base.stickyNote","position":[-2576,96],"typeVersion":1,"id":"86fa443b-841b-4558-aa39-f77aa53c98eb","name":"Sticky Note11"},{"parameters":{"method":"POST","url":"https://hcti.io/v1/image","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Basic MDRlZDA4NWYtYmY0OS00MzIyLWExMzEtMzY3ZjA1YmRiOTllOmQ0MzhjODk3LTVlYzctNGMyNS1iMjM0LWY5NGYyNjc1OGRhYQ=="}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"html","value":"={{ $json.html }}"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2256,464],"id":"49f21a5e-5202-4aa7-be97-d91debba9953","name":"HTML > Imagem","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"file","outputPropertyName":"imagem_final"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2048,464],"id":"f0744d87-de2a-4d32-8944-51133ec7bb2c","name":"Baixar imagem"},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"getmia","mode":"list","cachedResultName":"getmia","cachedResultUrl":"https://github.com/getmia"},"repository":{"__rl":true,"value":"miabuilder-images","mode":"list","cachedResultName":"miabuilder-images","cachedResultUrl":"https://github.com/getmia/miabuilder-images"},"filePath":"=images/{{$now.toFormat(\"yyyyMMddHHmmssSSS\")}}.jpg","binaryData":true,"binaryPropertyName":"imagem_final","commitMessage":"Adicionando imagem via n8n"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[-1536,336],"id":"206352f9-8757-48e5-a8f1-260023afe52a","name":"Salvar imagem no GitHub","webhookId":"d84e456d-0ee3-448d-bbba-f9a2bb39b0ab","credentials":{"githubApi":{"id":"Gd4bGzglU6thixeI","name":"GitHub account"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":4,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-816,640],"id":"7d43f04e-a624-45df-a893-d6af942430eb","name":"Dados + Imagem Final","onError":"continueRegularOutput"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Finamob - Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":[],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-48,864],"id":"c277e216-9ca3-4a7c-b9cc-947999070cbf","name":"Salvar no Sheets Controle","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"return items.map(item => {\n  const {\n    noticia_id, titulo, legenda = '', fonte, imagem,\n    arquivo_base64, imagem_url, imagem_url2, status, nota\n  } = item.json;\n\n  const data_processamento = new Date().toLocaleDateString('pt-BR');\n\n  return {\n    json: {\n      noticia_id,\n      data_processamento,\n      titulo,\n      legenda: legenda.replace(/\\\\n/g, '\\n\\n'),\n      fonte,\n      imagem,\n      arquivo_base64,\n      imagem_url,\n      imagem_url2,     // <-- agora vai junto\n      status,\n      nota\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-256,864],"id":"f324f201-194f-4e16-a9f8-b9ebb87ee9b7","name":"Filtro dos dados consolidados"},{"parameters":{"jsCode":"const dataAgora = new Date();\nconst yyyy = dataAgora.getFullYear();\nconst mm = String(dataAgora.getMonth() + 1).padStart(2, '0');\nconst dd = String(dataAgora.getDate()).padStart(2, '0');\nconst hh = String(dataAgora.getHours()).padStart(2, '0');\nconst min = String(dataAgora.getMinutes()).padStart(2, '0');\nconst ss = String(dataAgora.getSeconds()).padStart(2, '0');\n\nconst base = `noticia_${yyyy}${mm}${dd}_${hh}${min}${ss}`;\n\n// coleta TODAS as download_url (inclui download_url2) de TODOS os itens\nfunction collectDownloadUrls(obj, acc = []) {\n  if (!obj || typeof obj !== 'object') return acc;\n  for (const [k, v] of Object.entries(obj)) {\n    if ((k === 'download_url' || k === 'download_url2') && typeof v === 'string') acc.push(v);\n    else if (v && typeof v === 'object') collectDownloadUrls(v, acc);\n  }\n  return acc;\n}\n\n// URLs únicas vindas de todos os itens (ramo img1 + ramo img2)\nconst urlsAll = Array.from(new Set(items.flatMap(i => collectDownloadUrls(i.json))));\n\n// primeira e segunda URL do lote\nconst url1 = urlsAll[0] ?? null;\nconst url2 = urlsAll.find(u => u !== url1) ?? null;\n\nreturn items.map((item, index) => {\n  const sequencial = String(index + 1).padStart(3, '0');\n  const noticia_id = `${base}_${sequencial}`;\n\n  // se já vier setado no item, respeita; senão usa as do lote\n  const imagem_url  = item.json.imagem_url  ?? item.json.download_url  ?? url1;\n  const imagem_url2 = item.json.imagem_url2 ?? item.json.download_url2 ?? url2;\n\n  return {\n    json: {\n      ...item.json,\n      noticia_id,\n      status: item.json.status ?? 'aguardando',\n      arquivo_base64: `${noticia_id}.txt`,\n      imagem_url,\n      imagem_url2,\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-560,672],"id":"62063f0d-09cb-48f2-ad3f-d91c125688e0","name":"Criação Id + Link Github"},{"parameters":{"content":"# Atualização Controles e Envio do resultado por Whatsapp\n\n### Atualiza sheets e drive com informações e arquivos importantes\n### Envio do post completo por whatsapp para aprovador","height":656,"width":1312},"type":"n8n-nodes-base.stickyNote","position":[-1008,416],"typeVersion":1,"id":"c3176cb6-ea96-4815-aba8-5da6c2eaca72","name":"Sticky Note12"},{"parameters":{"url":"https://www.papoimobiliario.com/feed","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-880],"id":"fe9eb880-df23-4353-ba5e-fe147992e828","name":"RSS Papo Imobiliário","onError":"continueRegularOutput"},{"parameters":{"url":"https://exame.com/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-720],"id":"8ef15631-840a-470d-a7bf-42ab738db69e","name":"RSS Exame","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.infomoney.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-544],"id":"deaa0459-23ff-405c-ad8a-6314cf1c8346","name":"RSS infomoney","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.portalvgv.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-384],"id":"d3009a2c-c10a-4150-a7f4-4c1255d53cee","name":"RSS Portal VGV","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0c9a2cce-1e4b-4f37-9c24-91e5375e8efe","leftValue":"={{ $json.nota }}","rightValue":7,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2784,704],"id":"aa4b322c-eb24-423b-96ac-a3080ae9be3e","name":"Filtro Relevância"},{"parameters":{"operation":"crop","dataPropertyName":"imagem_final","width":1080,"height":1350,"options":{"format":"jpeg"}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[-1824,464],"id":"7e6e3844-4cbd-4540-b1a8-b33f8cc09e0d","name":"Cortar imagem 1080x1350"},{"parameters":{"url":"https://www.moneytimes.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-224],"id":"2f4e14b3-1f68-4f86-9328-b89c2ea8cad1","name":"RSS Portal Money Times","onError":"continueRegularOutput"},{"parameters":{"url":"https://cbic.org.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,-64],"id":"04ab05b9-ed0a-4df2-a2be-deeae17c8b8b","name":"RSS CBIC (Câmara Brasileira da Indústria da Construção)","onError":"continueRegularOutput"},{"parameters":{"url":"https://startupi.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,96],"id":"6503db9e-221a-4433-b62c-f63b79865e79","name":"RSS Startupi","onError":"continueRegularOutput"},{"parameters":{"url":"https://g1.globo.com/rss/g1/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,272],"id":"4a207268-3bc5-4e03-b6ed-f64aab642a32","name":"RSS Globo G1","onError":"continueRegularOutput"},{"parameters":{"url":"https://feeds.bbci.co.uk/portuguese/rss.xml","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,416],"id":"2997d38f-f97e-4963-a57a-e8cd9f5d2a2a","name":"RSS BBC","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.cnnbrasil.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,560],"id":"2ca5f745-b5c4-4d4e-9046-96a08a38ce21","name":"RSS CNN","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.jornaldooeste.com.br/rss/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,752],"id":"bd68a171-7162-4fd4-8c5a-3ddb9b520a73","name":"RSS Jornal do Oeste","onError":"continueRegularOutput"},{"parameters":{"url":"https://www12.senado.leg.br/noticias/rss/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,896],"id":"f2da5a60-f440-4283-9d50-206c593585eb","name":"RSS Senado","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/ultimas-noticias","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,1040],"id":"27ab9bf5-959f-41d6-940e-6af9dc30b5f0","name":"RSS Camara","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/dinamico/AGROPECUARIA","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,1200],"id":"4bdb90a5-9ebf-4c6b-9da8-ae715bedfdd4","name":"RSS Camara Agro","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/dinamico/ELEICOES","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,1360],"id":"81116aa0-007f-4035-912c-786c605e55a6","name":"RSS Camara Eleicoes","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/dinamico/ADMINISTRACAO-PUBLICA","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,1520],"id":"dda524f1-d655-43ca-81a2-6ec81dd0ee21","name":"RSS Camara Adm Publica","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/dinamico/POLITICA","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,1696],"id":"53eb5c9e-d826-4277-98ed-9890080d63bf","name":"RSS Camara Politica","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/dinamico/ECONOMIA","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,1856],"id":"3172df5d-e069-4298-b60f-0f5e4c440df8","name":"RSS Camara Economia","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.camara.leg.br/noticias/rss/dinamico/CIDADES","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,2016],"id":"d76b5f56-60ee-4eb5-bf80-3dd039a95a6d","name":"RSS Camara Cidades","onError":"continueRegularOutput"},{"parameters":{"url":"https://agenciabrasil.ebc.com.br/rss/ultimasnoticias/feed.xml","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,2176],"id":"d5d08157-db65-477c-a02d-b95591dd8d3d","name":"RSS Agencia Brasil","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.theguardian.com/world/rss","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,2336],"id":"6a535445-65d2-4689-be40-c36cb345c0b8","name":"RSS The Guardian","onError":"continueRegularOutput"},{"parameters":{"url":"https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,2480],"id":"189e41d1-5656-494c-a4d0-9ce3b2140141","name":"RSS nytimes","onError":"continueRegularOutput"},{"parameters":{"url":"https://rss.dw.com/rdf/rss-en-top","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,2624],"id":"4ea15b9a-ed84-45b9-b9dd-c116eef05f4b","name":"RSS Deutsche Welle","onError":"continueRegularOutput"},{"parameters":{"url":"https://www.aljazeera.com/xml/rss/all.xml","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-8432,2784],"id":"f72c02f5-be8f-4e6d-8f12-bd9910453850","name":"RSS Al Jazeera","onError":"continueRegularOutput"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-7792,848],"id":"09665444-bcd7-4eb6-b186-75be69cf13b7","name":"Notícias Consolidadas1"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-7792,2272],"id":"fb2a23f0-9252-445f-a32a-f43d3d9bcc00","name":"Notícias Consolidadas2"},{"parameters":{"numberInputs":3},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-7376,960],"id":"c5ffb717-15d2-4716-9053-8c60ea3130d5","name":"Notícias Consolidadas3"},{"parameters":{"operation":"createFromText","content":"={{ $json.base64Image }}","name":"={{$json[\"arquivo_base64\"]}}","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1-TqSloGeJhKGhoDNe9bI6jhDmRcH0KAM","mode":"list","cachedResultName":"base64","cachedResultUrl":"https://drive.google.com/drive/folders/1-TqSloGeJhKGhoDNe9bI6jhDmRcH0KAM"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-256,672],"id":"ee9d45ad-eaf3-4f5d-96bb-c00c69a8eb66","name":"Create base64.txt","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"6cb1827b-7e9b-4c1d-9553-704a28bc6cff","name":"html","value":"=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>CTA Journal</title>\n  <style>\n    * { margin:0; padding:0; box-sizing:border-box; }\n    html, body {\n      width:1080px; height:1350px; overflow:hidden; background:#000; font-family: Arial, Helvetica, sans-serif;\n    }\n    :root{\n      /* cor do logo (ajuste se quiser): */\n      --brand:#f36f21;\n      --text:#ffffff;\n      --muted:#cfcfcf;\n    }\n    .wrap{position:relative; width:1080px; height:1350px; background:#000;}\n    /* bloco central com logo e CTA */\n    .center{\n      position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:36px; padding:80px 80px 140px;\n      text-align:center;\n    }\n    .logo{\n      width:480px; height:auto; filter: drop-shadow(0 10px 24px rgba(0,0,0,.6));\n    }\n    .title{\n      font-size:64px; line-height:1.12; font-weight:800; color:var(--text);\n      letter-spacing:.2px;\n    }\n    .highlight{ color:var(--brand); }\n    .subtitle{\n      margin-top:6px; font-size:30px; line-height:1.46; color:var(--muted);\n    }\n    /* barra inferior com ícones de engajamento */\n    .footer{\n      position:absolute; left:0; right:0; bottom:0; height:160px; display:flex; align-items:center; justify-content:center; gap:56px;\n      border-top:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.6) 30%, rgba(0,0,0,.85) 100%);\n    }\n    .action{\n      display:flex; align-items:center; gap:14px; color:var(--text); font-size:28px; font-weight:700;\n      text-transform:uppercase; letter-spacing:.8px;\n    }\n    .action .label{opacity:.9}\n    .icon{ width:44px; height:44px; display:inline-block; }\n    /* selo no topo (opcional) */\n    .badge{\n      position:absolute; top:40px; left:40px; color:#111; background:var(--brand); padding:10px 16px; font-weight:800; font-size:22px; border-radius:999px;\n      letter-spacing:.5px;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wrap\">\n    <div class=\"badge\">JOURNAL</div>\n\n    <div class=\"center\">\n      <img class=\"logo\" src=\"https://i.ibb.co/XfPKQQ9v/imgjournal-removebg-preview.png\" alt=\"Logo\" />\n      <div class=\"title\">\n        Siga a <span class=\"highlight\">página</span> para as principais\n        notícias do mercado imobiliário.\n      </div>\n      <div class=\"subtitle\">\n        Assine o nosso <span class=\"highlight\">Journal</span> — <b>link na bio</b>.\n      </div>\n    </div>\n\n    <div class=\"footer\">\n      <!-- like -->\n      <div class=\"action\">\n        <svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <path d=\"M7 22H5a3 3 0 0 1-3-3v-7a3 3 0 0 1 3-3h2v13Z\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          <path d=\"M7 9l5-6a2 2 0 0 1 3 2l-1 5h5a2 2 0 0 1 2 2l-2 8a2 2 0 0 1-2 2H7\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <span class=\"label\">Curtir</span>\n      </div>\n      <!-- comment -->\n      <div class=\"action\">\n        <svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <path d=\"M21 15a4 4 0 0 1-4 4H8l-5 4V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v10Z\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <span class=\"label\">Comentar</span>\n      </div>\n      <!-- share -->\n      <div class=\"action\">\n        <svg class=\"icon\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <path d=\"M4 12l7-7v4c6 0 9 3 9 9-2-3-5-4-9-4v4l-7-6Z\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <span class=\"label\">Compartilhar</span>\n      </div>\n    </div>\n  </div>\n</body>\n</html>","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2448,1184],"id":"79a46c77-74d0-4d19-a14c-4d90397fac92","name":"Criação do HTML da Imagem1"},{"parameters":{"method":"POST","url":"https://hcti.io/v1/image","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Basic MDRlZDA4NWYtYmY0OS00MzIyLWExMzEtMzY3ZjA1YmRiOTllOmQ0MzhjODk3LTVlYzctNGMyNS1iMjM0LWY5NGYyNjc1OGRhYQ=="}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"html","value":"={{ $json.html }}"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2256,960],"id":"f34a28c5-94db-4e82-9f91-1c55a99a308c","name":"HTML > Imagem1","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"file","outputPropertyName":"imagem_final"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2048,960],"id":"e336ec90-605c-49d8-ab15-a447cd681636","name":"Baixar imagem1"},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"getmia","mode":"list","cachedResultName":"getmia","cachedResultUrl":"https://github.com/getmia"},"repository":{"__rl":true,"value":"miabuilder-images","mode":"list","cachedResultName":"miabuilder-images","cachedResultUrl":"https://github.com/getmia/miabuilder-images"},"filePath":"=images/{{$now.toFormat(\"yyyyMMddHHmmssSSS\")}}2.jpg","binaryData":true,"binaryPropertyName":"imagem_final","commitMessage":"Adicionando imagem via n8n"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[-1536,960],"id":"2ffa74e9-2de7-46d1-856c-e64338b1fe2a","name":"Salvar imagem no GitHub1","webhookId":"d84e456d-0ee3-448d-bbba-f9a2bb39b0ab","credentials":{"githubApi":{"id":"Gd4bGzglU6thixeI","name":"GitHub account"}}},{"parameters":{"operation":"crop","dataPropertyName":"imagem_final","width":1080,"height":1350,"options":{"format":"jpeg"}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[-1824,960],"id":"96f72ee2-f92a-4155-83b2-56b9cb01b84f","name":"Cortar imagem 1080x1351"},{"parameters":{"assignments":{"assignments":[{"id":"44644f81-81ee-4f9f-a299-8c3b33541f3d","name":"download_url2","value":"={{ $json.content.download_url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1312,960],"id":"476e1192-ae87-448e-9fc2-792cb796e8c0","name":"Create download_url2"},{"parameters":{"assignments":{"assignments":[{"id":"68aef7bc-9f60-4636-bc5f-06de8889a312","name":"download_url","value":"={{ $json.content.download_url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1328,336],"id":"a1c9602e-a16c-4895-ad2c-a2aeb3751c80","name":"Create download_url"},{"parameters":{"jsCode":"// === Parâmetros ===\nconst THRESHOLD = 80;           // mínimo para aprovar\nconst MAX_ITENS = 30;           // máximo a retornar\nconst DECAY_HALF_LIFE_H = 48;   // meia-vida da recência (horas)\nconst DEDUPE_SIMILARITY = 0.85; // similaridade p/ dedupe (0..1)\nconst KEEP_SCORE_IN_OUTPUT = false; // true só p/ debug\n\n// === Dicionários de relevância (mercado imobiliário) ===\nconst KW = {\n  forte: [\n    // Termos centrais do setor\n    'imóvel','imoveis','imovel','imobiliario','mercado imobiliario',\n    'apartamento','apartamentos','casa','casas',\n    'condominio','condominios','empreendimento','empreendimentos',\n    'loteamento','lançamento','construção','obra',\n    'aluguel','aluguéis','locação','comprar imóvel','venda de imóveis',\n    'financiamento imobiliario','credito imobiliario','hipoteca',\n    'sbpe','fgts','carta de crédito','consórcio imobiliário',\n    'minha casa minha vida','casa verde e amarela','mcmv',\n    'taxa de juros','selic','copom','inadimplência imobiliária',\n    'registro de imóveis','cartório de imóveis','escritura','averbação',\n    'iptu','itbi','patrimônio de afetação',\n    'incorporadora','construtora','imobiliária',\n    'fundo imobiliário','fii','fiis','lci','lca','cri','cra',\n    'cyrela','mrv','tenda','direcional','cury','eztec','loft','quintoandar'\n  ],\n  medio: [\n    'distrato','repasse','estoque de imóveis',\n    'plano diretor','zoneamento','uso do solo','licenciamento urbano',\n    'habite-se','alvará de construção','regularização fundiária',\n    'vacância','taxa de vacância','cap rate','valor venal','valuation imobiliário',\n    'smart city','cidade inteligente','urbanismo','arquitetura sustentável',\n    'sustentabilidade na construção','green building','esg','leed'\n  ],\n  fracos: [\n    'futebol','bbb','celebridade','cantor','cantora','show',\n    'meme','tiktok','game','jogo','filme','série','streaming'\n  ],\n  brasil: [\n    'brasil','são paulo','rio de janeiro','belo horizonte','curitiba','porto alegre',\n    'pernambuco','bahia','fortaleza','manaus','goiânia','campinas',\n    'caixa','banco do brasil','itaú','bradesco','santander','inter','sicredi','sicoob'\n  ],\n  contextoEco: [\n    'mercado de capitais','funding imobiliário','captação',\n    'juros','selic','copom','pib','inflação','ipca','igpm',\n    'crédito','investimento imobiliário','economia digital',\n    'setor de construção','setor imobiliário'\n  ]\n};\n\n// === Funções auxiliares ===\nconst norm = (s='') =>\n  String(s).toLowerCase()\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g,'')\n    .replace(/https?:\\/\\/\\S+/g,' ')\n    .replace(/[^\\p{L}\\p{N}\\s]/gu,' ')\n    .replace(/\\s+/g,' ')\n    .trim();\n\nconst tokens = s => new Set(norm(s).split(' ').filter(t => t.length > 2));\n\nconst tokenSimilarity = (a,b) => {\n  const A = tokens(a), B = tokens(b);\n  const inter = [...A].filter(t => B.has(t)).length;\n  return inter / (Math.max(A.size, B.size) || 1);\n};\n\nconst hasAny = (text, list) => {\n  const t = norm(text);\n  return list.some(k => t.includes(norm(k)));\n};\n\nconst hoursSince = (d) => {\n  if (!d) return 1e9;\n  const ts = new Date(d).getTime();\n  return isNaN(ts) ? 1e9 : (Date.now() - ts) / 36e5;\n};\n\nconst recencyMultiplier = (h) => {\n  const lambda = Math.log(2) / DECAY_HALF_LIFE_H;\n  return Math.exp(-lambda * h);\n};\n\nconst scoreItem = (j) => {\n  const title = j.title || '';\n  const body = j['content:encoded'] || j.content || '';\n  const snippet = j.contentSnippet || '';\n  const cats = Array.isArray(j.categories)\n    ? j.categories.map(c => typeof c === 'string' ? c : JSON.stringify(c)).join(' ')\n    : (typeof j.categories === 'string' ? j.categories : '');\n  const text = `${title} ${snippet} ${body} ${cats}`;\n\n  let score = 0;\n  const forte = hasAny(text, KW.forte);\n  const contexto = hasAny(text, KW.contextoEco);\n\n  if (forte) score += 40;\n  if (hasAny(text, KW.medio)) score += 20;\n  if (hasAny(text, KW.brasil)) score += 10;\n  if (hasAny(text, KW.fracos)) score -= 50;\n\n  if (forte && contexto) score += 30;\n\n  const hasNumber = /\\b\\d+([.,]\\d+)?\\b/.test(text);\n  const hasPercent = /%\\b/.test(text);\n  if (contexto && hasPercent) score += 15;\n  else if (contexto && hasNumber) score += 5;\n\n  score *= recencyMultiplier(hoursSince(j.isoDate || j.pubDate));\n  return Math.max(0, Math.min(100, Math.round(score)));\n};\n\n// === Pipeline ===\nconst seenTitles = [];\nconst scoredItems = [];\n\nfor (const item of items) {\n  const j = { ...item.json };\n  const s = scoreItem(j);\n\n  let dup = false;\n  for (const prevTitle of seenTitles) {\n    if (tokenSimilarity(prevTitle, j.title || '') >= DEDUPE_SIMILARITY) {\n      dup = true; break;\n    }\n  }\n  if (dup) continue;\n\n  if (s >= THRESHOLD) {\n    seenTitles.push(j.title || '');\n    if (KEEP_SCORE_IN_OUTPUT) j._score = s;\n    scoredItems.push({ json: j, _score: s });\n  }\n}\n\nscoredItems.sort((a,b) => b._score - a._score);\nreturn scoredItems.slice(0, MAX_ITENS).map(i => ({ json: i.json }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6624,960],"id":"06d9ee31-ffdc-4869-ba3c-3d616f8aaedb","name":"Code"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 1 / 2 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6960,976],"id":"2d7c5184-b3c5-47b8-b207-baefa1c3c8cf","name":"Filtro de data da notícia","onError":"continueRegularOutput"},{"parameters":{"resource":"image","prompt":"=Gere uma imagem moderna e realista sobre o seguinte tema:\n[{{ $json.title }}]\n\nA imagem deve ser de alta qualidade, chamativa, ideal para um post profissional no Instagram. Não inclua textos na imagem.\n","options":{"returnImageUrls":true}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4208,1088],"id":"73bbf9fb-9d32-45d5-87c9-d1c9876fc581","name":"Gerar imagem com IA1","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"text":"Você é um avaliador de qualidade de imagens.\n\nSua tarefa:\n- Analise a imagem recebida.\n- De uma nota de 0 a 10 para a imagem pensando em quanto a imagem esta boa para postarmos nas redes sociais\n\nResponda **apenas** com uma das duas palavras:  \n\n- Se a nota foi maior do que 6 responda com \"bom\"  \n- Se a nota foi menor ou igual a 6 responda com \"ruim\"","imageUrls":"={{ $json.imagem }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4960,416],"id":"78611137-ad21-40c0-925a-7dbad3b0eda2","name":"Analyze image1","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cf2d6cbd-1531-4e27-bee0-7d5bed199142","leftValue":"={{ $json.content }}","rightValue":"ruim","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-4784,416],"id":"7d410a2b-62b4-42ec-a833-8e98dda4f806","name":"If1"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Pega os dados originais da padronização\nconst original = $('Padronização do campo imagem1').item.json;\n\nreturn {\n  ...original\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3952,864],"id":"f61f0f9a-5b00-422f-a14c-aed32a6cf374","name":"Salvar imagem gerada5"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Pega os dados originais da padronização\nconst original = $('Padronização do campo imagem1').item.json;\n\n// Sobrescreve o campo imagem com a URL do item atual\nreturn {\n  ...original,\n  imagem: $json.url\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3952,1088],"id":"2d7d6c6e-0d52-49c9-979d-4ec101aacbf5","name":"Salvar imagem gerada4"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const html = $json.data || $json.body || '';\nconst ogImageMatch = html.match(/<meta\\s+property=[\"']og:image[\"']\\s+content=[\"']([^\"']+)[\"']/i);\nlet imagem = ogImageMatch ? ogImageMatch[1] : '';\n\nif (!imagem) {\n  const imgMatch = html.match(/<img[^>]+src=[\"']([^\"']+)[\"']/i);\n  if (imgMatch) {\n    imagem = imgMatch[1];\n  }\n}\n\n// Recupera os campos originais da notícia de 'Backup dados da notícia1'\nreturn {\n  ...($('Cria copia dos campos').item.json.original || {}),\n  imagem: $json.url // aqui pega a URL da imagem gerada pela IA\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3952,640],"id":"659aa21d-26b8-45ee-84c7-c3197a66bae3","name":"Salvar imagem gerada2"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const html = $json.data || $json.body || '';\nconst ogImageMatch = html.match(/<meta\\s+property=[\"']og:image[\"']\\s+content=[\"']([^\"']+)[\"']/i);\nlet imagem = ogImageMatch ? ogImageMatch[1] : '';\n\nif (!imagem) {\n  const imgMatch = html.match(/<img[^>]+src=[\"']([^\"']+)[\"']/i);\n  if (imgMatch) {\n    imagem = imgMatch[1];\n  }\n}\n\n// Recupera os campos originais da notícia de 'Backup dados da notícia1'\nreturn {\n  ...($('Cria copia dos campos').item.json.original || {}),\n  imagem: $('Imagem encontrada?1').item.json.imagem\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3952,400],"id":"57ca8bf3-103b-4185-bd3b-2a9125e5fbe4","name":"Salvar imagem gerada1"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Pega os dados originais do node \"Imagem encontrada?\"\nconst original = $('Imagem encontrada?1').item.json;\n\n// Junta tudo em um único objeto\nreturn {\n  ...original\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4592,512],"id":"af2ffb52-2847-4c9e-8a70-bac9456fda18","name":"Padronizar Campos"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-4400,640],"id":"a87dd3ff-bf92-4587-9648-7286f75023c7","name":"Merge3"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Coloque os possíveis campos que podem trazer a imagem direto do RSS\nconst possiveisCampos = [\n  $json['media:content']?.url,\n  $json['enclosure']?.url,\n  $json['image'],\n  $json['og:image']\n];\nconst imagemDireta = possiveisCampos.find(x => !!x);\n\nreturn {\n  ...$json,\n  imagem: imagemDireta || '' // Se não tiver, deixa vazio\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6288,960],"id":"f3addbb4-dd2b-43da-bebe-fdc8e64237e8","name":"Padronização do campo imagem1","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b5d79643-ef81-4cef-b02d-371990a64543","leftValue":"={{ $json.imagem }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6064,960],"id":"efc83cf2-55cb-4987-b680-dfff1b936aef","name":"Validação do campo imagem1"},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5632,640],"id":"db29e6f9-d235-4012-a06e-1368a90868ba","name":"Buscar HTML da notícia1","onError":"continueRegularOutput"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const html = $json.data || $json.body || '';\n\nconst ogImageMatch = html.match(/<meta\\s+property=[\"']og:image[\"']\\s+content=[\"']([^\"']+)[\"']/i);\nlet imagem = ogImageMatch ? ogImageMatch[1] : \"\";\n\nif (!imagem) {\n  const imgMatch = html.match(/<img[^>]+src=[\"']([^\"']+)[\"']/i);\n  if (imgMatch) {\n    imagem = imgMatch[1]; // aqui mantém a URL achada\n  }\n}\n\n// Recupera os campos originais da notícia de 'Backup dados da notícia1'\nreturn {\n  ...($('Cria copia dos campos').item.json.original || {}),\n  imagem\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5424,640],"id":"786af4df-70b7-4c22-aa6b-eb346dabdfa5","name":"Extrair imagem do HTML1","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"05295fc0-aca6-433a-a239-c5d8ed4fc011","leftValue":"={{ $json.imagem }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5216,640],"id":"d3285d97-bba6-4534-ad41-e21372391261","name":"Imagem encontrada?1","alwaysOutputData":false},{"parameters":{"resource":"image","prompt":"=Gere uma imagem moderna e realista sobre o seguinte tema:\n[{{ $json.title }}]\n\nA imagem deve ser de alta qualidade, chamativa, ideal para um post profissional no Instagram. Não inclua textos na imagem.\n","options":{"returnImageUrls":true}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4208,640],"id":"37ecb5b0-8cac-4385-b11c-29eed5595858","name":"Gerar imagem com IA2","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"text":"Você é um avaliador de qualidade de imagens.\n\nSua tarefa:\n- Analise a imagem recebida.\n- De uma nota de 0 a 10 para a imagem pensando em quanto a imagem esta boa para postarmos nas redes sociais\n\nResponda **apenas** com uma das duas palavras:  \n\n- Se a nota foi maior do que 6 responda com \"bom\"  \n- Se a nota foi menor ou igual a 6 responda com \"ruim\"","imageUrls":"={{ $json.imagem }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-5648,976],"id":"65160137-67c0-45ee-a9b4-85738a97305e","name":"Analyze image2","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cf2d6cbd-1531-4e27-bee0-7d5bed199142","leftValue":"={{ $json.content }}","rightValue":"ruim","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5216,976],"id":"1e0561dc-cf26-4bb8-b617-4be096d902e9","name":"If2"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"return {\n  ...$json,\n  original: $json // salva todos os dados da notícia\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5840,640],"id":"d7359818-2212-466d-b138-0e914193db0e","name":"Cria copia dos campos"}],"connections":{"RSS Folha":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":1}]]},"RSS Investing":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":0}]]},"RSS Metro Quadrado":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":2}]]},"Schedule Trigger":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"No Operation, do nothing":{"main":[[{"node":"RSS Folha","type":"main","index":0},{"node":"RSS Metro Quadrado","type":"main","index":0},{"node":"RSS Investing","type":"main","index":0},{"node":"RSS Papo Imobiliário","type":"main","index":0},{"node":"RSS Exame","type":"main","index":0},{"node":"RSS Portal VGV","type":"main","index":0},{"node":"RSS infomoney","type":"main","index":0},{"node":"RSS Portal Money Times","type":"main","index":0},{"node":"RSS CBIC (Câmara Brasileira da Indústria da Construção)","type":"main","index":0},{"node":"RSS Startupi","type":"main","index":0},{"node":"RSS Globo G1","type":"main","index":0},{"node":"RSS BBC","type":"main","index":0},{"node":"RSS CNN","type":"main","index":0},{"node":"RSS Jornal do Oeste","type":"main","index":0},{"node":"RSS Senado","type":"main","index":0},{"node":"RSS Camara","type":"main","index":0},{"node":"RSS Camara Agro","type":"main","index":0},{"node":"RSS Camara Eleicoes","type":"main","index":0},{"node":"RSS Camara Adm Publica","type":"main","index":0},{"node":"RSS Camara Politica","type":"main","index":0},{"node":"RSS Camara Economia","type":"main","index":0},{"node":"RSS Camara Cidades","type":"main","index":0},{"node":"RSS Agencia Brasil","type":"main","index":0},{"node":"RSS The Guardian","type":"main","index":0},{"node":"RSS nytimes","type":"main","index":0},{"node":"RSS Deutsche Welle","type":"main","index":0},{"node":"RSS Al Jazeera","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent - Estrutura dos Posts","type":"ai_languageModel","index":0}]]},"Binary > base64":{"main":[[{"node":"Dados + Imagem Final","type":"main","index":1}]]},"Notícias Consolidadas":{"main":[[{"node":"Notícias Consolidadas3","type":"main","index":0}]]},"Unificar imagem final":{"main":[[{"node":"AI Agent - Estrutura dos Posts","type":"main","index":0}]]},"AI Agent - Estrutura dos Posts":{"main":[[{"node":"Estruturação do JSON de saída","type":"main","index":0}]]},"Estruturação do JSON de saída":{"main":[[{"node":"Filtro Relevância","type":"main","index":0}]]},"Criação do HTML da Imagem":{"main":[[{"node":"HTML > Imagem","type":"main","index":0},{"node":"Dados + Imagem Final","type":"main","index":2}]]},"HTML > Imagem":{"main":[[{"node":"Baixar imagem","type":"main","index":0}]]},"Baixar imagem":{"main":[[{"node":"Cortar imagem 1080x1350","type":"main","index":0}]]},"Salvar imagem no GitHub":{"main":[[{"node":"Create download_url","type":"main","index":0}]]},"Dados + Imagem Final":{"main":[[{"node":"Criação Id + Link Github","type":"main","index":0}]]},"Salvar no Sheets Controle":{"main":[[]]},"Filtro dos dados consolidados":{"main":[[{"node":"Salvar no Sheets Controle","type":"main","index":0}]]},"Criação Id + Link Github":{"main":[[{"node":"Filtro dos dados consolidados","type":"main","index":0},{"node":"Create base64.txt","type":"main","index":0}]]},"RSS Papo Imobiliário":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":3}]]},"RSS Exame":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":4}]]},"RSS infomoney":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":5}]]},"RSS Portal VGV":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":6}]]},"Filtro Relevância":{"main":[[{"node":"Criação do HTML da Imagem","type":"main","index":0},{"node":"Criação do HTML da Imagem1","type":"main","index":0}]]},"Cortar imagem 1080x1350":{"main":[[{"node":"Binary > base64","type":"main","index":0},{"node":"Salvar imagem no GitHub","type":"main","index":0}]]},"RSS Portal Money Times":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":7}]]},"RSS CBIC (Câmara Brasileira da Indústria da Construção)":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":8}]]},"RSS Startupi":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":9}]]},"Notícias Consolidadas1":{"main":[[{"node":"Notícias Consolidadas3","type":"main","index":1}]]},"Notícias Consolidadas2":{"main":[[{"node":"Notícias Consolidadas3","type":"main","index":2}]]},"RSS Globo G1":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":0}]]},"RSS Al Jazeera":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":6}]]},"RSS Deutsche Welle":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":5}]]},"RSS nytimes":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":4}]]},"RSS The Guardian":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":3}]]},"RSS Agencia Brasil":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":2}]]},"RSS Camara Cidades":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":1}]]},"RSS Camara Economia":{"main":[[{"node":"Notícias Consolidadas2","type":"main","index":0}]]},"RSS Camara Politica":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":9}]]},"RSS Camara Adm Publica":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":8}]]},"RSS Camara Eleicoes":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":7}]]},"RSS Camara Agro":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":6}]]},"RSS Camara":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":5}]]},"RSS Senado":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":4}]]},"RSS Jornal do Oeste":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":3}]]},"RSS CNN":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":2}]]},"RSS BBC":{"main":[[{"node":"Notícias Consolidadas1","type":"main","index":1}]]},"Notícias Consolidadas3":{"main":[[{"node":"Filtro de data da notícia","type":"main","index":0}]]},"Create base64.txt":{"main":[[]]},"Criação do HTML da Imagem1":{"main":[[{"node":"HTML > Imagem1","type":"main","index":0}]]},"HTML > Imagem1":{"main":[[{"node":"Baixar imagem1","type":"main","index":0}]]},"Baixar imagem1":{"main":[[{"node":"Cortar imagem 1080x1351","type":"main","index":0}]]},"Cortar imagem 1080x1351":{"main":[[{"node":"Salvar imagem no GitHub1","type":"main","index":0}]]},"Salvar imagem no GitHub1":{"main":[[{"node":"Create download_url2","type":"main","index":0}]]},"Create download_url2":{"main":[[{"node":"Dados + Imagem Final","type":"main","index":3}]]},"Create download_url":{"main":[[{"node":"Dados + Imagem Final","type":"main","index":0}]]},"Code":{"main":[[{"node":"Padronização do campo imagem1","type":"main","index":0}]]},"Filtro de data da notícia":{"main":[[{"node":"Code","type":"main","index":0}]]},"Gerar imagem com IA1":{"main":[[{"node":"Salvar imagem gerada4","type":"main","index":0}]]},"Analyze image1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Salvar imagem gerada1","type":"main","index":0}],[{"node":"Padronizar Campos","type":"main","index":0}]]},"Padronizar Campos":{"main":[[{"node":"Merge3","type":"main","index":0}]]},"Merge3":{"main":[[{"node":"Gerar imagem com IA2","type":"main","index":0}]]},"Padronização do campo imagem1":{"main":[[{"node":"Validação do campo imagem1","type":"main","index":0}]]},"Validação do campo imagem1":{"main":[[{"node":"Cria copia dos campos","type":"main","index":0}],[{"node":"Analyze image2","type":"main","index":0}]]},"Buscar HTML da notícia1":{"main":[[{"node":"Extrair imagem do HTML1","type":"main","index":0}]]},"Extrair imagem do HTML1":{"main":[[{"node":"Imagem encontrada?1","type":"main","index":0}]]},"Imagem encontrada?1":{"main":[[{"node":"Analyze image1","type":"main","index":0}],[{"node":"Merge3","type":"main","index":1}]]},"Gerar imagem com IA2":{"main":[[{"node":"Salvar imagem gerada2","type":"main","index":0}]]},"Analyze image2":{"main":[[{"node":"If2","type":"main","index":0}]]},"If2":{"main":[[{"node":"Salvar imagem gerada5","type":"main","index":0}],[{"node":"Gerar imagem com IA1","type":"main","index":0}]]},"Salvar imagem gerada1":{"main":[[{"node":"Unificar imagem final","type":"main","index":0}]]},"Salvar imagem gerada2":{"main":[[{"node":"Unificar imagem final","type":"main","index":1}]]},"Salvar imagem gerada5":{"main":[[{"node":"Unificar imagem final","type":"main","index":2}]]},"Salvar imagem gerada4":{"main":[[{"node":"Unificar imagem final","type":"main","index":3}]]},"Cria copia dos campos":{"main":[[{"node":"Buscar HTML da notícia1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"Cem9y3zmcggUQhrp"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger":[{"json":{"timestamp":"2025-09-22T12:30:12.003-03:00","Readable date":"September 22nd 2025, 12:30:12 pm","Readable time":"12:30:12 pm","Day of week":"Monday","Year":"2025","Month":"September","Day of month":"22","Hour":"12","Minute":"30","Second":"12","Timezone":"America/Sao_Paulo (UTC-03:00)"}}]},"versionId":"8a4887bf-7474-47eb-80ae-09fe790baada","triggerCount":1,"tags":[]}