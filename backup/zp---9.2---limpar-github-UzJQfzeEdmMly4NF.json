{"createdAt":"2025-10-06T21:30:17.208Z","updatedAt":"2025-11-03T17:19:30.007Z","id":"UzJQfzeEdmMly4NF","name":"ZP - 9.2 - Limpar GitHub","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"weeks"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-176,384],"id":"137bacfa-e776-49db-8e3f-38c25ea6540c","name":"Schedule Trigger1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[448,384],"id":"7e9fb151-f1c0-4704-95bf-910819113c5d","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"3b7bdbdf-14bd-4be2-a2fe-d91f59bfaf9f","name":"Owner","value":"getmia-ia","type":"string"},{"id":"7ea8ddff-c64d-4978-b2e3-ac2cd706bf13","name":"Repository","value":"ZP","type":"string"},{"id":"3d4ab93f-fa96-4c8d-a2ae-4bfc70be4550","name":"path","value":"images/","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[32,384],"id":"1a823f67-46da-44f8-a538-ac60524715ab","name":"Dados para o GitHub"},{"parameters":{"authentication":"oAuth2","resource":"file","operation":"list","owner":{"__rl":true,"value":"={{ $json.Owner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $json.Repository }}","mode":"name"},"filePath":"={{ $json.path }}"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[224,384],"id":"30b8a92d-aaed-4390-b1ae-3b28a0b2389c","name":"Lista todos os arquivos do repositório","webhookId":"90fa00eb-63dc-446b-a56f-febcdca140d4","credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"method":"DELETE","url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/contents/{{ $('Lista todos os arquivos do repositório').item.json.path }}","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": \"Removendo arquivo antigo automaticamente\",\n  \"sha\": \"{{ $('Lista todos os arquivos do repositório').item.json.sha }}\",\n  \"committer\": {\n    \"name\": \"{{ $json.commit.committer.name }}\",\n    \"email\": \"{{ $json.commit.committer.email }}\"\n  }\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1408,384],"id":"697c2b38-aea3-46b8-9d19-0208d25518e0","name":"Deleta o arquivo do repositório","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32581fe4-aa4b-410a-986c-aec0ffa7ece3","leftValue":"={{ $json.commit.author.date }}","rightValue":"={{ $now.minus({ weeks: 1 }) }}","operator":{"type":"dateTime","operation":"beforeOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[848,400],"id":"16ac60ea-e692-461f-9248-d96fbcdc89bf","name":"Verifica se o arquivo está a mais de uma semana no repositório"},{"parameters":{"url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/commits","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"path","value":"={{ $('Lista todos os arquivos do repositório').item.json.path }}"},{"name":"per_page","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[672,400],"id":"cdfa7de6-6be9-4b52-8af8-63b2217b5b71","name":"Busca o último commit de cada arquivo","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"content":"## Fluxo que apaga arquivos que estão a mais de uma semana no repositório do GitHub\n(para as imagens das notícias)","height":400,"width":1872,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-272,256],"id":"ab7f49c9-3511-4be7-9c9e-00592fa1f5d6","name":"Sticky Note"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1232,384],"id":"8587dc57-5529-45be-add8-c01f7b52b45a","name":"Wait","webhookId":"c15acf1b-7e89-4275-ba34-ef49b83cddaf"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1056,416],"id":"7b943acd-fc40-4b75-b3ba-a552d1fe8a3f","name":"Wait1","webhookId":"0b514a72-d4e5-46b0-afa8-5a48bd1beb7e"}],"connections":{"Schedule Trigger1":{"main":[[{"node":"Dados para o GitHub","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Busca o último commit de cada arquivo","type":"main","index":0}]]},"Dados para o GitHub":{"main":[[{"node":"Lista todos os arquivos do repositório","type":"main","index":0}]]},"Lista todos os arquivos do repositório":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Deleta o arquivo do repositório":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Verifica se o arquivo está a mais de uma semana no repositório":{"main":[[{"node":"Wait","type":"main","index":0}],[{"node":"Wait1","type":"main","index":0}]]},"Busca o último commit de cada arquivo":{"main":[[{"node":"Verifica se o arquivo está a mais de uma semana no repositório","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Deleta o arquivo do repositório","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner"},"staticData":{"node:Schedule Trigger1":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6cb9ddaf-c803-4e9c-8cc4-a4092b856751","triggerCount":1,"tags":[]}