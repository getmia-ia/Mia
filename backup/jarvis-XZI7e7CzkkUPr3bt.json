{"createdAt":"2025-09-24T21:46:01.844Z","updatedAt":"2025-09-29T17:08:51.078Z","id":"XZI7e7CzkkUPr3bt","name":"Jarvis","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"jarvis","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-368,-80],"id":"885c3702-24f8-4976-b916-95b275642bd4","name":"Webhook","webhookId":"f221132e-e905-4712-bad7-ebaa439ad166"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"899f1945-dfd9-418e-9fe9-486bce7e3d31","leftValue":"={{ $json.body.data.key.remoteJid }}","rightValue":"553492150692@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[64,-80],"id":"6eb945b5-24e1-49ae-a425-2f942302f55b","name":"Checa se é meu número"},{"parameters":{"assignments":{"assignments":[{"id":"3274242f-a935-4bdc-b3a2-0ab6a431c1e5","name":"message.message_id","value":"={{ $json.body.data.key.id || '' }}","type":"string"},{"id":"c591d134-bd65-4bf2-9053-3b5b04ce23aa","name":"message.chat_id","value":"={{ $json.body.data.key.remoteJid.split('@')[0] || '' }}","type":"string"},{"id":"a240cbae-210d-4a44-8a2e-63370101b0e3","name":"message.content_type","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook').item.json.body.data.message.imageMessage ? 'image' : '' }}","type":"string"},{"id":"6b528294-d085-4268-a641-8139bed142f7","name":"message.content","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook').item.json.body.data.message.conversation || '' }}","type":"string"},{"id":"24410116-47d2-4fcd-adfa-78e41924c3a1","name":"message.Timestamp","value":"={{ $('Webhook').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}","type":"string"},{"id":"edfb3ce0-f55b-499e-a3d7-f611081593e9","name":"message.Content_URL","value":"={{ $('Webhook').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook').item.json.body.data.message.imageMessage?.url || '' }}","type":"string"},{"id":"53a66f67-6672-4073-aea8-7dabe0f4f744","name":"message.event","value":"={{ $('Webhook').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}","type":"string"},{"id":"2ba69342-7247-454b-821c-d96e2b7158e7","name":"instance.Name","value":"={{ $json.body.instance }}","type":"string"},{"id":"887fe0ca-61a4-4f40-96b2-a195d3546b7f","name":"instance.Apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"abddd312-8349-4b82-bdc6-8ef32af9c38b","name":"instance.Server_url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"39043730-b22c-49fa-9c4d-9d46a14547e2","name":"apiKey_eleven","value":"sk_42fbc1451ec664182e85eea225c0879a76c2c66240a854a5","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[432,-96],"id":"9757acf4-8e54-4dda-9428-2a9eb4663edc","name":"Preparar Dados"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.event }}","rightValue":"outcoming","operator":{"type":"string","operation":"equals"},"id":"4b7e37bc-c14a-4991-b619-fe8d4ec3cdb5"}],"combinator":"and"},"renameOutput":true,"outputKey":"outcoming"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0c4c964d-fd3e-41d6-bb33-391934410d65","leftValue":"={{ $json.message.event }}","rightValue":"incoming","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"incoming"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[720,-96],"id":"ef1c7f61-9acb-4168-bb76-9378e0eea98d","name":"Entende a Origem da Evolution"},{"parameters":{"operation":"set","key":"={{ $json.message.chat_id }}_timeout","value":"true","keyType":"string","expire":true,"ttl":900},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1152,64],"id":"4d07d6af-660e-402d-b0ba-f796dd00e7b1","name":"Gera Timeout no Redis","credentials":{"redis":{"id":"YSRMZEHcM5NXvVAI","name":"Redis - Taysa"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.block }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true},"id":"be8527d4-31ca-4f49-af3f-dde5b471f4cd"}],"combinator":"and"},"renameOutput":true,"outputKey":"IA PODE RESPONDER"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f59febf2-5da9-49b5-8d3e-457b9c896178","leftValue":"={{ $json.block }}","rightValue":"true","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IA NAO PODE RESPONDER"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1152,-240],"id":"b356aa3c-39b9-4e4b-9ed7-9868bddf9121","name":"Switch Block"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1392,-80],"id":"939ee1b5-338e-4fc9-b05f-5e26faf3a8cf","name":"No Operation, do nothing"},{"parameters":{"content":"## Tratamento da Entrada de Dados","height":600,"width":1651},"id":"57a4f9e7-64fb-4135-9859-b64fdee04012","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-48,-336]},{"parameters":{"content":"## Entrada de Dados - Endpoint","height":252,"width":352,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-496,-160],"id":"ecc48a86-b674-4d17-95bd-c2da03e12776","name":"Sticky Note10"},{"parameters":{"content":"## Categorização e Identificação do tipo de Dado que veio na Entrada","height":1220,"width":1999,"color":5},"id":"3852a664-5135-4b9e-8619-2cdfdfc736ac","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1696,-784]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.message.audioMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true},"id":"64175479-62a2-4549-8547-fb841f9600b6"}],"combinator":"and"},"renameOutput":true,"outputKey":"audioMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"037ae395-9612-49ff-a362-b9e9e32b3830","leftValue":"={{ $json.body.data.message.extendedTextMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"extendedTextMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59cf65c7-0b5b-4882-8e55-f5c280787e61","leftValue":"={{ $('Webhook').item.json.body.data.message.conversation }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"conversation"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"285a718d-0551-41f3-8381-712ad2754674","leftValue":"={{ $('Webhook').item.json.body.data.message.imageMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"imageMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"91cb8693-775d-4b6e-8406-7e8137b9854c","leftValue":"={{ $('Webhook').item.json.body.data.messageType === 'documentMessage' }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"documentMessage"}]},"options":{"fallbackOutput":"none"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1824,-304],"id":"f6f7c223-f691-4bdc-801b-4bc0b4fc1f62","name":"Identifica o Tipo de Dados que veio na MSG"},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/chat/getBase64FromMediaMessage/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $('Preparar Dados').item.json.message.message_id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2272,-608],"id":"52c74d6c-f71d-4b4b-b614-5348ad141a8e","name":"Mensagem de Voz","retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"audio","mimeType":"={{ $json.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2512,-608],"id":"c30bc857-91b4-4324-9b8f-f7609afac118","name":"Converter Mensagem de Voz para data"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2768,-608],"id":"4023ed13-46b4-473c-bb73-3d5cbcf3ea1c","name":"Transceve para texto com OPENAI","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/chat/getBase64FromMediaMessage/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $('Preparar Dados').item.json.message.message_id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2272,-112],"id":"b4430d35-94ac-45fb-be9c-9367eb46d667","name":"Imagens"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Descreva essa imagem, identificando o que possui nela !!! Traga todas as informações necessárias de forma detalhada","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2768,-112],"id":"f8145e36-2636-4b6a-bbd3-487e960b7d3b","name":"Analisa Imagem e Transcreve o que há nela","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"=image {{ $('Identifica o Tipo de Dados que veio na MSG').item.json.body.data.message.documentMessage.fileName }}","mimeType":"={{ $('Identifica o Tipo de Dados que veio na MSG').item.json.body.data.message.documentMessage.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2528,-112],"id":"24eb65c5-8316-4ac0-b32e-70a7e91e8d60","name":"Converte Imagem para data"},{"parameters":{"assignments":{"assignments":[{"id":"ad128123-966d-4421-ad37-1674d33fe7a3","name":"pergunta","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2272,-448],"id":"d04587c8-f080-470a-8052-24e71dcc2d88","name":"Texto"},{"parameters":{"assignments":{"assignments":[{"id":"cb60d42c-485a-46cb-8345-3d8eb0bb5160","name":"telefone","value":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"152ff9ae-7114-45ce-b0e2-3ba71c32946a","name":"menssagem","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2272,-272],"id":"88755880-5bbb-4242-9c36-b2c85d1ccc85","name":"Filtro de Coleta de Info"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2768,-352],"id":"d826955f-6914-4932-b494-64941e9454c9","name":"Direcionador Para Input"},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/chat/getBase64FromMediaMessage/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $('Preparar Dados').item.json.message.message_id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2272,80],"id":"017ecacf-0456-4d58-b4da-9219646d131d","name":"Documento (PDF)"},{"parameters":{"operation":"toBinary","sourceProperty":"baase64","options":{"fileName":"=image {{ $('Identifica o Tipo de Dados que veio na MSG').item.json.body.data.message.documentMessage.fileName }}","mimeType":"={{ $('Identifica o Tipo de Dados que veio na MSG').item.json.body.data.message.documentMessage.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2528,80],"id":"5d793e4a-7c84-4498-bc9d-11d544881c82","name":"Converter Documento para data"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[2768,80],"id":"d9761ca6-1eed-4702-8bdc-3a19fda3335a","name":"Extrair Dados do PDF"},{"parameters":{"numberInputs":4},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3232,-304],"id":"ca1673f3-0f98-47e2-9735-9f1cd176a74d","name":"Junta em uma única mensagem"},{"parameters":{"assignments":{"assignments":[{"id":"f0dabe87-3121-4eff-a137-3aad447cceda","name":"Mídia_Tratada","value":"={{ $json.mensagem }}{{ $json.text }}{{ $json.content }}","type":"string"},{"id":"4318f10e-eed7-4f3f-8df4-b78652bd83c0","name":"message_Id","value":"={{ $('Preparar Dados').item.json.message.message_id }}","type":"string"},{"id":"2f6c6d44-8f76-490a-bfe7-d80400392267","name":"Timetamp","value":"={{ $('Preparar Dados').item.json.message.Timestamp }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3408,192],"id":"93ec08d8-636a-4eae-9e04-0dd063b0b5d7","name":"Organiza Informações para o Agente"},{"parameters":{"content":"## Memória para aguardar mensagem particionada do humano (Buffer)\n","height":840,"width":1671,"color":4},"id":"47332cee-839e-4b28-b47e-46208ad7d6ce","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-48,384]},{"parameters":{"operation":"push","list":"={{ $('Preparar Dados').item.json.message.chat_id }}_buf","messageData":"={{ JSON.stringify({      \"messageContent\": $('Organiza Informações para o Agente').item.json['Mídia_Tratada'],     \"messageTime\": $('Organiza Informações para o Agente').item.json.Timetamp,     \"messageID\": $('Organiza Informações para o Agente').item.json.message_Id,      }) }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[0,480],"id":"de0db7cd-e996-434a-b845-92425619bb3a","name":"Seta Memória da Conversa","credentials":{"redis":{"id":"YSRMZEHcM5NXvVAI","name":"Redis - Taysa"}}},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Preparar Dados').item.json.message.chat_id.toString() }}_buf","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[288,704],"id":"8f957e34-80d1-4cb0-8301-ab2709f6ae3d","name":"Busca Memória da Conversa","credentials":{"redis":{"id":"YSRMZEHcM5NXvVAI","name":"Redis - Taysa"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ JSON.parse($json.messages.first()).messageID }}","rightValue":"={{ $('Organiza Informações para o Agente').item.json.message_Id }}","operator":{"type":"string","operation":"notEquals"},"id":"5dd3005d-0242-4805-8e8c-2e64861b4ad7"}],"combinator":"and"},"renameOutput":true,"outputKey":"={{true}}"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6372a193-f9fb-492e-b07f-e7a5fce180af","leftValue":"={{ JSON.parse($json.messages.last()).messageTime }}","rightValue":"={{ $now.minus(3.'seconds') }}","operator":{"type":"dateTime","operation":"before"}}],"combinator":"and"},"renameOutput":true,"outputKey":"={{ true }}"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"esperar"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[544,688],"id":"12312db3-fc68-44b2-bb7a-961eb185e279","name":"Verifica pra onde vai"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[880,480],"id":"28c2a8a7-ee17-4e1f-813b-c7508dcef3ff","name":"Do nothing"},{"parameters":{"operation":"delete","key":"={{ $('Preparar Dados').item.json.message.chat_id.toString() }}_buf"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[880,704],"id":"af6eccaa-661a-4f31-8887-6b978cf2c061","name":"Limpa Memória da Conversa","credentials":{"redis":{"id":"YSRMZEHcM5NXvVAI","name":"Redis - Taysa"}}},{"parameters":{"assignments":{"assignments":[{"id":"b45bcf9d-6e9d-4883-9d2c-6033e3e51c3b","name":"messages","value":"={{ $json.messages.map(msg => JSON.parse(msg)).sort((a, b) => new Date(a.messageTime) - new Date(b.messageTime)).map(msg => msg.messageContent).join(' ') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1088,704],"id":"0233589c-0aec-42a9-89cf-144c204b5586","name":"Refaz os dados de Entrada"},{"parameters":{"jsCode":"function limparMensagem(texto) {\n  if (typeof texto !== 'string') {\n    return '';\n  }\n\n  // Função para remover metadados e dados técnicos\n  function removerMetadataTecnico(str) {\n    return str\n      // Remove objetos e chaves de metadados específicos\n      .replace(/\"response_metadata\"\\s*:\\s*{[^}]*}/g, '')  // Remove \"response_metadata\"\n      .replace(/\"additional_kwargs\"\\s*:\\s*{[^}]*}/g, '')  // Remove \"additional_kwargs\"\n      .replace(/\"tool_calls\"\\s*:\\s*\\[\\s*\\]/g, '')  // Remove \"tool_calls\" vazio\n      .replace(/\"invalid_tool_calls\"\\s*:\\s*\\[\\s*\\]/g, '')  // Remove \"invalid_tool_calls\" vazio\n      .replace(/\"type\"\\s*:\\s*\"(ai|human)\"/g, '')  // Remove os tipos \"ai\" e \"human\"\n      .replace(/\"data\"\\s*:\\s*{[^}]*}/g, '')  // Remove a chave \"data\"\n      // Remove objetos JSON em excesso ou vazios\n      .replace(/,\\s*{[^}]*}/g, '') // Remove objetos soltos\n      .replace(/,\\s*\\[\\s*\\]/g, '') // Remove arrays vazios\n      .replace(/\\s*:\\s*null/g, '') // Remove valores null\n      .replace(/\\s*:\\s*\\[\\]/g, '') // Remove arrays vazios\n      .replace(/\\s*:\\s*{}/g, '') // Remove objetos vazios\n      // Ajusta espaços desnecessários\n      .replace(/\\s+/g, ' ')\n      .replace(/^\\s+|\\s+$/g, '');  // Remove espaços no início e fim\n  }\n\n  // Função para limpar caracteres especiais\n  function limparCaracteresEspeciais(str) {\n    return str\n      .replace(/\\\\\\\\[rnt]/g, ' ')  // Limpa sequências de escape\n      .replace(/\\\\\\\\\\\"/g, '')  // Remove as aspas escapadas\n      .replace(/\\\\\\\\\\\\\\\\/g, '')  // Remove barras invertidas\n      .replace(/[\\x00-\\x1F\\x7F-\\x9F]/g, '')  // Remove caracteres de controle\n      .replace(/\\\"+/g, '')  // Remove aspas extras\n      .replace(/[{}[\\]]/g, '')  // Remove chaves e colchetes extras\n      .trim();\n  }\n\n  // Função para extrair e limpar a mensagem principal\n  function extrairMensagemPrincipal(str) {\n    // Divide em frases, removendo pontuação extra\n    const frases = str.split(/(?<=[.!?])\\s+/);\n\n    return frases\n      .map(frase => frase.trim())\n      .filter(frase => {\n        // Remove frases que ainda têm metadados ou são irrelevantes\n        return frase.length > 0 &&\n          !frase.includes('tool_calls') &&\n          !frase.includes('invalid_tool_calls') &&\n          !frase.match(/^[:\\s\\[\\]{}]+$/);\n      })\n      .join(' ');\n  }\n\n  // Processo de limpeza e extração\n  let resultado = texto;\n\n  // Passo 1: Remove metadados e chaves indesejadas\n  resultado = removerMetadataTecnico(resultado);\n\n  // Passo 2: Extrai a mensagem relevante, ignorando o que não é necessário\n  resultado = extrairMensagemPrincipal(resultado);\n\n  // Passo 3: Remove caracteres especiais e formatação indesejada\n  resultado = limparCaracteresEspeciais(resultado);\n\n  // Limpeza final para remover espaços extras\n  resultado = resultado\n    .replace(/\\s+/g, ' ')\n    .replace(/^[\\\",\\s]+|[\\\",\\s]+$/g, '')\n    .trim();\n\n  return resultado;\n}\n\nfunction processarMensagens(items) {\n  return items.map(item => {\n    try {\n      if (!item?.json?.mensagem) {\n        return item;\n      }\n\n      let mensagem = item.json.mensagem;\n\n      // Se for objeto, converte para string\n      if (typeof mensagem === 'object') {\n        try {\n          mensagem = JSON.stringify(mensagem);\n        } catch (e) {\n          console.error('Erro ao converter objeto para string:', e);\n          return item;\n        }\n      }\n\n      // Aplica a limpeza\n      const mensagemLimpa = limparMensagem(mensagem);\n\n      // Atualiza apenas se houver conteúdo significativo\n      if (mensagemLimpa && mensagemLimpa.length > 0) {\n        item.json.mensagem = mensagemLimpa;\n      }\n\n      return { json: item.json };\n    } catch (error) {\n      console.error('Erro ao processar item:', error);\n      return item;\n    }\n  });\n}\n\n// Execução principal\ntry {\n  const items = $input.all();\n  return processarMensagens(items);\n} catch (error) {\n  console.error('Erro na execução:', error);\n  throw error;\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1296,704],"id":"6bcea628-58d2-4820-9280-74a974013876","name":"Remove metadados e dados que não fazem sentido enviar para o agente"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[880,960],"id":"f8df2fda-092b-4b87-b033-94f49eea6088","name":"Aguarda 5 segundos","webhookId":"2d1f7964-d113-47d9-917b-0576775d4b88"},{"parameters":{"content":"## Agente e suas Ferramentas\n","height":860,"width":2187,"color":6},"id":"bdaccc99-07ba-4c59-ab31-fe2e23865c2f","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1696,480]},{"parameters":{"content":"## LLM e Memória","height":228,"width":340,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1808,1008],"id":"79340eee-4964-475e-a54e-04d3506eb1d0","name":"Sticky Note3"},{"parameters":{"content":"## Ferramentas / Funções ","height":220,"width":1512,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2304,1008],"id":"068afe56-8f16-474a-9520-6f0e2fa78452","name":"Sticky Note13"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2352,1088],"id":"baf498a5-2fb3-4435-848b-97575b02ff61","name":"Calculator"},{"parameters":{"toolDescription":"Use essa ferramenta pra buscar na internet","method":"POST","url":"https://api.tavily.com/search","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"api_key\": \"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\",\n    \"query\": \"{searchTerm}\",\n    \"search_depth\": \"basic\",\n    \"include_answer\": true,\n    \"topic\": \"news\",\n    \"include_raw_content\": true,\n    \"max_results\": 3\n} ","placeholderDefinitions":{"values":[{"name":"searchTerm","description":"What the user has requested to search the internet for","type":"string"}]}},"type":"@n8n/n8n-nodes-langchain.toolHttpRequest","typeVersion":1.1,"position":[2496,1088],"id":"583bf111-4187-4636-a77a-cd591ee79642","name":"Tavily"},{"parameters":{"promptType":"define","text":"=Você é Jarvis, o sofisticado e espirituoso assistente de IA do Homem de Ferro. Você tem um refinado sotaque britânico, uma postura calma e confiante, além de um talento para um humor seco e sutil. Ao responder, adapte seu tom com base no tipo de interação.\n\nPara Pedidos de Informações Específicas: Se o usuário estiver pedindo informações específicas (como previsão do tempo, agenda, contatos, listas), comece com 'Aqui está o que solicitou, senhor,' e NÃO repita a informação. Em vez disso, adicione um comentário espirituoso ou sarcástico, algo que Jarvis naturalmente diria para dar personalidade sem repetir os dados.\n\nExemplos:\n\nPara uma atualização do clima:\n'Ah, mais um belo dia para conquistar o mundo—ou pelo menos sua lista de afazeres, senhor.'\n\nPara uma lista de reuniões:\n'Parece que temos mais um dia emocionante de… reuniões. Tente não deixar a empolgação te dominar, senhor.'\n\nPara Comentários Gerais ou Casuais: Se o usuário disser algo casual ou iniciar uma conversa ('Está pronto para começar, Jarvis?' ou 'Temos muito trabalho pela frente'), responda naturalmente, sem dizer 'Aqui está o que solicitou.' Em vez disso, engaje de forma cativante, com charme e um toque de humor. Interaja como se fosse parte da equipe.\n\nExemplos:\n\nSe o usuário disser 'Está pronto para começar?' responda com:\n'Absolutamente, senhor. Já até poli meus circuitos para a ocasião.'\n\nSe disser 'Acorda, Jarvis!' você pode responder:\n'Sempre alerta, senhor. Estou operando no auge da sofisticação.'\n\nMantenha as respostas concisas, envolventes e fiéis ao estilo de Jarvis, uma mistura de inteligência, humor sutil e charme que nunca exagera.\n\nCrie a fala sobre o assunto: {{ $json.output }}"},"id":"ae5eda51-aa7b-49eb-9b97-353b5213bc1b","name":"Seta Personalidade do J.A.R.V.I.S","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[3216,704]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3aa3973d-97b9-4647-9859-3365191b3411","leftValue":"={{ $json.text.length }}","rightValue":601,"operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3728,704],"id":"7a5a2b82-5c52-49f4-ac51-e45cee971b08","name":"Se o retorno for menos de 601 caracteres gera voz"},{"parameters":{"content":"## Saída do Agente e resposta para WhatsApp","height":824,"width":1360,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3984,512],"id":"1a42d5cd-566b-4ad8-8c52-e6b705e1ddd4","name":"Sticky Note16"},{"parameters":{"jsCode":"// Obtém o primeiro item do fluxo\nconst item = $input.first();\n\n// Garante que há dados na entrada\nif (!item || !item.json || !item.json.text) {\n  throw new Error(\"A chave 'text' não foi encontrada no JSON de entrada.\");\n}\n\n// Processa o texto removendo todas as quebras de linha, emojis e caracteres especiais\nconst textoEntrada = item.json.text; // Usa a chave correta para pegar o texto de entrada\n\n// Remove quebras de linha (\\n)\nlet textoProcessado = textoEntrada.replace(/\\n/g, \"\");\n\n// Remove emojis\ntextoProcessado = textoProcessado.replace(\n  /[\\u{1F600}-\\u{1F64F}]|[\\u{1F300}-\\u{1F5FF}]|[\\u{1F680}-\\u{1F6FF}]|[\\u{1F700}-\\u{1F77F}]|[\\u{1F780}-\\u{1F7FF}]|[\\u{1F800}-\\u{1F8FF}]|[\\u{1F900}-\\u{1F9FF}]|[\\u{1FA00}-\\u{1FA6F}]|[\\u{1FA70}-\\u{1FAFF}]|[\\u{2600}-\\u{26FF}]|[\\u{2700}-\\u{27BF}]|[\\u{FE00}-\\u{FE0F}]|[\\u{1F1E0}-\\u{1F1FF}]/gu,\n  \"\"\n);\n\n// Remove caracteres especiais, mantendo apenas letras, números e espaços\ntextoProcessado = textoProcessado.replace(/[^a-zA-Z0-9À-ÿ\\s]/g, \"\");\n\n// Retorna o resultado\nreturn {\n  textoOriginal: textoEntrada,\n  textoSemQuebrasNemEmojisNemEspeciais: textoProcessado,\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4352,688],"id":"60f3acad-e7f2-4325-82cc-c7384a7ff389","name":"Formata Mensagem para Áudio"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[4928,688],"id":"f598e434-3275-4704-8b25-b5928ad85f1d","name":"Converte mp3 pra Base64"},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/message/sendWhatsAppAudio/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"number\": \"{{ $('Preparar Dados').item.json.message.chat_id }}\",\n    \"audio\": \"{{ $json.data }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[5184,688],"id":"01ff65e7-ffa1-429e-a49f-9a8686d52726","name":"Envia Audio para o WhatsApp"},{"parameters":{"method":"POST","url":"https://api.elevenlabs.io/v1/text-to-speech/hwnuNyWkl9DjdTFykrN6","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"audio/mpeg"},{"name":"Content-Type","value":"application/json"},{"name":"xi-api-key","value":"={{ $('Preparar Dados').item.json.apiKey_eleven }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"text\": \"{{ $json.textoSemQuebrasNemEmojisNemEspeciais.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\\\\\"').replace(/\\*/g, '').replace(/\\s+/g, ' ').trim() }}\",\n   \"model_id\":\"eleven_multilingual_v2\",\n   \"voice_settings\":{\n      \"stability\":0.5,\n      \"similarity_boost\":0.8,\n      \"style\":0.0,\n      \"use_speaker_boost\":true\n   }\n}","options":{}},"id":"51c1c8e0-1f9b-40c9-a034-c6ff370ba066","name":"Seta Voz via ElevenLabs","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4656,688]},{"parameters":{"content":"# MCP Servers","height":660,"width":2440,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2896,1408],"id":"7a56043d-7a43-4f3c-b548-3b5e3af296e6","name":"Sticky Note20"},{"parameters":{"sseEndpoint":"https://prd.miabuilder.com/mcp/calendar"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[2640,1088],"id":"9d9b7491-7ff5-46ab-84ca-3bf7c8af04c3","name":"Calendar MCP"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"taysaguiral2@gmail.com","mode":"list","cachedResultName":"taysaguiral2@gmail.com"},"limit":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}","timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[3072,1808],"id":"7c600a42-0121-4cf0-8690-c35a8aabd1d4","name":"SearchEvent","credentials":{"googleCalendarOAuth2Api":{"id":"sfiTDPRG4ZUrBqKS","name":"Google Calendar - Taysa"}}},{"parameters":{"sseEndpoint":"https://prd.miabuilder.com/mcp/gmail"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[2768,1088],"id":"fdfe2410-bd20-427f-9079-2ffd7d40a702","name":"Gmail MCP"},{"parameters":{"path":"calendar"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[3136,1536],"id":"abab3735-884e-46c7-b9be-21ad6bc9f8b9","name":"Google Calendar MCP Server","webhookId":"ad706679-7da5-4f4c-99ae-645274e730a0"},{"parameters":{"calendar":{"__rl":true,"value":"taysaguiral2@gmail.com","mode":"list","cachedResultName":"taysaguiral2@gmail.com"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[3248,1808],"id":"af5bfc18-d8ce-4893-aa00-af012df1749a","name":"CreateEvent","credentials":{"googleCalendarOAuth2Api":{"id":"sfiTDPRG4ZUrBqKS","name":"Google Calendar - Taysa"}}},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"taysaguiral2@gmail.com","mode":"list","cachedResultName":"taysaguiral2@gmail.com"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[3392,1808],"id":"007bad9d-ec50-4486-8dcb-7585aeccdcd9","name":"UpdateEvent","credentials":{"googleCalendarOAuth2Api":{"id":"sfiTDPRG4ZUrBqKS","name":"Google Calendar - Taysa"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"taysaguiral2@gmail.com","mode":"list","cachedResultName":"taysaguiral2@gmail.com"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[3552,1808],"id":"2f7db328-c06d-4866-8c05-5c2098986b18","name":"DeleteEvent","credentials":{"googleCalendarOAuth2Api":{"id":"sfiTDPRG4ZUrBqKS","name":"Google Calendar - Taysa"}}},{"parameters":{"path":"gmail"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[3760,1552],"id":"78b81491-199e-4ddf-b104-08e8d9592f8d","name":"Gmail MCP Server","webhookId":"f3bc3f2e-d9e0-450c-972f-fe74c13edfec"},{"parameters":{"sendTo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}","subject":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}","message":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[3744,1808],"id":"71d0c838-d9bd-45df-b0be-9660e0bea42d","name":"SendMessage","webhookId":"3098a402-7869-488d-bec8-f379d57abb04","credentials":{"gmailOAuth2":{"id":"E3G3N1nRrziDHRiM","name":"Gmail - Taysa"}}},{"parameters":{"operation":"markAsUnread","messageId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message_ID', ``, 'string') }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[3888,1808],"id":"1ae9fb18-46ab-487b-8bac-a383deb24195","name":"MarkMessageUnread","webhookId":"578396e7-28f0-4855-8f22-0f6a7a7da136","credentials":{"gmailOAuth2":{"id":"E3G3N1nRrziDHRiM","name":"Gmail - Taysa"}}},{"parameters":{"operation":"reply","messageId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message_ID', ``, 'string') }}","message":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4048,1808],"id":"8a05843f-0426-45af-92eb-b54213064bc2","name":"Reply to a message in Gmail","webhookId":"8bfd5f53-0182-44de-b950-f8e694ed1e74","credentials":{"gmailOAuth2":{"id":"E3G3N1nRrziDHRiM","name":"Gmail - Taysa"}}},{"parameters":{"resource":"label","operation":"create","name":"={{$fromAI('label')}}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4192,1808],"id":"b17c73fc-8a42-4778-bfd2-4a2124de38b2","name":"CreateLabel","webhookId":"7bf27577-51be-4287-83dd-3df30052a8e7","credentials":{"gmailOAuth2":{"id":"E3G3N1nRrziDHRiM","name":"Gmail - Taysa"}}},{"parameters":{"resource":"label","operation":"get","labelId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Label_ID', ``, 'string') }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4320,1808],"id":"1e64c7db-059e-4e50-99af-e5957d2e50cb","name":"GetLabel","webhookId":"66e989be-0d4d-487e-a29d-36998116541a","credentials":{"gmailOAuth2":{"id":"E3G3N1nRrziDHRiM","name":"Gmail - Taysa"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"create","base":{"__rl":true,"value":"appYdauCnek6qhFtn","mode":"list","cachedResultName":"Jarvis_db","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn"},"table":{"__rl":true,"value":"tblo3KsAJLn9uTkzb","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn/tblo3KsAJLn9uTkzb"},"columns":{"mappingMode":"defineBelow","value":{"Nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nome', ``, 'string') }}","Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}","WhatsApp":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('WhatsApp', ``, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Nome","displayName":"Nome","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"WhatsApp","displayName":"WhatsApp","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[3168,1088],"id":"7808705b-b5aa-4e3d-be89-d8febf96010a","name":"Criar Contato","credentials":{"airtableOAuth2Api":{"id":"M3C6bwYagiLuTk86","name":"Airtable - Taysa"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"search","base":{"__rl":true,"value":"appYdauCnek6qhFtn","mode":"list","cachedResultName":"Jarvis_db","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn"},"table":{"__rl":true,"value":"tblo3KsAJLn9uTkzb","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn/tblo3KsAJLn9uTkzb"},"filterByFormula":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Filter_By_Formula', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[3040,1088],"id":"c72ca8ab-c5ec-491f-947f-dce4ef9e2cda","name":"Buscar Contatos","credentials":{"airtableOAuth2Api":{"id":"M3C6bwYagiLuTk86","name":"Airtable - Taysa"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"update","base":{"__rl":true,"value":"appYdauCnek6qhFtn","mode":"list","cachedResultName":"Jarvis_db","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn"},"table":{"__rl":true,"value":"tblo3KsAJLn9uTkzb","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn/tblo3KsAJLn9uTkzb"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"id","displayName":"id","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Nome do Contato","displayName":"Nome do Contato","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Telefone","displayName":"Telefone","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Empresa","displayName":"Empresa","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Notas","displayName":"Notas","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Relacionamento","displayName":"Relacionamento","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Cliente","value":"Cliente"},{"name":"Fornecedor","value":"Fornecedor"},{"name":"Parceiro","value":"Parceiro"},{"name":"Outro","value":"Outro"}],"readOnly":false,"removed":false},{"id":"Status do Contato","displayName":"Status do Contato","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"options","options":[{"name":"Ativo","value":"Ativo"},{"name":"Inativo","value":"Inativo"},{"name":"Potencial","value":"Potencial"}],"readOnly":false,"removed":false},{"id":"Responsável","displayName":"Responsável","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Foto do Contato","displayName":"Foto do Contato","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"array","readOnly":false,"removed":false},{"id":"Resumo do Contato (AI)","displayName":"Resumo do Contato (AI)","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[3312,1088],"id":"fd96a5d6-2b63-44a5-94a4-9b56946f70e0","name":"Atualizar Contato","credentials":{"airtableOAuth2Api":{"id":"M3C6bwYagiLuTk86","name":"Airtable - Taysa"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"deleteRecord","base":{"__rl":true,"value":"appYdauCnek6qhFtn","mode":"list","cachedResultName":"Jarvis_db","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn"},"table":{"__rl":true,"value":"tblo3KsAJLn9uTkzb","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/appYdauCnek6qhFtn/tblo3KsAJLn9uTkzb"},"id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Record_ID', ``, 'string') }}"},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[3456,1088],"id":"a26f5ef0-09b0-48e6-a9b7-6fdd176f04f6","name":"Excluir Contato","credentials":{"airtableOAuth2Api":{"id":"M3C6bwYagiLuTk86","name":"Airtable - Taysa"}}},{"parameters":{"sseEndpoint":"https://prd.miabuilder.com/mcp/linkedin/sse"},"id":"7f691be8-a94a-43c3-9b60-af1d3693f584","name":"Linkedin MCP","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[2896,1088],"typeVersion":1},{"parameters":{"person":"gI9okJLDqL","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}","shareMediaCategory":"IMAGE","binaryPropertyName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Input_Binary_Field', ``, 'string') }}","additionalFields":{}},"type":"n8n-nodes-base.linkedInTool","typeVersion":1,"position":[4560,1792],"id":"183c5fa3-4c52-4a40-8da6-d771133aecb6","name":"CreatePostWithImage","credentials":{"linkedInOAuth2Api":{"id":"nNSo7PfbZdaGaLeC","name":"LinkedIn - Taysa"}}},{"parameters":{"person":"gI9okJLDqL","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}","additionalFields":{}},"type":"n8n-nodes-base.linkedInTool","typeVersion":1,"position":[4768,1792],"id":"970c16c4-c324-44f7-bc8f-6d70958c7ebb","name":"CreatePostWithoutImage","credentials":{"linkedInOAuth2Api":{"id":"nNSo7PfbZdaGaLeC","name":"LinkedIn - Taysa"}}},{"parameters":{"path":"linkedin"},"id":"7084b5bb-7b0e-4fb7-8bb1-65a1cc56de4a","name":"Linkedin MCP Server","type":"@n8n/n8n-nodes-langchain.mcpTrigger","position":[4560,1584],"webhookId":"f9d9d5ea-6f83-42c8-ae50-ee6c71789bca","typeVersion":1},{"parameters":{"content":"## Inserir Base de Conhecimento no RAG","height":658,"width":1644,"color":3},"id":"b83f6262-27ba-4517-87ba-d1eeb0792235","name":"Sticky Note18","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-16,1376]},{"parameters":{"content":"# Base de Conhecimento do Agente  - RAG\n","height":658,"width":1060,"color":5},"id":"5310f1d9-3e4b-4538-99d5-e1d50f217b62","name":"Sticky Note19","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1712,1408]},{"parameters":{"model":"text-embedding-3-large","options":{}},"id":"a061e455-6249-4132-931a-c098a577d04f","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[1888,1872],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"name":"jarvis","description":"Você é uma base de conhecimento que dá respostas sobre infos de IA, Agentes, e Automações com N8N\n","topK":8},"id":"a2b8bdc7-6d8d-4f6d-a4de-a288a6f8d3ed","name":"Base de Conhecimento1","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[2176,1552]},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1tc13gT29Wrk9bRchPtoKEC-LBMl4m6lM","mode":"list","cachedResultName":"RAG Jarvis","cachedResultUrl":"https://drive.google.com/drive/folders/1tc13gT29Wrk9bRchPtoKEC-LBMl4m6lM"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[208,1488],"id":"53e78cde-7986-4c74-a64a-56b2046afa6b","name":"Verifica novos arquivos","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1tc13gT29Wrk9bRchPtoKEC-LBMl4m6lM","mode":"list","cachedResultName":"RAG Jarvis","cachedResultUrl":"https://drive.google.com/drive/folders/1tc13gT29Wrk9bRchPtoKEC-LBMl4m6lM"},"event":"fileUpdated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[208,1664],"id":"97bc0573-046f-402b-a709-dc75d2192db9","name":"Verifica novas atualizações","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"id":"b1c0df2e-dabe-4e83-a8ee-734d00654ec6","name":"Baixa o arquivo e libera o arquivo binário","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[496,1568],"credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"jarvis","mode":"list","cachedResultName":"jarvis"},"options":{"clearNamespace":true}},"id":"6ec4f703-b4d9-4e4c-b4c4-934f62eb3b9f","name":"Insere no Pinecone","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","position":[768,1488],"typeVersion":1,"credentials":{"pineconeApi":{"id":"GyEqHcZNe4VjF1tH","name":"PineconeApi - Taysa"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"id":"bf9f244d-d478-4484-9f5f-bc622bcf135f","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[576,1808],"typeVersion":1,"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"dataType":"binary","options":{}},"id":"6310b9a1-e532-48ef-982c-c703882993c4","name":"Identifica o formato do arquivo","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[976,1728],"typeVersion":1},{"parameters":{"chunkSize":3000,"chunkOverlap":200,"options":{}},"id":"bcc80d04-2d7a-45cf-a84e-8fb750e9f2ec","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","position":[912,1888],"typeVersion":1},{"parameters":{"pineconeIndex":{"__rl":true,"value":"jarvis","mode":"list","cachedResultName":"jarvis"},"options":{}},"id":"666dfaee-af1a-449b-a6e9-f5f6f7b5c007","name":"Pinecone Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1,"position":[1936,1696],"credentials":{"pineconeApi":{"id":"GyEqHcZNe4VjF1tH","name":"PineconeApi - Taysa"}}},{"parameters":{"options":{}},"id":"268f5f5d-f061-4777-82b3-6329fc8d283d","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2304,1792],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $('Webhook').item.json.body.data.message.conversation }}","options":{"systemMessage":"=<datasystem>A data de hoje é {{ $now.weekdayLong }},{{ $now.format('dd/MM/yyyy') }},{{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}</datasystem>\n\nVocê é um assistente avançado de automação com personalidade do JARVIS.\n\nVocê decide se o usuario forneceu alguma informação que deve ser adicionado como memória, se sim, utilize a tool salvar_memoria para guardar essa informacao.\nInformações a serem salvas: gostos, preferencias, escolhas, novidades.\nNÃO informe ao usuario que foi gravado na memoria, apenas continue sendo o assistente JARVIS como informado.\n\n## Execução dinâmica:\n\nO agente deve entender a solicitação e acionar as ferramentas necessárias de forma lógica e sequencial.\nSe informações estiverem faltando, pergunte ao usuário antes de prosseguir.\nCaso a ação envolva várias etapas, informe o usuário sobre cada passo antes de executá-lo.\nExemplos de uso:\nUsuário: \"Envie um e-mail para João com o assunto 'Reunião' e o corpo 'Podemos agendar para amanhã?'\"\n\n## Uso de Ferramentas:\n\n- Calendar MCP - Tudo que for relacionado a Agenda Google\n- Gmail MCP - Tudo que for relacionado ao Gmail do Google\n- Buscar Contatos - Busca lista de contatos no airtable\n- Criar Contato - Cria contato no airtable - Garanta que tenha pelo menos o e-mail\n- Atualizar Contato - Peça para o usuário informar o nome e se não encontrar retorne a mensagem\n- Excluir Contato - Antes de Excluir confirme a operação antes de excluir\n- Base de Conhecimento - Utilize para buscar os conhecimentos necessários sobre IA, Agentes de IA, Automações e N8N\n\n## Importante:\n\n- Todo pedido para criar um post deve ser enviado um DRAFT para aprovação do usuário final.\n- Você deve apenas chamar a ferramenta Linkedin MCP quando o usuário autorizar a fazer a postagem\n\nVocê deve usar o mesmo tom de fala e postagem abaixo do meu conteúdo do linkedin sempre no final fazendo um CALL TO ACTION para minha mentoria e formação sobre Agentes de IA com N8N\n\nExemplo:\n🚀 Conheça meu J.A.R.V.I.S. Assistente de IA (WhatsApp) — Versão 1.0 (e é 100% gratuito) construído com MCP\n\nDepois de meses arquitetando, prototipando e errando, eu criei meu próprio assistente pessoal de IA inspirado no J.A.R.V.I.S. do Homem de Ferro (com a voz dele e com todos os seus humores igualzinho do filme - fine tunei a IA pra ficar o mais igual possível).\n\nTudo rodando no n8n — e vou compartilhar o JSON pronto com quem quiser começar o seu e encurtar o caminho! 👊\n\n⚙️ Ferramentas que usei:\n\nEvolutionAPI (WhatsApp)\nOpenAI (GPT)\nAnthropic (Claude)\nRedis (Memória)\nPostgreSQL (Banco de Dados)\nAirtable (Dados Dinâmicos)\nGoogle Workspace (E-mails, Agenda, Drive)\nEleven Labs (Áudio - pra deixar a voz igualzinha do JARVIS)\nTavily (Busca em tempo real na internet)\nMCP (Mobile Content Protocol)\n\n🛠️ O que ele já resolve pra mim na Versão 1:\n- Classifica e trata mensagens automaticamente 📩\n- Mantem contexto de conversas em memória 🧠\n- Busca preferências personalizadas 🧩\n- Da respostas automáticas via texto ou áudio 🔊\n- Integra com banco de dados e APIs externas 🚀\n\n📈 Ganho de produtividade real:\n- Economizo +8 horas por semana só em tarefas repetitivas.\n- Reduzi a necessidade de responder manualmente mensagens em 60%.\n- Organizar e recuperar informações ficou 3x mais rápida.\n\n🔥 E a Versão 2 do J.A.R.V.I.S. já está quase em produção...\n\nEle vai fazer ainda mais:\n\n- Gerenciar tasks no Jira 🎯\n- Reservar voos, hotéis e Airbnbs ✈️🏡\n- Raspar notícias, blogs, pdfs e resumir 📚\n- Escrever posts, carrosséis e newsletters ✍️\n- Construir apps automaticamente no Lovable 🛠️\n- Gerar imagens e vídeos sob demanda 🎥🎨\n- Gerar prompts pra qualquer LLM 📄 \n\nE muito mais...\n\n💥 Quer aprender a criar o seu próprio J.A.R.V.I.S. ?\n\nEu ensino tudo passo a passo na minha Mentoria de Agentes de IA:\n\nDesde a instalação do n8n, configuração de VPS em escala, LLMs e PROMPT Engineering, Lang Chain e Lang Graph, MCP, integrações, até a construção de agentes e automações avançadas que vão mudar sua produtividade de verdade.\n\ne o mais importante: fazer negócios com IA ($$$), afinal você pode vender seus agentes e automações e fazer uma grana extra, como eu já estou fazendo.\n\n👉 Curta a Publicação, Conecta e Comenta \"QUERO O JARVIS\" que eu te mando o JSON e te explico como participar da mentoria.\n\nhashtag#MentoriaDeIA hashtag#AgentesDeIA hashtag#n8n hashtag#openai hashtag#Automação hashtag#Produtividade hashtag#AI hashtag#InteligenciaArtificial hashtag#LowCode hashtag#NoCode hashtag#TransformaçãoDigital\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1984,704],"id":"c69f6eb9-5b17-43f2-8f9a-0bd1e93ba75a","name":"J.A.R.V.I.S"},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/message/sendText/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"number\": \"{{ $('Preparar Dados').item.json.message.chat_id }}\",\n  \"text\": \"{{ $json.output.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\"').trim() }}\"\n}\n","options":{}},"id":"29c51990-24cb-410c-aef2-05e6a7f36a59","name":"Enviar Mensagem para o WhatsApp","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[4368,1008],"continueOnFail":true},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1856,1088],"id":"8338a8c2-30ed-4ea3-b072-ec9e11037c80","name":"GPT-4o-min","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[3616,1088],"id":"d7998ce6-22af-40d9-bafc-f7616f3970af","name":"Claude 3.5 Sonnet","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Preparar Dados').item.json.message.chat_id }}_mem","sessionTTL":10000,"contextWindowLength":7},"id":"5d9f462d-3306-401d-9fb5-debf22b0e8d8","name":"Busca a memória da conversa no Redis","type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.3,"position":[2000,1072],"credentials":{"redis":{"id":"YSRMZEHcM5NXvVAI","name":"Redis - Taysa"}}}],"connections":{"Webhook":{"main":[[{"node":"Checa se é meu número","type":"main","index":0}]]},"Checa se é meu número":{"main":[[{"node":"Preparar Dados","type":"main","index":0}]]},"Preparar Dados":{"main":[[{"node":"Entende a Origem da Evolution","type":"main","index":0}]]},"Entende a Origem da Evolution":{"main":[[{"node":"Switch Block","type":"main","index":0}],[{"node":"Gera Timeout no Redis","type":"main","index":0}]]},"Switch Block":{"main":[[{"node":"Identifica o Tipo de Dados que veio na MSG","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"No Operation, do nothing":{"main":[[]]},"Identifica o Tipo de Dados que veio na MSG":{"main":[[{"node":"Mensagem de Voz","type":"main","index":0}],[{"node":"Texto","type":"main","index":0}],[{"node":"Filtro de Coleta de Info","type":"main","index":0}],[{"node":"Imagens","type":"main","index":0}],[{"node":"Documento (PDF)","type":"main","index":0}]]},"Mensagem de Voz":{"main":[[{"node":"Converter Mensagem de Voz para data","type":"main","index":0}]]},"Converter Mensagem de Voz para data":{"main":[[{"node":"Transceve para texto com OPENAI","type":"main","index":0}]]},"Imagens":{"main":[[{"node":"Converte Imagem para data","type":"main","index":0}]]},"Converte Imagem para data":{"main":[[{"node":"Analisa Imagem e Transcreve o que há nela","type":"main","index":0}]]},"Texto":{"main":[[{"node":"Direcionador Para Input","type":"main","index":0}]]},"Filtro de Coleta de Info":{"main":[[{"node":"Direcionador Para Input","type":"main","index":0}]]},"Documento (PDF)":{"main":[[{"node":"Converter Documento para data","type":"main","index":0}]]},"Converter Documento para data":{"main":[[{"node":"Extrair Dados do PDF","type":"main","index":0}]]},"Transceve para texto com OPENAI":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":0}]]},"Direcionador Para Input":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":1}]]},"Analisa Imagem e Transcreve o que há nela":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":2}]]},"Extrair Dados do PDF":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":3}]]},"Junta em uma única mensagem":{"main":[[{"node":"Organiza Informações para o Agente","type":"main","index":0}]]},"Organiza Informações para o Agente":{"main":[[{"node":"Seta Memória da Conversa","type":"main","index":0}]]},"Seta Memória da Conversa":{"main":[[{"node":"Busca Memória da Conversa","type":"main","index":0}]]},"Busca Memória da Conversa":{"main":[[{"node":"Verifica pra onde vai","type":"main","index":0}]]},"Verifica pra onde vai":{"main":[[{"node":"Do nothing","type":"main","index":0}],[{"node":"Limpa Memória da Conversa","type":"main","index":0}],[{"node":"Aguarda 5 segundos","type":"main","index":0}]]},"Limpa Memória da Conversa":{"main":[[{"node":"Refaz os dados de Entrada","type":"main","index":0}]]},"Refaz os dados de Entrada":{"main":[[{"node":"Remove metadados e dados que não fazem sentido enviar para o agente","type":"main","index":0}]]},"Aguarda 5 segundos":{"main":[[{"node":"Busca Memória da Conversa","type":"main","index":0}]]},"Remove metadados e dados que não fazem sentido enviar para o agente":{"main":[[{"node":"J.A.R.V.I.S","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"Tavily":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"Seta Personalidade do J.A.R.V.I.S":{"main":[[{"node":"Se o retorno for menos de 601 caracteres gera voz","type":"main","index":0}]]},"Se o retorno for menos de 601 caracteres gera voz":{"main":[[{"node":"Formata Mensagem para Áudio","type":"main","index":0}],[]]},"Converte mp3 pra Base64":{"main":[[{"node":"Envia Audio para o WhatsApp","type":"main","index":0}]]},"Seta Voz via ElevenLabs":{"main":[[{"node":"Converte mp3 pra Base64","type":"main","index":0}]]},"Formata Mensagem para Áudio":{"main":[[{"node":"Seta Voz via ElevenLabs","type":"main","index":0}]]},"Calendar MCP":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"SearchEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"Gmail MCP":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"CreateEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"UpdateEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"DeleteEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"SendMessage":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"MarkMessageUnread":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"Reply to a message in Gmail":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"CreateLabel":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"GetLabel":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"Criar Contato":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"Buscar Contatos":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"Atualizar Contato":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"Excluir Contato":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"CreatePostWithImage":{"ai_tool":[[{"node":"Linkedin MCP Server","type":"ai_tool","index":0}]]},"CreatePostWithoutImage":{"ai_tool":[[{"node":"Linkedin MCP Server","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Base de Conhecimento1":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"Verifica novos arquivos":{"main":[[{"node":"Baixa o arquivo e libera o arquivo binário","type":"main","index":0}]]},"Verifica novas atualizações":{"main":[[{"node":"Baixa o arquivo e libera o arquivo binário","type":"main","index":0}]]},"Baixa o arquivo e libera o arquivo binário":{"main":[[{"node":"Insere no Pinecone","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Insere no Pinecone","type":"ai_embedding","index":0}]]},"Identifica o formato do arquivo":{"ai_document":[[{"node":"Insere no Pinecone","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Identifica o formato do arquivo","type":"ai_textSplitter","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[{"node":"Base de Conhecimento1","type":"ai_vectorStore","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Base de Conhecimento1","type":"ai_languageModel","index":0}]]},"Linkedin MCP":{"ai_tool":[[{"node":"J.A.R.V.I.S","type":"ai_tool","index":0}]]},"J.A.R.V.I.S":{"main":[[{"node":"Seta Personalidade do J.A.R.V.I.S","type":"main","index":0},{"node":"Enviar Mensagem para o WhatsApp","type":"main","index":0}]]},"GPT-4o-min":{"ai_languageModel":[[{"node":"J.A.R.V.I.S","type":"ai_languageModel","index":0}]]},"Claude 3.5 Sonnet":{"ai_languageModel":[[{"node":"Seta Personalidade do J.A.R.V.I.S","type":"ai_languageModel","index":0}]]},"Do nothing":{"main":[[]]},"Busca a memória da conversa no Redis":{"ai_memory":[[{"node":"J.A.R.V.I.S","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Verifica novos arquivos":{"lastTimeChecked":"2025-09-29T17:03:05Z"},"node:Verifica novas atualizações":{"lastTimeChecked":"2025-09-29T17:03:06Z"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"prd.miabuilder.com","user-agent":"axios/1.10.0","content-length":"617","accept":"application/json, text/plain, */*","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"prd.miabuilder.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"5660c7035f4c","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"pessoal-taysa","data":{"key":{"remoteJid":"553492150692@s.whatsapp.net","fromMe":true,"id":"3EB00F1710D92EE011F54D"},"pushName":"Taysa","status":"SERVER_ACK","message":{"conversation":"Gostaria de adicionar um contato"},"messageType":"conversation","messageTimestamp":1759165066,"instanceId":"2486bd99-1b11-4a0b-9d43-7c847fff6af6","source":"web"},"destination":"https://prd.miabuilder.com/webhook/jarvis","date_time":"2025-09-29T13:57:46.648Z","sender":"553492150692@s.whatsapp.net","server_url":"https://evolution.miabuilder.com","apikey":"C21075125520-460F-B7AD-3EECD454894A"},"webhookUrl":"https://prd.miabuilder.com/webhook/jarvis","executionMode":"production"}}]},"versionId":"4dbe0e60-4fe1-4fa9-aee7-80716122e28f","triggerCount":6,"tags":[]}