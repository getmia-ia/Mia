{"createdAt":"2025-08-15T17:34:10.542Z","updatedAt":"2025-10-06T18:34:56.055Z","id":"dsGeC8drTp6f0ofV","name":"Mia - 1.3 - Atlas - Resumidor Financeiro","active":false,"isArchived":false,"nodes":[{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"Analise os dados e forneça os parâmetros separadamente.\n","role":"system"},{"content":"={{ JSON.stringify($json.query) }}"}]},"jsonOutput":true,"options":{}},"id":"f0a0a8bb-5717-4d59-ae35-76a3b9923322","name":"🕵️‍♂️ Análise dos Dados 📊","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[544,432],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{},"id":"8da7e0f7-a5a2-4490-8a13-4b557ba13c5a","name":"Calculadora","type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1040,1920]},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"Seu papel é analisar transações financeiras usando os dados fornecidos. Forneça um resumo curto e preciso, porém informativo, sobre as informações recebidas para serem reportadas ao usuário.\n\nSe houver diversos meses e categorias no json, você deve considerar que deve fazer um resumo por categoria.\n\nSe houver apenas dados de um mês e diversas categorias, você pode resumir por categoria e dar mais detalhes sobre o principal gasto em cada categoria\n\nSe houver dados de um mês especifico e apenas uma categoria você deve dar todos os detalhes dos custos que contemplam aquele grupo de custos ou receitas.\n\nPode usar emojis pra deixar mais amigável a mensagem para ser enviada no whatsapp do usuário.\n\nIMPORTANTE:\nUse a ferramenta de calculadora para calcular o valor correto.","role":"system"},{"content":"={{ $json.data }}"}]},"options":{}},"id":"a2a9f5be-0199-4bbe-b665-5a245734bf35","name":"📋 Resumidor Financeiro 📊","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1024,1600],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c1927732-bfef-4337-86da-3c9aac5ecaf3","name":"data","value":"={{ $json.message.content.data }}","type":"string"},{"id":"a0349354-f30c-441f-bd81-1036f3bd087b","name":"categoria","value":"={{ $json.message.content.categoria }}","type":"string"},{"id":"dbe51abc-7ba1-44b3-9e7c-4d6f66a0dfe3","name":"ano","value":"={{ $json.message.content.ano }}","type":"string"}]},"options":{}},"id":"5d748486-2624-4041-bf8a-882d1ee59f23","name":"Seta Retorno","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[928,432]},{"parameters":{"jsCode":"// Entrada: it.json.data pode ser null, \"01/08/2025\" (DD/MM/YYYY) ou \"2025_08\" (YYYY_MM).\n// Saída: mantém campos originais e define json.mes_pagamento = \"YYYY_MM\" ou null.\n\nfunction toYYYY_MM(input) {\n  if (input == null) return null;\n  const s = String(input).trim();\n  let m;\n\n  // DD/MM/YYYY\n  if ((m = s.match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/))) {\n    const mm = parseInt(m[2], 10);\n    const yy = m[3];\n    if (mm >= 1 && mm <= 12) return `${yy}_${String(mm).padStart(2,'0')}`;\n    return null;\n  }\n\n  // YYYY_MM\n  if ((m = s.match(/^(\\d{4})_(\\d{2})$/))) {\n    const mm = parseInt(m[2], 10);\n    if (mm >= 1 && mm <= 12) return `${m[1]}_${m[2]}`;\n    return null;\n  }\n\n  return null; // qualquer outro formato → null\n}\n\nconst out = $input.all().map(it => {\n  const raw = it.json.data ?? null;\n  const chave = toYYYY_MM(raw);\n  return { json: { ...it.json, mes_pagamento: chave } };\n});\n\nreturn out;\n"},"id":"042e2fbb-c225-486a-a6e9-39c8ed8df556","name":"Formata Data","type":"n8n-nodes-base.code","typeVersion":2,"position":[1104,432]},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"id":"6a95e541-76f3-4ca2-ada1-bfe7a6004b9e","name":"Junta as Linhas em um único campo","type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[528,1600]},{"parameters":{"assignments":{"assignments":[{"id":"bfa82842-fee4-4b47-bd94-7de53e938b2a","name":"data","value":"={{ $json.data }}","type":"string"}]},"options":{}},"id":"42b2efb7-ddc1-47e2-b09c-b845bfbf6843","name":"Seta os Dados para o Agente","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[752,1600]},{"parameters":{"assignments":{"assignments":[{"id":"81416485-6e75-43e6-ab2f-6d2d9130f12c","name":"response","value":"={{ $json.message.content }}","type":"string"}]},"options":{}},"id":"500838f5-a3bc-4922-8077-b6265c406b06","name":"Retorna o Resumo","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1488,1600]},{"parameters":{"content":"## Chama IA  para analisar os dados de entrada","height":300,"width":360,"color":5},"type":"n8n-nodes-base.stickyNote","position":[512,320],"typeVersion":1,"id":"5929b13b-263e-430d-bea3-b23956608355","name":"Sticky Note13"},{"parameters":{"content":"## Trata os Dados","height":300,"width":360,"color":6},"type":"n8n-nodes-base.stickyNote","position":[880,320],"typeVersion":1,"id":"365c57f1-28da-4eaa-8181-901d15be1c50","name":"Sticky Note"},{"parameters":{"content":"## Busca as movimentações","height":1028,"width":968,"color":2},"type":"n8n-nodes-base.stickyNote","position":[1264,208],"typeVersion":1,"id":"4b3c04c7-cd4e-4187-a917-365d12c0752e","name":"Sticky Note14"},{"parameters":{"content":"## Manipula as Informações","height":300,"width":452,"color":2},"type":"n8n-nodes-base.stickyNote","position":[480,1488],"typeVersion":1,"id":"2246e0f7-50e2-452a-9cc5-75cac26cb50c","name":"Sticky Note15"},{"parameters":{"content":"## Chama IA  para gerar o Resumo Financeiro","height":300,"width":440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[944,1488],"typeVersion":1,"id":"5a9cd9b5-3a08-4d24-b524-004d90016134","name":"Sticky Note16"},{"parameters":{"content":"## Ferramenta","height":260,"width":280,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[944,1808],"id":"9e23150d-96b1-4f53-a0bf-dacc502c5efb","name":"Sticky Note1"},{"parameters":{"content":"","height":1988,"width":2244},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[272,128],"id":"c0402d66-cf79-4c50-842f-93a2a179b668","name":"Sticky Note3"},{"parameters":{},"id":"5d7dadfc-6188-4884-bcce-c5adee8c6bb3","name":"Executa Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[352,432]},{"parameters":{"content":"## Retorna Resumo para o Agente Chamador","height":300,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1408,1488],"typeVersion":1,"id":"9b7b4f59-cdde-433d-8440-7c35244f6ede","name":"Sticky Note2"},{"parameters":{"documentId":{"__rl":true,"value":"1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI","mode":"list","cachedResultName":"Gastos de Casa - Lucas e Isabella","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1203270906,"mode":"list","cachedResultName":"Lançamentos","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit#gid=1203270906"},"filtersUI":{"values":[{"lookupColumn":"Mês Pagamento","lookupValue":"={{ $json.mes_pagamento }}"}]},"options":{}},"id":"2204aa37-fd35-4118-9347-225fbdccc1a2","name":"Busca Movimentações - Só com Mês","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2016,624],"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"documentId":{"__rl":true,"value":"1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI","mode":"list","cachedResultName":"Gastos de Casa - Lucas e Isabella","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1203270906,"mode":"list","cachedResultName":"Lançamentos","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit#gid=1203270906"},"filtersUI":{"values":[{"lookupColumn":"Mês Pagamento","lookupValue":"={{ $json.mes_pagamento }}"},{"lookupColumn":"Classificação","lookupValue":"={{ ($node[\"Seta Retorno\"].json.categoria || '').toLowerCase().trim() }}"}]},"options":{}},"id":"5dfe77ad-0230-4362-8d28-f5555625c7f7","name":"Busca Movimentações - Mês + Categoria","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2016,400],"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"25b2325e-2c99-4742-a82b-2372399b8b32","leftValue":"={{$node[\"Seta Retorno\"].json[\"categoria\"]}}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1584,416],"id":"3b3d7af7-24ba-4e1c-bcc4-5a4bbf3b222e","name":"Verificar se tem categoria"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ecae9fdb-581c-47b5-8917-466708ac48ca","leftValue":"={{ $('Seta Retorno').item.json.data }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1344,432],"id":"3fa6ff80-8c14-42b2-b9e6-6b49dda81ae1","name":"Verificar se tem data"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"25b2325e-2c99-4742-a82b-2372399b8b32","leftValue":"={{$node[\"Seta Retorno\"].json[\"categoria\"]}}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1600,848],"id":"a9f9ce21-c8da-4631-91ee-018c281670a2","name":"Verificar se tem categoria1"},{"parameters":{"documentId":{"__rl":true,"value":"1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI","mode":"list","cachedResultName":"Gastos de Casa - Lucas e Isabella","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1203270906,"mode":"list","cachedResultName":"Lançamentos","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit#gid=1203270906"},"filtersUI":{"values":[{"lookupColumn":"Classificação","lookupValue":"={{ ($node[\"Seta Retorno\"].json.categoria || '').toLowerCase().trim() }}"},{"lookupColumn":"Ano","lookupValue":"={{ String($node[\"Seta Retorno\"].json.ano).trim() }}"}]},"options":{}},"id":"1c996205-c466-471b-b548-a6fb3c20c6d0","name":"Busca Movimentações - Ano + Categoria","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2016,832],"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"documentId":{"__rl":true,"value":"1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI","mode":"list","cachedResultName":"Gastos de Casa - Lucas e Isabella","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1203270906,"mode":"list","cachedResultName":"Lançamentos","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1C1DFqk6wSPEEwIh8UyA6ell7VQROCaVvWBwfuUSDFNI/edit#gid=1203270906"},"filtersUI":{"values":[{"lookupColumn":"Ano","lookupValue":"={{ String($node[\"Seta Retorno\"].json.ano).trim() }}"}]},"options":{}},"id":"b4511509-17de-4e64-8542-c17957cb6fe5","name":"Busca Movimentações - Ano","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2016,1040],"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}}],"connections":{"🕵️‍♂️ Análise dos Dados 📊":{"main":[[{"node":"Seta Retorno","type":"main","index":0}]]},"Calculadora":{"ai_tool":[[{"node":"📋 Resumidor Financeiro 📊","type":"ai_tool","index":0}]]},"📋 Resumidor Financeiro 📊":{"main":[[{"node":"Retorna o Resumo","type":"main","index":0}]]},"Seta Retorno":{"main":[[{"node":"Formata Data","type":"main","index":0}]]},"Formata Data":{"main":[[{"node":"Verificar se tem data","type":"main","index":0}]]},"Junta as Linhas em um único campo":{"main":[[{"node":"Seta os Dados para o Agente","type":"main","index":0}]]},"Seta os Dados para o Agente":{"main":[[{"node":"📋 Resumidor Financeiro 📊","type":"main","index":0}]]},"Executa Workflow":{"main":[[{"node":"🕵️‍♂️ Análise dos Dados 📊","type":"main","index":0}]]},"Busca Movimentações - Só com Mês":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]},"Busca Movimentações - Mês + Categoria":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]},"Verificar se tem categoria":{"main":[[{"node":"Busca Movimentações - Mês + Categoria","type":"main","index":0}],[{"node":"Busca Movimentações - Só com Mês","type":"main","index":0}]]},"Verificar se tem data":{"main":[[{"node":"Verificar se tem categoria","type":"main","index":0}],[{"node":"Verificar se tem categoria1","type":"main","index":0}]]},"Verificar se tem categoria1":{"main":[[{"node":"Busca Movimentações - Ano + Categoria","type":"main","index":0}],[{"node":"Busca Movimentações - Ano","type":"main","index":0}]]},"Busca Movimentações - Ano + Categoria":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]},"Busca Movimentações - Ano":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"QdC9qh9DPcT2xcoq"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"db25d427-d690-4a0e-9535-045c8befb18b","triggerCount":0,"tags":[{"createdAt":"2025-07-20T15:45:29.310Z","updatedAt":"2025-07-20T15:45:29.310Z","id":"wRUSTJ6mfrXjoMjo","name":"formacao-agentes-n8n"},{"createdAt":"2025-08-01T17:49:59.965Z","updatedAt":"2025-08-01T17:49:59.965Z","id":"uASGs3ovnkwqcA4l","name":"ai-agent"},{"createdAt":"2025-08-01T17:57:59.772Z","updatedAt":"2025-08-01T17:57:59.772Z","id":"DSDfqcFyPwY1Vy7F","name":"google-sheets"},{"createdAt":"2025-08-15T17:34:00.496Z","updatedAt":"2025-08-15T17:34:00.496Z","id":"EDmxLCNqtgvn9jdw","name":"finthrix"}]}