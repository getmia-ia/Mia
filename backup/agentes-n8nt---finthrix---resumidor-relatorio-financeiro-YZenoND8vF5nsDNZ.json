{"createdAt":"2025-09-24T20:53:18.633Z","updatedAt":"2025-09-24T21:26:23.004Z","id":"YZenoND8vF5nsDNZ","name":"Agentes N8NT - Finthrix - Resumidor Relatorio Financeiro","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"f7c184d8-d2b9-4c8a-9baf-b083c698cbc2","name":"Executa Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[-1184,160]},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"Analise os dados e forneça os parâmetros separadamente","role":"system"},{"content":"={{ JSON.stringify($json.query) }}"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-848,160],"id":"f8672370-7538-47cb-9088-685fb0d00e0b","name":"Análise dos Dados","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"content":"## Chama IA para analisar os dados de entrada","height":224,"width":304,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-880,80],"id":"292de24a-8bf0-4696-90b9-5840a4874ed8","name":"Sticky Note"},{"parameters":{"content":"## Trata os Dados","height":224,"width":320},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-512,80],"id":"a0d63942-fb90-4c26-8f54-2bfad6a7b84e","name":"Sticky Note1"},{"parameters":{"assignments":{"assignments":[{"id":"1c6aa2bb-f19c-4f34-adeb-e8b95fc2a247","name":"data","value":"={{ $json.message.content.data }}","type":"string"},{"id":"28af8383-cb03-4698-9563-e1563321ec83","name":"categoria","value":"={{ $json.message.content.categoria }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-480,160],"id":"f9aa4020-6861-494b-bf51-025a787de238","name":"Seta Retorno"},{"parameters":{"jsCode":"// Função para converter MM/YYYY para o nome do mês em português\nfunction obterNomeDoMes(data) {\n    const meses = [\n        \"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\",\n        \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"\n    ];\n    \n    const partes = data.split(\"/\");\n    if (partes.length !== 2) {\n        throw new Error(\"Formato inválido. Use MM/YYYY.\");\n    }\n\n    const mesIndex = parseInt(partes[0], 10) - 1;\n    if (mesIndex < 0 || mesIndex > 11) {\n        throw new Error(\"Mês inválido. Use um valor entre 01 e 12.\");\n    }\n\n    return meses[mesIndex];\n}\n\n// Entrada do n8n\nconst inputData = $input.all();\nconst resultados = inputData.map(item => {\n    const data = item.json.data; // Supondo que a entrada seja { \"data\": \"02/2024\" }\n    return { json: { mes: obterNomeDoMes(data) } };\n});\n\n// Saída do n8n\nreturn resultados;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-336,160],"id":"b5a4e571-f9f6-4c77-8550-9664dcf9af12","name":"Formata Data"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fdd84053-0da7-4a42-b665-bf1d0bb5fab2","leftValue":"={{$node[\"Seta Retorno\"].json[\"categoria\"]}}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-32,160],"id":"194807c9-0538-4e9a-bc19-b54efeb74184","name":"Verifica se tem categoria"},{"parameters":{"content":"## Busca as movimentações","height":448,"width":576,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-128,-16],"id":"b3fddcc4-abec-4322-870a-f44868e59f62","name":"Sticky Note2"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[656,128],"id":"b68ed66e-5772-44a2-9e52-ddec4b8cc4d5","name":"Junta as Linhas em um único campo"},{"parameters":{"content":"## Manipula as informações","height":256,"width":464},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[592,48],"id":"14bf87b9-522c-4ec6-9e3d-b228a6906a8b","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"d1e9aa3b-f61c-4acf-9cb2-d769138a41fb","name":"data","value":"={{ $json.data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,128],"id":"d690432b-07de-4041-92d8-8ea1c58acbae","name":"Seta os Dados para o Agente"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"Seu papel é analisar transações financeiras usando os dados fornecidos. Forneça um resumo curto e preciso, porém informativo, sobre as informações recebidas para serem reportadas ao usuário.\n\nPode usar emojis pra deixar mais amigável a mensagem para ser enviada no whatsapp do usuário\n\nIMPORTANTE:\nUse a ferramenta de calculadora para calcular o valor correto.","role":"system"},{"content":"={{ $json.data }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1184,128],"id":"f05a6b19-11fd-44f6-8cac-cfad6d3154de","name":"Resumidor Financeiro","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1376,336],"id":"be41d2cd-2c6b-4909-a5b2-70df95291310","name":"Calculator"},{"parameters":{"content":"## Chama a IA para gerar o Resumo Financeiro","height":256,"width":304,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1152,48],"id":"3fc77878-7386-48cf-88bc-783036f9ad00","name":"Sticky Note4"},{"parameters":{"assignments":{"assignments":[{"id":"56654bf5-16d8-4e42-b8c4-300a3a8baf92","name":"response","value":"={{ $json.message.content }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1616,128],"id":"83b4c1ff-7cf5-4d58-af77-9bcb5cfe83d4","name":"Retorna o Resumo"},{"parameters":{"content":"## Retorna o Resumo para o Agente Chamador","height":256,"width":288,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1520,48],"id":"124483a1-bebf-4e5a-a2a4-871ebb2faf8e","name":"Sticky Note5"},{"parameters":{"documentId":{"__rl":true,"value":"1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU","mode":"list","cachedResultName":"Banco de Dados - FinThrix","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Movimentações","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Mês","lookupValue":"={{ $json.mes }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[176,64],"id":"fd74f2d8-b4a5-4505-b613-c49d6a0f4e72","name":"Busca Movimentações - Só com Mês","credentials":{"googleSheetsOAuth2Api":{"id":"vZSfHHRYQWS29a4T","name":"Google Sheets - Taysa"}}},{"parameters":{"documentId":{"__rl":true,"value":"1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU","mode":"list","cachedResultName":"Banco de Dados - FinThrix","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Movimentações","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Mês","lookupValue":"={{ $json.mes }}"},{"lookupColumn":"Categoria","lookupValue":"={{$node[\"Seta Retorno\"].json[\"categoria\"]}}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[176,256],"id":"7303031a-44ba-4f17-b755-1be063ed56a4","name":"Busca Movimentações - Mês + Categoria","credentials":{"googleSheetsOAuth2Api":{"id":"vZSfHHRYQWS29a4T","name":"Google Sheets - Taysa"}}}],"connections":{"Executa Workflow":{"main":[[{"node":"Análise dos Dados","type":"main","index":0}]]},"Análise dos Dados":{"main":[[{"node":"Seta Retorno","type":"main","index":0}]]},"Seta Retorno":{"main":[[{"node":"Formata Data","type":"main","index":0}]]},"Formata Data":{"main":[[{"node":"Verifica se tem categoria","type":"main","index":0}]]},"Junta as Linhas em um único campo":{"main":[[{"node":"Seta os Dados para o Agente","type":"main","index":0}]]},"Seta os Dados para o Agente":{"main":[[{"node":"Resumidor Financeiro","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Resumidor Financeiro","type":"ai_tool","index":0}]]},"Resumidor Financeiro":{"main":[[{"node":"Retorna o Resumo","type":"main","index":0}]]},"Verifica se tem categoria":{"main":[[{"node":"Busca Movimentações - Só com Mês","type":"main","index":0}],[{"node":"Busca Movimentações - Mês + Categoria","type":"main","index":0}]]},"Busca Movimentações - Só com Mês":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]},"Busca Movimentações - Mês + Categoria":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"0fee5b73-4bda-4267-a696-7e65ebbf8f97","triggerCount":0,"tags":[]}