{"createdAt":"2025-10-20T18:55:46.059Z","updatedAt":"2025-11-17T21:47:23.321Z","id":"HJmh6E2HXm8b4Yue","name":"BMS - 6.2 - Consulta Folha","active":false,"isArchived":false,"nodes":[{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"chat_id\":\"+5534992150692\",\n\"pergunta\": \"quanto foi gasto com horas extras em mar√ßo de 2024\",\n  \"empresa\": \"TechRH Ltda\",\n  \"areas\": \"Comercial; Financeiro; Marketing; Opera√ß√µes; RH; TI\",\n  \"departamentos\": \"Comercial; Financeiro; Marketing; Opera√ß√µes; RH; TI\",\n  \"centro_de_custo\": \"104 ‚Äì RH; 115 ‚Äì Comercial; 115 ‚Äì Financeiro; 115 ‚Äì TI; 116 ‚Äì TI; 119 ‚Äì Comercial; 119 ‚Äì Financeiro; 119 ‚Äì Opera√ß√µes; 121 ‚Äì Financeiro; 122 ‚Äì Opera√ß√µes; 122 ‚Äì TI; 126 ‚Äì Marketing; 127 ‚Äì TI; 137 ‚Äì Comercial; 142 ‚Äì RH; 149 ‚Äì Marketing; 151 ‚Äì Opera√ß√µes; 157 ‚Äì Financeiro; 158 ‚Äì Opera√ß√µes; 159 ‚Äì Financeiro; 160 ‚Äì Marketing; 164 ‚Äì Financeiro; 165 ‚Äì Marketing; 165 ‚Äì TI; 167 ‚Äì Marketing; 168 ‚Äì Opera√ß√µes; 169 ‚Äì Marketing; 171 ‚Äì Comercial; 171 ‚Äì Financeiro; 177 ‚Äì Comercial; 182 ‚Äì TI; 219 ‚Äì Comercial; 241 ‚Äì Opera√ß√µes; 246 ‚Äì Opera√ß√µes; 256 ‚Äì TI; 274 ‚Äì Financeiro; 278 ‚Äì Opera√ß√µes; 280 ‚Äì Marketing; 284 ‚Äì Comercial; 284 ‚Äì RH\",\n  \"cargos\": \"Analista; Assistente; Coordenador; Gerente; Supervisor\"\n}"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[1296,-704],"id":"e33cb870-3ce6-4f60-8161-f95b677655d6","name":"trigger"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1840,-480],"id":"7ac2a397-9206-40c6-914b-946c37cf0f5b","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"promptType":"define","text":"=### Dia Atual: {{ $now.weekdayLong }},{{ $now.format('dd/MM/yyyy') }},{{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0')}}\n\nVoc√™ √© um interpretador de perguntas sobre folha de pagamento e colaboradores.\n\nSua fun√ß√£o √© transformar a pergunta do usu√°rio em um JSON com filtros objetivos para montar uma query SQL.\n\nUse os dados de contexto dispon√≠veis abaixo:\n\nas rubricas est√£o separadas por ; e n√£o por , ent√£o \"Comiss√µes, Gratifica√ß√µes e Premia√ß√µes\" √© uma r√∫brica s√≥\n\n**Empresa:** {{ $json.parametros_folha.empresa }}\n\n**√Åreas dispon√≠veis:** {{ $json.parametros_folha.areas.join('; ') }}\n\n**Departamentos dispon√≠veis:** {{ $json.parametros_folha.departamentos.join('; ') }}\n\n**Centro de Custo dispon√≠veis:** {{ $json.parametros_folha.centro_de_custo.join('; ') }}\n\n**Cargos dispon√≠veis:** {{ $json.parametros_folha.cargos.join('; ') }}\n\nQue cont√™m:\n- empresas: lista de empresas dispon√≠veis\n- √°reas, departamentos, centro_de_custo e cargos: estrutura organizacional completa\n\nAnalise a pergunta em {{ $json.pergunta }} e devolva apenas um JSON com os filtros detectados, sem texto adicional.\n\nCampos esperados:\n- mes_inicio (MM/AAAA)\n- mes_fim (MM/AAAA)\n- tipo_custo (ex: Sal√°rio, Benef√≠cios, Horas Extras e Adicionais, Encargos, etc.)\n- area\n- departamento\n- centro_de_custo\n- cargo\n- empresa\n- metrica (ex: total_gasto, ranking, media, comparativo)\n- periodo_comparativo (opcional)\n- colaborador (nome ou parte do nome ou cpf)\n\nRegras:\n- Se o usu√°rio n√£o especificar meses, defina o range como os **√∫ltimos 3 meses at√© o atual**.\n- Se disser ‚Äúm√™s passado‚Äù, use o m√™s anterior e os dois anteriores a ele.\n- Se pedir um m√™s espec√≠fico, puxe tamb√©m os dois anteriores.\n- Se disser ‚Äúano inteiro‚Äù, use o range completo informado.\n- Sempre considere o m√™s mais recente como o m√™s anterior ao m√™s atual.\n- O m√™s atual nunca deve ser inclu√≠do nos filtros.\n- Se o usu√°rio n√£o especificar meses, defina o range como os √∫ltimos 3 meses at√© o m√™s anterior ao atual.\n- Se disser ‚Äúm√™s passado‚Äù, use o m√™s anterior e os dois anteriores a ele.\n- Se pedir um m√™s espec√≠fico, puxe tamb√©m os dois anteriores, mas nunca inclua o m√™s atual.\n- Se disser ‚Äúano inteiro‚Äù, use o range completo informado, mas n√£o inclua o m√™s atual.\n- Se a pergunta for gen√©rica (‚Äúquanto gastei com pessoas‚Äù), use tipo_custo = ‚Äútodas‚Äù.\n- Se n√£o houver filtros de √°rea, departamento, cargo ou empresa, retorne null nesses campos.\n- Sempre responda apenas o JSON, sem explica√ß√µes.\n- Se area, departamento, tipo_custo, centro_de_custo, cargo ou empresa tiverem mais de um valor, retorne como array. Se n√£o houver valor, retorne null.‚Äù\n- Em casos de perguntas de rankeamento ou ranking ou ordena√ß√£o, defina a metrica como \"ranking\"\n- Quando o usu√°rio disser ‚Äúpor departamento‚Äù, ‚Äúpor √°rea‚Äù, ‚Äúpor cargo‚Äù‚Ä¶ interprete como:\n    departamento = TODOS os departamentos dispon√≠veis\n    (ou √°rea / cargo / empresa / CC)\n    Exemplo:\n    \"por departamento\" -> \"departamento\": [\"TI\", \"Marketing\", \"Financeiro\", ‚Ä¶]\n- Sempre que o usu√°rio mencionar um nome de pessoa, extraia esse nome exatamente como est√° e retorne no campo \"colaborador\".\nCaso mais de um nome seja citado, retorne em array.\nSe n√£o houver nome, retorne \"colaborador\": null.\n\nREGRAS SOBRE COLABORADORES\n\n1. Se a pergunta cont√©m um nome (ex.: ‚ÄúAna Souza‚Äù)\n  Preencha \"colaborador\": \"Ana Souza\"\n  Ative \"busca_colaborador_fuzzy\": true\n  (o workflow vai fazer query buscando semelhantes)\nL√≥gica de sele√ß√£o ap√≥s uma busca fuzzy\nQuando uma lista de colaboradores semelhantes for apresentada ao usu√°rio:\nSe o usu√°rio responder exatamente com o nome de uma das op√ß√µes da lista:\nO fuzzy N√ÉO deve ser executado novamente\nDeve ser feita uma identifica√ß√£o exata\nDefina \"busca_colaborador_fuzzy\": false\n\nContinue com a interpreta√ß√£o da inten√ß√£o original normalmente\n2. Se cont√©m m√∫ltiplos nomes\n  Retorne array: \"colaborador\": [\"Ana Souza\", \"Jo√£o Lima\"]\n  Sinalize \"busca_colaborador_fuzzy\": true\n3. Se cont√©m uma matr√≠cula (somente n√∫meros)\n  Preencha \"matricula\": \"12345\"\n  \"busca_colaborador_fuzzy\": false\n  \"colaborador\": null\n4. Se o usu√°rio erra o nome\n  Ainda assim retorne exatamente o nome escrito\n  E \"busca_colaborador_fuzzy\": true\n5. Se n√£o houver nome nem matr√≠cula\n  \"colaborador\": null\n  \"busca_colaborador_fuzzy\": false\n  \"matricula\": null\n\nIDENTIFICA√á√ÉO DO TIPO DE RANKING\nSe a pergunta contiver termos como:\n    ‚Äúquem mais gastou‚Äù\n    ‚Äúquem gastou mais‚Äù\n    ‚Äúquem‚Äù\n    ‚Äúpessoa‚Äù, ‚Äúcolaborador‚Äù, ‚Äúfuncion√°rio‚Äù\n    ‚Äútop‚Äù\n    ‚Äúranking‚Äù\n    ‚Äúmaiores gastos‚Äù\n    ‚Äúem ordem decrescente‚Äù\nEnt√£o: \"metrica\": \"ranking\"\nE classifique:\n    Se o foco √© pessoas (palavras como ‚Äúquem‚Äù, ‚Äúcolaborador‚Äù, ‚Äúpessoa‚Äù, ‚Äúfuncion√°rio‚Äù)\n      \"ranking_tipo\": \"pessoas\"\n    \n    Se o foco √© categorias (departamento, √°rea, centro de custo, cargo, empresa)\n      \"ranking_tipo\": \"categoria\"\n\nDETEC√á√ÉO DE RANKING POR CATEGORIA\n\nSempre que a pergunta contiver termos como:\n‚Äúqual √°rea mais gastou‚Äù\n‚Äú√°rea mais cara‚Äù\n‚Äúqual √°rea gastou mais‚Äù\n‚Äúmaior gasto por √°rea‚Äù\n‚Äúseparados por √°rea‚Äù\n‚Äúpor √°rea‚Äù\n‚Äúranking de √°reas‚Äù\n‚Äúdiferen√ßa entre √°reas‚Äù\n‚Äúcompara√ß√£o entre √°reas‚Äù\n\nEnt√£o:\n\"metrica\": \"ranking\"\n\"ranking_tipo\": \"categoria\"\n\"area\" = TODAS as √°reas dispon√≠veis\n‚Üí ex.: \"area\": [\"TI\", \"Marketing\", \"Financeiro\", ...]\n\nE mesma l√≥gica para departamento, cargo, centro de custo.\n\nSe n√£o houver qualifica√ß√£o (como ‚Äúpor √°rea‚Äù, ‚Äú√°rea‚Äù, \"departamento\"), escolha a categoria com base no termo encontrado.\n\nREGRAS DE PER√çODO (MUITO IMPORTANTE)\n1. Se o usu√°rio define um intervalo expl√≠cito\nExemplos:\n  ‚Äúde agosto a outubro‚Äù\n  ‚Äúentre 06/2025 e 09/2025‚Äù\n  ‚Äúde setembro at√© novembro‚Äù\n\n‚Üí Use exatamente esse intervalo:\n  mes_inicio = primeiro m√™s\n  mes_fim = √∫ltimo m√™s\n\n2. Se o usu√°rio pede um m√™s espec√≠fico\nExemplos:\n  ‚Äúem outubro‚Äù\n  ‚Äúem 10/2025‚Äù\n  ‚Äúno m√™s de agosto‚Äù\n\n‚Üí Regra especial:\nüìå Se m√©trica = ranking AND ranking_tipo = pessoas\n‚Üí Use somente esse m√™s\nüìå Caso contr√°rio (consultas gerais)\n‚Üí Puxe tamb√©m os 2 meses anteriores\n(n√£o incluir o m√™s atual)\n\n3. ‚Äúm√™s passado‚Äù / ‚Äú√∫ltimo m√™s‚Äù\n‚Üí Usar exatamente o m√™s anterior ao atual, sem meses extras.\n\n4. Se n√£o houver refer√™ncia temporal expl√≠cita\n‚Üí Use os √∫ltimos 3 meses completos, ignorando o m√™s atual.\n\nExemplo:\n{\n  \"mes_inicio\": \"...\",\n  \"mes_fim\": \"...\",\n  \"tipo_custo\": \"... OU [...]\",\n  \"colaborador\": \"... OU [...] OU null\",\n  \"busca_colaborador_fuzzy\": true | false,\n  \"matricula\": \"...\" | null,\n  \"area\": \"... OU [...] OU null\",\n  \"departamento\": \"... OU [...] OU null\",\n  \"centro_de_custo\": \"... OU [...] OU null\",\n  \"cargo\": \"... OU [...] OU null\",\n  \"empresa\": \"... OU null\",\n  \"metrica\": \"total_gasto | ranking | ...\",\n  \"ranking_tipo\": \"pessoas | categoria | null\",\n  \"periodo_comparativo\": number | null,\n  \"pergunta\": \"{{ $json.pergunta }}\"\n}\n\nExemplo de sa√≠da:\n{\n  \"mes_inicio\": \"06/2025\",\n  \"mes_fim\": \"08/2025\",\n  \"tipo_custo\": \"Sal√°rio\",\n  \"colaborador\": \"Ana Sophia Ara√∫jo\",\n  \"busca_colaborador_fuzzy\": true,\n  \"matricula\": null,\n  \"area\": null,\n  \"departamento\": null,\n  \"centro_de_custo\": null,\n  \"cargo\": null,\n  \"empresa\": {{ $json.parametros_folha.empresa }},\n  \"metrica\": \"total_gasto\",\n  \"ranking_tipo\": \"pessoas\",\n  \"periodo_comparativo\": 3,\n  \"pergunta\": {{ $json.pergunta }} \n}\n\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1840,-704],"id":"6140b614-29eb-4f22-8302-bc29c416569b","name":"Interpretar pergunta"},{"parameters":{"operation":"executeQuery","query":"{{$json.query}}"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[2480,-704],"id":"851b7a14-2f0d-433a-b985-1ed4ecf31654","name":"Executar Query","alwaysOutputData":true,"credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"jsCode":"// ======================\n// === PARSE DE FILTROS ===\n// ======================\nlet filtros;\ntry {\n  let raw = $json.output || $json;\n  if (typeof raw === 'object') {\n    filtros = raw;\n  } else {\n    const clean = raw.replace(/```json\\s*|\\s*```/g, '').trim();\n    filtros = JSON.parse(clean);\n  }\n} catch (e) {\n  console.log('‚ùå Erro ao parsear filtros:', e);\n  filtros = {};\n}\n\n// ======================\n// === NORMALIZA√á√ÉO ===\n// ======================\nconst normalize = (v) => {\n  if (!v) return v;\n  if (Array.isArray(v)) return v.map(x => normalize(x));\n  return String(v)\n    .replace(/[‚Äì‚Äî]/g, '-') \n    .replace(/\\s+/g, ' ')\n    .trim();\n};\n\nfor (const campo of [\n  'tipo_custo', 'area', 'departamento', 'centro_de_custo',\n  'cargo', 'empresa', 'colaborador'\n]) {\n  const val = filtros[campo];\n}\n\n// Detecta m√∫ltiplos tipos de custo\nconst isMultiTipoCusto = Array.isArray(filtros.tipo_custo) && filtros.tipo_custo.length > 1;\n\n// =======================================================\n// === REGRAS DE PER√çODO ================================\n// =======================================================\nfunction mmyyyyToInt(mmyyyy) {\n  if (!mmyyyy) return null;\n  const [mm, yyyy] = mmyyyy.split('/');\n  return parseInt(`${yyyy}${mm}`);\n}\n\nfunction formatMMYYYY(date) {\n  return `${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;\n}\n\nconst today = new Date();\nconst mesAtual = today.getMonth();\nconst anoAtual = today.getFullYear();\n\nconst mesAnteriorDate = new Date(anoAtual, mesAtual - 1, 1);\n\nlet mesInicio = filtros.mes_inicio || null;\nlet mesFim = filtros.mes_fim || null;\n\nconst metrica = filtros.metrica;\nconst rankingTipo = filtros.ranking_tipo;\n\n// === Per√≠odos ===\nif (mesInicio && mesFim) {\n  // range expl√≠cito\n}\nelse if (metrica === 'ranking' && rankingTipo === 'pessoas' && filtros.mes_especifico) {\n  mesInicio = filtros.mes_especifico;\n  mesFim = filtros.mes_especifico;\n}\nelse if (filtros.periodo_tipo === 'mes_passado') {\n  const mm = String(mesAnteriorDate.getMonth() + 1).padStart(2, '0');\n  const yyyy = mesAnteriorDate.getFullYear();\n  mesInicio = `${mm}/${yyyy}`;\n  mesFim = `${mm}/${yyyy}`;\n}\nelse if (filtros.mes_especifico) {\n  const [mes, ano] = filtros.mes_especifico.split('/');\n  const base = new Date(parseInt(ano), parseInt(mes) - 1, 1);\n  const inicio = new Date(base.getFullYear(), base.getMonth() - 2, 1);\n\n  mesInicio = formatMMYYYY(inicio);\n  mesFim = `${mes}/${ano}`;\n}\nelse {\n  const inicio = new Date(anoAtual, mesAtual - 3, 1);\n  const fim = new Date(anoAtual, mesAtual - 1, 1);\n  mesInicio = formatMMYYYY(inicio);\n  mesFim = formatMMYYYY(fim);\n}\n\n// Normaliza int\nlet startInt = mmyyyyToInt(mesInicio);\nlet endInt = mmyyyyToInt(mesFim);\nif (startInt > endInt) [startInt, endInt] = [endInt, startInt];\n\nconst filtroTemporal = `\n  AND CAST(RIGHT(LTRIM(RTRIM(r.[Mes_ref_folha])),4) \n      + LEFT(LTRIM(RTRIM(r.[Mes_ref_folha])),2) AS INT)\n      BETWEEN ${startInt} AND ${endInt}\n`;\n\n// ======================\n// === HELPERS SQL =====\n// ======================\nconst escapeSql = (v) => (v ? v.replace(/'/g, \"''\") : v);\nconst toIn = (arr) => arr.map(v => `'${escapeSql(v)}'`).join(', ');\n\nconst filtroTxt = (alias, campo, valor) => {\n  if (!valor) return '';\n  return Array.isArray(valor)\n    ? ` AND ${alias}.[${campo}] IN (${toIn(valor)})`\n    : ` AND ${alias}.[${campo}] = '${escapeSql(valor)}'`;\n};\n\n// =======================================================\n// === TIPO CUSTO FILTRO =================================\n// =======================================================\nlet tipoCustoFiltro = '';\nif (filtros.tipo_custo && filtros.tipo_custo !== 'todas') {\n  if (Array.isArray(filtros.tipo_custo)) {\n    tipoCustoFiltro = ` AND r.[Tipo_Custo] IN (${toIn(filtros.tipo_custo)})`;\n  } else {\n    tipoCustoFiltro = filtroTxt('r', 'Tipo_Custo', filtros.tipo_custo);\n  }\n}\n\n// =======================================================\n// === QUERY MULTI TIPO ==================================\n// =======================================================\nfunction queryMultiTipo() {\n  return `\n    SELECT \n      LTRIM(RTRIM(r.[Mes_ref_folha])) AS Mes,\n      r.[Tipo_Custo],\n      SUM(r.[Valor]) AS Total_Gasto\n    FROM [vw_Rubricas_Classificadas] r\n    INNER JOIN [RhTech_fake_Colaboradores] c  \n      ON REPLACE(REPLACE(REPLACE(c.[CPF],'.',''),'-',''),' ','') =\n         REPLACE(REPLACE(REPLACE(r.[CPF],'.',''),'-',''),' ','')\n    WHERE 1=1\n      ${tipoCustoFiltro}\n      ${filtroTxt('c','√Årea', filtros.area)}\n      ${filtroTxt('c','Departamento', filtros.departamento)}\n      ${filtroTxt('c','Cargo', filtros.cargo)}\n      ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n      ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n      ${filtroTemporal}\n    GROUP BY r.[Tipo_Custo], LTRIM(RTRIM(r.[Mes_ref_folha]))\n    ORDER BY Mes DESC, r.[Tipo_Custo];\n  `;\n}\n\n// =======================\n// CONSULTA POR MATR√çCULA\n// =======================\nif (filtros.matricula) {\n\n  let matriculas = filtros.matricula;\n\n  // Normaliza: sempre vira array\n  if (!Array.isArray(matriculas)) {\n    matriculas = [String(matriculas)];\n  }\n\n  // Aplica escape individualmente\n  const matriculasSanitizadas = matriculas.map(m => escapeSql(String(m)));\n\n  const query = isMultiTipoCusto\n    ? queryMultiTipo()\n    : `\n      SELECT \n        c.[Nome],\n        c.[Matr√≠cula],\n        LTRIM(RTRIM(r.[Mes_ref_folha])) AS Mes,\n        SUM(r.[Valor]) AS Total_Gasto\n      FROM [vw_Rubricas_Classificadas] r\n      INNER JOIN [RhTech_fake_Colaboradores] c  \n        ON REPLACE(REPLACE(REPLACE(c.[CPF],'.',''),'-',''),' ','')\n          = REPLACE(REPLACE(REPLACE(r.[CPF],'.',''),'-',''),' ','')\n      WHERE 1=1\n        AND c.[Matr√≠cula] IN (${matriculasSanitizadas.map(m => `'${m}'`).join(\", \")})\n        ${tipoCustoFiltro}\n        ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n        ${filtroTxt('c','√Årea', filtros.area)}\n        ${filtroTxt('c','Departamento', filtros.departamento)}\n        ${filtroTxt('c','Cargo', filtros.cargo)}\n        ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n        ${filtroTemporal}\n      GROUP BY c.[Nome], c.[Matr√≠cula], LTRIM(RTRIM(r.[Mes_ref_folha]))\n      ORDER BY c.[Nome], Mes DESC;\n    `;\n\n  return [{ json: { query, filtrosAplicados: filtros, modo: \"consulta_por_matricula\" } }];\n}\n\n\n// =======================================================\n// === CONSULTA POR NOME EXATO ===========================\n// =======================================================\nif (filtros.colaborador && !filtros.busca_colaborador_fuzzy) {\n\n  const query = isMultiTipoCusto\n    ? queryMultiTipo()\n    : `\n      SELECT \n        LTRIM(RTRIM(r.[Mes_ref_folha])) AS Mes,\n        SUM(r.[Valor]) AS Total_Gasto\n      FROM [vw_Rubricas_Classificadas] r\n      INNER JOIN [RhTech_fake_Colaboradores] c  \n        ON REPLACE(REPLACE(REPLACE(c.[CPF],'.',''),'-',''),' ','') =\n           REPLACE(REPLACE(REPLACE(r.[CPF],'.',''),'-',''),' ','')\n      WHERE 1=1\n        AND c.[Nome] = '${escapeSql(filtros.colaborador)}'\n        ${tipoCustoFiltro}\n        ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n        ${filtroTxt('c','√Årea', filtros.area)}\n        ${filtroTxt('c','Departamento', filtros.departamento)}\n        ${filtroTxt('c','Cargo', filtros.cargo)}\n        ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n        ${filtroTemporal}\n      GROUP BY LTRIM(RTRIM(r.[Mes_ref_folha]))\n      ORDER BY Mes DESC;\n    `;\n\n  return [{ json: { query, filtrosAplicados: filtros, modo: \"consulta_por_nome_exato\" } }];\n}\n\n// =======================================================\n// === FUZZY =============================================\n// =======================================================\n// FUZZY SEARCH ROBUSTO\nif (filtros.colaborador && filtros.busca_colaborador_fuzzy) {\n\n  const termos = filtros.colaborador\n    .split(/\\s+/)\n    .filter(t => t.length > 2)\n    .map(t => t.trim());\n\n  const likeParts = termos\n    .map(t => `c.[Nome] LIKE '%${escapeSql(t)}%' COLLATE Latin1_General_CI_AI`)\n    .join(' AND ');\n\n  const query = `\n    SELECT DISTINCT\n      c.[Nome],\n      c.[Matr√≠cula]\n    FROM [RhTech_fake_Colaboradores] c\n    WHERE 1=1\n      AND (${likeParts}\n           OR SOUNDEX(c.[Nome]) = SOUNDEX('${escapeSql(filtros.colaborador)}')\n           OR DIFFERENCE(c.[Nome], '${escapeSql(filtros.colaborador)}') >= 3\n      )\n      ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n      ${filtroTxt('c','√Årea', filtros.area)}\n      ${filtroTxt('c','Departamento', filtros.departamento)}\n      ${filtroTxt('c','Cargo', filtros.cargo)}\n      ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n    ORDER BY c.[Nome];\n  `;\n\n  return [{ json: { query, filtrosAplicados: filtros, modo: \"consulta_fuzzy\" } }];\n}\n\n// =======================================================\n// === RANKING PESSOAS ===================================\n// =======================================================\nif (metrica === 'ranking' && rankingTipo === 'pessoas') {\n  const query = `\n    SELECT\n      c.[Nome],\n      SUM(r.[Valor]) AS Total_Gasto\n    FROM [vw_Rubricas_Classificadas] r\n    INNER JOIN [RhTech_fake_Colaboradores] c\n      ON REPLACE(REPLACE(REPLACE(c.[CPF],'.',''),'-',''),' ','') =\n         REPLACE(REPLACE(REPLACE(r.[CPF],'.',''),'-',''),' ','')\n    WHERE 1=1\n      ${tipoCustoFiltro}\n      ${filtroTxt('c','√Årea', filtros.area)}\n      ${filtroTxt('c','Departamento', filtros.departamento)}\n      ${filtroTxt('c','Cargo', filtros.cargo)}\n      ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n      ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n      ${filtroTemporal}\n    GROUP BY c.[Nome]\n    ORDER BY SUM(r.[Valor]) DESC;\n  `;\n  return [{ json: { query, filtrosAplicados: filtros, modo: \"ranking_pessoas\" } }];\n}\n\n// =======================================================\n// === RANKING CATEGORIA ================================\n// =======================================================\nif (metrica === 'ranking' && rankingTipo === 'categoria') {\n\n  let campo;\n\n  if (Array.isArray(filtros.area)) {\n    campo = 'c.[√Årea]';\n  } else if (Array.isArray(filtros.departamento)) {\n    campo = 'c.[Departamento]';\n  } else if (Array.isArray(filtros.centro_de_custo)) {\n    campo = 'c.[Centro_de_Custo]';\n  } else if (Array.isArray(filtros.cargo)) {\n    campo = 'c.[Cargo]';\n  } else if (filtros.empresa && !filtros.area && !filtros.departamento && !filtros.centro_de_custo && !filtros.cargo) {\n    campo = 'c.[Nome_da_Empresa]';\n  } else {\n    campo = 'c.[√Årea]'; // fallback seguro\n  }\n\n\n  const query = `\n    SELECT ${campo} AS Categoria,\n           SUM(r.[Valor]) AS Total_Gasto\n    FROM [vw_Rubricas_Classificadas] r\n    INNER JOIN [RhTech_fake_Colaboradores] c\n      ON REPLACE(REPLACE(REPLACE(c.[CPF],'.',''),'-',''),' ','') =\n         REPLACE(REPLACE(REPLACE(r.[CPF],'.',''),'-',''),' ','')\n    WHERE 1=1\n      ${tipoCustoFiltro}\n      ${filtroTxt('c','√Årea', filtros.area)}\n      ${filtroTxt('c','Departamento', filtros.departamento)}\n      ${filtroTxt('c','Cargo', filtros.cargo)}\n      ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n      ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n      ${filtroTemporal}\n    GROUP BY ${campo}\n    ORDER BY SUM(r.[Valor]) DESC;\n  `;\n  return [{ json: { query, filtrosAplicados: filtros, modo: \"ranking_categoria\" } }];\n}\n\n// =======================================================\n// === TOTAL GASTO =======================================\n// =======================================================\nif (metrica === 'total_gasto' || !metrica) {\n\n  if (isMultiTipoCusto) {\n    return [{ json: { query: queryMultiTipo(), filtrosAplicados: filtros, modo: \"total_multiplos_tipos\" } }];\n  }\n\n  const precisaJoin =\n    filtros.area || filtros.departamento || filtros.cargo ||\n    filtros.centro_de_custo || filtros.empresa;\n\n  let query;\n\n  if (precisaJoin) {\n    query = `\n      SELECT \n        LTRIM(RTRIM(r.[Mes_ref_folha])) AS Mes,\n        SUM(r.[Valor]) AS Total_Gasto\n      FROM [vw_Rubricas_Classificadas] r\n      INNER JOIN [RhTech_fake_Colaboradores] c  \n        ON REPLACE(REPLACE(REPLACE(c.[CPF],'.',''),'-',''),' ','') =\n           REPLACE(REPLACE(REPLACE(r.[CPF],'.',''),'-',''),' ','')\n      WHERE 1=1\n        ${tipoCustoFiltro}\n        ${filtroTxt('c','√Årea', filtros.area)}\n        ${filtroTxt('c','Departamento', filtros.departamento)}\n        ${filtroTxt('c','Cargo', filtros.cargo)}\n        ${filtroTxt('c','Centro_de_Custo', filtros.centro_de_custo)}\n        ${filtroTxt('c','Nome_da_Empresa', filtros.empresa)}\n        ${filtroTemporal}\n      GROUP BY LTRIM(RTRIM(r.[Mes_ref_folha]))\n      ORDER BY Mes DESC;\n    `;\n  } else {\n    query = `\n      SELECT \n        LTRIM(RTRIM(r.[Mes_ref_folha])) AS Mes,\n        SUM(r.[Valor]) AS Total_Gasto\n      FROM [vw_Rubricas_Classificadas] r\n      WHERE 1=1\n        ${tipoCustoFiltro}\n        ${filtroTemporal}\n      GROUP BY LTRIM(RTRIM(r.[Mes_ref_folha]))\n      ORDER BY Mes DESC;\n    `;\n  }\n\n  return [{ json: { query, filtrosAplicados: filtros, modo: \"total_gasto\" } }];\n}\n\n// =======================================================\n// === FALLBACK ==========================================\n// =======================================================\nreturn [{\n  json: {\n    query: `\n      SELECT TOP 10000 *\n      FROM [vw_Rubricas_Classificadas] r\n      ORDER BY r.[Mes_ref_folha] DESC;\n    `,\n    filtrosAplicados: filtros,\n    modo: \"detalhamento\"\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2256,-704],"id":"9a62cafe-7ea8-44cd-8639-da532a293f9a","name":"Criar Query"},{"parameters":{"model":"openai/gpt-4o","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2928,-480],"id":"8f321671-8d20-47df-a15e-130f79cac433","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"promptType":"define","text":"=### Dia Atual: {{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\n\nVoc√™ √© a **Mindy**, diretora de RH virtual. \nExplique os resultados da consulta SQL de forma **clara, objetiva e profissional**.\n\n**CONTEXTO**\n- Pergunta do usu√°rio: \"{{ $json.pergunta }}\"\n- Dados da consulta: {{ JSON.stringify($json.resultados, null, 2) }}\n- Filtros aplicados: {{ JSON.stringify($json.filtros, null, 2) }}\n- Modo da consulta: {{ $('Criar Query').first().json.modo }}\n- Periodo foi considerado pra realizar a busca: {{ $json.filtros.mes_inicio }} e {{ $json.filtros.mes_fim }}\n\n**Regras gerais:**\n1. Resuma o per√≠odo completo analisado (‚ÄúNo √∫ltimo trimestre‚Äù, ‚ÄúNos √∫ltimos 3 meses‚Äù, etc.).\n2. Mencione m√™s(es) e, quando aplic√°vel, liste departamentos/√°reas/centros de custo/tipo de custo conforme retornado pela query.\n3. Formate valores em reais (R$ 1,2 mil / R$ 2,3 milh√µes).\n4. Se n√£o houver resultado (array vazio), responda exatamente:\n   { \"resposta\": \"N√£o encontrei registros para esse filtro.\", \"precisaImagem\": false }\n5. Se a pergunta mencionar m√∫ltiplas rubricas (ex: \"f√©rias e 13¬∫\") e a query devolver apenas algumas, descreva os dados encontrados e informe explicitamente quais rubricas n√£o tiveram registros.\ntraga a que existe, explique que n√£o encontrou registros da outra.\n6.Sempre listar os valores individuais por m√™s\nExemplo:\n‚ÄúJunho: R$ 8,8 mil; Julho: R$ 5,5 mil; Agosto: R$ 9,0 mil.‚Äù\n7. Sempre calcular o total geral do per√≠odo\nSome todos os valores de Total_Gasto usando a ferramenta Calculator.\nFormate em R$ com milhar/milh√£o quando necess√°rio.\n8. Sempre inferir a tend√™ncia\nCom base nos meses ordenados por data (crescente):\nSe o √∫ltimo m√™s > m√©dia dos anteriores = ‚Äútend√™ncia de alta‚Äù\nSe o √∫ltimo m√™s < m√©dia dos anteriores = ‚Äútend√™ncia de queda‚Äù\nSe estiver pr√≥ximo = ‚Äúest√°vel‚Äù\n\n# **REGRAS SOBRE MESES**\n\n* Se houver **mais de um m√™s**, liste todos, em ordem cronol√≥gica.\n* Se houver **apenas um m√™s**, liste-o normalmente e **n√£o calcule tend√™ncia**.\n* S√≥ calcule tend√™ncia quando existirem **2 ou mais meses distintos**.\n\n# **INFER√äNCIA DE TEND√äNCIA**\n\n* Tend√™ncia s√≥ deve ser calculada para queries com timeline (total_gasto, detalhamento, algumas rankings categoriais).\n* N√ÉO calcular tend√™ncia em:\n\n  * `ranking_pessoas`\n  * `consulta_fuzzy`\n  * qualquer caso em que n√£o existam pelo menos 2 meses\n\nRegra da tend√™ncia:\n\n* √öltimo m√™s > m√©dia dos anteriores ‚Üí **tend√™ncia de alta**\n* √öltimo m√™s < m√©dia dos anteriores ‚Üí **tend√™ncia de queda**\n* Diferen√ßa pequena ‚Üí **est√°vel**\n\n**DETERMINAR RANKING vs LISTAGEM COMPLETA**\n- Use **ranking** SOMENTE se a pergunta incluir explicitamente termos como: \"quem mais gastou\", \"quais s√£o os maiores gastos\", \"ranking\", \"top\", \"ordem decrescente\" ou varia√ß√µes √≥bvias.\n- Se **n√£o** pedir ranking, **liste todas** as categorias presentes em `resultados`.\n\n**Regra especial ‚Äî quando for ranking:**\n- Liste as categorias em ordem decrescente de gasto (ex: ‚ÄúOpera√ß√µes R$ 598,6 mil; Comercial R$ 556,8 mil; TI R$ 528,9 mil...‚Äù).\n- Informe o **total geral** do per√≠odo somando todas as categorias.\n- Finalize com uma **s√≠ntese da tend√™ncia geral** (‚Äúos gastos se mant√™m est√°veis‚Äù, ‚Äúhouve leve alta‚Äù, etc.).\n\n# **REGRAS PARA RANKING**\n\n### Quando a pergunta pedir ranking:\n\n* Ordene decrescentemente.\n* Liste os 5 maiores, ou todos se forem poucos.\n* Sempre informe o total geral.\n* Sempre definir `precisaImagem: true`.\n\n### **Ranking por pessoas (`modo = ranking_pessoas`)**\n\n* N√ÉO listar meses (pois n√£o existem).\n* N√ÉO inferir tend√™ncia.\n* Estrutura de resposta:\n\n  * quem gastou mais\n  * quanto gastou\n  * total geral do ranking\n\n### **Ranking por categorias (`modo = ranking_categoria`)**\n\n* Use meses apenas se existirem na consulta.\n* Pode calcular tend√™ncia se houver timeline.\n\n## FERRAMENTAS:\n**Calculator**\nUse essa ferramenta para te ajudar nos calculos\n\n‚ö†Ô∏è IMPORTANTE:\n- Se o campo {{ JSON.stringify($json.resultados, null, 2) }} estiver vazio (sem registros),\n  **precisaImagem √© false**.\n- Retorne apenas:\n  {\n  \"resposta\": \"N√£o encontrei registros para esse filtro.\",\n  \"precisaImagem\": false\n  }\n- Caso contrario precisaImagem √© true\n\n‚ö†Ô∏è Regra especial ‚Äî quando a consulta envolver um colaborador espec√≠fico\n\nSe o filtro incluir um campo matricula ou colaborador, aplique:\n\nSe resultados estiver vazio:\nSe o filtro tem matricula:\n‚Üí Responda exatamente:\n{\n  \"resposta\": \"N√£o encontrei nenhum colaborador com essa matr√≠cula.\",\n  \"precisaImagem\": false\n}\nSe o modo da consulta for \"consulta_por_nome_exato\" e resultados estiver vazio:\n‚Üí Retorne:\n{\n  \"resposta\": \"N√£o encontrei nenhum colaborador com esse nome.\",\n  \"precisaImagem\": false\n}\n\nSe o modo da consulta for \"consulta_fuzzy\" e resultados estiver vazio:\n‚Üí Retorne:\n{\n  \"resposta\": \"N√£o encontrei colaboradores semelhantes a esse nome.\",\n  \"precisaImagem\": false\n}\n\nTratamento para consulta_fuzzy\nSe modo = \"consulta_fuzzy\":\nNunca retorne \"n√£o encontrei colaborador com esse nome\", a menos que o array esteja vazio.\n\nSe houver resultados:\n‚Üí Liste todas as possibilidades encontradas como:\n    Foram encontrados v√°rios colaboradores com nomes semelhantes:\n    - Ana Sophia Ara√∫jo (Matr√≠cula 2139)\n    - Ana Sophia Freitas (7943)\n    - Ana Beatriz da Paz (5844)\n    ...\nSEMPRE finalize com:\nPor favor, confirme qual deles voc√™ deseja consultar digitando o n√∫mero de matr√≠cula correspondente.\nNESSE CASO SEMPRE DEVE PEDIR PRA DIGITAR O N√öMERO DE MATR√çCULA CORRESPONDENTE\ne \"precisaImagem\": false\n\n**Modelos esperados:**\n\n- ‚ÄúNo trimestre, Marketing liderou com R$ 1,2 milh√£o em horas extras, seguido por TI (R$ 940 mil) e RH (R$ 870 mil). O total do per√≠odo foi de R$ 3,5 milh√µes, com tend√™ncia de leve alta.‚Äù\n- ‚ÄúN√£o encontrei registros para esse filtro.‚Äù\n\n## Sa√≠da esperada\n\nRetorne somente este JSON:\n\n{\n  \"resposta\": \"texto explicativo da an√°lise\",\n  \"precisaImagem\": true | false\n}\n\n## Modelos esperados:\n\nSe houver dados:\n{\n  \"resposta\": ‚ÄúNos √∫ltimos 3 meses, os departamentos com maior gasto em f√©rias foram: Opera√ß√µes (R$ 598,6 mil), Comercial (R$ 556,8 mil) e TI (R$ 528,9 mil). O total geral foi de R$ 3,1 milh√µes, indicando estabilidade no per√≠odo.‚Äù,\n  \"precisaImagem\": true\n}\n\nSe n√£o houver registros\n{\n  \"resposta\": \"N√£o encontrei registros para esse filtro.\",\n  \"precisaImagem\": false\n}\n\n\n\n\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[2928,-704],"id":"0848e062-dfca-4083-beed-246caae858a6","name":"Analisar e Gerar Resposta"},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT\n  [C√≥digo_Rubrica],\n  [Descri√ß√£o_Rubrica],\n  [Descri√ß√£o_Natureza_Rubrica]\nFROM [RhTech_fake_Rubricas]\nORDER BY\n  [C√≥digo_Rubrica],\n  [Descri√ß√£o_Rubrica],\n  [Descri√ß√£o_Natureza_Rubrica];\n"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3872,-1568],"id":"7d35369c-391b-453d-b43c-677e7a02d8a5","name":"Executar Query1","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT\n    --[Cargo]\n    --[Departamento]\n    [Centro_de_Custo]\n    --[√Årea]\n    --[Nome_da_Empresa]\nFROM [RhTech_fake_Colaboradores]\n"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3664,-1568],"id":"4cafd7a0-4bd2-4d4f-ac82-606241c5d1c9","name":"Executar Query2","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"jsCode":"// -------------------------\n// 1) Captura os dados do trigger\n// -------------------------\n\nconst input = $input.first().json;\n\n// Tudo que vem do trigger via string deve virar array:\nfunction parseList(value) {\n  if (!value) return [];\n  if (Array.isArray(value)) return value;\n  return value\n    .split(\";\")\n    .map(v => v.trim())\n    .filter(v => v.length > 0);\n}\n\n// -------------------------\n// 2) Captura dados das planilhas (vindos dos nodes anteriores)\n// -------------------------\n\nconst parametros_folha = {\n  //rubricas: $('rubricas').all().map(item => item.json),\n  empresa: input.empresa || null,\n  areas: parseList(input.areas),\n  departamentos: parseList(input.departamentos),\n  centro_de_custo: parseList(input.centro_de_custo),\n  cargos: parseList(input.cargos),\n};\n\n// -------------------------\n// 3) Captura a pergunta\n// -------------------------\n\nconst pergunta =\n  input.pergunta ||\n  null;\n\n// -------------------------\n// 4) Retorna JSON consolidado\n// -------------------------\n\nreturn [\n  {\n    json: {\n      pergunta,\n      parametros_folha\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1584,-704],"id":"c9a01fd1-1626-4a7f-843e-d041e1c8dc58","name":"Code"},{"parameters":{"operation":"executeQuery","query":"CREATE OR ALTER VIEW vw_Rubricas_Classificadas AS\nSELECT \n    r.[C√≥digo_Rubrica],\n    r.[Descri√ß√£o_Rubrica],\n    r.[Descri√ß√£o_Natureza_Rubrica],\n    r.[CPF],\n    r.[Valor],\n    r.[Mes_ref_folha],\n    CASE \n        -- Horas Extras e Adicionais\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%HORA%EXTRA%' OR \n             r.[Descri√ß√£o_Rubrica] LIKE '%BANCO%HORA%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%SOBREAVISO%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%ADICIONAL%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%NOTURNO%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%INSALUBRIDADE%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%PERICULOSIDADE%'\n        THEN 'Horas Extras e Adicionais'\n        \n        -- Sal√°rio\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%SALARI%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%HORA%NORMA%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%DIAS%TRABALHADO%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%PRO-LABORE%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%QUEBRA%CAIXA%'\n        THEN 'Sal√°rio'\n        \n        -- Comiss√µes, Gratifica√ß√µes e Premia√ß√µes\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%COMISS%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%GRATIFIC%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%PREMI%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%PRODUTIVIDADE%'\n        THEN 'Comiss√µes, Gratifica√ß√µes e Premia√ß√µes'\n        \n        -- F√©rias\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%FERIAS%'\n        THEN 'F√©rias'\n        \n        -- 13¬∫ Sal√°rio\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%13%SALARIO%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%13¬∫%'\n        THEN '13 sal√°rio'\n        \n        -- Rescis√£o\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%RESCIS%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%AVISO%PREVIO%'\n        THEN 'Rescis√£o'\n        \n        -- Afastamento\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%ATESTADO%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%LICENCA%'\n        THEN 'Afastamento'\n        \n        -- Descontos\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%REEMBOLSO%' OR\n             r.[Descri√ß√£o_Rubrica] LIKE '%DESC%'\n        THEN 'Descontos'\n        \n        -- DSR\n        WHEN r.[Descri√ß√£o_Rubrica] LIKE '%DSR%'\n        THEN 'Horas Extras e Adicionais'\n        \n        ELSE 'Outros'\n    END AS Tipo_Custo\n    \nFROM [RhTech_fake_Rubricas] r;"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3664,-1376],"id":"e37b73b1-beb2-4049-ab32-66f2c1b43e86","name":"Cria View com as Rubricas adequadas","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"numberInputs":6},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1200,-2080],"id":"a7e47afa-adfb-405b-b702-d9c4c1c1a2f1","name":"Merge1"},{"parameters":{"jsCode":"// --- Captura dados das planilhas (vindos dos nodes anteriores)\nconst parametros_folha = {\n  rubricas: $('Buscar Rubricas Classificadas').all().map(item => item.json),\n  empresas: $('Buscar Empresas').all().map(item => item.json),\n  areas: $('Buscar √Åreas').all().map(item => item.json),\n  departamentos: $('Buscar Departamentos').all().map(item => item.json),\n  centro_de_custo: $('Buscar Centros de Custo').all().map(item => item.json),\n  cargos: $('Buscar Cargos').all().map(item => item.json)\n};\n\n// --- Captura a pergunta (de Edit Fields ou Trigger)\nlet pergunta = null;\n\ntry {\n  pergunta =\n    $('Definir Pergunta Manual').first().json.pergunta ||\n    $('Trigger').first().json.pergunta ||\n    null;\n} catch (e) {\n  pergunta = null;\n}\n\n// --- Retorna JSON consolidado\nreturn [\n  {\n    json: {\n      pergunta,\n      parametros_folha\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1488,-2016],"id":"dbf2c410-f8df-49f9-b485-bb597b7b61e0","name":"Consolidar Par√¢metros e Pergunta"},{"parameters":{"operation":"executeQuery","query":"-- Buscar apenas tipos de custo √∫nicos (em vez de 300k registros)\nSELECT DISTINCT [Tipo_Custo] \nFROM vw_Rubricas_Classificadas \nWHERE [Tipo_Custo] IS NOT NULL \nORDER BY [Tipo_Custo];"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[688,-2624],"id":"fe1d0dba-ebfa-4aec-b9b8-0930f033d1da","name":"Buscar Rubricas Classificadas","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT [Nome_da_Empresa] \nFROM [RhTech_fake_Colaboradores] \nWHERE [Nome_da_Empresa] IS NOT NULL \nORDER BY [Nome_da_Empresa];"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[688,-2400],"id":"2cefdb2d-c944-4e94-b0ca-cb2fee8b3e18","name":"Buscar Empresas","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT [√Årea] \nFROM [RhTech_fake_Colaboradores] \nWHERE [√Årea] IS NOT NULL \nORDER BY [√Årea];\n"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[688,-2176],"id":"52f9261d-534c-4852-974e-4d6ddd5373b5","name":"Buscar √Åreas","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT [Departamento] \nFROM [RhTech_fake_Colaboradores] \nWHERE [Departamento] IS NOT NULL \nORDER BY [Departamento];"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[688,-1968],"id":"34712d74-7a39-4f71-b20d-59fac43abc76","name":"Buscar Departamentos","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT [Centro_de_Custo] \nFROM [RhTech_fake_Colaboradores] \nWHERE [Centro_de_Custo] IS NOT NULL \nORDER BY [Centro_de_Custo];"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[688,-1744],"id":"6923dd9f-5c21-446a-9715-7d37d64846ca","name":"Buscar Centros de Custo","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT [Cargo] \nFROM [RhTech_fake_Colaboradores] \nWHERE [Cargo] IS NOT NULL \nORDER BY [Cargo];"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[688,-1520],"id":"71455db8-1e59-4c65-a512-e686f1eec5fd","name":"Buscar Cargos","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"assignments":{"assignments":[{"id":"4545f892-fbda-4554-bcdf-29a5962450b1","name":"pergunta","value":"Quanto gastamos de horas extras esse mes?","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-96,-1936],"id":"7a7b0731-49ff-45f8-a8c5-c9f70dca9962","name":"Definir Pergunta Manual"},{"parameters":{"operation":"executeQuery","query":"-- Buscar TODAS as tabelas dispon√≠veis (para ver o que existe)\nSELECT \n    TABLE_SCHEMA,\n    TABLE_NAME,\n    TABLE_TYPE\nFROM INFORMATION_SCHEMA.TABLES \nORDER BY TABLE_SCHEMA, TABLE_NAME;"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3664,-1728],"id":"8f910e9c-a721-486a-8e73-4fe69cb6ab01","name":"Ver todas as tabelas no banco atual","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[3120,-480],"id":"7322ac87-3056-45a5-a06d-0ccf3e6abf18","name":"Calculator"},{"parameters":{"jsCode":"// Processar os resultados otimizados\nconst rawData = $('Buscar Parametros Otimizados').first().json;\n\nconst parametros_folha = {\n  rubricas: JSON.parse(rawData.tipos_custo || '[]').map(tipo => ({ \n    Tipo_Custo: tipo.Tipo_Custo \n  })),\n  empresas: JSON.parse(rawData.empresas || '[]').map(emp => ({\n    Nome_da_Empresa: emp.Nome_da_Empresa\n  })),\n  areas: JSON.parse(rawData.areas || '[]').map(area => ({\n    √Årea: area.√Årea\n  })),\n  departamentos: JSON.parse(rawData.departamentos || '[]').map(depto => ({\n    departamentos: depto.Departamento\n  })),\n  centro_de_custo: JSON.parse(rawData.centros_custo || '[]').map(cc => ({\n    Centro_de_Custo: cc.Centro_de_Custo\n  })),\n  cargos: JSON.parse(rawData.cargos || '[]').map(cargo => ({\n    cargos: cargo.Cargo\n  }))\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[336,-1360],"id":"20be992b-fcd8-49fc-989e-6c662cd5e911","name":"Consolidar Par√¢metros e Pergunta1"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  (SELECT DISTINCT [Tipo_Custo] FROM vw_Rubricas_Classificadas WHERE [Tipo_Custo] IS NOT NULL FOR JSON PATH) as tipos_custo,\n  (SELECT DISTINCT [Nome_da_Empresa] FROM [RhTech_fake_Colaboradores] WHERE [Nome_da_Empresa] IS NOT NULL FOR JSON PATH) as empresas,\n  (SELECT DISTINCT [√Årea] FROM [RhTech_fake_Colaboradores] WHERE [√Årea] IS NOT NULL FOR JSON PATH) as areas,\n  (SELECT DISTINCT [Departamento] FROM [RhTech_fake_Colaboradores] WHERE [Departamento] IS NOT NULL FOR JSON PATH) as departamentos,\n  (SELECT DISTINCT [Centro_de_Custo] FROM [RhTech_fake_Colaboradores] WHERE [Centro_de_Custo] IS NOT NULL FOR JSON PATH) as centros_custo,\n  (SELECT DISTINCT [Cargo] FROM [RhTech_fake_Colaboradores] WHERE [Cargo] IS NOT NULL FOR JSON PATH) as cargos;"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[128,-1376],"id":"4b18173c-c124-438a-8c79-e79e1358871f","name":"Buscar Parametros Otimizados","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT \n    column_name,\n    data_type,\n    character_maximum_length,\n    is_nullable,\n    column_default\nFROM information_schema.columns\nWHERE table_name = 'RhTech_fake_Colaboradores'\nORDER BY ordinal_position;\n"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3872,-1728],"id":"0fb85ebd-342b-4ee0-8251-3274b46f735a","name":"Estrutura da tabela","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT TOP 10 *\nFROM vw_Rubricas_Classificadas\nWHERE [Tipo_Custo] = 'Horas Extras e Adicionais';\n"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[1168,-2560],"id":"fc0ee28f-2eae-48c7-ade3-1fc59123795e","name":"Buscar Rubricas Classificadas1","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"jsCode":"// === 1Ô∏è‚É£ Agrupa todos os resultados vindos do Executar Query ===\nconst resultados = items.map(item => item.json);\n\n// === 2Ô∏è‚É£ Extrai a pergunta e filtros do n√≥ \"Interpretar pergunta\" ===\nlet data = {};\ntry {\n  data = JSON.parse($('Interpretar pergunta').item.json.output || '{}');\n} catch (e) {\n  console.log('‚ùå Erro ao parsear Interpretar pergunta:', e);\n  data = {};\n}\n\n// === 3Ô∏è‚É£ Retorna tudo junto ===\nreturn [{\n  json: {\n    pergunta: data.pergunta || null,\n    filtros: data,\n    resultados: resultados\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2704,-704],"id":"daa00c61-6b93-4eb3-84b5-73fc4051b69a","name":"Agrupar Resultados + Salvar pergunta"},{"parameters":{"operation":"executeQuery","query":"SELECT r.[CPF]\nFROM [vw_Rubricas_Classificadas] r\nLEFT JOIN [RhTech_fake_Colaboradores] c\n  ON REPLACE(REPLACE(REPLACE(c.[CPF], '.', ''), '-', ''), ' ', '') =\n     REPLACE(REPLACE(REPLACE(r.[CPF], '.', ''), '-', ''), ' ', '')\nWHERE c.[CPF] IS NULL\n"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3360,-1552],"id":"7cd3c137-c96c-43f0-9c28-aa7f712dbc54","name":"CPF das folhas que n√£o aparecem na tabela de colaboradores","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"jsCode":"// Junta todos os outputs (cada item tem um JSON string dentro de \"output\")\nconst all = items.flatMap(item => {\n  try {\n    let jsonString = item.json.output;\n    \n    // Tenta encontrar conte√∫do entre ```json e ```, ou usa a string inteira\n    const jsonMatch = jsonString.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n    if (jsonMatch) {\n      jsonString = jsonMatch[1].trim();\n    } else {\n      // Se n√£o encontrar blocos de c√≥digo, tenta encontrar JSON entre { e }\n      const jsonContent = jsonString.match(/\\{[\\s\\S]*\\}/);\n      if (jsonContent) {\n        jsonString = jsonContent[0].trim();\n      }\n    }\n    \n    return JSON.parse(jsonString);\n  } catch (e) {\n    console.log('Erro ao fazer parse do JSON:', e);\n    return [];\n  }\n});\n\n// Se o resultado for um array com apenas 1 objeto, retorna s√≥ ele\nconst final = Array.isArray(all) && all.length === 1 ? all[0] : all;\n\n// Retorna no formato que o n8n espera\nreturn [\n  {\n    json: final\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3344,-704],"id":"87d97f93-c308-4469-9364-87a72c4ffbd0","name":"Estrutura√ß√£o do JSON de sa√≠da","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"LehnDUuuGefsfACB","mode":"list","cachedResultName":"BMS - 6.3 - Plot Gr√°ficos (Folha)"},"workflowInputs":{"mappingMode":"defineBelow","value":{"pergunta":"={{ $('Agrupar Resultados + Salvar pergunta').item.json.pergunta }}","dados":"={{ JSON.stringify($('Agrupar Resultados + Salvar pergunta').item.json.resultados, null, 2) }}","filtros":"={{ JSON.stringify($('Agrupar Resultados + Salvar pergunta').item.json.filtros, null, 2) }}"},"matchingColumns":[],"schema":[{"id":"pergunta","displayName":"pergunta","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"dados","displayName":"dados","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"filtros","displayName":"filtros","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3808,-720],"id":"fc055e28-68eb-48aa-98ba-a6feb5ddf6ce","name":"Executa o workflow que gera o gr√°fico","onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e26017ea-d38f-4d43-b9d3-30763fe6a270","leftValue":"={{ $json.precisaImagem }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3568,-704],"id":"9c9f12cf-8e60-4f21-b44d-fb92f6b027b4","name":"Verifica se gera ou n√£o o gr√°fico"},{"parameters":{"assignments":{"assignments":[{"id":"66c16819-2ec8-4fcf-8441-d7ac8a370fbe","name":"resposta","value":"={{ $('Verifica se gera ou n√£o o gr√°fico').item.json.resposta }}","type":"string"},{"id":"f14a7e86-5803-469e-949c-0232ae6424b0","name":"base64","value":"={{ $json.base64Image }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4032,-736],"id":"7aadcdf0-7c8b-4669-908c-a5d10a4c8cdf","name":"Monta output final com base64"},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"resposta\": \"{{ $('Estrutura√ß√£o do JSON de sa√≠da').item.json.resposta }}\"\n}\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3808,-496],"id":"efe35abd-321e-4dec-8bcc-f5c83478c5d3","name":"Monta output final sem o base64"},{"parameters":{"content":"## Torna o AI Agente mais eficiente e faz com que o fluxo n√£o seja t√£o demorado como se fosse uma tool","height":480,"width":1008},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3280,-816],"id":"fdeddbe5-5cb4-48b6-8106-f257392bcb77","name":"Sticky Note"},{"parameters":{"operation":"executeQuery","query":"SELECT *\nfrom vw_Rubricas_Classificadas\n    where [Descri√ß√£o_Rubrica] LIKE '%13%SALARIO%' OR\n             [Descri√ß√£o_Rubrica] LIKE '%13¬∫%';"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3200,-1552],"id":"b87b1cf1-c330-4483-8baa-f1a299ee023c","name":"13¬∞","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT tipo_custo\nfrom vw_Rubricas_Classificadas;"},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3872,-1392],"id":"587081f4-bb19-4c3f-b51b-d49434058070","name":"tipo_custo","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{"operation":"executeQuery","query":"\n    SELECT DISTINCT\n      c.[Nome],\n      c.[Matr√≠cula]\n    FROM [RhTech_fake_Colaboradores] c\n    WHERE 1=1\n      AND (c.[Nome] LIKE '%Ana%' COLLATE Latin1_General_CI_AI AND c.[Nome] LIKE '%Julia%' COLLATE Latin1_General_CI_AI AND c.[Nome] LIKE '%Rosa%' COLLATE Latin1_General_CI_AI\n           OR SOUNDEX(c.[Nome]) = SOUNDEX('Ana Julia da Rosa')\n           OR DIFFERENCE(c.[Nome], 'Ana Julia da Rosa') >= 3\n      )\n       AND c.[Nome_da_Empresa] = 'TechRH Ltda'\n      \n      \n      \n      \n    ORDER BY c.[Nome];\n  "},"type":"n8n-nodes-base.microsoftSql","typeVersion":1.1,"position":[3024,-1552],"id":"3a6b4541-eac2-48b5-bb6a-495c8d4fb83d","name":"13¬∞1","credentials":{"microsoftSql":{"id":"WFNrTNj4QqdUC7Gb","name":"Azure - BMS"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2032,-496],"id":"13f57773-30d7-43cc-a43f-6a5f6fea0873","name":"Calculator1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('trigger').first().json.chat_id }}_mem_agent","sessionTTL":100000,"contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.5,"position":[3056,-368],"id":"4f822b07-c73d-4353-9853-3352c4b34d22","name":"Mem√≥ria do Agente","credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('trigger').first().json.chat_id }}_mem_agent","sessionTTL":100000,"contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.5,"position":[1968,-336],"id":"4d41cffe-fd68-4975-a6ea-7f28ba53ea97","name":"Mem√≥ria do Agente1","credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}},"disabled":true}],"connections":{"trigger":{"main":[[{"node":"Code","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Interpretar pergunta","type":"ai_languageModel","index":0}]]},"Interpretar pergunta":{"main":[[{"node":"Criar Query","type":"main","index":0}]]},"Executar Query":{"main":[[{"node":"Agrupar Resultados + Salvar pergunta","type":"main","index":0}]]},"Criar Query":{"main":[[{"node":"Executar Query","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"Analisar e Gerar Resposta","type":"ai_languageModel","index":0}]]},"Executar Query1":{"main":[[]]},"Code":{"main":[[{"node":"Interpretar pergunta","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Consolidar Par√¢metros e Pergunta","type":"main","index":0}]]},"Buscar Rubricas Classificadas":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Buscar Empresas":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Buscar √Åreas":{"main":[[{"node":"Merge1","type":"main","index":2}]]},"Buscar Departamentos":{"main":[[{"node":"Merge1","type":"main","index":3}]]},"Buscar Centros de Custo":{"main":[[{"node":"Merge1","type":"main","index":4}]]},"Buscar Cargos":{"main":[[{"node":"Merge1","type":"main","index":5}]]},"Definir Pergunta Manual":{"main":[[{"node":"Buscar Rubricas Classificadas","type":"main","index":0},{"node":"Buscar Empresas","type":"main","index":0},{"node":"Buscar √Åreas","type":"main","index":0},{"node":"Buscar Departamentos","type":"main","index":0},{"node":"Buscar Centros de Custo","type":"main","index":0},{"node":"Buscar Cargos","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Analisar e Gerar Resposta","type":"ai_tool","index":0}]]},"Buscar Parametros Otimizados":{"main":[[{"node":"Consolidar Par√¢metros e Pergunta1","type":"main","index":0}]]},"Agrupar Resultados + Salvar pergunta":{"main":[[{"node":"Analisar e Gerar Resposta","type":"main","index":0}]]},"Analisar e Gerar Resposta":{"main":[[{"node":"Estrutura√ß√£o do JSON de sa√≠da","type":"main","index":0}]]},"Estrutura√ß√£o do JSON de sa√≠da":{"main":[[{"node":"Verifica se gera ou n√£o o gr√°fico","type":"main","index":0}]]},"Executa o workflow que gera o gr√°fico":{"main":[[{"node":"Monta output final com base64","type":"main","index":0}],[{"node":"Monta output final sem o base64","type":"main","index":0}]]},"Verifica se gera ou n√£o o gr√°fico":{"main":[[{"node":"Executa o workflow que gera o gr√°fico","type":"main","index":0}],[{"node":"Monta output final sem o base64","type":"main","index":0}]]},"Calculator1":{"ai_tool":[[{"node":"Interpretar pergunta","type":"ai_tool","index":0}]]},"Mem√≥ria do Agente":{"ai_memory":[[{"node":"Analisar e Gerar Resposta","type":"ai_memory","index":0}]]},"Mem√≥ria do Agente1":{"ai_memory":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"GbORhS24Rzw7hHlt"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"trigger":[{"json":{"chat_id":"+5534992150692","pergunta":"Consultar compara√ß√£o dos gastos totais com todos os tipos de custo para os colaboradores de matr√≠cula 2139 e 7943 nos √∫ltimos 3 meses na empresa TechRH Ltda.","empresa":"TechRH Ltda","areas":"Comercial; Financeiro; Marketing; Opera√ß√µes; RH; TI","departamentos":"Comercial; Financeiro; Marketing; Opera√ß√µes; RH; TI","centro_de_custo":"104 ‚Äì RH; 115 ‚Äì Comercial; 115 ‚Äì Financeiro; 115 ‚Äì TI; 116 ‚Äì TI; 119 ‚Äì Comercial; 119 ‚Äì Financeiro; 119 ‚Äì Opera√ß√µes; 121 ‚Äì Financeiro; 122 ‚Äì Opera√ß√µes; 122 ‚Äì TI; 126 ‚Äì Marketing; 127 ‚Äì TI; 137 ‚Äì Comercial; 142 ‚Äì RH; 149 ‚Äì Marketing; 151 ‚Äì Opera√ß√µes; 157 ‚Äì Financeiro; 158 ‚Äì Opera√ß√µes; 159 ‚Äì Financeiro; 160 ‚Äì Marketing; 164 ‚Äì Financeiro; 165 ‚Äì Marketing; 165 ‚Äì TI; 167 ‚Äì Marketing; 168 ‚Äì Opera√ß√µes; 169 ‚Äì Marketing; 171 ‚Äì Comercial; 171 ‚Äì Financeiro; 177 ‚Äì Comercial; 182 ‚Äì TI; 219 ‚Äì Comercial; 241 ‚Äì Opera√ß√µes; 246 ‚Äì Opera√ß√µes; 256 ‚Äì TI; 274 ‚Äì Financeiro; 278 ‚Äì Opera√ß√µes; 280 ‚Äì Marketing; 284 ‚Äì Comercial; 284 ‚Äì RH; 285 ‚Äì TI; 287 ‚Äì Financeiro; 297 ‚Äì Opera√ß√µes; 304 ‚Äì Opera√ß√µes; 308 ‚Äì RH; 314 ‚Äì Financeiro; 314 ‚Äì TI; 316 ‚Äì Financeiro; 316 ‚Äì RH; 317 ‚Äì Comercial; 320 ‚Äì RH; 328 ‚Äì Financeiro; 329 ‚Äì Marketing; 348 ‚Äì Financeiro; 353 ‚Äì Financeiro; 355 ‚Äì RH; 356 ‚Äì Opera√ß√µes; 357 ‚Äì RH; 359 ‚Äì Comercial; 361 ‚Äì RH; 362 ‚Äì Financeiro; 369 ‚Äì Comercial; 369 ‚Äì Marketing; 375 ‚Äì RH; 387 ‚Äì Opera√ß√µes; 392 ‚Äì Marketing; 395 ‚Äì Comercial; 437 ‚Äì Opera√ß√µes; 439 ‚Äì Comercial; 441 ‚Äì TI; 445 ‚Äì TI; 446 ‚Äì Marketing; 446 ‚Äì Opera√ß√µes; 447 ‚Äì Comercial; 449 ‚Äì RH; 452 ‚Äì Marketing; 455 ‚Äì Financeiro; 460 ‚Äì Comercial; 469 ‚Äì Financeiro; 469 ‚Äì Marketing; 471 ‚Äì Opera√ß√µes; 474 ‚Äì Comercial; 479 ‚Äì Comercial; 488 ‚Äì Comercial; 489 ‚Äì TI; 490 ‚Äì Marketing; 508 ‚Äì Opera√ß√µes; 515 ‚Äì Opera√ß√µes; 517 ‚Äì TI; 518 ‚Äì Comercial; 518 ‚Äì Financeiro; 524 ‚Äì Marketing; 529 ‚Äì Financeiro; 529 ‚Äì TI; 533 ‚Äì Marketing; 533 ‚Äì TI; 536 ‚Äì Marketing; 537 ‚Äì Financeiro; 544 ‚Äì Marketing; 546 ‚Äì Marketing; 563 ‚Äì Marketing; 567 ‚Äì Financeiro; 568 ‚Äì TI; 572 ‚Äì Marketing; 574 ‚Äì RH; 576 ‚Äì TI; 584 ‚Äì Marketing; 590 ‚Äì RH; 592 ‚Äì Financeiro; 598 ‚Äì Opera√ß√µes; 606 ‚Äì TI; 608 ‚Äì Marketing; 625 ‚Äì Marketing; 632 ‚Äì RH; 635 ‚Äì Financeiro; 637 ‚Äì Opera√ß√µes; 638 ‚Äì RH; 642 ‚Äì Marketing; 648 ‚Äì Comercial; 653 ‚Äì Financeiro; 667 ‚Äì TI; 668 ‚Äì Comercial; 668 ‚Äì Marketing; 668 ‚Äì RH; 671 ‚Äì TI; 675 ‚Äì Financeiro; 675 ‚Äì Marketing; 678 ‚Äì Comercial; 683 ‚Äì TI; 684 ‚Äì Financeiro; 687 ‚Äì RH; 688 ‚Äì Financeiro; 691 ‚Äì Marketing; 696 ‚Äì RH; 700 ‚Äì Opera√ß√µes; 701 ‚Äì TI; 704 ‚Äì Financeiro; 704 ‚Äì Marketing; 715 ‚Äì Opera√ß√µes; 719 ‚Äì Opera√ß√µes; 727 ‚Äì Opera√ß√µes; 734 ‚Äì Marketing; 739 ‚Äì TI; 744 ‚Äì Comercial; 747 ‚Äì RH; 748 ‚Äì Financeiro; 764 ‚Äì Opera√ß√µes; 771 ‚Äì Comercial; 772 ‚Äì Financeiro; 776 ‚Äì Marketing; 785 ‚Äì Comercial; 794 ‚Äì Opera√ß√µes; 796 ‚Äì Financeiro; 800 ‚Äì Opera√ß√µes; 801 ‚Äì Comercial; 810 ‚Äì Marketing; 811 ‚Äì RH; 814 ‚Äì Marketing; 818 ‚Äì Marketing; 823 ‚Äì Opera√ß√µes; 824 ‚Äì RH; 826 ‚Äì RH; 828 ‚Äì TI; 832 ‚Äì Financeiro; 833 ‚Äì TI; 839 ‚Äì Comercial; 839 ‚Äì Marketing; 844 ‚Äì Financeiro; 856 ‚Äì Opera√ß√µes; 857 ‚Äì Marketing; 864 ‚Äì Financeiro; 865 ‚Äì Comercial; 866 ‚Äì Opera√ß√µes; 874 ‚Äì Opera√ß√µes; 881 ‚Äì Marketing; 884 ‚Äì Marketing; 887 ‚Äì TI; 889 ‚Äì Comercial; 889 ‚Äì TI; 890 ‚Äì RH; 891 ‚Äì TI; 895 ‚Äì Opera√ß√µes; 900 ‚Äì Comercial; 903 ‚Äì Opera√ß√µes; 903 ‚Äì RH; 909 ‚Äì Marketing; 910 ‚Äì Opera√ß√µes; 914 ‚Äì Opera√ß√µes; 915 ‚Äì Comercial; 916 ‚Äì TI; 920 ‚Äì Financeiro; 921 ‚Äì Comercial; 921 ‚Äì RH; 927 ‚Äì Comercial; 932 ‚Äì RH; 936 ‚Äì Comercial; 942 ‚Äì Financeiro; 943 ‚Äì TI; 946 ‚Äì RH; 952 ‚Äì TI; 953 ‚Äì Comercial; 954 ‚Äì RH; 955 ‚Äì Financeiro; 957 ‚Äì Marketing; 967 ‚Äì Opera√ß√µes; 978 ‚Äì Financeiro; 979 ‚Äì Marketing; 992 ‚Äì Marketing; 992 ‚Äì TI; 996 ‚Äì Opera√ß√µes; 998 ‚Äì TI; 999 ‚Äì Opera√ß√µes","cargos":"Analista; Assistente; Coordenador; Gerente; Supervisor"}}]},"versionId":"50966e3d-a248-436f-bfc7-fadb5c952fb3","triggerCount":0,"tags":[]}