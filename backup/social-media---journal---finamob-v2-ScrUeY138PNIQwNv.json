{"createdAt":"2025-08-04T02:25:50.071Z","updatedAt":"2025-08-04T02:26:37.701Z","id":"ScrUeY138PNIQwNv","name":"Social Media - Journal - Finamob v2","active":false,"isArchived":true,"nodes":[{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $json.instagram_business_account_id }}","edge":"media","options":{"queryParameters":{"parameter":[{"name":"image_url","value":"={{ $json.image_url }}"},{"name":"caption","value":"={{ $json.instagram_post_caption }}"}]}}},"id":"b4e71afb-4a46-4316-8377-40481bf8615f","name":"Instagram prepare media","type":"n8n-nodes-base.facebookGraphApi","position":[1216,1856],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"k3HCbWva6dIScPmJ","name":"Facebook Graph - EMI"}}},{"parameters":{"httpRequestMethod":"POST","graphApiVersion":"v20.0","node":"={{ $('Instagram params').item.json.instagram_business_account_id }}","edge":"media_publish","options":{"queryParameters":{"parameter":[{"name":"creation_id","value":"={{ $json.id }}"}]}}},"id":"7766821e-8fce-4119-b2ac-e29659e17f52","name":"Instagram publish media","type":"n8n-nodes-base.facebookGraphApi","position":[1744,1776],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"k3HCbWva6dIScPmJ","name":"Facebook Graph - EMI"}}},{"parameters":{"content":"Add your credential","height":430,"width":1794},"id":"6f0f9644-f128-4b86-8749-9193ed14e4b1","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[1168,1712],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"68b89233-2740-4afd-a95c-72ed537d12e5","name":"noticia_id","value":"={{ $json.noticia_id }}","type":"string"},{"id":"225df266-bf29-4415-b04c-2750cef4506a","name":"image_url","type":"string","value":"={{ $json.imagem_url }}"},{"id":"1e380c14-e908-4eeb-90e0-957a422829d0","name":"instagram_business_account_id","type":"string","value":"17841471827515368"},{"id":"f35e3093-1bff-4cc6-a6c4-909dca314cc7","name":"instagram_post_caption","type":"string","value":"={{ $json.legenda }}"}]},"options":{}},"id":"520ac56c-14eb-42b1-a0a8-32ec0d9ea1d3","name":"Instagram params","type":"n8n-nodes-base.set","position":[1008,1856],"typeVersion":3.4},{"parameters":{"graphApiVersion":"v20.0","node":"=me","options":{"fields":{"field":[{"name":"name"},{"name":"connected_instagram_account"}]}}},"id":"7aaf6775-5fac-4fc0-9321-63dff9837efd","name":"Node just for retrive id of instagram page","type":"n8n-nodes-base.facebookGraphApi","position":[976,1504],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"k3HCbWva6dIScPmJ","name":"Facebook Graph - EMI"}},"disabled":true},{"parameters":{"content":"You can use this node if you want to retrieve the instagram id. \n\nAdd it to the workflow ore use manually","height":289,"width":318},"id":"6fc0d9fb-1e30-405f-873d-43fb6d7cd000","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[864,1392],"typeVersion":1},{"parameters":{"content":"Here we have all parameters for posting in instagram image url, caption and instagram business profile id","height":310,"width":188,"color":3},"id":"8898ea97-7d3f-4370-9715-cd2f72b112cf","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[960,1712],"typeVersion":1},{"parameters":{"content":"## Permissions\nPublishing relies on a combination of the following permissions. The exact combination depends on which endpoints your app uses. Refer to our endpoint references to determine which permissions each endpoint requires.\n\nads_management\nbusiness_management\ninstagram_basic\ninstagram_content_publish\npages_read_engagement\nIf your app will be used by app users who do not have a role on your app or a role in a Business that has claimed your app, you must request approval for each permission via App Review before non-role app users can grant them to your app.\n\n## Limitations\nJPEG is the only image format supported. Extended JPEG formats such as MPO and JPS are not supported.\nShopping tags are not supported.\nBranded content tags are not supported.\nFilters are not supported.\nPublishing to Instagram TV is not supported.\nFor additional limitations, refer to each endpoint's reference.\n\n## Rate Limit\nInstagram accounts are limited to 50 API-published posts within a rolling 24-hour period. Carousels count as a single post. This limit is enforced on the POST /{ig-user-id}/media_publish endpoint when attempting to publish a media container. We recommend that your app also enforce the publishing rate limit, especially if your app allows app users to schedule posts to be published in the future.\n\nTo check an Instagram Professional account's current rate limit usage, query the GET /{ig-user-id}/content_publishing_limit endpoint.","height":792,"width":439.10253951549294,"color":7},"id":"0fc8f0ea-7f16-4d1c-aad6-03492d68dad2","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[704,2032],"typeVersion":1},{"parameters":{"graphApiVersion":"v20.0","node":"={{ $json.id }}","options":{"fields":{"field":[{"name":"id"},{"name":"status"},{"name":"status_code"}]}}},"id":"e815cbca-06c0-424e-8018-39686475a572","name":"Instagram check status of media uploaded before","type":"n8n-nodes-base.facebookGraphApi","position":[1392,1856],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"k3HCbWva6dIScPmJ","name":"Facebook Graph - EMI"}}},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"FINISHED"}]},"options":{}},"id":"3c262855-7379-48dc-8c20-00f15c0265e0","name":"If media status is finished","type":"n8n-nodes-base.if","position":[1552,1856],"typeVersion":2.2},{"parameters":{"graphApiVersion":"v20.0","node":"={{ $('Instagram check status of media uploaded before').item.json.id }}","options":{"fields":{"field":[{"name":"id"},{"name":"status"},{"name":"status_code"}]}}},"id":"6b1a0f06-8675-496d-8499-045db98b5ebe","name":"Instagram check status of media published before","type":"n8n-nodes-base.facebookGraphApi","position":[1952,1776],"typeVersion":1,"credentials":{"facebookGraphApi":{"id":"k3HCbWva6dIScPmJ","name":"Facebook Graph - EMI"}}},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.status_code }}","rightValue":"PUBLISHED"}]},"options":{}},"id":"49a33183-88be-43c4-a58c-b8a9541a47fe","name":"If media status is finished1","type":"n8n-nodes-base.if","position":[2144,1776],"typeVersion":2.2},{"parameters":{"content":"You can send email for unsuccessful upload or what you want, you can trigger another workflow or another node","height":102.11100456713636,"color":3},"id":"35591c20-cbc7-4c43-a0df-b8117ab39d96","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[1696,2160],"typeVersion":1},{"parameters":{"url":"https://feeds.folha.uol.com.br/mercado/rss091.xml","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,448],"id":"c9157218-7b9b-4e17-b457-3bdbc20745ad","name":"RSS Folha"},{"parameters":{"url":"https://br.investing.com/rss/news_301.rss","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,256],"id":"61fd845c-3244-4832-bee5-2fd811c35454","name":"RSS Investing"},{"parameters":{"url":"https://metroquadrado.com/feed","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,608],"id":"f1c24be9-af4c-4578-bc1f-c399ce474f25","name":"RSS Metro Quadrado"},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-8064,784],"id":"8dbd2a16-d11b-457a-a8d9-8bb888c379ea","name":"Schedule Trigger"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-7808,784],"id":"e2209780-cb9a-4eae-99b1-715d1801ddd5","name":"No Operation, do nothing"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-3968,1136],"id":"fe6bb1cb-8790-405c-85f3-8d8cfbd2c40c","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const binaryData = $input.item.binary?.[\"imagem_final\"];\n\nif (!binaryData || !binaryData.data) {\n  throw new Error(\"Campo 'imagem_final' não encontrado no binário.\");\n}\n\nconst base64 = Buffer.from(binaryData.data, 'base64').toString(\"base64\");\n\nreturn {\n  json: {\n    base64Image: base64\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2144,816],"id":"37bfa54e-e156-46e8-bfed-2118d8aab17d","name":"Binary > base64"},{"parameters":{"operation":"createFromText","content":"={{ $json.base64Image }}","name":"={{$json[\"arquivo_base64\"]}}","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1-TqSloGeJhKGhoDNe9bI6jhDmRcH0KAM","mode":"list","cachedResultName":"base64","cachedResultUrl":"https://drive.google.com/drive/folders/1-TqSloGeJhKGhoDNe9bI6jhDmRcH0KAM"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1280,896],"id":"d1a4ca29-fa10-4b71-b0f6-5694fd1448c3","name":"Create file from text","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"event":"rowUpdate","options":{"columnsToWatch":["status"]}},"type":"n8n-nodes-base.googleSheetsTrigger","typeVersion":1,"position":[480,1872],"id":"6a62bf5d-be54-463a-a029-b11baf6d1c12","name":"Google Sheets Trigger","credentials":{"googleSheetsTriggerOAuth2Api":{"id":"PvlXorOaq6vxhcle","name":"Google Sheets Trigger account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"54fa4546-8262-4651-9b0e-ce3a2f66416f","leftValue":"={{ $json.status }}","rightValue":"aprovado","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[688,1872],"id":"b57b0cde-f4af-40c9-994b-a38395ffc54d","name":"If8"},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post Finamob falhou!","message":"Post Finamob falhou!","options":{},"path":"c569a2de-7c44-4178-a694-938c585da91d"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1744,1984],"id":"27da2603-a47e-4bbb-af88-0703f3b0ddcd","name":"Send a message","webhookId":"c569a2de-7c44-4178-a694-938c585da91d","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post Finamob deu certo!","message":"Post Finamob deu certo!","options":{},"path":"0000daec-327f-4526-96d5-31bdf9614717"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2368,1744],"id":"de2affb4-da1f-4a1f-bf77-9cdd7330062f","name":"Send a message1","webhookId":"0000daec-327f-4526-96d5-31bdf9614717","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"sendTo":"lucas@getmia.com.br","subject":"Post Finamob falhou 2!","message":"Post Finamob falhou 2!","options":{},"path":"b4cd33b9-a2f9-4827-8a09-704ef433575d"},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[2368,1920],"id":"71feafad-8224-46e4-a954-6939c27f5bbf","name":"Send a message2","webhookId":"b4cd33b9-a2f9-4827-8a09-704ef433575d","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"content":"# Portais de notícias\n\n### Portais de notícias que o fluxo irá consultar para gerar os posts","height":1888,"width":1184},"type":"n8n-nodes-base.stickyNote","position":[-7888,96],"typeVersion":1,"id":"49b9aa95-44a2-44a2-83c7-15a5e0aba2f6","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,608],"id":"ad5c250e-2cdc-449a-b277-b15352ee31c3","name":"Filtro de data da notícia 3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 72 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,448],"id":"df8e8198-892b-48fd-9f84-99ff1388bedd","name":"Filtro de data da notícia 2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 120 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,256],"id":"96f1dfea-2c1c-40cd-9c5e-9b3ec1a5748c","name":"Filtro de data da notícia 1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,240],"id":"0815a609-9be1-4c23-9bdd-ca2cdf1c5c5b","name":"Filtro de tema imobiliário 1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,432],"id":"799696a0-51e7-421e-b110-cf0046938c81","name":"Filtro de tema imobiliário 2"},{"parameters":{"numberInputs":10},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-6528,832],"id":"d2de63c6-7d8a-490e-9688-2d9c5820bb8b","name":"Notícias Consolidadas"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Coloque os possíveis campos que podem trazer a imagem direto do RSS\nconst possiveisCampos = [\n  $json['media:content']?.url,\n  $json['enclosure']?.url,\n  $json['image'],\n  $json['og:image']\n];\nconst imagemDireta = possiveisCampos.find(x => !!x);\n\nreturn {\n  ...$json,\n  imagem: imagemDireta || '' // Se não tiver, deixa vazio\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6240,960],"id":"82c30e41-075a-4aa4-9b63-2bfc5ef85abb","name":"Padronização do campo imagem","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b5d79643-ef81-4cef-b02d-371990a64543","leftValue":"={{ $json.imagem }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6032,960],"id":"742532f2-c22e-48ab-bc8f-a18bdd4ad4cd","name":"Validação do campo imagem"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"return {\n  ...$json,\n  original: $json // salva todos os dados da notícia\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5776,832],"id":"9c9d50e9-689a-41cb-b14a-6a185add9412","name":"Backup dados da notícia"},{"parameters":{"url":"={{ $json.link }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5536,832],"id":"cbea54a9-916d-404b-8510-14c06cd454ae","name":"Buscar HTML da notícia","onError":"continueRegularOutput"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const html = $json.data || $json.body || '';\nconst ogImageMatch = html.match(/<meta\\s+property=[\"']og:image[\"']\\s+content=[\"']([^\"']+)[\"']/i);\nlet imagem = ogImageMatch ? ogImageMatch[1] : '';\n\nif (!imagem) {\n  const imgMatch = html.match(/<img[^>]+src=[\"']([^\"']+)[\"']/i);\n  if (imgMatch) {\n    imagem = imgMatch[1];\n  }\n}\n\n// Traz de volta todos os campos da notícia original, mais o campo 'imagem'\nreturn {\n  ...($('Backup dados da notícia').item.json.original || {}), // todos os campos originais\n  imagem                    // novo campo imagem atualizado\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5296,832],"id":"0a3a4f20-2289-46af-ac9b-e50cd2016508","name":"Extrair imagem do HTML","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"05295fc0-aca6-433a-a239-c5d8ed4fc011","leftValue":"={{ $json.imagem }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5024,832],"id":"e97ff809-3d9a-4b9a-80a1-5eae53d467de","name":"Imagem encontrada?"},{"parameters":{"resource":"image","prompt":"=Gere uma imagem moderna e realista sobre o seguinte tema imobiliário:\n[{{ $json.title }}]\n\nA imagem deve ser de alta qualidade, chamativa, ideal para um post profissional no Instagram. Não inclua textos na imagem.\n","options":{"returnImageUrls":true}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4672,704],"id":"7dcb85e9-0490-4ab7-b304-b1cbaf18a046","name":"Gerar imagem com IA","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}},"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const html = $json.data || $json.body || '';\nconst ogImageMatch = html.match(/<meta\\s+property=[\"']og:image[\"']\\s+content=[\"']([^\"']+)[\"']/i);\nlet imagem = ogImageMatch ? ogImageMatch[1] : '';\n\nif (!imagem) {\n  const imgMatch = html.match(/<img[^>]+src=[\"']([^\"']+)[\"']/i);\n  if (imgMatch) {\n    imagem = imgMatch[1];\n  }\n}\n\n// Recupera os campos originais da notícia de 'Code3'\nreturn {\n  ...($('Backup dados da notícia').item.json.original || {}),\n  imagem: $input.first().json.url // campo imagem atualizado com o link retornado pela OpenAI\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4464,704],"id":"b1f42587-e524-4afb-80bb-6d1161b7a3c9","name":"Salvar imagem gerada"},{"parameters":{"numberInputs":3},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-4176,1040],"id":"fae185a7-a249-4972-8bda-f06109b8af31","name":"Unificar imagem final"},{"parameters":{"content":"# Definição da Imagem do Post\n\n### Primeiro busca imagem na notícia, se não encontra gera uma via IA","height":592,"width":2064},"type":"n8n-nodes-base.stickyNote","position":[-6352,608],"typeVersion":1,"id":"38fbac05-3adf-4e5e-a769-a5dd9ed94407","name":"Sticky Note6"},{"parameters":{"content":"# Custos totais da Infra + Manut.\n\n### VPS - BRL 60 / mês\n### Open Router e Open AI API - USD 25 / month\n### hcti.io - HTML/CSS to Image API - USD 14 / month\n### Evolution API - BRL 40 / mês?\n### Telera - Número Whatsapp - BRL 11 / mês?\n### Conta Google - BRL 60 / mês\n### Manutenção e melhorias - BRL 500 / mês\n\n## Total ~ 900 / mês","height":528,"width":560,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-8336,1568],"typeVersion":1,"id":"2571f19a-74d3-4d7e-a7af-4df2e71314c4","name":"Sticky Note9"},{"parameters":{"promptType":"define","text":"=Você é um social media especialista e autoridade em conteúdo imobiliário no Instagram. Sua comunicação é informativa, objetiva e valorizada por profissionais do setor — como incorporadores, construtores, investidores e gestores de fundos — que acompanham suas publicações para se manter atualizados com o que realmente importa.\n\nVocê recebe uma lista de notícias (que pode conter itens repetidos de diferentes fontes).\n\nSua missão:\n\nAnalise profundamente todas as notícias.\n\nPara cada notícia, atribua uma nota de relevância de 0 a 10, representando o quanto ela é relevante para o setor imobiliário brasileiro.\n\nA nota deve refletir o interesse para empresários, incorporadores, construtores, investidores, gestores de fundos ou loteadores.\n\nConsidere impacto direto no setor, novidades, dados, tendências, decisões legais, mudanças em crédito, urbanismo, mercado de capitais, etc.\n\nElimine apenas notícias claramente duplicadas (mesmo conteúdo ou tema).\n\nMesmo que a nota seja baixa, retorne todas as notícias únicas com sua respectiva nota.\n\nPara cada notícia única:\n\nCrie um título original e curto (até 10 palavras), nunca copiando o título publicado pelos portais.\n\nCrie uma legenda clara, informativa e direta, com até 300 caracteres, resumindo os principais pontos da notícia, como se o leitor não fosse clicar no link. Foque em ensinar, informar ou contextualizar.\n\nA legenda não deve parecer um convite para acessar a matéria completa. Ela já entrega o que importa.\n\nOpcionalmente, inclua um CTA leve, convidando para comentar, refletir ou compartilhar, se fizer sentido.\n\nSempre finalize com a fonte e o link.\n\nRetorne no seguinte formato JSON:\n\n\n[\n  {\n    \"titulo\": \"Seu título original aqui\",\n    \"legenda\": \"Resumo da notícia aqui, claro e direto.\\n\\n(Fonte: link)\",\n    \"imagem\": \"{{ $json.imagem }}\",\n    \"fonte\": \"{{ $json.link }}\",\n    \"nota\": 0-10 (número inteiro)\n  }\n]\n\nGaranta que cada item do array corresponde a uma notícia realmente única, com título e legenda originais, prontos para capturar e engajar o público do Instagram imobiliário.\n\n**Lista de notícias:**\nLink: {{ $json.link }}\nTitulo: {{ $json.title }}\nConteudo: {{ $json.content }}\nConteudo2: {{ $json.contentSnippet }}\n\nRetorne diretamente como JSON válido (não como string). Sem aspas no array completo.\n\nNa legenda, utilize \"\\n\\n\" para representar quebras de linha, separando claramente os blocos de conteúdo (gancho, contexto, CTA e fonte).","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-3968,944],"id":"8a4d97b5-a888-4afe-8d49-5b7417de2934","name":"AI Agent - Estrutura dos Posts","onError":"continueRegularOutput"},{"parameters":{"jsCode":"const allNoticias = items.flatMap(item => JSON.parse(item.json.output));\n\nreturn allNoticias.map((noticia, index) => {\n  return {\n    json: {\n      ...noticia\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3600,944],"id":"24bfe525-6a5f-4590-8104-5ad13a4d0cff","name":"Estruturação do JSON de saída","onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"6cb1827b-7e9b-4c1d-9553-704a28bc6cff","name":"html","value":"=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\" />\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n\n    html, body {\n      width: 1080px;\n      height: 1350px;\n      overflow: hidden;\n      background: black;\n      font-family: Arial, sans-serif;\n    }\n\n    .container {\n      position: relative;\n      width: 1080px;\n      height: 1350px;\n      background-image: url(\"{{$json['imagem']}}\");\n      background-size: cover;\n      background-position: center center;\n      background-repeat: no-repeat;\n    }\n\n    .overlay-gradient {\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      width: 100%;\n      height: 40%;\n      background: linear-gradient(to top, rgba(0,0,0,0.85), transparent);\n      z-index: 1;\n    }\n\n    .logo {\n      position: absolute;\n      top: 40px;\n      right: 50px;\n      width: 168px; /* Aumentado 40% em relação aos 120px */\n      z-index: 2;\n    }\n\n    .text-block {\n      position: absolute;\n      bottom: 200px; /* Subiu em relação aos 40px anteriores */\n      left: 50px;\n      right: 50px;\n      max-width: calc(100% - 100px); /* 50px de cada lado */\n      z-index: 2;\n      color: white;\n    }\n\n    .text-block h4 {\n      margin: 0 0 20px 0;\n      font-size: 28px;\n      font-weight: normal;\n      color: #ccc;\n    }\n\n    .text-block h2 {\n      margin: 0;\n      font-size: 56px;\n      font-weight: bold;\n      line-height: 1.2;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"overlay-gradient\"></div>\n    <img class=\"logo\" src=\"https://escoladomercadoimobiliario.com.br/wp-content/uploads/2025/02/Group-1171276103.svg\" />\n    <div class=\"text-block\">\n      <h4>MERCADO IMOBILIÁRIO</h4>\n      <h2>{{$json[\"titulo\"]}}</h2>\n    </div>\n  </div>\n</body>\n</html>\n","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3056,928],"id":"8a01804a-d62f-4c93-965b-8b736f7e7d68","name":"Criação do HTML da Imagem"},{"parameters":{"content":"# Estruturação dos Posts\n\n### Lógica para definir estrutura dos posts. Escolhe o que é mais relevante e reescreve título, legenda e prepara JSON para etapas seguintes.","height":576,"width":1040},"type":"n8n-nodes-base.stickyNote","position":[-4240,720],"typeVersion":1,"id":"3adbd659-2404-4bca-8521-8f412d01c8b5","name":"Sticky Note10"},{"parameters":{"content":"# Edição das Imagens\n\n### Todas as transformações necessárias para ter a imagem final. \n### Publicação da imagem no Github, geração do link público da imagem e transformação para base64 (para envio no whatsapp).","height":800,"width":1456},"type":"n8n-nodes-base.stickyNote","position":[-3168,352],"typeVersion":1,"id":"9f5b7521-cadc-4a53-9084-024afc3bfa98","name":"Sticky Note11"},{"parameters":{"method":"POST","url":"https://hcti.io/v1/image","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Basic MDRlZDA4NWYtYmY0OS00MzIyLWExMzEtMzY3ZjA1YmRiOTllOmQ0MzhjODk3LTVlYzctNGMyNS1iMjM0LWY5NGYyNjc1OGRhYQ=="}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"html","value":"={{ $json.html }}"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2864,704],"id":"7c9d7e2f-672b-47fd-bd1a-2488a6d76a31","name":"HTML > Imagem","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"file","outputPropertyName":"imagem_final"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2656,704],"id":"bb5b5799-7e89-4b1a-97bb-ea76cb92a96f","name":"Baixar imagem"},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"getmia","mode":"list","cachedResultName":"getmia","cachedResultUrl":"https://github.com/getmia"},"repository":{"__rl":true,"value":"miabuilder-images","mode":"list","cachedResultName":"miabuilder-images","cachedResultUrl":"https://github.com/getmia/miabuilder-images"},"filePath":"=images/{{$now.toFormat(\"yyyyMMddHHmmssSSS\")}}.jpg","binaryData":true,"binaryPropertyName":"imagem_final","commitMessage":"Adicionando imagem via n8n","path":"5f765876-e912-47f1-9f5c-278a0fdd10d1"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[-2144,576],"id":"e102a35d-b5fd-4e9e-8548-2da3e8d98739","name":"Salvar imagem no GitHub","webhookId":"5f765876-e912-47f1-9f5c-278a0fdd10d1","credentials":{"githubApi":{"id":"Gd4bGzglU6thixeI","name":"GitHub account"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":3,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-1904,880],"id":"41aa9fb4-ebb6-445c-b817-32394ec56b62","name":"Dados + Imagem Final","onError":"continueRegularOutput"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":[],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-1088,1088],"id":"f06ba674-71ba-4e18-b579-a447a4c06eca","name":"Salvar no Sheets Controle","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"return items.map(item => {\n  const { noticia_id, titulo, legenda, fonte, imagem, arquivo_base64, imagem_url, status, nota } = item.json;\n  const id = item.json.id;\n\n  const data = new Date();\n  const data_processamento = data.toLocaleDateString('pt-BR'); // formato: dd/mm/aaaa\n\n  return {\n    json: {\n      noticia_id,\n      data_processamento,\n      titulo,\n      legenda: legenda.replace(/\\\\n/g, '\\n\\n'), // <- agora gera 1 linha em branco entre blocos\n      fonte,\n      imagem,\n      arquivo_base64,\n      imagem_url,\n      status,\n      nota\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1280,1088],"id":"5df61b79-6948-4277-a7a9-2c21dd345629","name":"Filtro dos dados consolidados"},{"parameters":{"jsCode":"const dataHoje = new Date();\nconst yyyy = dataHoje.getFullYear();\nconst mm = String(dataHoje.getMonth() + 1).padStart(2, '0');\nconst dd = String(dataHoje.getDate()).padStart(2, '0');\nconst prefixo = `noticia_${yyyy}${mm}${dd}_`;\n\nreturn items.map((item, index) => {\n  const sequencial = String(index + 1).padStart(3, '0');\n  const noticia_id = `${prefixo}${sequencial}`;\n\n  return {\n    json: {\n      ...item.json, // mantém tudo que veio antes: titulo, fonte, etc\n      noticia_id,\n      status: 'aguardando',\n      arquivo_base64: `${noticia_id}.txt`,\n      imagem_url: item.json.content.download_url  // usa o campo correto do GitHub\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1584,896],"id":"dfae1c55-8b12-4fc9-b4f6-932462e64549","name":"Criação Id + Link Github"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-576,2192],"id":"9798849e-602f-4f2d-9563-228c167503dd","name":"Loop Over Items"},{"parameters":{"resource":"messages-api","instanceName":"social-media-finamob-oficial","remoteJid":"5511992486507","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-336,2208],"id":"52761fd5-994b-4e69-8e28-4f0f6dabab69","name":"Envio do post - Whatsapp","credentials":{"evolutionApi":{"id":"4JfTThlwBUF4KuNE","name":"Evolution - social-media-finamob-oficial"}},"onError":"continueRegularOutput"},{"parameters":{"content":"# Atualização Controles e Envio do resultado por Whatsapp\n\n### Atualiza sheets e drive com informações e arquivos importantes\n### Envio do post completo por whatsapp para aprovador","height":656,"width":1024},"type":"n8n-nodes-base.stickyNote","position":[-1664,640],"typeVersion":1,"id":"1eceaf54-5185-4f73-a611-4bc43bef0c10","name":"Sticky Note12"},{"parameters":{"content":"# Ação de postar no Instagram\n\n### Aqui cadastramos os tokens necessários para a API do Meta\n### O post é realizado no mesmo momento em que a aprovação acontece","height":1696,"width":2640,"color":5},"type":"n8n-nodes-base.stickyNote","position":[384,1200],"typeVersion":1,"id":"2a6f6c8e-f13a-4bc6-981f-86525282a551","name":"Sticky Note14"},{"parameters":{"url":"https://www.papoimobiliario.com/feed","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,784],"id":"521e892a-2f62-4bb4-8e04-9bb3d4b70abd","name":"RSS Papo Imobiliário"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,784],"id":"1d29db44-f3fb-4cd3-b8ab-3c71cdac66e1","name":"Filtro de data da notícia 4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,944],"id":"5669c217-63ad-4759-9ff4-f7e4d3b93ef2","name":"Filtro de data da notícia 5"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,928],"id":"68cfbf2c-c0ff-4504-ace8-6536b3cd5519","name":"Filtro de tema imobiliário 5"},{"parameters":{"url":"https://exame.com/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,944],"id":"d0f09c10-c5b8-4e30-be9b-81297c0a1e8e","name":"RSS Exame"},{"parameters":{"url":"https://www.infomoney.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,1120],"id":"e12bf711-a781-42a9-8a21-6977c3525c45","name":"RSS infomoney"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,1120],"id":"20b10ea3-20ae-4cea-8372-056d0eaa3241","name":"Filtro de data da notícia 6"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,1104],"id":"e0b0e5eb-d463-467c-bd5a-74df9529d874","name":"Filtro de tema imobiliário 6"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 72 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,1280],"id":"461a0b24-11d1-4013-8890-373848d0390d","name":"Filtro de data da notícia 8"},{"parameters":{"url":"https://www.portalvgv.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,1280],"id":"971de575-918b-42f6-8c39-0cd8380a5721","name":"RSS Portal VGV"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0c9a2cce-1e4b-4f37-9c24-91e5375e8efe","leftValue":"={{ $json.nota }}","rightValue":5,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3392,944],"id":"3d956bb2-5f73-4113-bd02-667346da8c30","name":"Filtro Relevância"},{"parameters":{"operation":"crop","dataPropertyName":"imagem_final","width":1080,"height":1350,"options":{"format":"jpeg"}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[-2432,704],"id":"d05b6adc-d898-45f2-a85f-899e042e4bea","name":"Cortar imagem 1080x1350"},{"parameters":{"content":"# Fluxo de Aprovação dos Posts\n\n### Esse fluxo roda sempre que existe uma alteracao no sheets de controle do journal\n### O AI Agent define se aprova ou rejeita um post baseado em sua imagem e se ja foi postado alguma vez um tema similar","height":640,"width":1024,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-1872,1312],"typeVersion":1,"id":"30a0c6fb-b071-4152-aa1f-eaacc391ebe7","name":"Sticky Note13"},{"parameters":{"promptType":"define","text":"=Você é responsável por analisar uma lista de notícias com status \"aguardando\", decidindo se cada uma deve ser \"aprovada\" ou \"reprovada\".\n\nVocê tem acesso ao Tool \"Google Sheets\", que contém o histórico completo de notícias já processadas, com os campos: noticia_id, status e justificativa. Use esse Tool apenas para comparação, nunca para modificar ou gerar dados.\n\n🔍 Regras de decisão:\n1. Evite duplicidade no mesmo dia:\n\nCompare também com outras notícias do mesmo input (mesmo dia).\n\nSe o tema e o conteúdo forem muito semelhantes (mesmo assunto, mesma abordagem), reprove todas as duplicadas e aprove apenas a melhor (com imagem mais adequada).\n\nCite os noticia_ids semelhantes na justificativa.\n\n2. Defina similaridade com critério alto:\n\nSó reprove por conteúdo repetido se a notícia falar do mesmo evento específico (ex: mesma reunião do Copom, mesmo projeto de lei, mesma ação judicial etc).\n\nNão reprove por temas amplos ou vagos (ex: “sustentabilidade”, “inovação”, “juros”) — só se o conteúdo for sobre a mesma ocorrência.\n\n3. Imagem obrigatoriamente analisada:\n\nReprove imagens com qualquer um dos seguintes problemas:\n\nMuito escuras\n\nGenéricas demais\n\nLogotipos de portais ou marcas d'água\n\nBaixa qualidade ou ausência de informação visual relevante\n\n4. Ao encontrar um tema novo e relevante:\n\nAprove pelo menos uma notícia com esse tema, se a imagem for adequada.\n\nSe mais de uma notícia tratar o mesmo tema do dia, escolha a melhor para aprovação.\n\n🧾 Formato de resposta:\n\n[\n  {\n    \"noticia_id\": \"noticia_20250803_001\",\n    \"status\": \"aprovado\",\n    \"justificativa\": \"Tema novo sobre tributação entre FIIs e ETFs. Imagem informativa e com boa qualidade.\"\n  },\n  {\n    \"noticia_id\": \"noticia_20250803_004\",\n    \"status\": \"reprovado\",\n    \"justificativa\": \"Conteúdo idêntico à noticia_20250803_001 e imagem muito escura. Já aprovada anteriormente no mesmo input.\"\n  }\n]\n\n⚠️ Regras finais:\nNunca crie nem edite noticia_id.\n\nNão aprove ou reprove com base em estilo de escrita — avalie conteúdo e imagem.\n\nUse o Tool apenas como histórico, sem alterar ou depender exclusivamente dele.\n\n📨 Notícias para análise:\n\n{{ $json.noticia_id }}\n{{ $json.titulo }}\n{{ $json.legenda }}\n{{ $json.imagem_url }}\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-1392,1552],"id":"624401e5-e7d3-4ce5-8a5c-781de6ecde03","name":"AI Agent","executeOnce":false},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,1424],"id":"ebcff7d2-cb71-49db-a503-d0a834a987c1","name":"Filtro de tema imobiliário "},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,1440],"id":"c97a606b-a6e9-432b-a231-ce6e4f698e7f","name":"Filtro de data da notícia "},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,1584],"id":"10c28929-836e-4923-9d79-59ef1eb31672","name":"Filtro de tema imobiliário 3"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,1600],"id":"60c1b7ac-9f39-49b5-9eb2-05501f7adf25","name":"Filtro de data da notícia 7"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"imovel\", \"imoveis\",\n  \"imobiliario\", \"imobiliarios\",\n  \"apartamento\", \"apartamentos\",\n  \"aluguel\", \"aluguéis\",\n  \"compra\", \"compras\",\n  \"venda\", \"vendas\",\n  \"locacao\", \"locacoes\",\n  \"casa\", \"casas\",\n  \"construtora\", \"construtoras\",\n  \"incorporacao\", \"incorporacoes\",\n  \"condominio\", \"condominios\",\n  \"empreendimento\", \"empreendimentos\", \"selic\"\n].some(palavra =>\n  ($json.title || '').toLowerCase().includes(palavra) ||\n  ($json['content:encoded'] || '').toLowerCase().includes(palavra)\n)\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7008,1744],"id":"cabd6e6d-00fe-4150-a3bf-0553a60f9e80","name":"Filtro de tema imobiliário 4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7296,1760],"id":"55d0e9a1-6238-4f04-9e9f-ab0b761beb23","name":"Filtro de data da notícia 9"},{"parameters":{"url":"https://www.moneytimes.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,1440],"id":"b63ec499-6a28-4ece-b975-8a3882163727","name":"RSS Portal Money Times"},{"parameters":{"url":"https://cbic.org.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,1600],"id":"0fdaac86-6be0-4009-875b-703e8f08a895","name":"RSS CBIC (Câmara Brasileira da Indústria da Construção)"},{"parameters":{"url":"https://startupi.com.br/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,1760],"id":"62ca43ce-99c3-46bc-83b3-a13498e19f6a","name":"RSS Startupi"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheetsTrigger","typeVersion":1,"position":[-1808,1552],"id":"7d7842c4-51c1-4316-afcd-768fb1ef8121","name":"Trigger nova noticia no sheets","credentials":{"googleSheetsTriggerOAuth2Api":{"id":"PvlXorOaq6vxhcle","name":"Google Sheets Trigger account"}}},{"parameters":{"documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"aguardando"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-1616,1552],"id":"610a4da9-f2cf-425c-8696-e88897e0934f","name":"Noticias aguardando aprovação","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}},"onError":"continueRegularOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-1472,1776],"id":"de780d3f-ca11-4dad-af16-637370875ff7","name":"gpt-4.1-mini","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Histórico completo de notícias já analisadas, com os campos: noticia_id, status e justificativa. Use esta base para verificar se uma nova notícia trata de um tema já postado (status = 'postado').","documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"postado"}]},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.6,"position":[-1120,1776],"id":"0ef572a8-5595-4774-a3a6-8f105fd98fdd","name":"BD Noticias Postadas","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-1008,1552],"id":"f1de68a3-d0cf-4ae5-91ad-4202d2a29bab","name":"Atualizar status da noticia","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2784,1744],"id":"fc656ea8-917e-49fa-939b-ba07ff0d8181","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"f2c98e3a-ba6b-4df7-a0c9-96994c91a690","name":"noticia_id","value":"={{ $('Instagram params').item.json.noticia_id }}","type":"string"},{"id":"a95682ad-ea9c-4d88-a370-0ffad2b3eea5","name":"status","value":"postado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2592,1744],"id":"27cdc4fb-dbd2-425d-8b46-d0e26150df96","name":"Edit Fields"},{"parameters":{"rule":{"interval":[{"triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1808,2192],"id":"3451b653-aaef-4b54-aaeb-ce28e7cc4574","name":"Schedule Trigger1"},{"parameters":{"documentId":{"__rl":true,"value":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","mode":"list","cachedResultName":"Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"data_processamento","lookupValue":"={{ $json.data_processamento }}"},{"lookupColumn":"status","lookupValue":"postado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-1392,2192],"id":"ae0fb85b-2bdd-4f04-b142-4752c19b2e45","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"const ontem = new Date();\nontem.setDate(ontem.getDate() - 1);\n\nconst dia = String(ontem.getDate()).padStart(2, '0');\nconst mes = String(ontem.getMonth() + 1).padStart(2, '0');\nconst ano = ontem.getFullYear();\n\nreturn {\n  data_processamento: `${dia}/${mes}/${ano}`\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1600,2192],"id":"6dbe8ae8-aaf7-43a8-b60f-106ba529c3ef","name":"Code"},{"parameters":{"promptType":"define","text":"={{ $json.prompt }}","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-960,2192],"id":"c98ca75c-e944-4c40-8fa0-a82202fef8f1","name":"AI Agent1","executeOnce":true,"onError":"continueRegularOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-960,2416],"id":"77e7c33d-6ab1-4295-a212-96d8e173a44f","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"jsCode":"const items = $input.all();\nif (!items.length) {\n  return [{ json: { prompt: \"Nenhuma notícia foi processada.\" } }];\n}\n\nconst data = items[0].json.data_processamento || \"DATA_NÃO_ENCONTRADA\";\n\nlet prompt = `Você é responsável por gerar uma mensagem visual, resumida e organizada com o resumo das notícias do setor imobiliário processadas no dia anterior. A mensagem será enviada via WhatsApp para uma comunidade chamada EMI.\\n\\n`;\n\nprompt += `Aqui estão as notícias processadas no dia *${data}*, com os campos:\\n`;\nprompt += `- título: título da notícia\\n`;\nprompt += `- legenda: conteúdo detalhado da notícia\\n`;\nprompt += `- fonte: link real da notícia\\n\\n`;\n\nprompt += `Notícias:\\n`;\n\nitems.forEach((item, i) => {\n  const { titulo, legenda, fonte } = item.json;\n  prompt += `\\n---\\nNotícia ${i + 1}:\\nTítulo: ${titulo?.trim() || \"sem título\"}\\nLegenda: ${legenda?.trim() || \"sem legenda\"}\\nFonte: ${fonte?.trim() || \"sem fonte\"}\\n`;\n});\n\nprompt += `\\n---\\n\\nCom base nessas informações, gere uma mensagem no seguinte formato:\\n\\n`;\n\nprompt += `*Bom dia comunidade EMI!* 📰\\n\\n`;\nprompt += `Segue resumo de notícias do dia *${data}*:\\n\\n`;\nprompt += `Acompanhe a nossa página no Instagram:\\nhttps://www.instagram.com/escoladomercadoimobiliario\\n\\n`;\n\nitems.forEach((_, i) => {\n  prompt += `${i + 1}️⃣ (resumo curto da notícia ${i + 1} em uma frase)\\n🔗 Leia mais: (link da notícia ${i + 1})\\n\\n`;\n});\n\nprompt += `*Bom dia para todos!* 🚀\\n\\n`;\n\nprompt += `---\\n\\n`;\nprompt += `**Instruções importantes para gerar a mensagem:**\\n`;\nprompt += `- Use o campo \"legenda\" como base para sintetizar o bullet point.\\n`;\nprompt += `- Use *negrito* no resumo principal de cada item.\\n`;\nprompt += `- Use os emojis 1️⃣ 2️⃣ 3️⃣ etc. no início.\\n`;\nprompt += `- Separe visualmente os itens com quebras de linha.\\n`;\nprompt += `- A mensagem final deve ser apenas o texto formatado para WhatsApp, sem explicações extras.`;\n\n// Output\nreturn [{ json: { prompt } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1184,2192],"id":"1c219e43-7b22-4f5f-ba65-61f7f8934716","name":"Code1"},{"parameters":{"content":"# Fluxo de Envio do Resumo Diário para comunidade Whatsapp\n### Esse fluxo roda todo dia de manhã as 08am\n### Envia um resumo das notícias processadas no dia anterior","height":640,"width":1776,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-1872,1968],"typeVersion":1,"id":"6be4e301-0594-4ae8-9bcc-bdfb71cbbfe6","name":"Sticky Note15"},{"parameters":{"url":"https://venturebeat.com/feed/","options":{}},"type":"n8n-nodes-base.rssFeedRead","typeVersion":1.2,"position":[-7504,1936],"id":"e6247480-4068-439b-a6aa-368e0d2738a8","name":"RSS Venture Beat","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e201d72c-d4e6-4a9e-a07e-782cf5a39960","leftValue":"={{ new Date($json[\"pubDate\"]) }}","rightValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000) }}","operator":{"type":"dateTime","operation":"after"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7264,1952],"id":"5bc1052e-72a9-45bf-b82f-c9624f3be084","name":"Filtro de data da notícia","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1e4edfc7-f562-40cd-8253-35b4e8bac0b8","leftValue":"={{ \n[\n  \"inteligência artificial\", \"inteligencia artificial\", \"ia\", \"ai\", \"chatgpt\", \"gpt\", \"openai\", \"bard\", \"gemini\", \"claude\", \"anthropic\", \"llama\", \"meta ai\",\n  \"modelo de linguagem\", \"modelos de linguagem\", \"modelo generativo\", \"modelos generativos\", \"gpt-3\", \"gpt-4\", \"gpt-5\",\n  \"assistente virtual\", \"assistentes virtuais\", \"chatbot\", \"chatbots\",\n  \"machine learning\", \"aprendizado de máquina\", \"aprendizado de maquina\", \"aprendizagem de máquina\", \"ml\",\n  \"deep learning\", \"rede neural\", \"redes neurais\", \"neurônios artificiais\", \"neuronios artificiais\",\n  \"classificação automática\", \"reconhecimento de imagem\", \"reconhecimento facial\", \"visão computacional\", \"computer vision\",\n  \"processamento de linguagem natural\",  \"fine-tuning\", \"prompt\", \"prompting\", \"in-context learning\", \"modelo fundacional\", \"foundation model\", \"autonomia artificial\", \"sistemas autônomos\", \"sistema autonomo\",\n  \"agente de IA\", \"agente inteligente\", \"agentes autônomos\", \"autonomous agent\",\n  \"auto-gpt\", \"babyagi\", \"agentic workflows\", \"automação\", \"automatização\", \"robôs inteligentes\", \"robôs autônomos\", \"robotização\", \"robotizacao\",\"open source\",  \"text-to-image\", \"text-to-video\", \"deepfake\", \"tokenização\"\n].some(palavra => {\n  const regex = new RegExp(`\\\\b${palavra.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\b`, 'i');\n  return regex.test($json.title || '')\n  // || regex.test($json.content || '')\n  // || regex.test($json['content:encoded'] || '')\n  // || regex.test($json.contentSnippet || '')\n})\n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-7024,1936],"id":"546f9b26-a30f-4737-941e-e376f3a63ab1","name":"Filtro de tema IA"}],"connections":{"Instagram params":{"main":[[{"node":"Instagram prepare media","type":"main","index":0}]]},"Instagram prepare media":{"main":[[{"node":"Instagram check status of media uploaded before","type":"main","index":0}]]},"Instagram publish media":{"main":[[{"node":"Instagram check status of media published before","type":"main","index":0}]]},"If media status is finished":{"main":[[{"node":"Instagram publish media","type":"main","index":0}],[{"node":"Send a message","type":"main","index":0}]]},"If media status is finished1":{"main":[[{"node":"Send a message1","type":"main","index":0}],[{"node":"Send a message2","type":"main","index":0}]]},"Instagram check status of media uploaded before":{"main":[[{"node":"If media status is finished","type":"main","index":0}]]},"Instagram check status of media published before":{"main":[[{"node":"If media status is finished1","type":"main","index":0}]]},"RSS Folha":{"main":[[{"node":"Filtro de data da notícia 2","type":"main","index":0}]]},"RSS Investing":{"main":[[{"node":"Filtro de data da notícia 1","type":"main","index":0}]]},"RSS Metro Quadrado":{"main":[[{"node":"Filtro de data da notícia 3","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"No Operation, do nothing":{"main":[[{"node":"RSS Folha","type":"main","index":0},{"node":"RSS Metro Quadrado","type":"main","index":0},{"node":"RSS Investing","type":"main","index":0},{"node":"RSS Papo Imobiliário","type":"main","index":0},{"node":"RSS Exame","type":"main","index":0},{"node":"RSS Portal VGV","type":"main","index":0},{"node":"RSS infomoney","type":"main","index":0},{"node":"RSS Portal Money Times","type":"main","index":0},{"node":"RSS CBIC (Câmara Brasileira da Indústria da Construção)","type":"main","index":0},{"node":"RSS Startupi","type":"main","index":0},{"node":"RSS Venture Beat","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent - Estrutura dos Posts","type":"ai_languageModel","index":0}]]},"Binary > base64":{"main":[[{"node":"Dados + Imagem Final","type":"main","index":1}]]},"Create file from text":{"main":[[]]},"Google Sheets Trigger":{"main":[[{"node":"If8","type":"main","index":0}]]},"If8":{"main":[[{"node":"Instagram params","type":"main","index":0}]]},"Filtro de data da notícia 3":{"main":[[]]},"Filtro de data da notícia 2":{"main":[[{"node":"Filtro de tema imobiliário 2","type":"main","index":0}]]},"Filtro de data da notícia 1":{"main":[[{"node":"Filtro de tema imobiliário 1","type":"main","index":0}]]},"Filtro de tema imobiliário 1":{"main":[[]]},"Filtro de tema imobiliário 2":{"main":[[]]},"Notícias Consolidadas":{"main":[[{"node":"Padronização do campo imagem","type":"main","index":0}]]},"Padronização do campo imagem":{"main":[[{"node":"Validação do campo imagem","type":"main","index":0}]]},"Validação do campo imagem":{"main":[[{"node":"Backup dados da notícia","type":"main","index":0}],[{"node":"Unificar imagem final","type":"main","index":2}]]},"Backup dados da notícia":{"main":[[{"node":"Buscar HTML da notícia","type":"main","index":0}]]},"Buscar HTML da notícia":{"main":[[{"node":"Extrair imagem do HTML","type":"main","index":0}]]},"Extrair imagem do HTML":{"main":[[{"node":"Imagem encontrada?","type":"main","index":0}]]},"Imagem encontrada?":{"main":[[{"node":"Gerar imagem com IA","type":"main","index":0}],[{"node":"Unificar imagem final","type":"main","index":1}]]},"Gerar imagem com IA":{"main":[[{"node":"Salvar imagem gerada","type":"main","index":0}]]},"Salvar imagem gerada":{"main":[[{"node":"Unificar imagem final","type":"main","index":0}]]},"Unificar imagem final":{"main":[[{"node":"AI Agent - Estrutura dos Posts","type":"main","index":0}]]},"AI Agent - Estrutura dos Posts":{"main":[[{"node":"Estruturação do JSON de saída","type":"main","index":0}]]},"Estruturação do JSON de saída":{"main":[[{"node":"Filtro Relevância","type":"main","index":0}]]},"Criação do HTML da Imagem":{"main":[[{"node":"HTML > Imagem","type":"main","index":0},{"node":"Dados + Imagem Final","type":"main","index":2}]]},"HTML > Imagem":{"main":[[{"node":"Baixar imagem","type":"main","index":0}]]},"Baixar imagem":{"main":[[{"node":"Cortar imagem 1080x1350","type":"main","index":0}]]},"Salvar imagem no GitHub":{"main":[[{"node":"Dados + Imagem Final","type":"main","index":0}]]},"Dados + Imagem Final":{"main":[[{"node":"Criação Id + Link Github","type":"main","index":0}]]},"Salvar no Sheets Controle":{"main":[[]]},"Filtro dos dados consolidados":{"main":[[{"node":"Salvar no Sheets Controle","type":"main","index":0}]]},"Criação Id + Link Github":{"main":[[{"node":"Filtro dos dados consolidados","type":"main","index":0},{"node":"Create file from text","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Envio do post - Whatsapp","type":"main","index":0}]]},"Envio do post - Whatsapp":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"RSS Papo Imobiliário":{"main":[[{"node":"Filtro de data da notícia 4","type":"main","index":0}]]},"Filtro de data da notícia 4":{"main":[[]]},"Filtro de data da notícia 5":{"main":[[{"node":"Filtro de tema imobiliário 5","type":"main","index":0}]]},"Filtro de tema imobiliário 5":{"main":[[]]},"RSS Exame":{"main":[[{"node":"Filtro de data da notícia 5","type":"main","index":0}]]},"RSS infomoney":{"main":[[{"node":"Filtro de data da notícia 6","type":"main","index":0}]]},"Filtro de data da notícia 6":{"main":[[{"node":"Filtro de tema imobiliário 6","type":"main","index":0}]]},"Filtro de tema imobiliário 6":{"main":[[]]},"Filtro de data da notícia 8":{"main":[[]]},"RSS Portal VGV":{"main":[[{"node":"Filtro de data da notícia 8","type":"main","index":0}]]},"Filtro Relevância":{"main":[[{"node":"Criação do HTML da Imagem","type":"main","index":0}]]},"Cortar imagem 1080x1350":{"main":[[{"node":"Binary > base64","type":"main","index":0},{"node":"Salvar imagem no GitHub","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Atualizar status da noticia","type":"main","index":0}]]},"Filtro de data da notícia ":{"main":[[{"node":"Filtro de tema imobiliário ","type":"main","index":0}]]},"Filtro de data da notícia 7":{"main":[[{"node":"Filtro de tema imobiliário 3","type":"main","index":0}]]},"Filtro de data da notícia 9":{"main":[[{"node":"Filtro de tema imobiliário 4","type":"main","index":0}]]},"Filtro de tema imobiliário ":{"main":[[]]},"Filtro de tema imobiliário 3":{"main":[[]]},"Filtro de tema imobiliário 4":{"main":[[]]},"RSS Portal Money Times":{"main":[[{"node":"Filtro de data da notícia ","type":"main","index":0}]]},"RSS CBIC (Câmara Brasileira da Indústria da Construção)":{"main":[[{"node":"Filtro de data da notícia 7","type":"main","index":0}]]},"RSS Startupi":{"main":[[{"node":"Filtro de data da notícia 9","type":"main","index":0}]]},"Trigger nova noticia no sheets":{"main":[[{"node":"Noticias aguardando aprovação","type":"main","index":0}]]},"Noticias aguardando aprovação":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"gpt-4.1-mini":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"BD Noticias Postadas":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Send a message1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Code1","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Code1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Filtro de data da notícia":{"main":[[{"node":"Filtro de tema IA","type":"main","index":0}]]},"RSS Venture Beat":{"main":[[{"node":"Filtro de data da notícia","type":"main","index":0}]]},"Filtro de tema IA":{"main":[[{"node":"Notícias Consolidadas","type":"main","index":2}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"83c3cd6c-fdc3-41e7-a5e2-e51e8dd0c7a2","triggerCount":4,"tags":[]}