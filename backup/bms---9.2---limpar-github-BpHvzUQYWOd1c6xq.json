{"createdAt":"2025-11-03T17:45:09.457Z","updatedAt":"2025-11-03T18:25:54.741Z","id":"BpHvzUQYWOd1c6xq","name":"BMS - 9.2 - Limpar GitHub","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"weeks"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-176,384],"id":"f9748962-a609-4be6-8405-82d80e340b2f","name":"Schedule Trigger1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[448,384],"id":"5507863e-45fe-4071-aa3d-1c87e81df5bc","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"3b7bdbdf-14bd-4be2-a2fe-d91f59bfaf9f","name":"Owner","value":"getmia-ia","type":"string"},{"id":"7ea8ddff-c64d-4978-b2e3-ac2cd706bf13","name":"Repository","value":"BMS","type":"string"},{"id":"af7e8803-8459-481a-9b63-20025f401957","name":"path","value":"images/","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[32,384],"id":"c1c2baec-27d4-4280-abac-459b8c950583","name":"Dados para o GitHub"},{"parameters":{"authentication":"oAuth2","resource":"file","operation":"list","owner":{"__rl":true,"value":"={{ $json.Owner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $json.Repository }}","mode":"name"},"filePath":"={{$json.path}}"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[224,384],"id":"412641db-94c8-40f2-a2cb-05b1b41fdaf4","name":"Lista todos os arquivos do repositório","webhookId":"7722e325-4f66-4f54-bbb3-5e7f12552327","credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"method":"DELETE","url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/contents/{{ $('Lista todos os arquivos do repositório').item.json.path }}","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": \"Removendo arquivo antigo automaticamente\",\n  \"sha\": \"{{ $('Lista todos os arquivos do repositório').item.json.sha }}\",\n  \"committer\": {\n    \"name\": \"{{ $json.commit.committer.name }}\",\n    \"email\": \"{{ $json.commit.committer.email }}\"\n  }\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,384],"id":"d5010dfc-76b2-4eba-8582-53f05f859d57","name":"Deleta o arquivo do repositório","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32581fe4-aa4b-410a-986c-aec0ffa7ece3","leftValue":"={{ $json.commit.author.date }}","rightValue":"={{ $now.minus({ weeks: 2 }) }}","operator":{"type":"dateTime","operation":"beforeOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[864,400],"id":"981c2ba5-a876-48d8-8652-e4b0c618a441","name":"Verifica se o arquivo está a mais de uma semana no repositório"},{"parameters":{"url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/commits","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"path","value":"={{ $('Lista todos os arquivos do repositório').item.json.path }}"},{"name":"per_page","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[672,400],"id":"9a7b54ba-724f-4e43-bac9-f2efee3da41d","name":"Busca o último commit de cada arquivo","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"content":"## Fluxo que apaga arquivos que estão a mais de uma semana no repositório do GitHub\n(para as imagens das notícias)","height":640,"width":1744,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-272,256],"id":"0e6f152e-13c1-40b8-a1b0-ae05debf1501","name":"Sticky Note"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1280,384],"id":"f008bf7d-8f07-4a65-a287-26b8518c1f74","name":"Wait","webhookId":"c9b4a441-4f09-4c3f-a5b0-1f89b358573c"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1280,624],"id":"44730c36-0dee-4200-a100-b535fe9bf6d1","name":"Wait1","webhookId":"72a5cebb-4fb9-47d1-ad76-df4b8c136a78"}],"connections":{"Schedule Trigger1":{"main":[[{"node":"Dados para o GitHub","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Busca o último commit de cada arquivo","type":"main","index":0}]]},"Dados para o GitHub":{"main":[[{"node":"Lista todos os arquivos do repositório","type":"main","index":0}]]},"Lista todos os arquivos do repositório":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Deleta o arquivo do repositório":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Verifica se o arquivo está a mais de uma semana no repositório":{"main":[[{"node":"Deleta o arquivo do repositório","type":"main","index":0}],[{"node":"Wait1","type":"main","index":0}]]},"Busca o último commit de cada arquivo":{"main":[[{"node":"Verifica se o arquivo está a mais de uma semana no repositório","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"GbORhS24Rzw7hHlt"},"staticData":{"node:Schedule Trigger1":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6f5a565f-f61c-430a-950d-347a7805f525","triggerCount":1,"tags":[]}