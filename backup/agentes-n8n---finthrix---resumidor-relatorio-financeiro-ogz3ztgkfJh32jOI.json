{"createdAt":"2025-09-23T19:53:13.102Z","updatedAt":"2025-09-23T21:22:05.228Z","id":"ogz3ztgkfJh32jOI","name":"Agentes N8N - Finthrix - Resumidor Relatorio Financeiro","active":false,"isArchived":false,"nodes":[{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"Analise os dados e forneça os parâmetros separadamente.\n","role":"system"},{"content":"={{ JSON.stringify($json.query) }}"}]},"jsonOutput":true,"options":{}},"id":"9633677b-b35f-48cd-be73-b34834ee606d","name":"🕵️‍♂️ Análise dos Dados 📊","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[208,160]},{"parameters":{},"id":"700906f4-f5dd-4b1c-ba76-9f916c08282d","name":"Calculadora","type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1056,1200]},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"Seu papel é analisar transações financeiras usando os dados fornecidos. Forneça um resumo curto e preciso, porém informativo, sobre as informações recebidas para serem reportadas ao usuário.\n\nPode usar emojis pra deixar mais amigável a mensagem para ser enviada no whatsapp do usuário\n\nIMPORTANTE:\nUse a ferramenta de calculadora para calcular o valor correto.","role":"system"},{"content":"={{ $json.data }}"}]},"options":{}},"id":"fd3d6344-5418-459c-9657-1a65cd98aa83","name":"📋 Resumidor Financeiro 📊","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1088,880]},{"parameters":{"assignments":{"assignments":[{"id":"c1927732-bfef-4337-86da-3c9aac5ecaf3","name":"data","value":"={{ $json.message.content.data }}","type":"string"},{"id":"a0349354-f30c-441f-bd81-1036f3bd087b","name":"categoria","value":"={{ $json.message.content.categoria }}","type":"string"}]},"options":{}},"id":"210e1211-9618-4825-a770-3a38706981e8","name":"Seta Retorno","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[960,384]},{"parameters":{"jsCode":"// Função para converter MM/YYYY para o nome do mês em português\nfunction obterNomeDoMes(data) {\n    const meses = [\n        \"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\",\n        \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"\n    ];\n    \n    const partes = data.split(\"/\");\n    if (partes.length !== 2) {\n        throw new Error(\"Formato inválido. Use MM/YYYY.\");\n    }\n\n    const mesIndex = parseInt(partes[0], 10) - 1;\n    if (mesIndex < 0 || mesIndex > 11) {\n        throw new Error(\"Mês inválido. Use um valor entre 01 e 12.\");\n    }\n\n    return meses[mesIndex];\n}\n\n// Entrada do n8n\nconst inputData = $input.all();\nconst resultados = inputData.map(item => {\n    const data = item.json.data; // Supondo que a entrada seja { \"data\": \"02/2024\" }\n    return { json: { mes: obterNomeDoMes(data) } };\n});\n\n// Saída do n8n\nreturn resultados;\n"},"id":"0369e194-82b9-4381-8ca6-587fa7446114","name":"Formata Data","type":"n8n-nodes-base.code","typeVersion":2,"position":[1136,384]},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"id":"fccf5ea3-cbf1-431e-a972-11ba659c64bf","name":"Junta as Linhas em um único campo","type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[560,880]},{"parameters":{"assignments":{"assignments":[{"id":"bfa82842-fee4-4b47-bd94-7de53e938b2a","name":"data","value":"={{ $json.data }}","type":"string"}]},"options":{}},"id":"f229fe27-2bd3-4960-ba73-77550a80a576","name":"Seta os Dados para o Agente","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[784,880]},{"parameters":{"assignments":{"assignments":[{"id":"81416485-6e75-43e6-ab2f-6d2d9130f12c","name":"response","value":"={{ $json.message.content }}","type":"string"}]},"options":{}},"id":"8a4990b4-2e55-4b7f-9f77-efdff41a58d5","name":"Retorna o Resumo","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1520,880]},{"parameters":{"content":"## Chama IA  para analisar os dados de entrada","height":300,"width":360,"color":5},"type":"n8n-nodes-base.stickyNote","position":[544,272],"typeVersion":1,"id":"17a002d5-69a1-4514-91d3-0a408ff163b7","name":"Sticky Note13"},{"parameters":{"content":"## Trata os Dados","height":300,"width":360,"color":6},"type":"n8n-nodes-base.stickyNote","position":[912,272],"typeVersion":1,"id":"709bbbe6-d0c8-4cec-b819-589b9730041b","name":"Sticky Note"},{"parameters":{"content":"## Busca as movimentações","height":420,"width":680,"color":2},"type":"n8n-nodes-base.stickyNote","position":[1296,160],"typeVersion":1,"id":"92e4ff13-4d9b-429c-8c7a-3c9418774cda","name":"Sticky Note14"},{"parameters":{"content":"## Manipula as Informações","height":300,"width":420,"color":2},"type":"n8n-nodes-base.stickyNote","position":[544,784],"typeVersion":1,"id":"a709111a-64f9-4ea8-986f-880bc10f55bf","name":"Sticky Note15"},{"parameters":{"content":"## Chama IA  para gerar o Resumo Financeiro","height":300,"width":440,"color":5},"type":"n8n-nodes-base.stickyNote","position":[976,784],"typeVersion":1,"id":"64c79c5a-d0ab-4e59-9b47-7e71977115c5","name":"Sticky Note16"},{"parameters":{"content":"## Ferramenta","height":260,"width":280,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[960,1088],"id":"831d5f11-9ea8-48dc-b5b6-e210e5023c50","name":"Sticky Note1"},{"parameters":{"content":"","height":1140,"width":1700},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[304,80],"id":"df285930-6be4-4521-843c-f25613ad6479","name":"Sticky Note3"},{"parameters":{"content":"███████╗██╗███╗░░██╗████████╗██╗░░██╗██████╗░██╗██╗░░██╗  ░░░░░░  ██████╗░███████╗░██████╗██╗░░░██╗███╗░░░███╗██╗██████╗░░█████╗░██████╗░  ███████╗██╗███╗░░██╗░█████╗░███╗░░██╗░█████╗░███████╗██╗██████╗░░█████╗░\n██╔════╝██║████╗░██║╚══██╔══╝██║░░██║██╔══██╗██║╚██╗██╔╝  ░░░░░░  ██╔══██╗██╔════╝██╔════╝██║░░░██║████╗░████║██║██╔══██╗██╔══██╗██╔══██╗  ██╔════╝██║████╗░██║██╔══██╗████╗░██║██╔══██╗██╔════╝██║██╔══██╗██╔══██╗\n█████╗░░██║██╔██╗██║░░░██║░░░███████║██████╔╝██║░╚███╔╝░  █████╗  ██████╔╝█████╗░░╚█████╗░██║░░░██║██╔████╔██║██║██║░░██║██║░░██║██████╔╝  █████╗░░██║██╔██╗██║███████║██╔██╗██║██║░░╚═╝█████╗░░██║██████╔╝██║░░██║\n██╔══╝░░██║██║╚████║░░░██║░░░██╔══██║██╔══██╗██║░██╔██╗░  ╚════╝  ██╔══██╗██╔══╝░░░╚═══██╗██║░░░██║██║╚██╔╝██║██║██║░░██║██║░░██║██╔══██╗  ██╔══╝░░██║██║╚████║██╔══██║██║╚████║██║░░██╗██╔══╝░░██║██╔══██╗██║░░██║\n██║░░░░░██║██║░╚███║░░░██║░░░██║░░██║██║░░██║██║██╔╝╚██╗  ░░░░░░  ██║░░██║███████╗██████╔╝╚██████╔╝██║░╚═╝░██║██║██████╔╝╚█████╔╝██║░░██║  ██║░░░░░██║██║░╚███║██║░░██║██║░╚███║╚█████╔╝███████╗██║██║░░██║╚█████╔╝\n╚═╝░░░░░╚═╝╚═╝░░╚══╝░░░╚═╝░░░╚═╝░░╚═╝╚═╝░░╚═╝╚═╝╚═╝░░╚═╝  ░░░░░░  ╚═╝░░╚═╝╚══════╝╚═════╝░░╚═════╝░╚═╝░░░░░╚═╝╚═╝╚═════╝░░╚════╝░╚═╝░░╚═╝  ╚═╝░░░░░╚═╝╚═╝░░╚══╝╚═╝░░╚═╝╚═╝░░╚══╝░╚════╝░╚══════╝╚═╝╚═╝░░╚═╝░╚════╝░","width":2200},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,-48],"id":"ea9c44a7-2ac3-4388-970c-15a171586ebf","name":"Sticky Note4"},{"parameters":{},"id":"92f1c0f0-0da7-4e32-bb1c-760c1246fd75","name":"Executa Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[384,384]},{"parameters":{"content":"## Retorna Resumo para o Agente Chamador","height":300,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1440,784],"typeVersion":1,"id":"1bc0e458-7138-4620-a3b2-5eb8c901d528","name":"Sticky Note2"},{"parameters":{"documentId":{"__rl":true,"value":"1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U","mode":"list","cachedResultName":"Banco de Dados - FinThrix","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Movimentações","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Mês","lookupValue":"={{ $json.mes }}"}]},"options":{}},"id":"175d7f61-0685-4951-ad19-725e81d794f4","name":"Busca Movimentações - Só com Mês","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1712,176]},{"parameters":{"documentId":{"__rl":true,"value":"1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U","mode":"list","cachedResultName":"Banco de Dados - FinThrix","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Movimentações","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Mês","lookupValue":"={{ $json.mes }}"},{"lookupColumn":"Categoria","lookupValue":"={{$node[\"Seta Retorno\"].json[\"categoria\"]}}"}]},"options":{}},"id":"b0226d95-4a11-4c39-bd21-4439967bac5b","name":"Busca Movimentações - Mês + Categoria","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1712,384]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"25b2325e-2c99-4742-a82b-2372399b8b32","leftValue":"={{$node[\"Seta Retorno\"].json[\"categoria\"]}}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1360,384],"id":"db00f1bf-c041-430a-8558-cbb7e6435250","name":"Verificar se tem categoria"},{"parameters":{"promptType":"define","text":"={{ JSON.stringify($json.query) }}","hasOutputParser":true,"options":{"systemMessage":"Analise os dados e forneça os parâmetros separadamente."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[592,368],"id":"c07033b8-55c5-44ac-8937-30691e6de961","name":"AI Agent"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[784,592],"id":"b9e1f165-c1c2-476a-a71a-d2a923b4ca88","name":"Structured Output Parser"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[592,592],"id":"9fc344ed-6d50-4483-98fc-001994136e89","name":"OpenRouter Chat Model"}],"connections":{"🕵️‍♂️ Análise dos Dados 📊":{"main":[[]]},"Calculadora":{"ai_tool":[[{"node":"📋 Resumidor Financeiro 📊","type":"ai_tool","index":0}]]},"📋 Resumidor Financeiro 📊":{"main":[[{"node":"Retorna o Resumo","type":"main","index":0}]]},"Seta Retorno":{"main":[[{"node":"Formata Data","type":"main","index":0}]]},"Formata Data":{"main":[[{"node":"Verificar se tem categoria","type":"main","index":0}]]},"Junta as Linhas em um único campo":{"main":[[{"node":"Seta os Dados para o Agente","type":"main","index":0}]]},"Seta os Dados para o Agente":{"main":[[{"node":"📋 Resumidor Financeiro 📊","type":"main","index":0}]]},"Executa Workflow":{"main":[[]]},"Busca Movimentações - Só com Mês":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]},"Busca Movimentações - Mês + Categoria":{"main":[[{"node":"Junta as Linhas em um único campo","type":"main","index":0}]]},"Verificar se tem categoria":{"main":[[{"node":"Busca Movimentações - Só com Mês","type":"main","index":0}],[{"node":"Busca Movimentações - Mês + Categoria","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"f0fafb17-efb6-4d99-9d42-1dd2aa1c77c5","triggerCount":0,"tags":[]}