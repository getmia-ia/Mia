{"createdAt":"2025-10-10T19:34:30.576Z","updatedAt":"2025-10-31T21:07:44.450Z","id":"bYAtfJl8winx9mzD","name":"ZP - 1.2 - Journal - Aprovador (Carrossel)","active":true,"isArchived":false,"nodes":[{"parameters":{"documentId":{"__rl":true,"value":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","mode":"list","cachedResultName":"Controle Radar do Corretor","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"postado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[432,464],"id":"09f0c11c-7fb8-41e4-ba5d-52ed93329729","name":"Noticias Postadas","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}},"onError":"continueRegularOutput"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[992,288],"id":"0272721b-2cda-4b40-943f-2dac86992570","name":"Merge"},{"parameters":{"content":"# Fluxo de Aprova√ß√£o dos Posts\n\n### Esse fluxo roda sempre que existe uma alteracao no sheets de controle do journal\n### O AI Agent define se aprova ou rejeita um post baseado em sua imagem e se ja foi postado alguma vez um tema similar","height":608,"width":4064,"color":3},"type":"n8n-nodes-base.stickyNote","position":[144,32],"typeVersion":1,"id":"cd1c08ce-be3f-4aca-9182-f089c857cb61","name":"Sticky Note"},{"parameters":{"promptType":"define","text":"=Voc√™ √© respons√°vel por analisar uma not√≠cia com status \"aguardando\" e decidir se ela deve ser \"aprovada nivel 1\" ou \"reprovada\".\n\nOBJETIVO:\nAprovar apenas not√≠cias **relevantes, novas e aplic√°veis ao corretor de im√≥veis**, com foco em vendas, cr√©dito, tend√™ncias e contexto de valoriza√ß√£o imobili√°ria.\n\nüìú Hist√≥rico de not√≠cias j√° postadas (use para evitar duplicidade; compare por t√≠tulo/legenda/evento):\n{{ $('Injetar Hist√≥rico').item.json.historico }}\n\nüì∞ Not√≠cia para an√°lise:\nID: {{ $('Injetar Hist√≥rico').item.json.noticia_id }}\nT√≠tulo: {{ $('Injetar Hist√≥rico').item.json.titulo }}\nLegenda: {{ $('Injetar Hist√≥rico').item.json.legenda }}\nDescricao da Imagem: {{ $json.content }}\n\nGATES (regras eliminat√≥rias ‚Äî se falhar, REPROVE)\n\n1. Foco no corretor/imobili√°rio (obrigat√≥rio): aprove **somente se** houver rela√ß√£o direta e expl√≠cita com **o mercado imobili√°rio ou o trabalho do corretor**.  \nAbrange temas como:\n\n- Cr√©dito/financiamento (Caixa, FGTS, SBPE, juros, subs√≠dios, cons√≥rcios, Tesouro Direto com impacto no cr√©dito imobili√°rio);\n- Mercado imobili√°rio (pre√ßos, aluguel, lan√ßamentos, vendas, estoque, distratos, dados CBIC/Secovi/Abrainc/FipeZap/IBGE ligados a habita√ß√£o, FIIs, construtoras, incorporadoras, MCMV, programas habitacionais);\n- Construtoras/incorporadoras/imobili√°rias (resultados, estrat√©gias, comissionamento, produtos, lan√ßamentos);\n- Pol√≠ticas p√∫blicas/leis (habita√ß√£o, uso do solo, IPTU/ITBI, registro, regulariza√ß√£o, urbanismo/mobilidade com impacto de valoriza√ß√£o);\n- Design de interiores & arquitetura aplicados √† venda (tend√™ncias que ajudem a argumenta√ß√£o/valoriza√ß√£o do im√≥vel: ilumina√ß√£o, planta, acabamentos, home staging etc. ‚Äî sem tecnicismo);\n- T√©cnicas de vendas/atendimento/capta√ß√£o (t√©cnicas de negocia√ß√£o, p√≥s-venda, capta√ß√£o, funil, relacionamento com clientes, marketing digital, imagem profissional, scripts, obje√ß√µes);\n- Branding pessoal & marketing do corretor (posicionamento, conte√∫do, stories/reels, prova social, networking).\n\n‚Üí Reprove se:\n- Falar s√≥ de macroeconomia (‚ÄúFED‚Äù, ‚Äúinfla√ß√£o global‚Äù, ‚Äúbolsa‚Äù, ‚Äúd√≥lar‚Äù, ‚ÄúPIB mundial‚Äù) sem ponte clara com o mercado BR/imobili√°rio.\n- Falar apenas de pol√≠tica, crimes, esc√¢ndalos, esportes, celebridades (sem conex√£o com im√≥veis).\n- For gen√©rica (‚Äúeconomia est√°vel‚Äù, ‚Äújuros sobem‚Äù) sem indicar efeito no setor imobili√°rio.\n\n2. Duplicidade/Novidade (decisor):\n\nCompare t√≠tulo e legenda com o hist√≥rico (normalizando mai√∫sculas/min√∫sculas, acentos, datas, n√∫meros e entidades).\n\nReprove se:\n- Falar do mesmo evento, dado ou √≠ndice j√° postado nos √∫ltimos 7 dias.\n- Tiver mais de 50% de similaridade sem novo impacto material (ex.: ‚ÄúSelic segue est√°vel‚Äù ap√≥s not√≠cia ‚ÄúSelic em 15% aumenta interesse no Tesouro Direto‚Äù).\n- For apenas reedi√ß√£o de resultado (‚ÄúDirecional tem lucro 26% maior‚Äù / ‚ÄúLucro da Direcional sobe 26%‚Äù).\n\nConsidere duplicado tamb√©m ‚Äúdesdobramentos‚Äù sem novo impacto material (apenas reedi√ß√£o de n√∫meros/declara√ß√µes).\n\nAo reprovar por duplicidade, cite o ID da not√≠cia do hist√≥rico correspondente.\n\nRegra decisora: se for duplicado, reprove mesmo que a pontua√ß√£o da rubrica seja alta.\n\n3. N√≠vel t√©cnico/acessibilidade:\n\nReprove conte√∫dos muito t√©cnicos/academicistas (jarg√µes, f√≥rmulas/engenharia/arquitetura complexa, finan√ßas corporativas avan√ßadas) sem aplica√ß√£o pr√°tica clara para o corretor no dia a dia.\n\n4. Imagem: Leia a descricao da imagem recebida e caso nao seja uma boa imagem para fazer a postagem reprove, uma imagem toda preta n√£o √© boa, ent√£o reprove.\n\nETAPA 2 ‚Äî RUBRICA DE AVALIA√á√ÉO (s√≥ aplique se passou nos GATES)\nAtribua pontos e aprove apenas se pontua√ß√£o ‚â• 7 e nenhum gate falhou:\n\nAlinhamento com o corretor (0‚Äì3): 0=indireto; 1=men√ß√£o tangencial; 2=relacionado; 3=impacto direto no trabalho ou mercado do corretor (cr√©dito, dados setoriais, t√©cnica de vendas, branding, design aplic√°vel).\n\nAplicabilidade pr√°tica (0‚Äì3): 0=nenhuma; 1=fraca; 2=implica√ß√µes de atendimento/capta√ß√£o/precifica√ß√£o; 3=fornece insight ou a√ß√£o √∫til (ex.: como vender mais, orientar cliente, identificar oportunidades).\n\nOriginalidade (0‚Äì2): 0=repeti√ß√£o/desdobramento sem novo impacto; 1=algum dado novo; 2=conte√∫do realmente novo.\n\nLocalidade/Contexto Brasil (0‚Äì2): 0=externo/indireto; 1=externo com ponte expl√≠cita ao BR; 2=not√≠cia sobre o Brasil ou com efeito direto no Brasil.\n\nAprove se **pontua√ß√£o ‚â• 8** e nenhum gate falhar.  \nEm caso de d√∫vida, **reprove** (pol√≠tica de conservadorismo).\n\nExemplos r√°pidos\n**Aprovar (boas refer√™ncias):**\n- ‚ÄúCaixa lan√ßa cr√©dito imobili√°rio com juros menores‚Äù  \n- ‚ÄúConecta Imobi 2025 destaca alta nas vendas‚Äù  \n- ‚ÄúSelic em 15% aumenta interesse no Tesouro Direto entre investidores‚Äù  \n- ‚ÄúAutoma√ß√£o residencial valoriza im√≥veis e atrai compradores‚Äù\n\n**Reprovar:**\n- ‚ÄúFED mant√©m juros nos EUA‚Äù (sem liga√ß√£o com BR)  \n- ‚ÄúApple lan√ßa novo iPhone‚Äù (irrelevante ao corretor)  \n- ‚ÄúInfla√ß√£o global sobe em setembro‚Äù (sem rela√ß√£o direta)  \n- ‚ÄúLucro da Direcional sobe 26%‚Äù (duplicado j√° postado)\n\nSA√çDA (JSON PURO, sem texto extra):\n[\n  {\n    \"noticia_id\": \"{{ $('Injetar Hist√≥rico').item.json.noticia_id }}\",\n    \"status\": \"aprovado nivel 1\" | \"reprovado\",\n    \"justificativa\": \"motivo curto e objetivo; se duplicado, cite o ID original\"\n  }\n]\n\nRegras finais:\n- N√£o altere noticia_id.\n- N√£o inclua explica√ß√µes fora do JSON.\n- Use PT-BR.\n- Se reprovar, seja espec√≠fico: ‚Äúsem impacto direto p/ cr√©dito/im√≥veis‚Äù, ‚Äúduplicado do ID X‚Äù, ‚Äúimagem inadequada‚Äù, etc.","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1584,288],"id":"2e53efd7-f23c-464e-8038-960d73bdb1e3","name":"AI Agent1","executeOnce":false},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1584,464],"id":"7af7db52-bc85-4066-8954-5c7a490f55da","name":"gpt-4.1-mini1","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const raw = $json.output;\nconst parsed = JSON.parse(raw); // Isso vira um array com 1 objeto\n\n// Retorna o primeiro e √∫nico objeto do array\nreturn {\n  json: parsed[0]\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1968,288],"id":"24590e23-eeff-4e6a-9201-52f78598ce57","name":"Code3"},{"parameters":{"documentId":{"__rl":true,"value":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","mode":"list","cachedResultName":"Controle Radar do Corretor","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"noticia_id","lookupValue":"={{ $json.noticia_id }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2608,272],"id":"7a22bcee-15cd-4d4f-b392-3da546afceca","name":"Get row(s) in sheet","executeOnce":false,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[3696,272],"id":"212ad63e-5810-457f-90bc-11456cac9c18","name":"Loop Over Items"},{"parameters":{"resource":"messages-api","operation":"send-image","instanceName":"social-media-radarcorretor","remoteJid":"553497781602","media":"={{ $json.base64Image }}","caption":"=[NOT√çCIA {{ $('Get row(s) in sheet').item.json.row_number }}]\n\n{{ $('Get row(s) in sheet').item.json.legenda }}\n\nResponda com:\naprovar {{ $('Get row(s) in sheet').item.json.row_number }} ou rejeitar {{ $('Get row(s) in sheet').item.json.row_number }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[3920,288],"id":"e931363c-b599-4aec-89f2-efc6246ebb61","name":"Envio do post - Whatsapp","credentials":{"evolutionApi":{"id":"vDN1jxL85cL5Mz2G","name":"Evolution - Radar Corretor"}},"onError":"continueRegularOutput"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"\" Analise as TR√äS imagens fornecidas e para CADA UMA descreva se est√° adequada para post no Instagram.\n\nIMAGEM 1: {{ $json.imagem_url }}\nIMAGEM 2: {{ $json.imagem_url2 }}  \nIMAGEM 3: {{ $json.imagem_url3 }}\n\nPara cada imagem, informe:\n- Est√° clara, n√≠tida, completa e relevante?\n- Ou est√° cortada, vazia, sem sentido ou toda preta?\n\nRetorne a an√°lise de CADA imagem separadamente.Informe se a imagem est√° clara, n√≠tida, completa e relevante, ou se est√° borrada, cortada, vazia, sem sentido ou toda preta.\n\nAs vezes vem uma imagem toda escura apenas com legenda, nesses casos pode rejeitar. O importante e analisar a imagem de fundo, todas sempre vem com legenda padrao, porem a imagem de fundo que deve ser avaliada.\n\nFundo totalmente escuro deve ser rejeitado\"","imageUrls":"={{ $json.imagem_url }},{{ $json.imagem_url2 }},{{ $json.imagem_url3 }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1376,288],"id":"05348f6a-5669-4b95-94c4-01780884b985","name":"Analyze image","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"jsCode":"const items = $input.all();\nif (!items.length) return [];\n\n// Pega o primeiro item que tenha hist√≥rico\nconst histItem = items.find(item => item.json?.historico);\nconst historico = histItem?.json?.historico || '';\n\n// Limita tamanho\nconst hist = historico.length > 15000 ? historico.slice(0, 15000) : historico;\n\n// Filtra apenas itens que s√£o not√≠cias (tem noticia_id)\nconst noticias = items.filter(item => item.json?.noticia_id);\n\n// Se n√£o h√° not√≠cias, retorna vazio\nif (!noticias.length) return [];\n\n// Injeta hist√≥rico\nreturn noticias.map(noticia => ({\n  json: {\n    ...noticia.json,\n    historico: hist\n  }\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1184,288],"id":"773707a4-74a1-46c6-ab0a-fe17b91c82e4","name":"Injetar Hist√≥rico","alwaysOutputData":false},{"parameters":{"jsCode":"const DIAS = 3;\nconst corte = new Date(); \ncorte.setDate(corte.getDate() - DIAS);\n\nconsole.log('=== DEBUG HIST√ìRICO ===');\nconsole.log('Data de corte:', corte.toISOString());\n\nfunction parseBR(v){\n  if (!v) return NaN;\n  if (v instanceof Date) return v;\n  const m = String(v).trim().match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\n  if (!m) return NaN;\n  const [_, dd, mm, yyyy] = m.map(Number);\n  return new Date(yyyy, mm-1, dd);\n}\n\n// Debug: ver todas as not√≠cias recebidas\nconst todasNoticias = $input.all();\nconsole.log('Total not√≠cias recebidas:', todasNoticias.length);\n\ntodasNoticias.forEach((noticia, index) => {\n  const j = noticia.json || {};\n  console.log(`Noticia ${index}:`, {\n    id: j.noticia_id,\n    status: j.status,\n    data: j.data_processamento || j.data_proce || j.data_proces || j.data,\n    titulo: j.titulo?.substring(0, 50) + '...'\n  });\n});\n\n// filtra √∫ltimos DIAS\nconst recentes = todasNoticias.filter(i => {\n  const j = i.json || {};\n  const raw = j.data_processamento || j.data_proce || j.data_proces || j.data;\n  const d = parseBR(raw);\n  const statusOk = (j.status || '').toLowerCase() === 'postado';\n  const dataOk = d instanceof Date && !isNaN(d) && d >= corte;\n  \n  console.log(`Filtro - ID: ${j.noticia_id}, Status: ${j.status}, Data: ${raw}, DataOK: ${dataOk}, StatusOK: ${statusOk}`);\n  \n  return dataOk && statusOk;\n});\n\nconsole.log('Not√≠cias recentes encontradas:', recentes.length);\n\n// monta string\nlet historico = recentes.map(i => {\n  const j = i.json || {};\n  return `ID:${j.noticia_id} | ${j.titulo || ''} | ${j.legenda || ''}`;\n}).join('\\n');\n\nconsole.log('Hist√≥rico gerado:', historico.substring(0, 200) + '...');\n\n// limita tamanho (evita prompt gigante)\nif (historico.length > 15000) historico = historico.slice(0, 15000);\n\n// Se n√£o h√° hist√≥rico, cria um vazio mas identific√°vel\nif (!historico || historico.trim() === '') {\n  historico = 'Nenhuma not√≠cia postada nos √∫ltimos 3 dias';\n  console.log('Hist√≥rico VAZIO - usando placeholder');\n}\n\n// retorna **um √∫nico item**\nreturn [{ \n  json: { \n    historico,\n    _debug: {\n      total_noticias: todasNoticias.length,\n      noticias_recentes: recentes.length,\n      data_corte: corte.toISOString()\n    }\n  } \n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[688,464],"id":"321e5ced-b358-4e9c-8ae5-ae2dfc9167a8","name":"Gera Hist√≥rico","alwaysOutputData":true},{"parameters":{"documentId":{"__rl":true,"value":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","mode":"list","cachedResultName":"Controle Radar do Corretor","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"aguardando"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[432,272],"id":"b40318e7-8999-49a2-a57d-eae253576c1e","name":"Noticias aguardando aprova√ß√£o","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}},"onError":"continueRegularOutput"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","mode":"list","cachedResultName":"Controle Radar do Corretor","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo2_base64","displayName":"arquivo2_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo3_base64","displayName":"arquivo3_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url2","displayName":"imagem_url2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url3","displayName":"imagem_url3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"last_4_days","displayName":"last_4_days","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status_envio_whatsapp","displayName":"status_envio_whatsapp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2176,288],"id":"0b2fcb96-fa37-4534-a14a-0e767d801113","name":"Atualizar status da noticia","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"method":"POST","url":"https://hcti.io/v1/image","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Basic MDRlZDA4NWYtYmY0OS00MzIyLWExMzEtMzY3ZjA1YmRiOTllOmQ0MzhjODk3LTVlYzctNGMyNS1iMjM0LWY5NGYyNjc1OGRhYQ=="}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"html","value":"={{ $json.html }}"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2960,272],"id":"8889e8fe-58be-433c-98bd-2c586be22f67","name":"HTML > Imagem","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"file","outputPropertyName":"imagem_final"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3136,272],"id":"c6ce3cb9-1286-48cb-8de4-65c59836c90c","name":"Baixar imagem"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const binaryData = $input.item.binary?.[\"imagem_final\"];\n\nif (!binaryData || !binaryData.data) {\n  throw new Error(\"Campo 'imagem_final' n√£o encontrado no bin√°rio.\");\n}\n\nconst base64 = Buffer.from(binaryData.data, 'base64').toString(\"base64\");\n\nreturn {\n  json: {\n    base64Image: base64\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3472,272],"id":"7a19851d-eb18-4190-b126-2650d6721295","name":"Binary > base64"},{"parameters":{"assignments":{"assignments":[{"id":"6cb1827b-7e9b-4c1d-9553-704a28bc6cff","name":"html","value":"=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Radar Corretor - Carrossel</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n\n    body {\n      width: 1200px;\n      height: 1200px;\n      background: #d9d9d9;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: 'Arial', sans-serif;\n    }\n\n    /* Container principal */\n    .mosaic-container {\n      width: 1200px;\n      height: 1200px;\n      background: #fff;\n      border-radius: 30px;\n      box-shadow: 0 20px 50px rgba(0,0,0,0.3);\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      grid-template-rows: repeat(2, 1fr);\n      gap: 20px;\npadding: 60px; /* espa√ßo interno branco */\n\twidth: fit-content;\n      height: fit-content;\n      overflow: hidden;\n    }\n\n    /* Cada box com propor√ß√£o mais vertical, mas dentro do quadrado */\n    .image-box {\n      border-radius: 20px;\n      background: #fff;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      overflow: hidden;\n      position: relative;\n      width: 440px;\n      height: 575px;\n      box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n    }\n\n    .image-box img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover; /* cobre o ret√¢ngulo sem distorcer */\n      transition: transform 0.3s ease;\n    }\n\n    .image-box:hover img {\n      transform: scale(1.03);\n    }\n\n    .watermark {\n      position: absolute;\n      bottom: 15px;\n      right: 15px;\n      background: rgba(255,255,255,0.9);\n      padding: 8px 15px;\n      border-radius: 20px;\n      font-size: 14px;\n      color: #146ab7;\n      font-weight: bold;\n    }\n\n    .image-box:nth-child(1) { border: 3px solid #146ab7; }\n    .image-box:nth-child(2) { border: 3px solid #0d47a1; }\n    .image-box:nth-child(3) { border: 3px solid #1976d2; }\n    .image-box:nth-child(4) { border: 3px solid #42a5f5; }\n  </style>\n</head>\n<body>\n  <div class=\"mosaic-container\">\n    <div class=\"image-box\">\n      <img src=\"{{ $json.imagem_url }}\" alt=\"Imagem 1 da not√≠cia\">\n      <div class=\"watermark\">1</div>\n    </div>\n    <div class=\"image-box\">\n      <img src=\"{{ $json.imagem_url2 }}\" alt=\"Imagem 2 da not√≠cia\">\n      <div class=\"watermark\">2</div>\n    </div>\n    <div class=\"image-box\">\n      <img src=\"{{ $json.imagem_url3 }}\" alt=\"Imagem 3 da not√≠cia\">\n      <div class=\"watermark\">3</div>\n    </div>\n    <div class=\"image-box\">\n      <img src=\"https://raw.githubusercontent.com/getmia/miabuilder-images/main/RadarCorretor_Final_Post_Fixo.jpg\" alt=\"Imagem 4 da not√≠cia\">\n      <div class=\"watermark\">4</div>\n    </div>\n  </div>\n</body>\n</html>\n","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2784,272],"id":"2901931d-8dab-444b-a570-23cebb895302","name":"HTML Mosaico das imagens"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"763c93d5-96c1-491e-b9dd-f1e2b7e83637","leftValue":"={{ $json.status }}","rightValue":"reprovado","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2384,288],"id":"894257b6-9906-47ff-ad26-226b4f24fb8e","name":"Verifica o status da not√≠cia"},{"parameters":{"operation":"crop","dataPropertyName":"imagem_final","width":1200,"height":1200,"options":{"format":"jpeg"}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[3296,272],"id":"9dacc073-ed48-4986-a029-342e2ad08812","name":"Cortar imagem 1200X1200"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":15}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[224,352],"id":"2d108d67-ef07-4e2d-bc48-b40ce0a9befa","name":"Schedule Trigger1"}],"connections":{"Noticias Postadas":{"main":[[{"node":"Gera Hist√≥rico","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Injetar Hist√≥rico","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Code3","type":"main","index":0}]]},"gpt-4.1-mini1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Code3":{"main":[[{"node":"Atualizar status da noticia","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"HTML Mosaico das imagens","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Envio do post - Whatsapp","type":"main","index":0}]]},"Envio do post - Whatsapp":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Analyze image":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Injetar Hist√≥rico":{"main":[[{"node":"Analyze image","type":"main","index":0}]]},"Gera Hist√≥rico":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Noticias aguardando aprova√ß√£o":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Atualizar status da noticia":{"main":[[{"node":"Verifica o status da not√≠cia","type":"main","index":0}]]},"HTML > Imagem":{"main":[[{"node":"Baixar imagem","type":"main","index":0}]]},"Baixar imagem":{"main":[[{"node":"Cortar imagem 1200X1200","type":"main","index":0}]]},"Binary > base64":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"HTML Mosaico das imagens":{"main":[[{"node":"HTML > Imagem","type":"main","index":0}]]},"Verifica o status da not√≠cia":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Cortar imagem 1200X1200":{"main":[[{"node":"Binary > base64","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Noticias aguardando aprova√ß√£o","type":"main","index":0},{"node":"Noticias Postadas","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"UldWpZHcKTrRMFpI"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","sheetId":0,"lastRevision":57,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek&revision=57&exportFormat=xlsx"},"node:Trigger nova noticia no sheets1":{"documentId":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","sheetId":0,"lastRevision":4272,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek&revision=4272&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger1":[{"json":{"timestamp":"2025-10-31T17:31:00.627-03:00","Readable date":"October 31st 2025, 5:31:00 pm","Readable time":"5:31:00 pm","Day of week":"Friday","Year":"2025","Month":"October","Day of month":"31","Hour":"17","Minute":"31","Second":"00","Timezone":"America/Sao_Paulo (UTC-03:00)"}}]},"versionId":"9917b92f-c0ee-4403-aa45-1bf62aa7eed8","triggerCount":1,"tags":[]}