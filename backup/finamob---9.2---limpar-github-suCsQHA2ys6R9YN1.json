{"createdAt":"2025-10-14T17:41:22.263Z","updatedAt":"2025-11-03T17:19:45.076Z","id":"suCsQHA2ys6R9YN1","name":"Finamob - 9.2 - Limpar GitHub","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"weeks"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-176,384],"id":"690c8f2f-17c9-461b-9bfd-d8fb265dc758","name":"Schedule Trigger1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[448,384],"id":"daae3b0a-2f3c-4f60-8508-6dc3b9437bb4","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"3b7bdbdf-14bd-4be2-a2fe-d91f59bfaf9f","name":"Owner","value":"getmia-ia","type":"string"},{"id":"7ea8ddff-c64d-4978-b2e3-ac2cd706bf13","name":"Repository","value":"finamob","type":"string"},{"id":"af7e8803-8459-481a-9b63-20025f401957","name":"path","value":"images/","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[32,384],"id":"528c5ba9-3fd3-43f3-9017-4474582a4e90","name":"Dados para o GitHub"},{"parameters":{"authentication":"oAuth2","resource":"file","operation":"list","owner":{"__rl":true,"value":"={{ $json.Owner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $json.Repository }}","mode":"name"},"filePath":"={{$json.path}}"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[224,384],"id":"09036981-9b03-4847-8b28-98953d70d8a0","name":"Lista todos os arquivos do repositório","webhookId":"abb17ecd-f766-4e76-b621-afda24ba87bd","credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"method":"DELETE","url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/contents/{{ $('Lista todos os arquivos do repositório').item.json.path }}","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": \"Removendo arquivo antigo automaticamente\",\n  \"sha\": \"{{ $('Lista todos os arquivos do repositório').item.json.sha }}\",\n  \"committer\": {\n    \"name\": \"{{ $json.commit.committer.name }}\",\n    \"email\": \"{{ $json.commit.committer.email }}\"\n  }\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,384],"id":"584cd4b4-c23b-4a9e-bd47-4b95ab139ddc","name":"Deleta o arquivo do repositório","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32581fe4-aa4b-410a-986c-aec0ffa7ece3","leftValue":"={{ $json.commit.author.date }}","rightValue":"={{ $now.minus({ weeks: 2 }) }}","operator":{"type":"dateTime","operation":"beforeOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[864,400],"id":"05bb9031-1931-4905-9a00-3d7a913be9f0","name":"Verifica se o arquivo está a mais de uma semana no repositório"},{"parameters":{"url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/commits","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"path","value":"={{ $('Lista todos os arquivos do repositório').item.json.path }}"},{"name":"per_page","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[672,400],"id":"7675dbeb-3b87-4e19-9186-1b4d9bd83234","name":"Busca o último commit de cada arquivo","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"content":"## Fluxo que apaga arquivos que estão a mais de uma semana no repositório do GitHub\n(para as imagens das notícias)","height":640,"width":1744,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-272,256],"id":"8808f960-5bd3-4fb4-857d-d09f8baf482b","name":"Sticky Note"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1280,384],"id":"b3de194c-1b39-46db-9769-40533683493f","name":"Wait","webhookId":"61da440a-2dc1-4603-92c9-77825d76cc22"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1280,624],"id":"300ae7b4-17c2-4e46-8b2d-357c7c2e67da","name":"Wait1","webhookId":"6411f046-6821-47e4-bdc4-485e8a60484f"}],"connections":{"Schedule Trigger1":{"main":[[{"node":"Dados para o GitHub","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Busca o último commit de cada arquivo","type":"main","index":0}]]},"Dados para o GitHub":{"main":[[{"node":"Lista todos os arquivos do repositório","type":"main","index":0}]]},"Lista todos os arquivos do repositório":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Deleta o arquivo do repositório":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Verifica se o arquivo está a mais de uma semana no repositório":{"main":[[{"node":"Deleta o arquivo do repositório","type":"main","index":0}],[{"node":"Wait1","type":"main","index":0}]]},"Busca o último commit de cada arquivo":{"main":[[{"node":"Verifica se o arquivo está a mais de uma semana no repositório","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"Cem9y3zmcggUQhrp"},"staticData":{"node:Schedule Trigger1":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"24b397e3-2c8e-4207-899a-78c5727c6b2d","triggerCount":1,"tags":[]}