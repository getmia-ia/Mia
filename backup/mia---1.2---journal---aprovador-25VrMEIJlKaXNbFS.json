{"createdAt":"2025-08-26T20:55:30.788Z","updatedAt":"2025-10-31T19:42:49.731Z","id":"25VrMEIJlKaXNbFS","name":"Mia - 1.2 - Journal - Aprovador","active":true,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"=Voc√™ √© respons√°vel por analisar uma not√≠cia com status \"aguardando\" e decidir se ela deve ser \"aprovada\" ou \"reprovada\".\n\nüìú Hist√≥rico de not√≠cias j√° postadas (use para evitar duplicidade; compare por t√≠tulo/legenda/evento):\n{{ $('Code6').item.json.historico }}\n\nüì∞ Not√≠cia para an√°lise:\nID: {{ $('Code6').item.json.noticia_id }}\nT√≠tulo: {{ $('Code6').item.json.titulo }}\nLegenda: {{ $('Code6').item.json.legenda }}\nDescricao da Imagem: {{ $json.content }}\n\n### REGRAS DE DECIS√ÉO\n\n#### 1) Duplicidade:\n\n* **Reprove** se falar do **mesmo evento** j√° postado ‚Äî como o mesmo lan√ßamento de modelo de IA, atualiza√ß√£o de ferramenta, decis√£o regulat√≥ria, ou caso de uso espec√≠fico.\n* Ao reprovar por duplicidade, **CITE o ID correspondente** do hist√≥rico.\n* **N√£o reprovar** por tema geral (ex: ‚ÄúIA na sa√∫de‚Äù, ‚ÄúIA na educa√ß√£o‚Äù) se for **outro evento ou √¢ngulo**.\n\n#### 2) Imagem:\n\n* **Leia a descri√ß√£o da imagem.**\n* Reprove se for claramente **inadequada para publica√ß√£o** ‚Äî exemplos: imagem toda preta, borrada, ileg√≠vel, com elementos inapropriados ou sem rela√ß√£o com o tema da not√≠cia.\n\n#### 3) Relev√¢ncia (mundo da IA):\n\n* **Aprove** apenas se houver liga√ß√£o **direta com Intelig√™ncia Artificial**, como:\n\n  * Avan√ßos tecnol√≥gicos (modelos, algoritmos, ferramentas, open source, etc.)\n  * Aplica√ß√µes em setores (sa√∫de, educa√ß√£o, ind√∫stria, marketing, seguran√ßa, etc.)\n  * Impactos √©ticos, sociais, econ√¥micos ou no trabalho\n  * Pol√≠ticas p√∫blicas e regula√ß√µes sobre IA\n  * Casos de uso, riscos ou controv√©rsias com IA\n\n* **Reprove** not√≠cias sobre:\n\n  * Tecnologia em geral sem IA envolvida\n  * Economia, pol√≠tica ou ci√™ncia sem rela√ß√£o com IA\n  * Conte√∫dos motivacionais ou especulativos sem base factual\n\nSA√çDA (JSON PURO, sem texto extra):\n[\n  {\n    \"noticia_id\": \"{{ $('Code6').item.json.noticia_id }}\",\n    \"status\": \"aprovado\" | \"reprovado\",\n    \"justificativa\": \"motivo curto e objetivo; se duplicado, cite o ID original\"\n  }\n]\nREGRAS FINAIS:\n- N√£o altere noticia_id.\n- Retorne SOMENTE o array JSON.\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1520,880],"id":"5a9d6176-c076-4337-908f-f4a110482ea7","name":"AI Agent","executeOnce":false},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1520,1056],"id":"e75dc7b4-17f2-4c09-96fa-feadec0c6cbe","name":"gpt-4.1-mini","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"\" Analise as TR√äS imagens fornecidas e para CADA UMA descreva se est√° adequada para post no Instagram.\n\nIMAGEM 1: {{ $json.imagem_url }}\nIMAGEM 2: {{ $json.imagem_url2 }}  \nIMAGEM 3: {{ $json.imagem_url3 }}\n\nPara cada imagem, informe:\n- Est√° clara, n√≠tida, completa e relevante?\n- Ou est√° cortada, vazia, sem sentido ou toda preta?\n\nRetorne a an√°lise de CADA imagem separadamente.Informe se a imagem est√° n√≠tida, completa e relevante, ou se est√° borrada, cortada, vazia, sem sentido ou **toda** preta.\n\nAs vezes vem uma imagem toda escura apenas com legenda, nesses casos pode rejeitar. O importante e analisar a imagem de fundo, todas sempre vem com legenda padrao, porem a imagem de fundo que deve ser avaliada.\n\nFundo totalmente escuro, isto √©, preto deve ser rejeitado\"","imageUrls":"={{ $json.imagem_url }},{{ $json.imagem_url2 }},{{ $json.imagem_url3 }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1312,880],"id":"7531c388-213b-4ebe-adb4-ba98d0677094","name":"Analyze image","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[384,960],"id":"ad95d0f5-909f-4543-b898-6cd95b0984a9","name":"Schedule Trigger1"},{"parameters":{"content":"# Fluxo de Aprova√ß√£o dos Posts\n\n### Esse fluxo roda sempre que existe uma alteracao no sheets de controle do journal\n### O AI Agent define se aprova ou rejeita um post baseado em sua imagem e se ja foi postado alguma vez um tema similar","height":784,"width":2000,"color":3},"type":"n8n-nodes-base.stickyNote","position":[320,608],"typeVersion":1,"id":"864b0e61-ce3b-477f-a439-3c95829c4dfa","name":"Sticky Note14"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const raw = $json.output;\nconst parsed = JSON.parse(raw); // Isso vira um array com 1 objeto\n\n// Retorna o primeiro e √∫nico objeto do array\nreturn {\n  json: parsed[0]\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1888,880],"id":"6b080a8e-682d-4691-b701-cb536483a489","name":"Code5"},{"parameters":{"jsCode":"const items = $input.all();\nif (!items.length) return [];\n\n// Pega o primeiro item que tenha hist√≥rico\nconst histItem = items.find(item => item.json?.historico);\nconst historico = histItem?.json?.historico || '';\n\n// Limita tamanho\nconst hist = historico.length > 15000 ? historico.slice(0, 15000) : historico;\n\n// Filtra apenas itens que s√£o not√≠cias (tem noticia_id)\nconst noticias = items.filter(item => item.json?.noticia_id);\n\n// Se n√£o h√° not√≠cias, retorna vazio\nif (!noticias.length) return [];\n\n// Injeta hist√≥rico\nreturn noticias.map(noticia => ({\n  json: {\n    ...noticia.json,\n    historico: hist\n  }\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1120,880],"id":"cf8e5ff4-2479-40bb-b0b4-3151ee624787","name":"Code6"},{"parameters":{"jsCode":"const DIAS = 3;\nconst corte = new Date(); \ncorte.setDate(corte.getDate() - DIAS);\n\nconsole.log('=== DEBUG HIST√ìRICO ===');\nconsole.log('Data de corte:', corte.toISOString());\n\nfunction parseBR(v){\n  if (!v) return NaN;\n  if (v instanceof Date) return v;\n  const m = String(v).trim().match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\n  if (!m) return NaN;\n  const [_, dd, mm, yyyy] = m.map(Number);\n  return new Date(yyyy, mm-1, dd);\n}\n\n// Debug: ver todas as not√≠cias recebidas\nconst todasNoticias = $input.all();\nconsole.log('Total not√≠cias recebidas:', todasNoticias.length);\n\ntodasNoticias.forEach((noticia, index) => {\n  const j = noticia.json || {};\n  console.log(`Noticia ${index}:`, {\n    id: j.noticia_id,\n    status: j.status,\n    data: j.data_processamento || j.data_proce || j.data_proces || j.data,\n    titulo: j.titulo?.substring(0, 50) + '...'\n  });\n});\n\n// filtra √∫ltimos DIAS\nconst recentes = todasNoticias.filter(i => {\n  const j = i.json || {};\n  const raw = j.data_processamento || j.data_proce || j.data_proces || j.data;\n  const d = parseBR(raw);\n  const statusOk = (j.status || '').toLowerCase() === 'postado';\n  const dataOk = d instanceof Date && !isNaN(d) && d >= corte;\n  \n  console.log(`Filtro - ID: ${j.noticia_id}, Status: ${j.status}, Data: ${raw}, DataOK: ${dataOk}, StatusOK: ${statusOk}`);\n  \n  return dataOk && statusOk;\n});\n\nconsole.log('Not√≠cias recentes encontradas:', recentes.length);\n\n// monta string\nlet historico = recentes.map(i => {\n  const j = i.json || {};\n  return `ID:${j.noticia_id} | ${j.titulo || ''} | ${j.legenda || ''}`;\n}).join('\\n');\n\nconsole.log('Hist√≥rico gerado:', historico.substring(0, 200) + '...');\n\n// limita tamanho (evita prompt gigante)\nif (historico.length > 15000) historico = historico.slice(0, 15000);\n\n// Se n√£o h√° hist√≥rico, cria um vazio mas identific√°vel\nif (!historico || historico.trim() === '') {\n  historico = 'Nenhuma not√≠cia postada nos √∫ltimos 3 dias';\n  console.log('Hist√≥rico VAZIO - usando placeholder');\n}\n\n// retorna **um √∫nico item**\nreturn [{ \n  json: { \n    historico,\n    _debug: {\n      total_noticias: todasNoticias.length,\n      noticias_recentes: recentes.length,\n      data_corte: corte.toISOString()\n    }\n  } \n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[752,1056],"id":"595db1c6-1913-4644-9670-73349ec478e0","name":"Code7","alwaysOutputData":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[928,880],"id":"2ea9391b-204e-45db-8a83-346d0e31ce2c","name":"Merge2"},{"parameters":{"documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"postado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[592,1056],"id":"38405b4e-1c17-47d8-976e-4abe9680fb2b","name":"Noticias Postadas2","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}},"onError":"continueRegularOutput"},{"parameters":{"documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"aguardando"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[592,864],"id":"f5d374d0-f642-4680-a5c2-7f6371a01324","name":"Noticias aguardando aprova√ß√£o2","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}},"onError":"continueRegularOutput"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo2_base64","displayName":"arquivo2_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"arquivo3_base64","displayName":"arquivo3_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url2","displayName":"imagem_url2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"imagem_url3","displayName":"imagem_url3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2080,880],"id":"1b9d6547-8860-4ca9-819e-8fbcdddef455","name":"Atualizar status da noticia","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}}],"connections":{"AI Agent":{"main":[[{"node":"Code5","type":"main","index":0}]]},"gpt-4.1-mini":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Analyze image":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Noticias Postadas2","type":"main","index":0},{"node":"Noticias aguardando aprova√ß√£o2","type":"main","index":0}]]},"Code5":{"main":[[{"node":"Atualizar status da noticia","type":"main","index":0}]]},"Code6":{"main":[[{"node":"Analyze image","type":"main","index":0}]]},"Code7":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"Merge2":{"main":[[{"node":"Code6","type":"main","index":0}]]},"Noticias Postadas2":{"main":[[{"node":"Code7","type":"main","index":0}]]},"Noticias aguardando aprova√ß√£o2":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Atualizar status da noticia":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"QdC9qh9DPcT2xcoq"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","sheetId":0,"lastRevision":57,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek&revision=57&exportFormat=xlsx"},"node:Trigger nova noticia no sheets1":{"documentId":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","sheetId":0,"lastRevision":1012,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM&revision=1012&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger1":[{"json":{"timestamp":"2025-10-14T10:16:24.879-03:00","Readable date":"October 14th 2025, 10:16:24 am","Readable time":"10:16:24 am","Day of week":"Tuesday","Year":"2025","Month":"October","Day of month":"14","Hour":"10","Minute":"16","Second":"24","Timezone":"America/Sao_Paulo (UTC-03:00)"}}]},"versionId":"10e46c3b-1a9e-482c-aaed-6a75450723da","triggerCount":1,"tags":[]}