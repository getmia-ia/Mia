{"createdAt":"2025-11-05T16:48:40.684Z","updatedAt":"2025-11-05T20:14:13.037Z","id":"E6PIvxX0YqhzJDJ5","name":"BMS - 1.3 - Journal - Disparo Journal List","active":true,"isArchived":false,"nodes":[{"parameters":{"content":"# Fluxo de Aprova√ß√£o dos Posts\n\n### Esse fluxo roda sempre que existe uma alteracao no sheets de controle do journal\n### O AI Agent define se aprova ou rejeita um post baseado em sua imagem e se ja foi postado alguma vez um tema similar","height":1008,"width":5904,"color":3},"type":"n8n-nodes-base.stickyNote","position":[512,-128],"typeVersion":1,"id":"d4cdf5c0-fad6-425b-8e41-a8d00e712242","name":"Sticky Note13"},{"parameters":{"resource":"fileFolder","searchMethod":"query","queryString":"=name = '{{ $json.arquivo_base64 }}' and trashed = false\n","limit":1,"filter":{},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[2272,448],"id":"d3e2bff3-d14c-4a18-b614-20939c143f0d","name":"Search files and folders","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[2480,448],"id":"fa8e3a5a-d418-4623-a72b-a84d813b1b7e","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Executar: Run Once for Each Item\n\n// 1) Buscar dados do Sheets alinhando pelo √≠ndice do item atual\nconst noticia = $('Encontra a Pr√≥xima Not√≠cia V√°lida').item.json;\nconst legenda = noticia.legenda || '';\nconst param_2 = noticia.param_2 || null;   // üÜï novo campo\nconst param_3 = noticia.param_3 || null;   // üÜï novo campo\nconst param_4 = noticia.param_4 || null;   // üÜï novo campo\nconst imagem_url = noticia.imagem_url || null; // üÜï novo campo\n\n// 2) Pegar o .txt baixado do Drive (base64 do ARQUIVO .txt)\nconst txtB64 = $input.item?.binary?.data?.data;\nif (!txtB64) {\n  throw new Error('Bin√°rio do .txt n√£o encontrado no node \"Download file\".');\n}\n\n// 3) .txt (base64) -> texto UTF-8 -> que cont√©m o base64 da IMAGEM\nconst content = Buffer.from(txtB64, 'base64').toString('utf8').trim();\n\n// 4) Se vier em dataURI, remover prefixo e capturar MIME\nconst m = content.match(/^data:([^;]+);base64,(.+)$/i);\nlet mimeType = m ? m[1] : null;\nlet base64 = (m ? m[2] : content).replace(/\\s+/g, ''); // remove quebras/espa√ßos\n\n// 5) Detectar MIME pelos \"magic bytes\" caso n√£o tenha\nconst buf = Buffer.from(base64, 'base64');\nif (!mimeType) {\n  const sig = buf.slice(0, 4).toString('hex');\n  if (sig.startsWith('ffd8ff')) mimeType = 'image/jpeg';\n  else if (sig === '89504e47') mimeType = 'image/png';\n  else if (sig.startsWith('47494638')) mimeType = 'image/gif';\n  else if (sig.startsWith('52494646')) mimeType = 'image/webp';\n  else mimeType = 'application/octet-stream';\n}\n\n// 6) Retornar o que outros n√≥s v√£o usar\nreturn {\n  json: {\n    noticiaIndex: noticia.noticia_id,\n    legenda,\n    param_2,    // üÜï adicionado\n    param_3,    // üÜï adicionado\n    param_4,    // üÜï adicionado\n    imagem_url,\n    mimeType,\n    base64\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2752,368],"id":"256fa570-2be6-411f-8e61-3ad25060ea39","name":"Code3"},{"parameters":{"batchSize":"=1","options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[4368,448],"id":"ebf4d8a2-523d-41a7-a4a4-55c3ac617361","name":"Loop Over Items1"},{"parameters":{"amount":"={{ 5 + Math.floor(Math.random() * 20) }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[4816,448],"id":"e905ff3c-4118-4615-a029-096cd4c05620","name":"Wait","webhookId":"56291188-ec96-4e3f-ad03-920b5123e81a"},{"parameters":{"resource":"messages-api","instanceName":"bms-social-media","remoteJid":"=5511992486507","messageText":"=Mensagem para: {{ $('Wait').item.json.nome }} - {{ $('Wait').item.json.telefone }}\n\nTitulo: {{ $('Wait').item.json.param_2 }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[5296,448],"id":"29f21b34-02a7-4a61-b17b-e8d1baf73926","name":"Envio do post - Journal List","credentials":{"evolutionApi":{"id":"vy2ySY8uAchmjNnK","name":"bms"}},"onError":"continueErrorOutput"},{"parameters":{"documentId":{"__rl":true,"value":"1IDXSuMzMhUFDCmKkpS9qSfH3UuBKyoOD66M75UYcgSs","mode":"list","cachedResultName":"CRM - BMS","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1IDXSuMzMhUFDCmKkpS9qSfH3UuBKyoOD66M75UYcgSs/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"journal_list","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1IDXSuMzMhUFDCmKkpS9qSfH3UuBKyoOD66M75UYcgSs/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"ativo"},{"lookupColumn":"novo?","lookupValue":"cadastrado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[2752,544],"id":"5a0bf7ec-19cc-4494-9570-4a191341824d","name":"Get row(s) in sheet1","executeOnce":true,"credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Normaliza o telefone do item atual\nconst raw = $json.telefone || \"\";\nlet clean = String(raw).replace(/\\D+/g, \"\"); // mant√©m s√≥ os d√≠gitos\n\nif (clean.length === 11) {\n  clean = \"55\" + clean; // adiciona DDI se faltar\n} else if (clean.length === 13 && clean.startsWith(\"55\")) {\n  // j√° est√° ok\n}\n\n// Retorna o item original + o campo novo\nreturn {\n  json: {\n    ...$json,\n    telefoneAjustado: clean\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3200,464],"id":"15ecce40-b8fc-4de1-ac0e-9c2983fcb3b8","name":"Code4"},{"parameters":{"documentId":{"__rl":true,"value":"1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA","mode":"list","cachedResultName":"BMS - Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status_WhatsApp","lookupValue":"aprovado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1184,464],"id":"0a3ec007-905e-4aed-927e-b0012fc623b7","name":"base_noticias","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"mode":"combineBySql","query":"SELECT\n  b.nome AS nome,\n  b.telefone AS telefone,\n  a.legenda AS legenda,\n  a.param_2 AS param_2,\n  a.param_3 AS param_3,\n  a.param_4 AS param_4,\n  a.base64 AS base64,\n  a.imagem_url AS imagem_url,\n  a.mimeType AS mimeType,\n  a.noticiaIndex AS idx\nFROM input1 a\nCROSS JOIN input2 b","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3008,464],"id":"23888d2b-4e80-42c1-89ac-0d5c33d81d87","name":"Merge1"},{"parameters":{"tableId":"bms-historico_mensagens","fieldsUi":{"fieldValues":[{"fieldId":"mensagem_usuario","fieldValue":"="},{"fieldId":"mensagem_agente","fieldValue":"={{ $('Wait').item.json.legenda }}"},{"fieldId":"telefone","fieldValue":"={{ $('Wait').item.json.telefone }}"},{"fieldId":"nome_usuario","fieldValue":"={{ $('Wait').item.json.nome }}"},{"fieldId":"message_type","fieldValue":"text"},{"fieldId":"ativo","fieldValue":"true"},{"fieldId":"nome_app","fieldValue":"SDR-BMS"},{"fieldId":"id_usuario","fieldValue":"={{ $('Wait').item.json.telefone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[5520,592],"id":"feb1ffbd-0da9-46aa-a463-0a4ccb8a43a9","name":"Cria Mensagem no Supabase1","credentials":{"supabaseApi":{"id":"9FeQpCfKieI9F2Ms","name":"bms"}},"onError":"continueRegularOutput","notes":"Este fluxo √© de propriedade da FORMA√á√ÉO AGENTES DE IA COM N8N -BY RICNEVES"},{"parameters":{"operation":"getAll","tableId":"bms-historico_mensagens","returnAll":true},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3456,336],"id":"acc3c8ba-7442-4810-baa0-b35db705218f","name":"Get many rows","executeOnce":true,"credentials":{"supabaseApi":{"id":"9FeQpCfKieI9F2Ms","name":"bms"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"23d972c0-0f5f-48b0-bd9d-488327b1c337","leftValue":"={{ $json.mensagens_hoje }}","rightValue":4,"operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[4576,464],"id":"b4cc609e-b6b5-48ab-82f3-001513d325cf","name":"If"},{"parameters":{"jsCode":"// 1Ô∏è‚É£ Captura todas as mensagens do Supabase\nconst mensagens = $items(\"Get many rows\");\n\n// 2Ô∏è‚É£ Captura todos os n√∫meros existentes no Code4 (para garantir que ningu√©m fique de fora)\nconst baseNumeros = $items(\"Code4\").map(item => String(item.json.telefoneAjustado || \"\").replace(/\\D+/g, \"\"));\n\n// 3Ô∏è‚É£ Pega a data de hoje em formato YYYY-MM-DD\nconst hoje = new Date().toISOString().slice(0, 10);\n\n// 4Ô∏è‚É£ Cria um dicion√°rio para contar mensagens por telefone\nconst contagem = {};\n\nfor (const item of mensagens) {\n  const msg = item.json;\n  const telefone = String(msg.telefone || \"\").replace(/\\D+/g, \"\");\n  const dataMsg = msg.created_at ? msg.created_at.slice(0, 10) : \"\";\n\n  // Se for de hoje, incrementa a contagem\n  if (dataMsg === hoje && telefone) {\n    contagem[telefone] = (contagem[telefone] || 0) + 1;\n  }\n}\n\n// 5Ô∏è‚É£ Garante que todos os n√∫meros da base venham com valor (0 se n√£o tiver mensagens hoje)\nfor (const tel of baseNumeros) {\n  if (!contagem[tel]) contagem[tel] = 0;\n}\n\n// 6Ô∏è‚É£ Transforma o dicion√°rio em array (como uma \"tabela\" pra merge)\nconst resultado = Object.entries(contagem).map(([telefone, mensagens_hoje]) => ({\n  json: { telefone, mensagens_hoje }\n}));\n\nreturn resultado;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3632,336],"id":"2fdba73a-e7f0-48df-84cd-c7918867bd1b","name":"Code5"},{"parameters":{"mode":"combine","advanced":true,"mergeByFields":{"values":[{"field1":"telefone","field2":"telefoneAjustado"}]},"joinMode":"enrichInput2","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3840,448],"id":"ff866db2-0834-47ed-a6dd-dcf310d44a94","name":"Merge2"},{"parameters":{"jsCode":"// Cria um mapa para controlar quantas vezes cada telefone aparece\nconst contador = {};\n\n// Percorre todos os itens recebidos (Code7 est√° antes do Loop)\nreturn $input.all().map(item => {\n  const json = item.json;\n  const telefone = json.telefoneAjustado;\n\n  // Valor inicial vindo do Supabase\n  const mensagensHoje = json.mensagens_hoje || 0;\n\n  // Se o telefone ainda n√£o foi visto neste lote, inicia com o valor atual do Supabase\n  if (!contador[telefone]) {\n    contador[telefone] = mensagensHoje;\n  }\n\n  // Incrementa 1 para esta ocorr√™ncia\n  contador[telefone]++;\n\n  // Retorna o item com o novo total\n  return {\n    json: {\n      ...json,\n      mensagens_hoje: contador[telefone],\n    },\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4064,448],"id":"b2708a49-3c3b-43f4-b18c-25be42d25704","name":"Code7"},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 10 * * 1-6"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[928,464],"id":"28919e99-4b65-4acb-adf7-a4ce2698d4ae","name":"Schedule Trigger"},{"parameters":{"method":"POST","url":"https://graph.facebook.com/v22.0/782664311604851/messages","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.telefoneAjustado }}\",\n  \"type\": \"template\",\n  \"template\": {\n    \"name\": \"atualizacao_cliente\",\n    \"language\": {\n      \"code\": \"pt_BR\"\n    },\n    \"components\": [\n      {\n        \"type\": \"header\",\n        \"parameters\": [\n          {\n            \"type\": \"image\",\n            \"image\": {\n              \"link\": \"{{ $json.imagem_url }}\"\n            }\n          }\n        ]\n      },\n      {\n        \"type\": \"body\",\n        \"parameters\": [\n          { \"type\": \"text\", \"text\": \"{{ $json.nome }}\" },\n          { \"type\": \"text\", \"text\": \"{{ $json.param_2 }}\" },\n          { \"type\": \"text\", \"text\": \"{{ $json.param_3 }}\" },\n          { \"type\": \"text\", \"text\": \"{{ $json.param_4 }}\" }\n        ]\n      }\n    ]\n  }\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[5056,448],"id":"19778807-273d-4de2-a757-7cb3045b88d9","name":"HTTP Request","retryOnFail":true,"credentials":{"httpBearerAuth":{"id":"W8jSHgF1bru0lIPY","name":"whatsapp"}}},{"parameters":{"method":"POST","url":"=https://chatwoot.miabuilder.com/api/v1/accounts/8/conversations/{{ $('Vari√°veis do Fluxo').item.json.message.chat_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"api_access_token","value":"wr4beE6ke1EQNaaFqMVJWQmm"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"content","value":"={{ $json['output.mensagens'] }}"},{"name":"message_type","value":"outgoing"},{"name":"private","value":"false"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4848,-48],"id":"4c23c655-e1e6-4e5c-909f-62841db4bad2","name":"HTTP Request3","disabled":true,"onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"dcdb56d1-ac07-4175-b2b8-aec30dec60c5","leftValue":"={{$json.titulo}}","rightValue":"undefined","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1792,464],"id":"7b7d6fea-c775-46dd-ba77-330057e463bf","name":"Verifica se h√° not√≠cia"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2000,560],"id":"22c097dc-6ee7-4f8e-9b80-01e7fd842d6c","name":"No Operation, do nothing1"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA","mode":"list","cachedResultName":"BMS - Controle Journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda_x","displayName":"legenda_x","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"param_2","displayName":"param_2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"param_3","displayName":"param_3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"param_4","displayName":"param_4","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo2_base64","displayName":"arquivo2_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo3_base64","displayName":"arquivo3_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url2","displayName":"imagem_url2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url3","displayName":"imagem_url3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status_WhatsApp","displayName":"status_WhatsApp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"status_X","displayName":"status_X","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[4752,288],"id":"d7f3ec08-865a-490c-9c75-6b91d2478123","name":"Atualiza status do envio no whatsapp","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"f2c98e3a-ba6b-4df7-a0c9-96994c91a690","name":"noticia_id","value":"={{ $('Code3').first().json.noticiaIndex }}","type":"string"},{"id":"a95682ad-ea9c-4d88-a370-0ffad2b3eea5","name":"status_WhatsApp","value":"postado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4576,288],"id":"735ec2bd-d211-40a3-920b-13258ba018b9","name":"Prepara os campos a serem atualizados na planilha"},{"parameters":{"jsCode":"// n8n Code Node: Ordena e seleciona a mais recente das N√ÉO ENVIADAS\nconst items = $input.all();\n\nconst parseBR = (s) => {\n  if (!s) return null;\n  const parts = s.split(/[\\/\\s:]+/);\n  if (parts.length < 3) return null;\n  const [dd, mm, yyyy] = parts.map(p => parseInt(p, 10));\n  return new Date(yyyy, mm - 1, dd); // cria data no fuso local\n};\n\nif (items.length === 0) return [];\n\nconst sortedItems = items.sort((a, b) => {\n  const dateA = parseBR(a.json.data_processamento) || new Date(0);\n  const dateB = parseBR(b.json.data_processamento) || new Date(0);\n\n  const diff = dateB - dateA;\n  if (diff !== 0) return diff;\n\n  return (b.json.row_number || 0) - (a.json.row_number || 0);\n});\n\n// Para depurar a ordem\nconsole.log(sortedItems.map(i => ({\n  data: i.json.data_processamento,\n  titulo: i.json.titulo\n})));\n\n// Retorna a mais recente\nreturn [{ json: sortedItems[0].json }];\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1472,464],"id":"1c8757a1-043c-4750-8920-f04beb49ecb5","name":"Encontra a Pr√≥xima Not√≠cia V√°lida"}],"connections":{"Search files and folders":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Download file":{"main":[[{"node":"Code3","type":"main","index":0},{"node":"Get row(s) in sheet1","type":"main","index":0}]]},"Code3":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"Prepara os campos a serem atualizados na planilha","type":"main","index":0}],[{"node":"If","type":"main","index":0}]]},"Wait":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Envio do post - Journal List":{"main":[[{"node":"Cria Mensagem no Supabase1","type":"main","index":0}],[{"node":"Cria Mensagem no Supabase1","type":"main","index":0}]]},"Get row(s) in sheet1":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Code4":{"main":[[{"node":"Get many rows","type":"main","index":0},{"node":"Merge2","type":"main","index":1}]]},"base_noticias":{"main":[[{"node":"Encontra a Pr√≥xima Not√≠cia V√°lida","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Code4","type":"main","index":0}]]},"Get many rows":{"main":[[{"node":"Code5","type":"main","index":0}]]},"If":{"main":[[{"node":"Wait","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"Cria Mensagem no Supabase1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Code5":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Code7","type":"main","index":0}]]},"Code7":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"base_noticias","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Envio do post - Journal List","type":"main","index":0}]]},"HTTP Request3":{"main":[[],[]]},"Verifica se h√° not√≠cia":{"main":[[{"node":"Search files and folders","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Atualiza status do envio no whatsapp":{"main":[[]]},"Prepara os campos a serem atualizados na planilha":{"main":[[{"node":"Atualiza status do envio no whatsapp","type":"main","index":0}]]},"Encontra a Pr√≥xima Not√≠cia V√°lida":{"main":[[{"node":"Verifica se h√° not√≠cia","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"GbORhS24Rzw7hHlt"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA","sheetId":0,"lastRevision":823,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1hqVrO3gl7qnmgBRDNh20zB_VJm7aGigjuJS4rN3S2yA&revision=823&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger":[{"json":{"timestamp":"2025-11-04T10:00:00.031-03:00","Readable date":"November 4th 2025, 10:00:00 am","Readable time":"10:00:00 am","Day of week":"Tuesday","Year":"2025","Month":"November","Day of month":"04","Hour":"10","Minute":"00","Second":"00","Timezone":"America/Sao_Paulo (UTC-03:00)"}}]},"versionId":"17c63f49-5e70-48b5-a430-8fcb3a0da8b0","triggerCount":1,"tags":[]}