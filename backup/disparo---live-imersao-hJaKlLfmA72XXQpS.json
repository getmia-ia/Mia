{"createdAt":"2025-10-30T19:28:48.222Z","updatedAt":"2025-11-03T22:05:10.869Z","id":"hJaKlLfmA72XXQpS","name":"Disparo - Live Imersao","active":false,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"https://graph.facebook.com/v22.0/869722152886578/messages","authentication":"genericCredentialType","genericAuthType":"httpBearerAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.telefoneAjustado }}\",\n  \"type\": \"template\",\n  \"template\": {\n    \"name\": \"anuncio_live\",\n    \"language\": {\n      \"code\": \"pt_BR\"\n    }\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[912,-48],"id":"5b5c25a9-10bb-41b8-98c2-f64a87dbf78f","name":"HTTP Request","retryOnFail":true,"credentials":{"httpBearerAuth":{"id":"W8jSHgF1bru0lIPY","name":"whatsapp"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-304,-64],"id":"dcb12c93-71de-4f10-910b-faa65d4d9689","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"assignments":{"assignments":[{"id":"26565e15-c62b-4b84-b815-8a1daee1aebd","name":"image_url","value":"https://raw.githubusercontent.com/getmia-ia/finamob/main/WhatsApp%20Image%202025-10-30%20at%2012.54.30.jpeg","type":"string"},{"id":"c8e5eb01-974e-428f-8c63-61eeb5fcb3d7","name":"telefoneAjustado","value":"5511992486507","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-80,-256],"id":"cfbe2bd8-34ba-4187-8ba9-522e9e343134","name":"Edit Fields"},{"parameters":{"documentId":{"__rl":true,"value":"1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s","mode":"list","cachedResultName":"base_disparo_live","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"disparo","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-80,-64],"id":"3188b9ed-419d-45fa-a910-87819dbf29a6","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"const imagem_url = \"https://raw.githubusercontent.com/getmia-ia/finamob/main/WhatsApp%20Image%202025-10-30%20at%2012.54.30.jpeg\";\n\nreturn items.map(item => {\n  // pega do campo correto e for√ßa string\n  const bruto = item.json.Contato != null ? String(item.json.Contato) \n             : item.json.telefone != null ? String(item.json.telefone)\n             : \"\";\n\n  // mant√©m s√≥ d√≠gitos\n  let numero = bruto.replace(/\\D/g, \"\");\n\n  // normaliza√ß√£o Brasil\n  // j√° vem com 55? mant√©m\n  if (numero.startsWith(\"55\")) {\n    // remove zeros extras ap√≥s 55 (casos tipo 55011...)\n    numero = \"55\" + numero.slice(2).replace(/^0+/, \"\");\n  } else {\n    // adiciona 55\n    numero = \"55\" + numero.replace(/^0+/, \"\");\n  }\n\n  return {\n    json: {\n      ...item.json,\n      telefoneAjustado: numero,\n      imagem_url,\n    },\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[144,-64],"id":"9bf6342f-9284-4429-b258-01f9c661257e","name":"Code"},{"parameters":{"batchSize":"=1","options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[400,-64],"id":"538fa0f2-7801-470d-8a7d-7ffa0df1bbad","name":"Loop Over Items1"},{"parameters":{"amount":"=1"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[688,-48],"id":"c7b0c575-1fe7-41f2-bab7-76c9d196a826","name":"Wait","webhookId":"dce9f589-31c7-4599-98e3-e02f77da5852"},{"parameters":{"tableId":"finamob-historico_mensagens","fieldsUi":{"fieldValues":[{"fieldId":"mensagem_usuario","fieldValue":"="},{"fieldId":"mensagem_agente","fieldValue":"=üü¢ Ao Vivo Agora √†s 20h\n\nüí∞ Onde est√° o dinheiro do mercado imobili√°rio?\n\nVoc√™ vai ver isso agora com quem √© especialista em financiamento de incorpora√ß√£o imobili√°ria.\n\nSe voc√™ √© incorporador ou loteador, essa live √© para voc√™.\n\nDe gra√ßa, agora, no Zoom.\nüëá Clique e acesse a sala fechada\n\nhttps://pxllnk.co/o-dinheiro-da-incorporacao\nSe quiser que o link seja clic√°vel salve o meu contato"},{"fieldId":"telefone","fieldValue":"={{ $('Wait').item.json.telefoneAjustado }}"},{"fieldId":"nome_usuario","fieldValue":"={{ $('Wait').item.json.Nome }}"},{"fieldId":"message_type","fieldValue":"text"},{"fieldId":"ativo","fieldValue":"true"},{"fieldId":"nome_app","fieldValue":"SDR-MURILO"},{"fieldId":"id_usuario","fieldValue":"={{ $('Wait').item.json.telefoneAjustado }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1440,64],"id":"0625a009-de7b-4387-bad7-72a66d910490","name":"Cria Mensagem no Supabase1","credentials":{"supabaseApi":{"id":"4MbqyW9T081a3o7d","name":"Finamob"}},"onError":"continueRegularOutput","notes":"Este fluxo √© de propriedade da FORMA√á√ÉO AGENTES DE IA COM N8N -BY RICNEVES"},{"parameters":{"resource":"messages-api","instanceName":"finamob-sdr-diogo","remoteJid":"=5511992486507","messageText":"=Mensagem para: {{ $('Wait').item.json.Nome  }} - {{ $('Wait').item.json.telefoneAjustado }}\n\nTitulo: anuncio_live","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1168,-48],"id":"455d5379-8201-4762-bc9a-602927484944","name":"Envio do post - Journal List","credentials":{"evolutionApi":{"id":"j82pkEtO22SNtgh3","name":"finamob-sdr-diogo"}},"onError":"continueErrorOutput"},{"parameters":{"documentId":{"__rl":true,"value":"1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s","mode":"list","cachedResultName":"base_disparo_live","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"disparo","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-32,-512],"id":"1d99e214-d7fb-49a6-82d1-f624ade29c74","name":"Get row(s) in sheet1","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"// Normaliza n√∫mero de telefone para formato E.164 (Brasil)\nfunction ajustarTelefone(raw) {\n  if (!raw) return \"\";\n\n  // Remove tudo que n√£o for n√∫mero\n  let num = raw.toString().replace(/\\D/g, \"\");\n\n  // Remove zeros √† esquerda\n  num = num.replace(/^0+/, \"\");\n\n  // Se j√° come√ßar com 55 e tiver tamanho 12 ou 13 ‚Üí OK\n  if (num.startsWith(\"55\") && (num.length === 12 || num.length === 13)) {\n    return num;\n  }\n\n  // Se tiver 11 d√≠gitos (ex: 11987654321) ‚Üí adiciona 55\n  if (num.length === 11) {\n    return \"55\" + num;\n  }\n\n  // Se tiver 10 d√≠gitos (ex: 1187654321) ‚Üí adiciona 55\n  if (num.length === 10) {\n    return \"55\" + num;\n  }\n\n  // Se for 9 d√≠gitos (sem DDD) ‚Üí inv√°lido\n  if (num.length < 10) {\n    return \"\";\n  }\n\n  // Se sobrar algo diferente ‚Üí retorna vazio\n  return \"\";\n}\n\n// Executa para cada item\nreturn items.map(item => {\n  const contato = item.json[\"Contato\"];\n  const telefoneAjustado = ajustarTelefone(contato);\n\n  return {\n    json: {\n      ...item.json,\n      \"Telefone Ajustado\": telefoneAjustado\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-512],"id":"a75894f6-0f87-46e4-a92c-e683717ca3e5","name":"Code1"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s","mode":"list","cachedResultName":"base_disparo_live","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"disparo","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Bb8sXotwsr9mTkVQ-BAMcQsmCwncKhMAYw11UcQlq7s/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"row_number":"={{ $json.row_number }}","Contato2":"={{ $json['Telefone Ajustado'] }}"},"matchingColumns":["row_number"],"schema":[{"id":"Nome","displayName":"Nome","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Contato","displayName":"Contato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Contato2","displayName":"Contato2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[384,-512],"id":"3cb732ff-483b-41ac-a042-529361bacfac","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}}],"connections":{"HTTP Request":{"main":[[{"node":"Envio do post - Journal List","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Get row(s) in sheet":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Envio do post - Journal List":{"main":[[{"node":"Cria Mensagem no Supabase1","type":"main","index":0}],[{"node":"Cria Mensagem no Supabase1","type":"main","index":0}]]},"Cria Mensagem no Supabase1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Get row(s) in sheet1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"29dc820f-b471-480e-b3c1-64e2732447c5","triggerCount":0,"tags":[]}