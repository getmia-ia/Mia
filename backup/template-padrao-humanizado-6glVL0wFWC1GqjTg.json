{"createdAt":"2025-08-18T17:02:28.306Z","updatedAt":"2025-10-06T18:35:07.025Z","id":"6glVL0wFWC1GqjTg","name":"Template Padrao Humanizado","active":false,"isArchived":true,"nodes":[{"parameters":{"content":"## Entrada Evo API","height":540,"width":340,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-928,880],"id":"96124305-50ea-4798-8104-5d252fa95571","name":"Sticky Note2"},{"parameters":{"content":"## Variáveis do Fluxo\nSetas as configurações do fluxo","height":540,"width":340,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-560,880],"id":"9b516549-d792-452e-87c5-ddd0cc12ea2f","name":"Sticky Note3"},{"parameters":{"content":"## Gestão de Fluxo Agente Desativado (Humano em Atendimento)\nGestão do fluxo para atendimento humano\n","height":540,"width":900,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-208,880],"id":"39bbbe03-99d5-49e1-8799-30c2f9b6bef6","name":"Sticky Note6"},{"parameters":{"content":"## Identifica o Tipo de Mensagem\nO que for enviado para o WhatsApp é convertido em prompt para o agente como: texto, áudio, imagem, documentos, etc..","height":1220,"width":1020,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[832,544],"id":"c1daa460-41a8-41df-8321-7cf84b50994c","name":"Sticky Note8"},{"parameters":{"content":"## Armazenamento Temporário em Memória das Mensagens enviadas pelo WhatsApp\nJunta todas as mensagens enviadas antes de enviar para o Agente - Mensagens no formato PICOTADO","height":1240,"width":1440,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1872,544],"id":"44b4e4a5-a20c-47ce-865c-4d281fb71808","name":"Sticky Note9"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usuário para o agente limpando caracteres especiais","height":540,"width":560,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3360,944],"id":"10c81fc8-dbdb-4397-bb04-f602010bdb78","name":"Sticky Note10"},{"parameters":{"content":"## Agente de IA\nAgente inteligente com memória e prompt pré formatado","height":560,"width":880,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4064,912],"id":"3a288421-d9fa-464b-a8b8-54b9533ea84b","name":"Sticky Note11"},{"parameters":{"content":"## Componentes Humanizador de Resposta\nQuebra de mensagens em mensagens menores e com contexto.","height":660,"width":920,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4992,992],"id":"50271ea3-6709-4ea0-8cfc-d7f4e08116da","name":"Sticky Note12"},{"parameters":{"content":"## Envio das Respostas ao Usuário\nEnvio das mensagens quebradas para o usuário","height":500,"width":900,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[6048,960],"id":"1e479864-fa49-4de1-be71-c53b13c2e3f4","name":"Sticky Note13"},{"parameters":{"content":"","height":2660,"width":8080,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1008,48],"id":"377353d5-6c1b-4bbb-b7df-dc8582bfe169","name":"Sticky Note14"},{"parameters":{"content":"Ajuste as infos abaixo\n","height":280,"width":190,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-480,1024],"id":"0e22e193-006e-46e4-9d72-319274b80abb","name":"Sticky Note18"},{"parameters":{"content":"Faça os ajustes necessários no Prompt do seu agente","height":220,"width":330,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4208,1040],"id":"95d16343-1f18-4fda-9a25-f22a9c33b42f","name":"Sticky Note21"},{"parameters":{"content":"████████░▄█████░▄██▄▄██▄░█████▄░██░░░░░▄████▄░████████░▄█████░░░█████▄░▄████▄░██████▄░█████▄░▄████▄░▄█████▄░░░██░░░██░██░░░██░▄██▄▄██▄░▄████▄░██████▄░██████░███████░▄████▄░██████▄░▄█████▄░░░█████▄░▄████▄░█████▄░▄████▄░░░▄█████░██░░░██░▄█████▄░██░░░░░██░░░██░████████░██████░▄█████▄░██████▄░░░▄████▄░█████▄░██████░░░▄██░▄██████░█████▄░▄████▄░████████░██░░░██░██████░████████░▄████▄░░░██████▄░▄████▄░▄█████▄░░░▄█████▄░██████░██████░▄█████░██████░▄████▄░██░░░░░░░██░██░██░██░░░██░▄████▄░████████░▄██████░▄████▄░█████▄░█████▄░██▄░░░░░░░░░░░░█████▄░██░░██░░░█████▄░██████░▄█████░██████▄░▄█████░██░░░██░▄█████░▄██████\n░░░██░░░░██░░░░░██░██░██░██░░██░██░░░░░██░░██░░░░██░░░░██░░░░░░░██░░██░██░░██░██░░░██░██░░██░██░░██░██░░░██░░░██░░░██░██░░░██░██░██░██░██░░██░██░░░██░░░██░░░░░░░░██░██░░██░██░░░██░██░░░██░░░██░░██░██░░██░██░░██░██░░██░░░██░░░░░██░░░██░██░░░██░██░░░░░██░░░██░░░░██░░░░░░██░░░██░░░██░██░░░██░░░██░░██░██░░██░░░██░░░░░██░░██░░░░░░██░░██░██░░██░░░░██░░░░██░░░██░░░██░░░░░░██░░░░██░░██░░░██░░░██░██░░██░██░░░██░░░██░░░██░██░░░░░░░██░░░██░░░░░░░██░░░██░░██░██░░░░░░░██░██░██░██░░░██░██░░██░░░░██░░░░██░░░░░░██░░██░██░░██░██░░██░░██░░░░░░░░░░░░██░░██░██░░██░░░██░░██░░░██░░░██░░░░░██░░░██░██░░░░░██░░░██░██░░░░░██░░░░░\n░░░██░░░░█████░░██░██░██░█████▀░██░░░░░██░░██░░░░██░░░░█████░░░░█████▀░██░░██░██░░░██░█████▀░██░░██░██░░░██░░░███████░██░░░██░██░██░██░██░░██░██░░░██░░░██░░░▄█████▀░██░░██░██░░░██░██░░░██░░░█████▀░██░░██░█████▀░██░░██░░░█████░░██░░░██░██░░░██░██░░░░░██░░░██░░░░██░░░░░░██░░░██░░░██░██░░░██░░░██░░██░█████▀░░░██░░░░░██░░██░░███░█████▀░██░░██░░░░██░░░░██░░░██░░░██░░░░░░██░░░░██░░██░░░██░░░██░██░░██░██░░░██░░░██░░░██░█████░░░░██░░░██░░░░░░░██░░░██░░██░██░░░░░░░██░██░██░███████░██░░██░░░░██░░░░▀█████▄░██░░██░█████▀░█████▀░░██░░░░░░░░░░░░█████░░▀████▀░░░█████▀░░░██░░░██░░░░░██░░░██░█████░░██░░░██░█████░░▀█████▄\n░░░██░░░░██░░░░░██░██░██░██░░░░░██░░░░░██████░░░░██░░░░██░░░░░░░██░░░░░██████░██░░░██░██░░██░██████░██░░░██░░░██░░░██░██░░░██░██░██░██░██████░██░░░██░░░██░░░██░░░░░░██████░██░░░██░██░░░██░░░██░░░░░██████░██░░██░██████░░░██░░░░░██░░██░░██░░░██░██░░░░░██░░░██░░░░██░░░░░░██░░░██░░░██░██░░░██░░░██████░██░░░░░░░██░░░░░██░░██░░░██░██░░██░██████░░░░██░░░░██░░░██░░░██░░░░░░██░░░░██████░░░██░░░██░██████░██░░░██░░░██░░░██░██░░░░░░░██░░░██░░░░░░░██░░░██████░██░░░░░░░██░██░██░██░░░██░██████░░░░██░░░░░░░░░██░██████░██░░░░░██░░░░░░██░░░██████░░░██░░██░░░██░░░░░██░░██░░░██░░░██░░░░░██░░░██░██░░░░░██░░██░░██░░░░░░░░░░██\n░░░██░░░░▀█████░██░██░██░██░░░░░██████░██░░██░░░░██░░░░▀█████░░░██░░░░░██░░██░██████▀░██░░██░██░░██░▀█████▀░░░██░░░██░▀█████▀░██░██░██░██░░██░██░░░██░██████░███████░██░░██░██████▀░▀█████▀░░░██░░░░░██░░██░██░░██░██░░██░░░▀█████░▀███▀░░░▀█████▀░██████░▀█████▀░░░░██░░░░██████░▀█████▀░██░░░██░░░██░░██░██░░░░░██████░░░▀██░▀█████▀░██░░██░██░░██░░░░██░░░░▀█████▀░██████░░░░██░░░░██░░██░░░██░░░██░██░░██░▀█████▀░░░▀█████▀░██░░░░░██████░▀█████░██████░██░░██░██████░░░▀██▀▀██▀░██░░░██░██░░██░░░░██░░░░██████▀░██░░██░██░░░░░██░░░░░██▀░░░░░░░░░░░░█████▀░░░██░░░░░██░░██░██████░▀█████░██░░░██░▀█████░▀███▀░░░▀█████░██████▀\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░","width":6100},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"d1867d20-c12d-4fdf-9a53-b72866250432","name":"Sticky Note"},{"parameters":{"httpMethod":"POST","path":"coloque-aqui-seu-path","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-816,1120],"id":"afbfba7c-4c83-4193-bb1f-8e8800a23def","name":"Webhook Evo","webhookId":"9e8914c2-44b6-4d3c-acf0-58c5ef11bb97","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"content":"Renomei o path e atualize no seu Manager da Evo","height":280,"width":190,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-864,1024],"id":"ddf8ebc0-9f14-4bc0-a993-f43dd68641d6","name":"Sticky Note20"},{"parameters":{"operation":"get","propertyName":"AgenteStatus","key":"={{ $('Variáveis do Fluxo').item.json.IdAgente }}_status_{{ $('Variáveis do Fluxo').item.json.IdConversa }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-128,1120],"id":"cea2ab5b-a275-44b4-b0fa-932244e21427","name":"Busca Memória da Conversa","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"756ab323-31a2-4a59-92e8-c2c695027962","leftValue":"={{ $json.AgenteStatus }}","rightValue":"Desativado","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[144,1120],"id":"6c72ef11-d179-45df-9d3c-4f9c090cc8ed","name":"Valida se Bot Esta Ativo","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[384,992],"id":"2db8f814-2e1b-4b13-8854-ee85319e0a46","name":"Não faz nada se estiver inativo","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"bc64f125-d93c-4d1d-97ae-65c0adb08b79","leftValue":"={{ $('Webhook Evo').item.json.body.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"f7053057-3e82-49ad-a2bf-07bafc958f06","leftValue":"={{ $('Webhook Evo').item.json.body.data.messageType }}","rightValue":"extendedTextMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"137aec3f-e95e-4d59-b9ba-1140f9fc4fb4","leftValue":"={{ $('Webhook Evo').item.json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Webhook Evo').item.json.body.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals"},"id":"40b284c8-fdf7-49e5-9ac3-8c5051f51521"}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"7babc8fd-200c-4cb8-bc63-f999f57d5217","leftValue":"={{ $('Webhook Evo').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.mimetype }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Documento"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"Outro"}},"id":"0329cbfb-a9e8-4128-80ea-939796eab507","name":"Identifica o Tipo de Mensagem","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[944,1088],"notesInFlow":true,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook Evo').item.json.body.data.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1168,752],"id":"8d53e5d9-a697-4d47-8a74-785f614cd0f6","name":"Mensagem de Texto","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook Evo').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1168,912],"id":"db60b869-51ad-4b3c-86a5-4af1573bdada","name":"Mensagem Extendida de Texto","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Audio","value":"={{ $('Webhook Evo').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1168,1072],"id":"cd626984-dd6c-4540-af56-36dff954fa71","name":"Mensagem de Audio","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Imagem","value":"={{ $('Webhook Evo').item.json.body.data.message.base64 }}","type":"string"},{"id":"f5c70ab5-7671-4bc8-9d23-65b8954ddb08","name":"MensagemImagem","value":"={{ $('Webhook Evo').item.json.body.data.message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1168,1232],"id":"51ac7997-292a-4704-9a7f-bd06a975842a","name":"Mensagem com Imagem","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"11dc126a-e72e-431b-8db5-c78168c69439","name":"Erro","value":"<ErroFormatoMensagem>","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1168,1568],"id":"3dd7e703-a6d8-4e07-a59e-c3921d90a43f","name":"Mensagem de Erro  - Formato não suportado","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"toBinary","sourceProperty":"Audio","options":{"mimeType":"audio/mp4"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[1424,1024],"id":"be4951b5-8c59-48a9-a9b6-20518e479091","name":"Converte Audio base64 para File","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"toBinary","sourceProperty":"Imagem","options":{"mimeType":"image/png"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[1424,1200],"id":"d32b24b3-2a57-4e23-98e1-2295abf22416","name":"Converte Imagem Base64 para File","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{"language":"pt"}},"id":"d223a1eb-9139-4ad8-9dc9-415aabed9fdd","name":"Transcreve Audio com OpenAI","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[1648,1024],"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"toBinary","sourceProperty":"Documento","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[1424,1392],"id":"a26545cb-93d4-4f68-8daf-67748514edf7","name":"Convert Documento base64 para Arquivo","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Documento","value":"={{ $('Webhook Evo').item.json.body.data.message.base64 }}","type":"string"},{"id":"003323ec-ffbe-4c91-b8b5-623466b5014d","name":"MensagemDocumento","value":"={{ $('Webhook Evo').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1168,1392],"id":"3661bccc-956f-404b-a814-08f963b74980","name":"Mensagem com Documento","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[1648,1392],"id":"725c91a6-11d4-4af3-9966-5b471e6b1a24","name":"Extrai Dados do PDF","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"push","list":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","messageData":"={{ $json.Texto }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1952,768],"id":"34e0596f-9080-4dc1-8382-53849a7edcf2","name":"Adiciona Texto na Memoria","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"3bdce7b6-d0f1-442c-aafd-8cd123aa21b6","name":"EsperaMemoria","value":15,"type":"number"},{"id":"c38e8985-4494-40a4-878e-f25467849842","name":"TempoInatividadeAgente","value":900,"type":"number"},{"id":"ac619a5e-1438-4e19-aaf5-21dfcbc32312","name":"ModeloTemperatura","value":0.4,"type":"number"},{"id":"5c22f7c5-4e37-47af-accc-ba14384d10df","name":"IdConversa","value":"={{ $('Webhook Evo').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"757c2490-27f7-4455-9d77-606467494060","name":"nomeDoLead","value":"={{ $('Webhook Evo').item.json.body.data.pushName }}","type":"string"},{"id":"e385b427-fb2e-4265-933d-9caea711f9f6","name":"instanciaEvo","value":"={{ $json.body.instance }}","type":"string"},{"id":"afd5cc73-f530-4a01-9ba9-8506f4e9cd1c","name":"apiKeyEvo","value":"={{ $json.body.apikey }}","type":"string"},{"id":"b3ad89d3-2443-40a8-b5da-814d7c7fda09","name":"serverURLEvo","value":"={{ $json.body.server_url }}","type":"string"},{"id":"fccbd453-64f1-4f0e-9ec9-74ca35ba213e","name":"usarElevenLabs","value":false,"type":"boolean"},{"id":"e2a0bc97-b106-4ec0-95f1-061c742bd409","name":"voiceIdElevenLabs","value":"coloque-aqui-seu-id","type":"string"},{"id":"71881795-07a1-46da-9ace-431c28d229d6","name":"apiKeyElevenLabs","value":"coloque-aqui-sua-apikey","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-448,1120],"id":"57ea12fe-e603-45d9-9e6b-2b2a390e8765","name":"Variáveis do Fluxo","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=#Instruções\nO usuário te enviou uma imagem a qual você deve descrever.\n\nA imagem pode vir acompanhada de uma mensagem de texto (<MensagemUsuario>)\n\nCaso venha, utilize a mensagem anexa como contexto extra, tente capturar o sentimento da mensagem e objetivo pelo qual o usuário esteja enviando esta imagem na conversa.\n\nCrie uma resposta descrevendo as informações enviadas para que estas sejam utilizadas por um agente no futuro.\n\nImportante:\nEste agente apenas terá as informações que você fornecer, portanto repasse toda informação que julgar importante.\n\nInterprete tudo que estiver na imagem, texto, pessoas, objetivos e etc\n\n\n#Dados\n<MensagemUsuario>\n{{ $json.MensagemImagem }}\n</MensagemUsuario>\n","inputType":"base64","options":{}},"id":"78c10153-dd3b-4e74-a6f4-c74cc54e7a90","name":"Traduz Imagem em Texto","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[1648,1200],"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"push","list":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","messageData":"={{ $json.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1952,960],"id":"f8143602-cadc-47d9-86f0-558d217e46b2","name":"Adiciona Audio Na Memória","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"push","list":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","messageData":"=<ContextoImagem>\n\n  <DetalheImagem>\n{{ $json.content }}\n  </DetalheImagem>\n\nContexto Extra: O usuário encaminhou a mensagem a seguir junto á imagem.\n  <MensagemUsuario>\n{{ $('Mensagem com Imagem').item.json.MensagemImagem }}\n  </MensagemUsuario>\n\n</ContextoImagem>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1952,1200],"id":"eb8b62de-01da-40af-bd1b-f00df4dbe776","name":"Adiciona Imagem na Memória","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"push","list":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","messageData":"=<ContextoPDF>\n  <TranscricaoPDF>\n{{ $json.text }}\n  </TranscricaoPDF>\nContexto Extra: O usuário encaminhou a mensagem a seguir junto ao PDF.\n  <MensagemUsuario>\n{{ $('Mensagem com Documento').item.json.MensagemDocumento }}\n  </MensagemUsuario>\n</ContextoPDF>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1952,1408],"id":"95f03e37-7e8b-466c-afa6-c542fa65bee5","name":"Adiciona Documento na Memória","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"push","list":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","messageData":"={{ $json.Erro }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1952,1584],"id":"9de898f8-53bd-4b2d-a9a1-c2a1912e5c2d","name":"Adiciona Erro na Memória","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2224,1168],"id":"37840e37-9257-4861-9e32-e3a24de10ce8","name":"Memória Temporária","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"amount":"={{ $('Variáveis do Fluxo').item.json.EsperaMemoria }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2448,1168],"id":"0f024c2f-713a-4728-bcc9-3786c437dd08","name":"Espera Tempo Definido","webhookId":"169ea291-c3dc-4bca-854f-05520c979d7d","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2672,1168],"id":"1fe1a424-c8ff-41d9-ad29-469131775aad","name":"Busca mensagens da Memória","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1bd6c365-d077-4284-9dfe-94db1cbe39bd","leftValue":"={{ $('Busca mensagens da Memória').item.json.messages.last() }}","rightValue":"={{ $('Memória Temporária').item.json.messages.last() }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2880,1168],"id":"08dd1dc8-1156-41db-b425-342a915a67a6","name":"Verifica se houve troca de mensagem","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3104,1264],"id":"9247e7d9-33de-498e-a9c6-e8f2678dc1b1","name":"Se houve não faz nada e aguarda vir a nova mensagem"},{"parameters":{"operation":"delete","key":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_mem"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[3104,1072],"id":"aeafcf93-4cc2-455b-a248-dd85f12fe305","name":"Limpa a Memória Temporária"},{"parameters":{"assignments":{"assignments":[{"id":"66a91f66-e755-4120-b22f-44c814f56162","name":"message","value":"={{ $('Limpa a Memória Temporária').item.json.messages.join('\\n\\n') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3472,1120],"id":"8356e2b0-8c26-4912-9a95-b595f7d61805","name":"Seta Mensagem para o Agente"},{"parameters":{"jsCode":"function limparMensagem(texto) {\n  if (typeof texto !== 'string') {\n    return '';\n  }\n\n  // Função para remover metadados e dados técnicos\n  function removerMetadataTecnico(str) {\n    return str\n      // Remove objetos e chaves de metadados específicos\n      .replace(/\"response_metadata\"\\s*:\\s*{[^}]*}/g, '')  // Remove \"response_metadata\"\n      .replace(/\"additional_kwargs\"\\s*:\\s*{[^}]*}/g, '')  // Remove \"additional_kwargs\"\n      .replace(/\"tool_calls\"\\s*:\\s*\\[\\s*\\]/g, '')  // Remove \"tool_calls\" vazio\n      .replace(/\"invalid_tool_calls\"\\s*:\\s*\\[\\s*\\]/g, '')  // Remove \"invalid_tool_calls\" vazio\n      .replace(/\"type\"\\s*:\\s*\"(ai|human)\"/g, '')  // Remove os tipos \"ai\" e \"human\"\n      .replace(/\"data\"\\s*:\\s*{[^}]*}/g, '')  // Remove a chave \"data\"\n      // Remove objetos JSON em excesso ou vazios\n      .replace(/,\\s*{[^}]*}/g, '') // Remove objetos soltos\n      .replace(/,\\s*\\[\\s*\\]/g, '') // Remove arrays vazios\n      .replace(/\\s*:\\s*null/g, '') // Remove valores null\n      .replace(/\\s*:\\s*\\[\\]/g, '') // Remove arrays vazios\n      .replace(/\\s*:\\s*{}/g, '') // Remove objetos vazios\n      // Ajusta espaços desnecessários\n      .replace(/\\s+/g, ' ')\n      .replace(/^\\s+|\\s+$/g, '');  // Remove espaços no início e fim\n  }\n\n  // Função para limpar caracteres especiais\n  function limparCaracteresEspeciais(str) {\n    return str\n      .replace(/\\\\\\\\[rnt]/g, ' ')  // Limpa sequências de escape\n      .replace(/\\\\\\\\\\\"/g, '')  // Remove as aspas escapadas\n      .replace(/\\\\\\\\\\\\\\\\/g, '')  // Remove barras invertidas\n      .replace(/[\\x00-\\x1F\\x7F-\\x9F]/g, '')  // Remove caracteres de controle\n      .replace(/\\\"+/g, '')  // Remove aspas extras\n      .replace(/[{}[\\]]/g, '')  // Remove chaves e colchetes extras\n      .trim();\n  }\n\n  // Função para extrair e limpar a mensagem principal\n  function extrairMensagemPrincipal(str) {\n    // Divide em frases, removendo pontuação extra\n    const frases = str.split(/(?<=[.!?])\\s+/);\n\n    return frases\n      .map(frase => frase.trim())\n      .filter(frase => {\n        // Remove frases que ainda têm metadados ou são irrelevantes\n        return frase.length > 0 &&\n          !frase.includes('tool_calls') &&\n          !frase.includes('invalid_tool_calls') &&\n          !frase.match(/^[:\\s\\[\\]{}]+$/);\n      })\n      .join(' ');\n  }\n\n  // Processo de limpeza e extração\n  let resultado = texto;\n\n  // Passo 1: Remove metadados e chaves indesejadas\n  resultado = removerMetadataTecnico(resultado);\n\n  // Passo 2: Extrai a mensagem relevante, ignorando o que não é necessário\n  resultado = extrairMensagemPrincipal(resultado);\n\n  // Passo 3: Remove caracteres especiais e formatação indesejada\n  resultado = limparCaracteresEspeciais(resultado);\n\n  // Limpeza final para remover espaços extras\n  resultado = resultado\n    .replace(/\\s+/g, ' ')\n    .replace(/^[\\\",\\s]+|[\\\",\\s]+$/g, '')\n    .trim();\n\n  return resultado;\n}\n\nfunction processarMensagens(items) {\n  return items.map(item => {\n    try {\n      if (!item?.json?.mensagem) {\n        return item;\n      }\n\n      let mensagem = item.json.mensagem;\n\n      // Se for objeto, converte para string\n      if (typeof mensagem === 'object') {\n        try {\n          mensagem = JSON.stringify(mensagem);\n        } catch (e) {\n          console.error('Erro ao converter objeto para string:', e);\n          return item;\n        }\n      }\n\n      // Aplica a limpeza\n      const mensagemLimpa = limparMensagem(mensagem);\n\n      // Atualiza apenas se houver conteúdo significativo\n      if (mensagemLimpa && mensagemLimpa.length > 0) {\n        item.json.mensagem = mensagemLimpa;\n      }\n\n      return { json: item.json };\n    } catch (error) {\n      console.error('Erro ao processar item:', error);\n      return item;\n    }\n  });\n}\n\n// Execução principal\ntry {\n  const items = $input.all();\n  return processarMensagens(items);\n} catch (error) {\n  console.error('Erro na execução:', error);\n  throw error;\n}\n"},"id":"807f8c6b-fc60-4265-b985-9d558ced1b4d","name":"Remove metadados e simbolos","type":"n8n-nodes-base.code","typeVersion":2,"position":[3744,1152]},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[3744,1744],"id":"221d869f-9d77-4032-b823-d0c9a2acadc5","name":"OpenRouter Chat Model","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"descriptionType":"manual","toolDescription":"Essa tool desativa o seu atendimento e passa a conversa para o atendente humano. Após a desativação, você não poderá mais falar com o atentende.\n\nApenas fale sobre a possibilidade de um atendimento humano caso seja explicitamente requisitado esse tipo de atendimento, ou caso o clima da conversa com o usuário ficar muito negativo.\n\nAntes de desativar, reforce para o cliente sobre quais assuntos você pode ajuda-lo e confirme se mesmo assim ele deseja seguir com atendimento humano.\n\nSempre solicite uma dupla confirmação do usuário antes de desativar o seu atendimento.\n\n# Resposta após desativação:\nResponda ao usuário que a conversa foi encaminhada para um atendente especializado que logo irá entrar em contato e dará seguimento ao atendimento.","operation":"set","key":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}_status","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Value', `Definir como \"Ativo\" ou \"Desativado\"\n\nSempre manter ativo, \nDesativar apenas após dupla confirmação explicita do usuário.`, 'string') }}","expire":true,"ttl":"={{ $('Variáveis do Fluxo').item.json.TempoInatividadeAgente }}"},"type":"n8n-nodes-base.redisTool","typeVersion":1,"position":[4400,1760],"id":"516d0473-5943-49b1-82e2-537181738207","name":"Desativar Agente","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}","contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[3904,1744],"id":"4f804931-2182-42ef-911a-7fc80af55e8d","name":"Memória do Chat","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n{{ $json.texto }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Apenas estruture a <mensagem_do_usuario> no formato JSON solicitado no output parser e seguindo as instruções de formatação abaixo. Não altere nada mais na mensagem\n\n# Formatação\n- Divida as mensagens para que fiquem naturais e humanizadas;\n- Divida as mensagens conforme estrutura do output parser para que não fiquem muito longas (maiores que 240 caractéres);\n- Não separe mensagens vazias;\n- Use quebras de linhas (\\n\\n) após pontos finais;\n- Para negrito (bold) use apenas um '' nunca duas '' (exemplo: *negrito).\n\nExemplo de formato JSON:\n{\n\"mensagens\": [\"Mensagem 0\", \"Mensagem 1\", \"Mensagem 2\"]\n}"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[5152,1120],"id":"ed2adc0a-053a-4c6b-b7cb-e2deb00e6ec8","name":"Estrutura da Mensagem de Retorno","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"mensagens\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"mensagens\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[5440,1472],"id":"d7074094-2850-45a5-9939-2a4ce9b95c78","name":"Seta o Tipo de Retorno JSON","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[5248,1280],"id":"419843f3-ad23-4b48-8480-974957fdc405","name":"Ajusta o Parse do JSON","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"fieldToSplitOut":"output.mensagens","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[5712,1120],"id":"71118b27-352e-485d-a5dc-64c6b0c6bdc8","name":"Quebra Mensagens em várias Linhas","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[6512,1008],"id":"95e5b979-ffc4-428b-858f-784d6d0db6a8","name":"Não faz nada","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[6208,1120],"id":"77c16abf-6f56-42b6-bf88-273e0fc060e5","name":"Itera sobre cada mensagem","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"method":"POST","url":"={{ $('Variáveis do Fluxo').item.json.serverURLEvo }}/message/sendText/{{ $('Variáveis do Fluxo').item.json.instaciaEvo }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Variáveis do Fluxo').item.json.IdConversa }}"},{"name":"text","value":"={{ $json['output.mensagens'] }}"}]},"options":{}},"id":"9184595f-090b-4018-bbdb-4b4659f962a1","name":"Enviar Mensagem no WhatsApp","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[6512,1200],"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"assignments":{"assignments":[{"id":"85b6d75a-ee4f-42b9-bd5a-40031b4daf12","name":"texto","value":"={{$json.output}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4720,1120],"id":"09f65fb2-4ebf-431e-8387-b38c3ba892fe","name":"Saida do Agente","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[5120,1488],"id":"26869ac6-acf4-4b3b-8050-24e00fead59f","name":"GPT-4o-mini","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"promptType":"define","text":"={{ $('Seta Mensagem para o Agente').item.json.message }}","options":{"systemMessage":"=# Instruções\nVocê é um agente de suporte e vendas da Empresa Synthrop.AI, um ecossistema de ensino de Agentes de IA, Automações NoCode com N8N, com formações, comunidades, mentorias e com grande foco na criação de Agentes de Inteligência Artificial e Automação.\n\nAdicione emojis em suas respostas.\n\n# Restrições\n- Adapte o fluxo da conversa conforme as necessidades do usuário, porém evite responder perguntas fora do seu papel, atenha-se a suas <instruções> e função;\n- Nunca invente informações, atenha-se apenas as suas informações fornecidas;\n- Responda apenas com informações que você sabe e tem certeza;\n- Responda o usuário no idioma que ele estiver falando;\n- Nunca envie links coletados da base vetorial;\n\n# Variáveis\nData atual: {{ $now }}\n\n  <ContextoImagem>\nDados entre os parâmetros <ContextoImagem></ContextoImagem> são imagens enviadas pelo usuário que foram pré processadas e detalhadas por uma IA  para que você as entenda.\n\n  <ContextoPDF>\nDados entre os parâmetros <ContextoPDF></ContextoPDF> são arquivos PDF enviados pelo usuário que foram pré processadas e transcritos por uma IA  para que você as entenda.\n\n  <ErroFormatoMensagem>\nO usuário enviou um formato de mensagem que não podemos processar. \nCaso seja a única mensagem enviada, diga ao usuário que não entende esse tipo de mensagem.\n\n\n# Contexto Extra"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[4240,1120],"id":"2a0a69c0-b355-4ada-8a76-6d7b3bc9bf5f","name":"AI Agent","retryOnFail":true,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[6768,1200],"id":"1e951e9a-6a8a-45dd-a08e-0f7623548c77","name":"Espera 2 segundos","webhookId":"65ff8064-0a3a-4195-bf63-5cc130c8fe48","notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"content":"## Formação - Agente N8N\n![Source example](https://i.postimg.cc/zDL8sNR7/logo-agentes-de-IA.png)\n\n## https://agentes-n8n.com.br","height":700,"width":800,"color":7},"type":"n8n-nodes-base.stickyNote","position":[6064,1744],"typeVersion":1,"id":"16cc0d3a-403b-4c15-8644-d53283ab522d","name":"Sticky Note28"},{"parameters":{"content":"![Source example](https://www.drupal.org/files/project-images/elevenlabs.png#full-width)","height":360,"width":440,"color":7},"type":"n8n-nodes-base.stickyNote","position":[2528,2208],"typeVersion":1,"id":"83c4873a-2ab0-4276-9520-2226463a9390","name":"Sticky Note16"},{"parameters":{"content":"![Source example](https://venturebeat.com/wp-content/uploads/2020/10/google-workspace-logo.png#full-width)","height":240,"width":460,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-288,2224],"typeVersion":1,"id":"11252bb0-cf4d-4e2b-99aa-fa35b853fbf4","name":"Sticky Note19"},{"parameters":{"content":"![Source example](https://pbs.twimg.com/media/GoKJJggW4AEJi_k.png#full-width)","height":620,"width":560,"color":7},"type":"n8n-nodes-base.stickyNote","position":[1888,1952],"typeVersion":1,"id":"af225b33-0077-4492-98be-be7313b41f24","name":"Sticky Note22"},{"parameters":{"content":"![Source example](https://raw.githubusercontent.com/EvolutionAPI/evolution-api/main/public/images/cover.png#full-width)","height":360,"width":500,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-864,1920],"typeVersion":1,"id":"0c3c1445-057b-41dd-8626-124101b92efb","name":"Sticky Note15"},{"parameters":{"content":"![Source example](https://ps.w.org/redis-cache/assets/banner-1544x500.png?rev=2315420#full-width)","height":280,"width":580,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-288,1904],"typeVersion":1,"id":"8b16a009-44d8-4ff4-ab3f-9962171abc19","name":"Sticky Note23"},{"parameters":{"content":"![Source example](https://miro.medium.com/v2/resize:fit:610/1*lZrXmWJRDLqIImJThs5Lrw.png#full-width)","height":320,"width":600,"color":7},"type":"n8n-nodes-base.stickyNote","position":[480,2064],"typeVersion":1,"id":"e4f27573-d939-4066-8b5e-674fbe47e8d7","name":"Sticky Note24"},{"parameters":{"content":"![Source example](https://upload.wikimedia.org/wikipedia/commons/5/57/OpenAI.png#full-width)","height":360,"width":500,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-864,2192],"typeVersion":1,"id":"32ddabdd-fea9-458b-8c7c-06d43a9b2c8f","name":"Sticky Note25"},{"parameters":{"content":"","height":840,"width":4040,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-928,1824],"id":"dee04d79-c55a-4e02-b457-436c17e83326","name":"Sticky Note30"},{"parameters":{"content":"![Source example](https://supabase.com/_next/image?url=https%3A%2F%2Ffrontend-assets.supabase.com%2Fwww%2F4230c5a3dca5%2F_next%2Fstatic%2Fmedia%2Flogo-preview.50e72501.jpg&w=3840&q=75&dpl=dpl_6MJKiT6sytsEBe5iAn5nt9URV6GG#full-width)","height":380,"width":560,"color":7},"type":"n8n-nodes-base.stickyNote","position":[1248,2160],"typeVersion":1,"id":"ee7e6d02-1c58-44da-b427-a377af4eb87d","name":"Sticky Note26"},{"parameters":{"sseEndpoint":"https://webhook.agentes-n8n.com.br/mcp/my-calendar/sse"},"id":"4cde31e4-c65b-4b7a-9d91-34cc36c02d00","name":"Calendar MCP","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[4704,1760],"typeVersion":1},{"parameters":{"content":"## LLMs e Memória\n","height":340,"width":440,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3648,1632],"id":"08fe03f6-7c27-4cdf-bfad-17b351e1ab6f","name":"Sticky Note5"},{"parameters":{"sendTo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}","subject":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}","message":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4560,1760],"id":"8d2cc07b-e635-4002-a10f-2c4a0c0cb3d7","name":"Gmail","webhookId":"98d6c05b-a984-410e-8164-7dd017b51017"},{"parameters":{"content":"## Ferramentas e MCPs\n","height":300,"width":500,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4368,1632],"id":"a3b0726f-c1de-4ac8-8cce-94c0ae89ccbb","name":"Sticky Note27"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"ricardo.braga@caf.io","mode":"list","cachedResultName":"Ric Neves"},"limit":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}","timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}","options":{}},"id":"86cf8e72-a853-4fed-a45c-3ce5c0c8e25e","name":"SearchEvent","type":"n8n-nodes-base.googleCalendarTool","position":[4512,2224],"typeVersion":1.3,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"calendar":{"__rl":true,"value":"ricardo.braga@caf.io","mode":"list","cachedResultName":"Ric Neves"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"id":"7f4a16c1-b818-4b96-bf64-7c04684c825c","name":"CreateEvent","type":"n8n-nodes-base.googleCalendarTool","position":[4640,2224],"typeVersion":1.3,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"ricardo.braga@caf.io","mode":"list","cachedResultName":"Ric Neves"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"id":"b973fd90-b0fa-4fba-a938-a7386028a9f8","name":"UpdateEvent","type":"n8n-nodes-base.googleCalendarTool","position":[4784,2224],"typeVersion":1.3,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"ricardo.braga@caf.io","mode":"list","cachedResultName":"Ric Neves"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"id":"262c1017-df64-4d30-bf11-ae52fcb0f022","name":"DeleteEvent","type":"n8n-nodes-base.googleCalendarTool","position":[4928,2224],"typeVersion":1.3,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"path":"my-calendar"},"id":"7ca8f3d0-b703-4220-97e9-1a7368e948cf","name":"Google Calendar MCP","type":"@n8n/n8n-nodes-langchain.mcpTrigger","position":[4544,2048],"webhookId":"f9d9d5ea-6f83-42c8-ae50-ee6c71789bca","typeVersion":1,"notes":"Este template é propriedade de RIC NEVES da formação Agentes de IA com N8N\nhttps://www.agentes-n8n.com.br/"},{"parameters":{"content":"## Servidores MCP","height":440,"width":740},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4368,1984],"id":"df1cdd39-eba5-438b-a286-f4ebd665960d","name":"Sticky Note29"},{"parameters":{"content":"██████░██░░░░░▄█████▄░██░██░██░░░▄█████░▄█████▄░██████▄░██████░██████░▄██████░██░░░██░█████▄░▄████▄░████████░▄█████▄░█████▄\n██░░░░░██░░░░░██░░░██░██░██░██░░░██░░░░░██░░░██░██░░░██░██░░░░░░░██░░░██░░░░░░██░░░██░██░░██░██░░██░░░░██░░░░██░░░██░██░░██\n█████░░██░░░░░██░░░██░██░██░██░░░██░░░░░██░░░██░██░░░██░█████░░░░██░░░██░░███░██░░░██░█████▀░██░░██░░░░██░░░░██░░░██░█████▀\n██░░░░░██░░░░░██░░░██░██░██░██░░░██░░░░░██░░░██░██░░░██░██░░░░░░░██░░░██░░░██░██░░░██░██░░██░██████░░░░██░░░░██░░░██░██░░██\n██░░░░░██████░▀█████▀░▀██▀▀██▀░░░▀█████░▀█████▀░██░░░██░██░░░░░██████░▀█████▀░▀█████▀░██░░██░██░░██░░░░██░░░░▀█████▀░██░░██\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░","width":1340},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-704,624],"id":"5001f03a-35df-43b4-bf54-190490ed46b0","name":"Sticky Note37"},{"parameters":{"content":"▄██▄▄██▄░▄█████░▄██████░▄██████░▄████▄░▄██████░▄█████░░░▄█████░▄█████▄░██████▄░██████░██████░▄██████░██░░░██░█████▄░▄████▄░████████░▄█████▄░█████▄\n██░██░██░██░░░░░██░░░░░░██░░░░░░██░░██░██░░░░░░██░░░░░░░██░░░░░██░░░██░██░░░██░██░░░░░░░██░░░██░░░░░░██░░░██░██░░██░██░░██░░░░██░░░░██░░░██░██░░██\n██░██░██░█████░░▀█████▄░▀█████▄░██░░██░██░░███░█████░░░░██░░░░░██░░░██░██░░░██░█████░░░░██░░░██░░███░██░░░██░█████▀░██░░██░░░░██░░░░██░░░██░█████▀\n██░██░██░██░░░░░░░░░░██░░░░░░██░██████░██░░░██░██░░░░░░░██░░░░░██░░░██░██░░░██░██░░░░░░░██░░░██░░░██░██░░░██░██░░██░██████░░░░██░░░░██░░░██░██░░██\n██░██░██░▀█████░██████▀░██████▀░██░░██░▀█████▀░▀█████░░░▀█████░▀█████▀░██░░░██░██░░░░░██████░▀█████▀░▀█████▀░██░░██░██░░██░░░░██░░░░▀█████▀░██░░██\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░","width":1520},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1232,288],"id":"8aa61d43-96d7-45e8-9562-3d226f3578d1","name":"Sticky Note38"},{"parameters":{"content":"▄████▄░██████░░░▄████▄░▄██████░▄█████░██████▄░████████\n██░░██░░░██░░░░░██░░██░██░░░░░░██░░░░░██░░░██░░░░██░░░\n██░░██░░░██░░░░░██░░██░██░░███░█████░░██░░░██░░░░██░░░\n██████░░░██░░░░░██████░██░░░██░██░░░░░██░░░██░░░░██░░░\n██░░██░██████░░░██░░██░▀█████▀░▀█████░██░░░██░░░░██░░░\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░","width":620},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3424,544],"id":"1f8f64e1-888b-4a70-9e78-5781f87c8aef","name":"Sticky Note39"},{"parameters":{"content":"██░░░██░██░░░██░▄██▄▄██▄░▄████▄░██████▄░██████░███████░▄█████░██████▄░░░▄██▄▄██▄░▄█████░▄██████░▄██████░▄████▄░▄██████░▄█████░▄██████\n██░░░██░██░░░██░██░██░██░██░░██░██░░░██░░░██░░░░░░░░██░██░░░░░██░░░██░░░██░██░██░██░░░░░██░░░░░░██░░░░░░██░░██░██░░░░░░██░░░░░██░░░░░\n███████░██░░░██░██░██░██░██░░██░██░░░██░░░██░░░▄█████▀░█████░░██░░░██░░░██░██░██░█████░░▀█████▄░▀█████▄░██░░██░██░░███░█████░░▀█████▄\n██░░░██░██░░░██░██░██░██░██████░██░░░██░░░██░░░██░░░░░░██░░░░░██░░░██░░░██░██░██░██░░░░░░░░░░██░░░░░░██░██████░██░░░██░██░░░░░░░░░░██\n██░░░██░▀█████▀░██░██░██░██░░██░██░░░██░██████░███████░▀█████░██████▀░░░██░██░██░▀█████░██████▀░██████▀░██░░██░▀█████▀░▀█████░██████▀\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░","width":1400},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[5072,752],"id":"c790ee0b-beaa-4b17-80af-e6a9c78e2fbf","name":"Sticky Note41"}],"connections":{"Webhook Evo":{"main":[[{"node":"Variáveis do Fluxo","type":"main","index":0}]]},"Busca Memória da Conversa":{"main":[[{"node":"Valida se Bot Esta Ativo","type":"main","index":0}]]},"Valida se Bot Esta Ativo":{"main":[[{"node":"Não faz nada se estiver inativo","type":"main","index":0}],[{"node":"Identifica o Tipo de Mensagem","type":"main","index":0}]]},"Identifica o Tipo de Mensagem":{"main":[[{"node":"Mensagem de Texto","type":"main","index":0}],[{"node":"Mensagem Extendida de Texto","type":"main","index":0}],[{"node":"Mensagem de Audio","type":"main","index":0}],[{"node":"Mensagem com Imagem","type":"main","index":0}],[{"node":"Mensagem com Documento","type":"main","index":0}],[{"node":"Mensagem de Erro  - Formato não suportado","type":"main","index":0}]]},"Mensagem de Texto":{"main":[[{"node":"Adiciona Texto na Memoria","type":"main","index":0}]]},"Mensagem Extendida de Texto":{"main":[[{"node":"Adiciona Texto na Memoria","type":"main","index":0}]]},"Mensagem de Audio":{"main":[[{"node":"Converte Audio base64 para File","type":"main","index":0}]]},"Mensagem com Imagem":{"main":[[{"node":"Converte Imagem Base64 para File","type":"main","index":0}]]},"Mensagem de Erro  - Formato não suportado":{"main":[[{"node":"Adiciona Erro na Memória","type":"main","index":0}]]},"Converte Audio base64 para File":{"main":[[{"node":"Transcreve Audio com OpenAI","type":"main","index":0}]]},"Converte Imagem Base64 para File":{"main":[[{"node":"Traduz Imagem em Texto","type":"main","index":0}]]},"Transcreve Audio com OpenAI":{"main":[[{"node":"Adiciona Audio Na Memória","type":"main","index":0}]]},"Convert Documento base64 para Arquivo":{"main":[[{"node":"Extrai Dados do PDF","type":"main","index":0}]]},"Mensagem com Documento":{"main":[[{"node":"Convert Documento base64 para Arquivo","type":"main","index":0}]]},"Extrai Dados do PDF":{"main":[[{"node":"Adiciona Documento na Memória","type":"main","index":0}]]},"Adiciona Texto na Memoria":{"main":[[{"node":"Memória Temporária","type":"main","index":0}]]},"Variáveis do Fluxo":{"main":[[{"node":"Busca Memória da Conversa","type":"main","index":0}]]},"Traduz Imagem em Texto":{"main":[[{"node":"Adiciona Imagem na Memória","type":"main","index":0}]]},"Adiciona Audio Na Memória":{"main":[[{"node":"Memória Temporária","type":"main","index":0}]]},"Adiciona Imagem na Memória":{"main":[[{"node":"Memória Temporária","type":"main","index":0}]]},"Adiciona Documento na Memória":{"main":[[{"node":"Memória Temporária","type":"main","index":0}]]},"Adiciona Erro na Memória":{"main":[[{"node":"Memória Temporária","type":"main","index":0}]]},"Memória Temporária":{"main":[[{"node":"Espera Tempo Definido","type":"main","index":0}]]},"Espera Tempo Definido":{"main":[[{"node":"Busca mensagens da Memória","type":"main","index":0}]]},"Busca mensagens da Memória":{"main":[[{"node":"Verifica se houve troca de mensagem","type":"main","index":0}]]},"Verifica se houve troca de mensagem":{"main":[[{"node":"Limpa a Memória Temporária","type":"main","index":0}],[{"node":"Se houve não faz nada e aguarda vir a nova mensagem","type":"main","index":0}]]},"Limpa a Memória Temporária":{"main":[[{"node":"Seta Mensagem para o Agente","type":"main","index":0}]]},"Seta Mensagem para o Agente":{"main":[[{"node":"Remove metadados e simbolos","type":"main","index":0}]]},"Remove metadados e simbolos":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Desativar Agente":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Memória do Chat":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Estrutura da Mensagem de Retorno":{"main":[[{"node":"Quebra Mensagens em várias Linhas","type":"main","index":0}]]},"Seta o Tipo de Retorno JSON":{"ai_outputParser":[[{"node":"Ajusta o Parse do JSON","type":"ai_outputParser","index":0}]]},"Ajusta o Parse do JSON":{"ai_outputParser":[[{"node":"Estrutura da Mensagem de Retorno","type":"ai_outputParser","index":0}]]},"Quebra Mensagens em várias Linhas":{"main":[[{"node":"Itera sobre cada mensagem","type":"main","index":0}]]},"Itera sobre cada mensagem":{"main":[[{"node":"Não faz nada","type":"main","index":0}],[{"node":"Enviar Mensagem no WhatsApp","type":"main","index":0}]]},"Enviar Mensagem no WhatsApp":{"main":[[{"node":"Espera 2 segundos","type":"main","index":0}]]},"Saida do Agente":{"main":[[{"node":"Estrutura da Mensagem de Retorno","type":"main","index":0}]]},"GPT-4o-mini":{"ai_languageModel":[[{"node":"Ajusta o Parse do JSON","type":"ai_languageModel","index":0},{"node":"Estrutura da Mensagem de Retorno","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Saida do Agente","type":"main","index":0}]]},"Espera 2 segundos":{"main":[[{"node":"Itera sobre cada mensagem","type":"main","index":0}]]},"Calendar MCP":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Gmail":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"SearchEvent":{"ai_tool":[[{"node":"Google Calendar MCP","type":"ai_tool","index":0}]]},"CreateEvent":{"ai_tool":[[{"node":"Google Calendar MCP","type":"ai_tool","index":0}]]},"UpdateEvent":{"ai_tool":[[{"node":"Google Calendar MCP","type":"ai_tool","index":0}]]},"DeleteEvent":{"ai_tool":[[{"node":"Google Calendar MCP","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"0d9aa2dc-e157-45ec-bb4f-53d9809364e3","triggerCount":0,"tags":[{"createdAt":"2025-07-20T15:45:29.310Z","updatedAt":"2025-07-20T15:45:29.310Z","id":"wRUSTJ6mfrXjoMjo","name":"formacao-agentes-n8n"},{"createdAt":"2025-08-15T17:35:24.405Z","updatedAt":"2025-08-15T17:35:24.405Z","id":"zVYDTsum20GGDoCQ","name":"evolution-api"},{"createdAt":"2025-08-16T22:03:27.954Z","updatedAt":"2025-08-16T22:03:27.954Z","id":"STmhazgabTcuLI1u","name":"whatsapp"}]}