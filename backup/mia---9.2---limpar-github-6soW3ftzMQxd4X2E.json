{"createdAt":"2025-11-03T17:39:46.091Z","updatedAt":"2025-11-03T18:27:30.119Z","id":"6soW3ftzMQxd4X2E","name":"MIA - 9.2 - Limpar GitHub","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"weeks"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-176,384],"id":"593a1f43-2011-4fcd-a0d5-f2652dd9990d","name":"Schedule Trigger1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[448,384],"id":"353f17bc-81eb-44fa-bb57-ae28d9539575","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"3b7bdbdf-14bd-4be2-a2fe-d91f59bfaf9f","name":"Owner","value":"getmia-ia","type":"string"},{"id":"7ea8ddff-c64d-4978-b2e3-ac2cd706bf13","name":"Repository","value":"Mia","type":"string"},{"id":"3d4ab93f-fa96-4c8d-a2ae-4bfc70be4550","name":"path","value":"images/","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[32,384],"id":"f778cc70-fc3b-4a1c-a184-c3e6fcf96242","name":"Dados para o GitHub"},{"parameters":{"authentication":"oAuth2","resource":"file","operation":"list","owner":{"__rl":true,"value":"={{ $json.Owner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $json.Repository }}","mode":"name"},"filePath":"={{ $json.path }}"},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[224,384],"id":"a95ce134-4317-443f-9590-b08c0e28df8c","name":"Lista todos os arquivos do repositório","webhookId":"24f3f417-0893-43a3-bec1-16341ead7ada","credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"method":"DELETE","url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/contents/{{ $('Lista todos os arquivos do repositório').item.json.path }}","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": \"Removendo arquivo antigo automaticamente\",\n  \"sha\": \"{{ $('Lista todos os arquivos do repositório').item.json.sha }}\",\n  \"committer\": {\n    \"name\": \"{{ $json.commit.committer.name }}\",\n    \"email\": \"{{ $json.commit.committer.email }}\"\n  }\n} ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1408,384],"id":"2e916681-26fe-41b1-bddc-0ec074a7f144","name":"Deleta o arquivo do repositório","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32581fe4-aa4b-410a-986c-aec0ffa7ece3","leftValue":"={{ $json.commit.author.date }}","rightValue":"={{ $now.minus({ weeks: 1 }) }}","operator":{"type":"dateTime","operation":"beforeOrEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[848,400],"id":"e73c498d-e016-4542-bc84-75b93356cbcd","name":"Verifica se o arquivo está a mais de uma semana no repositório"},{"parameters":{"url":"=https://api.github.com/repos/{{ $('Dados para o GitHub').item.json.Owner }}/{{ $('Dados para o GitHub').item.json.Repository }}/commits","authentication":"predefinedCredentialType","nodeCredentialType":"githubOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"path","value":"={{ $('Lista todos os arquivos do repositório').item.json.path }}"},{"name":"per_page","value":"1"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/vnd.github.v3+json"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[672,400],"id":"025e2817-20de-46ab-ac44-b5b274ea0a36","name":"Busca o último commit de cada arquivo","executeOnce":true,"credentials":{"githubOAuth2Api":{"id":"hR55JFsx4bIpxagL","name":"GitHub - Organização MIA"}}},{"parameters":{"content":"## Fluxo que apaga arquivos que estão a mais de uma semana no repositório do GitHub\n(para as imagens das notícias)","height":400,"width":1872,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-272,256],"id":"591993c9-adca-4182-9991-cb552eb16e8e","name":"Sticky Note"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1232,384],"id":"0f080067-6cfb-4227-8f86-e7fd4b910661","name":"Wait","webhookId":"fbf41b00-01a5-419f-8c4d-8f34e497e1c6"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1056,416],"id":"b1629e40-3140-401d-a3cf-2448cf4455ca","name":"Wait1","webhookId":"b87f314c-b8f8-4051-929f-3c6f3180060a"}],"connections":{"Schedule Trigger1":{"main":[[{"node":"Dados para o GitHub","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Busca o último commit de cada arquivo","type":"main","index":0}]]},"Dados para o GitHub":{"main":[[{"node":"Lista todos os arquivos do repositório","type":"main","index":0}]]},"Lista todos os arquivos do repositório":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Deleta o arquivo do repositório":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Verifica se o arquivo está a mais de uma semana no repositório":{"main":[[{"node":"Wait","type":"main","index":0}],[{"node":"Wait1","type":"main","index":0}]]},"Busca o último commit de cada arquivo":{"main":[[{"node":"Verifica se o arquivo está a mais de uma semana no repositório","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Deleta o arquivo do repositório","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"QdC9qh9DPcT2xcoq"},"staticData":{"node:Schedule Trigger1":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"bf7a17a7-16ea-496c-80ee-adaa443218a0","triggerCount":1,"tags":[]}