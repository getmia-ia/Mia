{"createdAt":"2025-09-24T20:46:33.638Z","updatedAt":"2025-09-24T21:43:00.454Z","id":"7AgkIy06NDtJHI2s","name":"Agentes N8NT - Finthrix - Importador de Extrato","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1cj7sRk-oPlDuTZkpU0xjCVKl6kaB8L4h","mode":"list","cachedResultName":"Extratos","cachedResultUrl":"https://drive.google.com/drive/folders/1cj7sRk-oPlDuTZkpU0xjCVKl6kaB8L4h"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-112,-16],"id":"c3d22104-2ee2-4212-beef-23ec8ab1075c","name":"Lê a pasta Extratos a cada 1 minuto","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[208,-16],"id":"01b53244-f391-4eca-a454-225398dd9030","name":"Faz o Download do Extrato","credentials":{"googleDriveOAuth2Api":{"id":"KkxgbqeFnpS3oC7s","name":"Google Drive - Taysa"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"},{"name":"purpose","value":"ocr"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[416,-16],"id":"6d753a84-48e0-4946-90a2-9b371ef28e67","name":"Enviar Arquivo para Mistral","credentials":{"mistralCloudApi":{"id":"GBOMe4hI06Uj36k2","name":"Mistral Cloud - Taysa"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url?expiry=24","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[624,-16],"id":"0d73398e-0a2c-4fcb-a1ad-d78d1246fd77","name":"Gerar URL Assinada do Documento","credentials":{"mistralCloudApi":{"id":"GBOMe4hI06Uj36k2","name":"Mistral Cloud - Taysa"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"model\": \"mistral-ocr-latest\",\n    \"document\": {\n        \"type\": \"document_url\",\n        \"document_url\": \"{{ $json.url }}\"\n    },\n    \"include_image_base64\": true\n  } ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[848,-16],"id":"cf2c6c68-2d11-4f64-863a-d72030ef315c","name":"Fazer o OCR do documento","credentials":{"mistralCloudApi":{"id":"GBOMe4hI06Uj36k2","name":"Mistral Cloud - Taysa"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Esse é o conteudo do extrato para que você possa ler:\n\n{{ $json.pages[0].markdown}}"},{"content":"Você é um assistente de análise de texto para documentos de extrato bancário. Sua tarefa é analisar o texto de um 'output' fornecido contendo os dados do extrato bancário e formatá-los em um JSON **com os nomes de chave fixos**.\n\n**IMPORTANTE:** A resposta deve seguir **EXATAMENTE** o seguinte formato, sem variação nos nomes dos campos.\n\n```json\n{\n  \"transacao\": [\n    {\n      \"data_conta\": \"data lancamento\",\n      \"tipo\": \"entrada ou saída\",\n      \"descricao\": \"descricao da transacao\",\n      \"entrada\": \"valor entrada em R$ caso exista\",\n      \"saida\": \"valor saida em R$ caso exista\",\n      \"valor\": \"valor total em R$\"\n    }\n  ]\n}\n\nA chave do array DEVE ser sempre 'transacao'. Não use sinônimos como 'transacoes' ou 'lista'.\nNão inclua texto adicional fora do JSON.\n**Quando receber valores, sempre utilize a moeda R$**\nCaso um campo não tenha valor, retorne null no lugar.\nNunca utilize '+' ou '-' antes dos valores para indicar entrada ou saída, passe apenas os números.\nApenas gere a estrutura acima com os dados extraídos. Nenhuma explicação adicional.\n\nImportante: Ignore linhas no extrato como SALDO ANTERIOR OU SALDO ATUAL","role":"system"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[224,320],"id":"612a423c-9689-4ee0-9496-37ff248ca484","name":"Leitor de Extrato","credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"796d67e1-6bc3-4be8-ad0a-ff6bd40d4a23","name":"transactions","value":"={{ $json.message.content.transacao }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[640,320],"id":"e64f5ae7-5973-492d-9a28-a135cc557884","name":"Seta o Retorno"},{"parameters":{"fieldToSplitOut":"transactions","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[848,320],"id":"2c8c9b4f-5519-4b09-b17e-c691f76e30d0","name":"Separa todas as Movimentações"},{"parameters":{"content":"## Processa o arquivo enviado - Envia para a MISTRAL AI para fazer o OCR do PDF","height":236,"width":928,"color":4},"type":"n8n-nodes-base.stickyNote","position":[160,-80],"typeVersion":1,"id":"e288b31c-ee67-4db0-a740-8f28a595551f","name":"Sticky Note13"},{"parameters":{"content":"## Chama IA  para Identificar as Movimentações Contidas no Extrato","height":252,"width":444,"color":5},"type":"n8n-nodes-base.stickyNote","position":[128,224],"typeVersion":1,"id":"acee097a-2ac1-441f-bcc0-dda8957f7f35","name":"Sticky Note16"},{"parameters":{"content":"## Insere Linhas das Movimentações na Planilha","height":252,"width":640,"color":4},"type":"n8n-nodes-base.stickyNote","position":[592,240],"typeVersion":1,"id":"fcf8b3ee-aa9b-49ae-91b1-d0dc36e3381d","name":"Sticky Note2"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU","mode":"list","cachedResultName":"Banco de Dados - FinThrix","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Movimentações","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1EQKgIrcSxHzIw90PmL3JBdWQHYuUM6wg2jt_yBknJRU/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Data":"={{ $('Separa todas as Movimentações').item.json.data_conta }}","Mês":"={{    [\"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"][     ($('Separa todas as Movimentações').item.json.data_conta.includes(\"/\") ?        $('Separa todas as Movimentações').item.json.data_conta.split(\"/\")[1] :        $('Separa todas as Movimentações').item.json.data_conta.split(\"-\")[1]     ) - 1   ]  }}","Transação":"={{ $('Separa todas as Movimentações').item.json.descricao }}","Categoria":"={{ $('Separa todas as Movimentações').item.json.tipo }}","Entrada":"={{ $('Separa todas as Movimentações').item.json.entrada }}","Saída":"={{ $('Separa todas as Movimentações').item.json.saida }}"},"matchingColumns":[],"schema":[{"id":"Data","displayName":"Data","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Mês","displayName":"Mês","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Transação","displayName":"Transação","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Entrada","displayName":"Entrada","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Saída","displayName":"Saída","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{"cellFormat":"USER_ENTERED"}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1056,320],"id":"2e05d7d2-3ee0-412f-8ddd-bed5ec2f226b","name":"Insere as Movimentações","credentials":{"googleSheetsOAuth2Api":{"id":"mSK6en3eCTk82mBe","name":"Google Sheets - Taysa"}}}],"connections":{"Lê a pasta Extratos a cada 1 minuto":{"main":[[{"node":"Faz o Download do Extrato","type":"main","index":0}]]},"Faz o Download do Extrato":{"main":[[{"node":"Enviar Arquivo para Mistral","type":"main","index":0}]]},"Enviar Arquivo para Mistral":{"main":[[{"node":"Gerar URL Assinada do Documento","type":"main","index":0}]]},"Gerar URL Assinada do Documento":{"main":[[{"node":"Fazer o OCR do documento","type":"main","index":0}]]},"Fazer o OCR do documento":{"main":[[{"node":"Leitor de Extrato","type":"main","index":0}]]},"Leitor de Extrato":{"main":[[{"node":"Seta o Retorno","type":"main","index":0}]]},"Seta o Retorno":{"main":[[{"node":"Separa todas as Movimentações","type":"main","index":0}]]},"Separa todas as Movimentações":{"main":[[{"node":"Insere as Movimentações","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Lê a pasta Extratos a cada 1 minuto":{"lastTimeChecked":"2025-09-24T21:40:00Z"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"97c2ee3e-face-4ff5-8afe-6db5fd93413d","triggerCount":1,"tags":[]}