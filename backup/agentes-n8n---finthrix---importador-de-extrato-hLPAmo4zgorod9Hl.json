{"createdAt":"2025-09-23T19:52:58.130Z","updatedAt":"2025-09-24T18:44:29.487Z","id":"hLPAmo4zgorod9Hl","name":"Agentes N8N - Finthrix - Importador de Extrato","active":false,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1XC7oKSUmvkApTbqVcDPkZPJh9nAawKDb","mode":"list","cachedResultName":"Extratos","cachedResultUrl":"https://drive.google.com/drive/folders/1XC7oKSUmvkApTbqVcDPkZPJh9nAawKDb"},"event":"fileCreated","options":{}},"id":"6e69ddf0-747b-448a-8c26-288e910adf8a","name":"Lê a pasta Extratos a cada 1 minuto","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[320,256]},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"id":"e2d75e40-e4ba-4a9e-a51e-b9ebcfdae364","name":"Faz o Download do Extrato","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[624,256],"credentials":{"googleDriveOAuth2Api":{"id":"8G4VgOQRG6X5KJnF","name":"Google Drive account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"messages":{"values":[{"content":"=Esse é o conteudo do extrato para que você possa ler:\n\n{{ $json.pages[0].markdown}}"},{"content":"=Você é um assistente de análise de texto para documentos de extrato bancário. Sua tarefa é analisar o texto de um 'output' fornecido contendo os dados do extrato bancário e formatá-los em um JSON **com os nomes de chave fixos**.\n\n**IMPORTANTE:** A resposta deve seguir **EXATAMENTE** o seguinte formato, sem variação nos nomes dos campos.\n\n```json\n{\n  \"transacao\": [\n    {\n      \"data_conta\": \"data lancamento\",\n      \"tipo\": \"entrada ou saída\",\n      \"descricao\": \"descricao da transacao\",\n      \"entrada\": \"valor entrada em R$ caso exista\",\n      \"saida\": \"valor saida em R$ caso exista\",\n      \"valor\": \"valor total em R$\"\n    }\n  ]\n}\n\nA chave do array DEVE ser sempre 'transacao'. Não use sinônimos como 'transacoes' ou 'lista'.\nNão inclua texto adicional fora do JSON.\n**Quando receber valores, sempre utilize a moeda R$**\nCaso um campo não tenha valor, retorne null no lugar.\nNunca utilize '+' ou '-' antes dos valores para indicar entrada ou saída, passe apenas os números.\nApenas gere a estrutura acima com os dados extraídos. Nenhuma explicação adicional.\n\nImportante: Ignore linhas no extrato como SALDO ANTERIOR OU SALDO ATUAL\n","role":"system"}]},"jsonOutput":true,"options":{}},"id":"52faa300-1839-4d1b-9655-38259edfb6ac","name":"🔎 Leitor de Extrato 🔎","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[560,608]},{"parameters":{"assignments":{"assignments":[{"id":"e29f70c2-5f12-4d63-8c0e-d76416475959","name":"transactions","value":"={{ $json.message.content.transacao }}","type":"array"}]},"options":{}},"id":"276078e7-1f98-44a5-aee9-8a77623c9074","name":"Seta o Retorno","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[960,608]},{"parameters":{"fieldToSplitOut":"transactions","options":{}},"id":"c0f4667b-13cb-477f-8a59-871511eca9bd","name":"Separa todas as Movimentações","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1168,608]},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U","mode":"list","cachedResultName":"Banco de Dados - FinThrix","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Movimentações","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1YXnXe7fcRCwpLTly1JTLLFuRWXBBomyc4dye-RKM41U/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Data":"={{ $('Separa todas as Movimentações').item.json.data_conta }}","Transação":"={{ $('Separa todas as Movimentações').item.json.descricao }}","Entrada":"={{ $('Separa todas as Movimentações').item.json.entrada }}","Saída":"={{ $('Separa todas as Movimentações').item.json.saida }}","Categoria":"={{ $('Separa todas as Movimentações').item.json.tipo }}","Mês":"={{ \n  [\"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"][\n    ($('Separa todas as Movimentações').item.json.data_conta.includes(\"/\") ? \n      $('Separa todas as Movimentações').item.json.data_conta.split(\"/\")[1] : \n      $('Separa todas as Movimentações').item.json.data_conta.split(\"-\")[1]\n    ) - 1\n  ] \n}}"},"matchingColumns":[],"schema":[{"id":"Data","displayName":"Data","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Mês","displayName":"Mês","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Transação","displayName":"Transação","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Categoria","displayName":"Categoria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Entrada","displayName":"Entrada","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Saída","displayName":"Saída","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"c8dbe797-0eec-4a56-a3b5-a103ef2c0c64","name":"Insere as Movimentações","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1360,608],"credentials":{"googleSheetsOAuth2Api":{"id":"vZSfHHRYQWS29a4T","name":"Google Sheets - Taysa"}}},{"parameters":{"content":"## Processa o arquivo enviado - Envia para a MISTRAL AI para fazer o OCR do PDF","height":300,"width":1040,"color":6},"type":"n8n-nodes-base.stickyNote","position":[528,192],"typeVersion":1,"id":"5dca20b3-800f-4630-8db2-826f376384f3","name":"Sticky Note13"},{"parameters":{"content":"## Chama IA  para Identificar as Movimentações Contidas no Extrato","height":300,"width":380,"color":5},"type":"n8n-nodes-base.stickyNote","position":[528,512],"typeVersion":1,"id":"f4a3a122-4e51-4eb1-9e6d-d59a6ec882d8","name":"Sticky Note16"},{"parameters":{"content":"## Insere Linhas das Movimentações na Planilha","height":300,"width":640,"color":4},"type":"n8n-nodes-base.stickyNote","position":[928,512],"typeVersion":1,"id":"66aab4e4-7b55-48b6-a418-3d5531a3309c","name":"Sticky Note2"},{"parameters":{"content":"","height":820,"width":1560},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[208,96],"id":"6028c069-560b-44c3-a97d-c3e968971e8a","name":"Sticky Note3"},{"parameters":{"content":"███████╗██╗███╗░░██╗████████╗██╗░░██╗██████╗░██╗██╗░░██╗  ░░░░░░  ██╗███╗░░░███╗██████╗░░█████╗░██████╗░████████╗░█████╗░██████╗░░█████╗░██████╗░  ██████╗░███████╗  ███████╗██╗░░██╗████████╗██████╗░░█████╗░████████╗░█████╗░\n██╔════╝██║████╗░██║╚══██╔══╝██║░░██║██╔══██╗██║╚██╗██╔╝  ░░░░░░  ██║████╗░████║██╔══██╗██╔══██╗██╔══██╗╚══██╔══╝██╔══██╗██╔══██╗██╔══██╗██╔══██╗  ██╔══██╗██╔════╝  ██╔════╝╚██╗██╔╝╚══██╔══╝██╔══██╗██╔══██╗╚══██╔══╝██╔══██╗\n█████╗░░██║██╔██╗██║░░░██║░░░███████║██████╔╝██║░╚███╔╝░  █████╗  ██║██╔████╔██║██████╔╝██║░░██║██████╔╝░░░██║░░░███████║██║░░██║██║░░██║██████╔╝  ██║░░██║█████╗░░  █████╗░░░╚███╔╝░░░░██║░░░██████╔╝███████║░░░██║░░░██║░░██║\n██╔══╝░░██║██║╚████║░░░██║░░░██╔══██║██╔══██╗██║░██╔██╗░  ╚════╝  ██║██║╚██╔╝██║██╔═══╝░██║░░██║██╔══██╗░░░██║░░░██╔══██║██║░░██║██║░░██║██╔══██╗  ██║░░██║██╔══╝░░  ██╔══╝░░░██╔██╗░░░░██║░░░██╔══██╗██╔══██║░░░██║░░░██║░░██║\n██║░░░░░██║██║░╚███║░░░██║░░░██║░░██║██║░░██║██║██╔╝╚██╗  ░░░░░░  ██║██║░╚═╝░██║██║░░░░░╚█████╔╝██║░░██║░░░██║░░░██║░░██║██████╔╝╚█████╔╝██║░░██║  ██████╔╝███████╗  ███████╗██╔╝╚██╗░░░██║░░░██║░░██║██║░░██║░░░██║░░░╚█████╔╝\n╚═╝░░░░░╚═╝╚═╝░░╚══╝░░░╚═╝░░░╚═╝░░╚═╝╚═╝░░╚═╝╚═╝╚═╝░░╚═╝  ░░░░░░  ╚═╝╚═╝░░░░░╚═╝╚═╝░░░░░░╚════╝░╚═╝░░╚═╝░░░╚═╝░░░╚═╝░░╚═╝╚═════╝░░╚════╝░╚═╝░░╚═╝  ╚═════╝░╚══════╝  ╚══════╝╚═╝░░╚═╝░░░╚═╝░░░╚═╝░░╚═╝╚═╝░░╚═╝░░░╚═╝░░░░╚════╝░","width":2280},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-144,-32],"id":"d2d264c3-3d2f-4c99-851b-1809840a5f6e","name":"Sticky Note"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"model\": \"mistral-ocr-latest\",\n    \"document\": {\n        \"type\": \"document_url\",\n        \"document_url\": \"{{ $json.url }}\"\n    },\n    \"include_image_base64\": true\n  } ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1328,256],"id":"631eb75d-a5cf-4a58-afd3-770a17da58fe","name":"Fazer o OCR do documento"},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url?expiry=24","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1088,256],"id":"d40c1c00-0da2-4fdb-b937-194aa2adbc08","name":"Gerar URL Assinada do Documento"},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"predefinedCredentialType","nodeCredentialType":"mistralCloudApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"},{"name":"purpose","value":"ocr"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[848,256],"id":"463f2608-89ee-4862-a9fd-2f4c9d12c775","name":"Enviar Arquivo para Mistral"}],"connections":{"Lê a pasta Extratos a cada 1 minuto":{"main":[[{"node":"Faz o Download do Extrato","type":"main","index":0}]]},"Faz o Download do Extrato":{"main":[[{"node":"Enviar Arquivo para Mistral","type":"main","index":0}]]},"🔎 Leitor de Extrato 🔎":{"main":[[{"node":"Seta o Retorno","type":"main","index":0}]]},"Seta o Retorno":{"main":[[{"node":"Separa todas as Movimentações","type":"main","index":0}]]},"Separa todas as Movimentações":{"main":[[{"node":"Insere as Movimentações","type":"main","index":0}]]},"Gerar URL Assinada do Documento":{"main":[[{"node":"Fazer o OCR do documento","type":"main","index":0}]]},"Enviar Arquivo para Mistral":{"main":[[{"node":"Gerar URL Assinada do Documento","type":"main","index":0}]]},"Fazer o OCR do documento":{"main":[[{"node":"🔎 Leitor de Extrato 🔎","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6b03ca97-9e9a-476a-a6bd-d135fe69e7f0","triggerCount":0,"tags":[]}