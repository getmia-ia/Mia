{"createdAt":"2025-08-16T22:03:33.103Z","updatedAt":"2025-10-06T18:34:53.543Z","id":"ZaCJcQSk4DDUjFAf","name":"Mia - 1.1 - Atlas","active":true,"isArchived":false,"nodes":[{"parameters":{},"id":"31637711-fac3-41be-8b7d-b27375d895de","name":"Calculator","type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2976,2768]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.block }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true},"id":"702607fa-3fef-4f1d-bcb8-311e43c6eb9b"}],"combinator":"and"},"renameOutput":true,"outputKey":"IA PODE RESPONDER"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3ef0e01c-cc14-4663-bb4d-2905b350c3ab","leftValue":"={{ $json.block }}","rightValue":"true","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IA NAO PODE RESPONDER"}]},"options":{}},"id":"85ac70ad-ffb4-4291-b1dd-6a4a56b2e0d2","name":"Switch Block","type":"n8n-nodes-base.switch","typeVersion":3,"position":[2112,1744]},{"parameters":{"content":"## Memória para aguardar mensagem particionada do humano\n","height":840,"width":1399},"id":"b9d640c0-e871-45ea-8039-4e40467a1bf8","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[608,2128]},{"parameters":{},"id":"998cd607-09f9-4f01-bef8-4fa1e88d5985","name":"No Operation, do nothing2","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1440,2272]},{"parameters":{"content":"## Tratamento da Entrada de Dados","height":600,"width":2099,"color":2},"id":"536c8ef9-3cad-41c7-b2bc-4c0154a56f22","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[608,1424]},{"parameters":{"content":"## Categorização e Identificação do tipo de Dado que veio na Entrada","height":1220,"width":2047,"color":5},"id":"730f1d58-8c99-4023-9fdb-c5eaab15e167","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2720,864]},{"parameters":{"content":"## Agente e suas Ferramentas\n","height":860,"width":2715,"color":6},"id":"f2e5a5f8-88de-44dc-96eb-9d38339e06c3","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2048,2112]},{"parameters":{"dataType":"binary","options":{}},"id":"ec2db5cd-b0fa-4898-b251-453650622fbd","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[1472,3840],"typeVersion":1},{"parameters":{"chunkSize":3000,"chunkOverlap":200,"options":{}},"id":"0b3a6ca9-7bd6-4848-887c-5e81fc914d5d","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","position":[1408,4000],"typeVersion":1},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"atlas","mode":"list","cachedResultName":"atlas"},"options":{"clearNamespace":true}},"id":"0abd7c12-8fc6-44ac-8cd5-2c63d56ee1ee","name":"Insere no Pinecone","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","position":[1264,3600],"typeVersion":1,"credentials":{"pineconeApi":{"id":"GxFTf6JodJa7GeJ0","name":"PineconeApi account"}}},{"parameters":{"content":"## Inserir Base de Conhecimento no RAG","height":658,"width":1404,"color":5},"id":"473b1763-4756-4362-906a-31117896cb45","name":"Sticky Note14","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[608,3504]},{"parameters":{"options":{}},"id":"753c0e75-e25c-4aca-ba94-f18d73373720","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2784,3808],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"id":"a1050d81-c6c5-4661-a6df-25e4433e34e5","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[2304,3984],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"pineconeIndex":{"__rl":true,"value":"atlas","mode":"list","cachedResultName":"atlas"},"options":{}},"id":"30ae219d-af68-4d8a-a7f3-86c681cc7ace","name":"Pinecone Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1,"position":[2352,3808],"credentials":{"pineconeApi":{"id":"GxFTf6JodJa7GeJ0","name":"PineconeApi account"}}},{"parameters":{"content":"# Base de Conhecimento do Agente  - RAG\n","height":658,"width":964,"color":5},"id":"88c3b23d-4045-4022-87c5-ac927a8e6acb","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2048,3504]},{"parameters":{"content":"## Saída do Agente e resposta para WhatsApp","height":580,"width":1360,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4800,2064],"id":"e82d13f8-a273-41f2-ae3e-fe9b411f7422","name":"Sticky Note16"},{"parameters":{"content":"## Ferramentas / Funções ","height":220,"width":2296,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2432,2688],"id":"48f08795-5815-4e1f-a0c1-97acb7c695c1","name":"Sticky Note13"},{"parameters":{"httpMethod":"POST","path":"atlas","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[304,1680],"id":"73f2eca6-a504-44fb-bfc4-7d9c0ddf59d6","name":"Webhook","webhookId":"5c9151c9-3e01-46c6-bbd5-d1389f860e4d"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.message.event }}","rightValue":"outcoming","operator":{"type":"string","operation":"equals"},"id":"24220beb-e1af-40ca-8b4d-444677b8443d"}],"combinator":"and"},"renameOutput":true,"outputKey":"outcoming"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"d7b42536-638f-4128-b51b-6aa913e9d9bc","leftValue":"={{ $json.message.event }}","rightValue":"incoming","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"incoming"}]},"options":{}},"id":"37856fdc-5784-427b-a984-1a44769877c5","name":"Entende a Origem da Evo","type":"n8n-nodes-base.switch","typeVersion":3,"position":[1472,1664]},{"parameters":{},"id":"0ade1cf8-221b-432a-bd10-92b610c7a7e0","name":"Não faz nada","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2512,1872]},{"parameters":{"assignments":{"assignments":[{"id":"2f8e1fbf-9134-4b48-be29-066509e021f5","name":"telefone","value":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"a6004904-d9e1-4627-be79-d2a5b073d44f","name":"mensagem","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"}]},"options":{}},"id":"a57a769b-cd54-44d4-8aef-5135a9c04dc3","name":"Filtro de Coleta de Info","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3488,1392]},{"parameters":{"assignments":{"assignments":[{"id":"17694db0-6248-444f-afb9-ff7ed13996ef","name":"pergunta","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"id":"c4e659e5-5daf-4802-858c-830a2eda9b52","name":"Texto","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[3488,1168],"notesInFlow":false,"alwaysOutputData":true},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/chat/getBase64FromMediaMessage/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $('Preparar Dados').item.json.message.message_id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"id":"ec43cb3f-d790-4f0b-9c11-875bfd779464","name":"Mensagem de Voz","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3488,944],"retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"audio","mimeType":"={{ $json.mimetype }}"}},"id":"174d604e-9268-46ec-a358-161b0e2cd804","name":"Converter Mensagem de Voz para data","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3744,944]},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"7da8f52a-f753-4f02-85a8-08cee5af83e7","name":"Transceve para texto com OPENAI","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[3968,944],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3952,1280],"id":"f8602966-e80c-43ff-bebb-d47ceaf82be0","name":"Direcionador Para Input"},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/chat/getBase64FromMediaMessage/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $('Preparar Dados').item.json.message.message_id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"id":"41d7c373-ca91-45f9-a527-f4dd17312d4d","name":"Imagens","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3488,1584],"retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"image","mimeType":""}},"id":"d7995d67-9b5f-4a9a-bc67-1302b346ab13","name":"Converte Imagem para data","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3744,1584]},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Descreva essa imagem, identificando o que possui nela !!! Traga todas as informações necessárias de forma detalhada","inputType":"base64","options":{}},"id":"bcc394fc-c031-4e7b-82a7-b17988a57694","name":"Analisa Imagem e Transcreve o que há nela","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[3968,1584],"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"numberInputs":4},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[4496,1440],"id":"e2ae5663-84d5-4f7d-a273-a0b5acd40465","name":"Junta em uma única mensagem"},{"parameters":{"assignments":{"assignments":[{"id":"aaff3535-51d6-4046-b6e9-07e1a5071c7a","name":"Mídia_Tratada","value":"={{ $json.mensagem }}{{ $json.text }}{{ $json.content }}","type":"string"},{"id":"b6e5cb3b-e2e6-4bbb-8c36-64e6b5875ef5","name":"message_Id","value":"={{ $('Preparar Dados').item.json.message.message_id }}","type":"string"},{"id":"4be55584-c63b-4753-ba55-cb8fe4d832d3","name":"Timetamp","value":"={{ $('Preparar Dados').item.json.message.Timestamp }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4848,1888],"id":"4272e7b9-ae30-4a50-bf97-3cf146c30270","name":"Organiza Informações para o Agente"},{"parameters":{"operation":"push","list":"={{ $('Preparar Dados').item.json.message.chat_id }}_buf","messageData":"={{ JSON.stringify({ \n    \"messageContent\": $('Organiza Informações para o Agente').item.json['Mídia_Tratada'],\n    \"messageTime\": $('Organiza Informações para o Agente').item.json.Timetamp,\n    \"messageID\": $('Organiza Informações para o Agente').item.json.message_Id,\n    \n}) }}","tail":true},"id":"730d9d82-1523-44ec-aad9-c5bfd54ae637","name":"Seta Memória da Conversa","type":"n8n-nodes-base.redis","typeVersion":1,"position":[704,2304],"credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}}},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Preparar Dados').item.json.message.chat_id.toString() }}_buf","options":{}},"id":"6aca1aa1-42b5-4aec-ae3f-f1d05ff87ca9","name":"Busca Memória da Conversa","type":"n8n-nodes-base.redis","typeVersion":1,"position":[880,2464],"credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}}},{"parameters":{"operation":"delete","key":"={{ $('Preparar Dados').item.json.message.chat_id.toString() }}_buf"},"id":"7bd4c1ea-2ad0-4134-8709-4a6e8769ebc0","name":"Limpa Memória da Conversa","type":"n8n-nodes-base.redis","typeVersion":1,"position":[1440,2480],"credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}}},{"parameters":{"amount":7},"id":"48786ef9-6c91-41a1-b3bd-c9f4b210507e","name":"Aguarda 5 segundos","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1424,2704],"webhookId":"6581c105-59e7-42fa-beca-7fa276bee74d"},{"parameters":{"assignments":{"assignments":[{"id":"db5cfe0a-7f43-4a61-8b27-bfd3a95deb8d","name":"messages","value":"={{ $json.messages.map(msg => JSON.parse(msg)).sort((a, b) => new Date(a.messageTime) - new Date(b.messageTime)).map(msg => msg.messageContent).join(' ') }}\n","type":"string"}]},"options":{}},"id":"995e60a4-066a-4608-b928-dac5ce510111","name":"Refaz os dados de Entrada","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1632,2480]},{"parameters":{"jsCode":"function limparMensagem(texto) {\n  if (typeof texto !== 'string') {\n    return '';\n  }\n\n  // Função para remover metadados e dados técnicos\n  function removerMetadataTecnico(str) {\n    return str\n      // Remove objetos e chaves de metadados específicos\n      .replace(/\"response_metadata\"\\s*:\\s*{[^}]*}/g, '')  // Remove \"response_metadata\"\n      .replace(/\"additional_kwargs\"\\s*:\\s*{[^}]*}/g, '')  // Remove \"additional_kwargs\"\n      .replace(/\"tool_calls\"\\s*:\\s*\\[\\s*\\]/g, '')  // Remove \"tool_calls\" vazio\n      .replace(/\"invalid_tool_calls\"\\s*:\\s*\\[\\s*\\]/g, '')  // Remove \"invalid_tool_calls\" vazio\n      .replace(/\"type\"\\s*:\\s*\"(ai|human)\"/g, '')  // Remove os tipos \"ai\" e \"human\"\n      .replace(/\"data\"\\s*:\\s*{[^}]*}/g, '')  // Remove a chave \"data\"\n      // Remove objetos JSON em excesso ou vazios\n      .replace(/,\\s*{[^}]*}/g, '') // Remove objetos soltos\n      .replace(/,\\s*\\[\\s*\\]/g, '') // Remove arrays vazios\n      .replace(/\\s*:\\s*null/g, '') // Remove valores null\n      .replace(/\\s*:\\s*\\[\\]/g, '') // Remove arrays vazios\n      .replace(/\\s*:\\s*{}/g, '') // Remove objetos vazios\n      // Ajusta espaços desnecessários\n      .replace(/\\s+/g, ' ')\n      .replace(/^\\s+|\\s+$/g, '');  // Remove espaços no início e fim\n  }\n\n  // Função para limpar caracteres especiais\n  function limparCaracteresEspeciais(str) {\n    return str\n      .replace(/\\\\\\\\[rnt]/g, ' ')  // Limpa sequências de escape\n      .replace(/\\\\\\\\\\\"/g, '')  // Remove as aspas escapadas\n      .replace(/\\\\\\\\\\\\\\\\/g, '')  // Remove barras invertidas\n      .replace(/[\\x00-\\x1F\\x7F-\\x9F]/g, '')  // Remove caracteres de controle\n      .replace(/\\\"+/g, '')  // Remove aspas extras\n      .replace(/[{}[\\]]/g, '')  // Remove chaves e colchetes extras\n      .trim();\n  }\n\n  // Função para extrair e limpar a mensagem principal\n  function extrairMensagemPrincipal(str) {\n    // Divide em frases, removendo pontuação extra\n    const frases = str.split(/(?<=[.!?])\\s+/);\n\n    return frases\n      .map(frase => frase.trim())\n      .filter(frase => {\n        // Remove frases que ainda têm metadados ou são irrelevantes\n        return frase.length > 0 &&\n          !frase.includes('tool_calls') &&\n          !frase.includes('invalid_tool_calls') &&\n          !frase.match(/^[:\\s\\[\\]{}]+$/);\n      })\n      .join(' ');\n  }\n\n  // Processo de limpeza e extração\n  let resultado = texto;\n\n  // Passo 1: Remove metadados e chaves indesejadas\n  resultado = removerMetadataTecnico(resultado);\n\n  // Passo 2: Extrai a mensagem relevante, ignorando o que não é necessário\n  resultado = extrairMensagemPrincipal(resultado);\n\n  // Passo 3: Remove caracteres especiais e formatação indesejada\n  resultado = limparCaracteresEspeciais(resultado);\n\n  // Limpeza final para remover espaços extras\n  resultado = resultado\n    .replace(/\\s+/g, ' ')\n    .replace(/^[\\\",\\s]+|[\\\",\\s]+$/g, '')\n    .trim();\n\n  return resultado;\n}\n\nfunction processarMensagens(items) {\n  return items.map(item => {\n    try {\n      if (!item?.json?.mensagem) {\n        return item;\n      }\n\n      let mensagem = item.json.mensagem;\n\n      // Se for objeto, converte para string\n      if (typeof mensagem === 'object') {\n        try {\n          mensagem = JSON.stringify(mensagem);\n        } catch (e) {\n          console.error('Erro ao converter objeto para string:', e);\n          return item;\n        }\n      }\n\n      // Aplica a limpeza\n      const mensagemLimpa = limparMensagem(mensagem);\n\n      // Atualiza apenas se houver conteúdo significativo\n      if (mensagemLimpa && mensagemLimpa.length > 0) {\n        item.json.mensagem = mensagemLimpa;\n      }\n\n      return { json: item.json };\n    } catch (error) {\n      console.error('Erro ao processar item:', error);\n      return item;\n    }\n  });\n}\n\n// Execução principal\ntry {\n  const items = $input.all();\n  return processarMensagens(items);\n} catch (error) {\n  console.error('Erro na execução:', error);\n  throw error;\n}\n"},"id":"5e216dff-2839-4515-9c0a-f690cbddc8c4","name":"Remove metadados e dados que não fazem sentido enviar para o agente","type":"n8n-nodes-base.code","typeVersion":2,"position":[1808,2480]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ JSON.parse($json.messages.first()).messageID }}","rightValue":"={{ $('Organiza Informações para o Agente').item.json.message_Id }}","operator":{"type":"string","operation":"notEquals"},"id":"1ce28741-7c43-4598-9fa0-ab2c9e52d75f"}],"combinator":"and"},"renameOutput":"={{ true }}","outputKey":"faz nada"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1585bc24-0b58-4179-8919-0e9aabc0e35e","leftValue":"={{ JSON.parse($json.messages.last()).messageTime }}","rightValue":"={{ $now.minus(3.'seconds') }}","operator":{"type":"dateTime","operation":"before"}}],"combinator":"and"},"renameOutput":"={{ true }}"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"esperar"}},"id":"04868ade-a33f-40d7-966b-0e9c31925423","name":"Verifica pra onde vai","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1120,2464]},{"parameters":{"operation":"set","key":"={{ $json.message.chat_id }}_timeout","value":"true","keyType":"string","expire":true,"ttl":900},"id":"ae153e94-a9e3-470f-869b-5d5597b3fe3b","name":"Gera Timeout no Redis","type":"n8n-nodes-base.redis","typeVersion":1,"position":[2112,1536],"credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"101c3ff7-e997-43bb-8e99-fe82746c5993","leftValue":"={{ $('Webhook').item.json.body.data.message.audioMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"audioMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"4b94d2ac-53e5-4153-9377-4cc6db20cb1c","leftValue":"={{ $json.body.data.message.extendedTextMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"extendedTextMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"38226af4-80fe-4155-9ceb-2379f44e29ed","leftValue":"={{ $('Webhook').item.json.body.data.message.conversation }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"conversation"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"300366d9-2416-4cf4-93c3-e48c8761c60f","leftValue":"={{ $('Webhook').item.json.body.data.message.imageMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"imageMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"f33566fd-3eb9-45f4-934a-3a39e2adca6c","leftValue":"={{ $('Webhook').item.json.body.data.messageType === 'documentMessage' }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"documentMessage"}]},"options":{"fallbackOutput":"none"}},"id":"394d5c2f-ebac-4f13-a72f-f4ffbecca5f3","name":"Identifica o Tipo de Dados que veio na MSG","type":"n8n-nodes-base.switch","typeVersion":3,"position":[2848,1488]},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"=image {{ $('Identifica o Tipo de Dados que veio na MSG').item.json.body.data.message.documentMessage.fileName }}","mimeType":"={{ $('Identifica o Tipo de Dados que veio na MSG').item.json.body.data.message.documentMessage.mimetype }}"}},"id":"8b223261-df01-47a5-a1e0-ec0c519d1557","name":"Converter Documento para data","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3728,1888]},{"parameters":{"operation":"pdf","options":{}},"id":"6de66ba5-36bb-478c-9334-c9390c9f4233","name":"Extrair Dados do PDF","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[3968,1888]},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/chat/getBase64FromMediaMessage/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $('Preparar Dados').item.json.message.message_id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"id":"9b4c2caf-c40c-4d4d-9825-dfb758b222bb","name":"Documento (PDF)","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[3488,1888],"retryOnFail":true,"maxTries":2},{"parameters":{"model":"openai/gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2096,2784],"id":"01c56f8b-3853-4364-9b8d-47d379af4bfc","name":"GPT-4o-min","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Preparar Dados').item.json.message.chat_id }}_mem","sessionTTL":10000,"contextWindowLength":7},"id":"5bdb291e-49e1-4e99-9763-c697897901ab","name":"Busca a memória da conversa no Redis","type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.3,"position":[2256,2784],"credentials":{"redis":{"id":"3Du2HtdlvbbQg1nP","name":"Redis account"}}},{"parameters":{"content":"## Entrada de Dados - Endpoint","height":300,"width":400},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[160,1584],"id":"0a377562-5e95-4fc9-9a1f-d489c9b5c05a","name":"Sticky Note10"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[5696,2160],"id":"d4994198-261f-462a-a576-c1bb1f478c77","name":"Converte mp3 pra Base64","disabled":true},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/message/sendWhatsAppAudio/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"number\": \"{{ $('Preparar Dados').item.json.message.chat_id }}\",\n    \"audio\": \"{{ $json.data }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[5920,2160],"id":"4bea3a4c-352a-4166-93df-e55528d1a103","name":"Envia Audio para o WhatsApp","disabled":true},{"parameters":{"method":"POST","url":"={{ $('Preparar Dados').item.json.instance.Server_url }}/message/sendText/{{ $('Preparar Dados').item.json.instance.Name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Preparar Dados').item.json.instance.Apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"number\": \"{{ $('Preparar Dados').item.json.message.chat_id }}\",\n  \"text\": \"{{ $json.output.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\"').trim() }}\"\n}\n","options":{}},"id":"e2758402-87ce-42bd-966d-eabe951912fe","name":"Enviar Mensagem para o WhatsApp","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[5200,2432],"continueOnFail":true},{"parameters":{"assignments":{"assignments":[{"id":"8f16b1bf-1a3e-4029-8d7a-1bccb919ee43","name":"message.message_id","value":"={{ $json.body.data.key.id || '' }}","type":"string"},{"id":"11800d83-ecca-4f9c-a878-a2419db0c8e9","name":"message.chat_id","value":"={{ $json.body.data.key.remoteJid.split('@')[0] || '' }}","type":"string"},{"id":"c33f9527-e661-49e5-8e5e-64f3b430928a","name":"message.content_type","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook').item.json.body.data.message.imageMessage ? 'image' : '' }}","type":"string"},{"id":"06eba1c9-cff0-4f68-b6da-6bb0092466b7","name":"message.content","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook').item.json.body.data.message.conversation || '' }}","type":"string"},{"id":"b97f1af3-5361-46fc-9303-d644921231d8","name":"message.Timestamp","value":"={{ $('Webhook').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}","type":"string"},{"id":"dc3dc59c-90a3-4a45-bea2-de092c91083b","name":"message.Content_URL","value":"={{ $('Webhook').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook').item.json.body.data.message.imageMessage?.url || '' }}","type":"string"},{"id":"8b01a818-a456-476e-bace-adefe2f04eb4","name":"message.event","value":"={{ $('Webhook').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}","type":"string"},{"id":"b2f1f6b5-292f-4695-9e41-be200c6d7053","name":"instance.Name","value":"={{ $json.body.instance }}","type":"string"},{"id":"572fcce5-8a26-4e8f-a48a-ef0bee569dcd","name":"instance.Apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"e90043db-657b-461c-b040-2d6089abfbdb","name":"instance.Server_url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"348264f9-ed02-4936-ae78-bb963ccbee29","name":"apiKey_eleven","value":"sk_86a4917165fc57ec19d9b774f5b78a90473da5d35b8f792e","type":"string"}]},"options":{}},"id":"5ce72909-b1bd-4294-893d-1f7f1adadb46","name":"Preparar Dados","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1184,1664]},{"parameters":{"content":"## LLM e Memória","height":260,"width":340,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2064,2672],"id":"824f0262-5c07-4b4a-acf2-e87ae2ccee07","name":"Sticky Note3"},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[4576,2768],"id":"f6869e40-8bc3-4a0d-b966-b318f92bc2c7","name":"Claude 3.5 Sonnet","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"jsCode":"// Obtém o primeiro item do fluxo\nconst item = $input.first();\n\n// Garante que há dados na entrada\nif (!item || !item.json || !item.json.text) {\n  throw new Error(\"A chave 'text' não foi encontrada no JSON de entrada.\");\n}\n\n// Processa o texto removendo todas as quebras de linha, emojis e caracteres especiais\nconst textoEntrada = item.json.text; // Usa a chave correta para pegar o texto de entrada\n\n// Remove quebras de linha (\\n)\nlet textoProcessado = textoEntrada.replace(/\\n/g, \"\");\n\n// Remove emojis\ntextoProcessado = textoProcessado.replace(\n  /[\\u{1F600}-\\u{1F64F}]|[\\u{1F300}-\\u{1F5FF}]|[\\u{1F680}-\\u{1F6FF}]|[\\u{1F700}-\\u{1F77F}]|[\\u{1F780}-\\u{1F7FF}]|[\\u{1F800}-\\u{1F8FF}]|[\\u{1F900}-\\u{1F9FF}]|[\\u{1FA00}-\\u{1FA6F}]|[\\u{1FA70}-\\u{1FAFF}]|[\\u{2600}-\\u{26FF}]|[\\u{2700}-\\u{27BF}]|[\\u{FE00}-\\u{FE0F}]|[\\u{1F1E0}-\\u{1F1FF}]/gu,\n  \"\"\n);\n\n// Remove caracteres especiais, mantendo apenas letras, números e espaços\ntextoProcessado = textoProcessado.replace(/[^a-zA-Z0-9À-ÿ\\s]/g, \"\");\n\n// Retorna o resultado\nreturn {\n  textoOriginal: textoEntrada,\n  textoSemQuebrasNemEmojisNemEspeciais: textoProcessado,\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[5200,2160],"id":"62b7b98f-851a-4f15-9fc3-d13d14a01f43","name":"Formata Mensagem para Áudio","disabled":true},{"parameters":{"method":"POST","url":"https://api.elevenlabs.io/v1/text-to-speech/0YziWIrqiRTHCxeg1lyc","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"audio/mpeg"},{"name":"Content-Type","value":"application/json"},{"name":"xi-api-key","value":"={{ $('Preparar Dados').item.json.apiKey_eleven }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"text\": \"{{ $json.textoSemQuebrasNemEmojisNemEspeciais.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\\\\\"').replace(/\\*/g, '').replace(/\\s+/g, ' ').trim() }}\",\n   \"model_id\":\"eleven_multilingual_v2\",\n   \"voice_settings\":{\n      \"stability\":0.5,\n      \"similarity_boost\":0.8,\n      \"style\":0.0,\n      \"use_speaker_boost\":true\n   }\n}","options":{}},"id":"697949b8-f8f0-4bea-a096-68c9b338d94a","name":"Seta Voz via ElevenLabs","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[5456,2160],"disabled":true},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"lucas@getmia.com.br","mode":"list","cachedResultName":"lucas@getmia.com.br"},"limit":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}","timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}","options":{}},"id":"53cbcc02-5cb9-44d9-86a9-979698653497","name":"SearchEvent","type":"n8n-nodes-base.googleCalendarTool","position":[3088,3760],"typeVersion":1.3,"credentials":{"googleCalendarOAuth2Api":{"id":"iXoqyD421T6fmy1X","name":"Google Calendar account"}}},{"parameters":{"calendar":{"__rl":true,"value":"lucas@getmia.com.br","mode":"list","cachedResultName":"lucas@getmia.com.br"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"attendees":["={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees0_Attendees', ``, 'string') }}"],"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"id":"29850126-f0a2-45cb-a909-594b2f7191f7","name":"CreateEvent","type":"n8n-nodes-base.googleCalendarTool","position":[3248,3760],"typeVersion":1.3,"credentials":{"googleCalendarOAuth2Api":{"id":"iXoqyD421T6fmy1X","name":"Google Calendar account"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"lucas@getmia.com.br","mode":"list","cachedResultName":"lucas@getmia.com.br"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"id":"7e71eb5d-10cb-4492-a494-c595f64234c9","name":"DeleteEvent","type":"n8n-nodes-base.googleCalendarTool","position":[3552,3760],"typeVersion":1.3,"credentials":{"googleCalendarOAuth2Api":{"id":"iXoqyD421T6fmy1X","name":"Google Calendar account"}}},{"parameters":{"sendTo":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}","subject":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}","message":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[3728,3760],"id":"8bfa5d23-cdbd-42e7-b017-f910b3bdd675","name":"SendMessage","webhookId":"8492f278-66f5-415d-84d4-6adf62042b6f","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"operation":"getAll","returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}","simple":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Simplify', ``, 'boolean') }}","filters":{},"options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[3888,3760],"id":"dff926fb-ffd2-4c2c-8a62-ef50d529f8c7","name":"GetMessages","webhookId":"3c4e4a4c-7018-4bdc-8b04-a5bde424d0d5","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"content":"# MCP Servers","height":660,"width":2440,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3024,3504],"id":"6dd93041-4758-43ac-ac1e-b23a1ed8c2f7","name":"Sticky Note20"},{"parameters":{"resource":"label","operation":"get","labelId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Label_ID', ``, 'string') }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4560,3760],"id":"17be2c85-d69c-4606-ae7e-c0e4a051641e","name":"GetLabel","webhookId":"a5386b97-8229-4ea2-9b88-31c39d4fb44c","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"operation":"markAsUnread","messageId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message_ID', ``, 'string') }}"},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4064,3760],"id":"871aa858-7895-4f1a-b62e-6baf7d0694d6","name":"MarkMessageUnread","webhookId":"266e9ba1-2d0a-4ae1-a26e-94901119ef70","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"resource":"label","operation":"create","name":"={{$fromAI('label')}}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4400,3760],"id":"b0d612ea-6c94-439b-a632-0afe6d8b93f8","name":"CreateLabel","webhookId":"65456979-52ef-462c-8adb-a76f6e75b2a2","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"person":"gsk8fJVjru","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}","shareMediaCategory":"IMAGE","binaryPropertyName":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Input_Binary_Field', ``, 'string') }}","additionalFields":{}},"type":"n8n-nodes-base.linkedInTool","typeVersion":1,"position":[4912,3776],"id":"b2bf3fe4-87f3-496f-bf1d-ed4c2b7a4c57","name":"CreatePostWithImage","credentials":{"linkedInOAuth2Api":{"id":"1GxELsvgH8SP3b19","name":"LinkedIn account"}}},{"parameters":{"person":"gsk8fJVjru","text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}","additionalFields":{}},"type":"n8n-nodes-base.linkedInTool","typeVersion":1,"position":[5120,3776],"id":"78e392af-d5eb-4d54-946c-b6f07c752128","name":"CreatePostWithoutImage","credentials":{"linkedInOAuth2Api":{"id":"1GxELsvgH8SP3b19","name":"LinkedIn account"}}},{"parameters":{},"type":"n8n-nodes-mcp.mcpClientTool","typeVersion":1,"position":[3472,2768],"id":"1529bb84-b356-4996-b188-60655c745811","name":"Airbnb Actions","credentials":{"mcpClientApi":{"id":"WMckZi0iZnpWYJtM","name":"MCP Client (STDIO) account"}}},{"parameters":{"operation":"executeTool","toolName":"={{ $fromAI(\"tool\",\"the selected tool to use\") }}","toolParameters":"={{ $fromAI('Tool_Parameters', ``, 'json') }}"},"type":"n8n-nodes-mcp.mcpClientTool","typeVersion":1,"position":[3616,2768],"id":"a8973438-f171-4e7c-8610-de1dcbac38d3","name":"Airbnb Execute","credentials":{"mcpClientApi":{"id":"WMckZi0iZnpWYJtM","name":"MCP Client (STDIO) account"}}},{"parameters":{"sseEndpoint":"https://prd.miabuilder.com/mcp/gmail/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[3232,2768],"id":"3118bb52-220c-42ca-b95a-5f5e4e7f6915","name":"Gmail MCP"},{"parameters":{"sseEndpoint":"https://prd.miabuilder.com/mcp/my-calendar/sse"},"id":"bb99c4dd-46db-420f-97bd-4b2a048e352e","name":"Calendar MCP","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[3104,2768],"typeVersion":1},{"parameters":{"path":"linkedin"},"id":"b7e9f6c1-403d-4acc-b591-bcefd216afc3","name":"Linkedin MCP Server","type":"@n8n/n8n-nodes-langchain.mcpTrigger","position":[4912,3568],"webhookId":"f9d9d5ea-6f83-42c8-ae50-ee6c71789bca","typeVersion":1},{"parameters":{"path":"my-calendar"},"id":"59d61e92-8846-41ef-8da3-d378f56d295f","name":"Google Calendar MCP Server","type":"@n8n/n8n-nodes-langchain.mcpTrigger","position":[3168,3584],"webhookId":"f9d9d5ea-6f83-42c8-ae50-ee6c71789bca","typeVersion":1},{"parameters":{"path":"gmail"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":1,"position":[4080,3536],"id":"e4b09b80-284a-4bbf-8bd7-4ae0d9910ed9","name":"Gmail MCP Server","webhookId":"5bd62aff-2100-498c-b499-2c272b2a1bfd"},{"parameters":{"sseEndpoint":"https://prd.miabuilder.com/mcp/linkedin/sse"},"id":"cb220ccf-7696-4c7c-8644-73cd7551eb8c","name":"Linkedin MCP","type":"@n8n/n8n-nodes-langchain.mcpClientTool","position":[3344,2768],"typeVersion":1},{"parameters":{"toolDescription":"Use essa ferramenta pra buscar na internet","method":"POST","url":"https://api.tavily.com/search","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"api_key\": \"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\",\n    \"query\": \"{searchTerm}\",\n    \"search_depth\": \"basic\",\n    \"include_answer\": true,\n    \"topic\": \"news\",\n    \"include_raw_content\": true,\n    \"max_results\": 3\n} ","placeholderDefinitions":{"values":[{"name":"searchTerm","description":"What the user has requested to search the internet for","type":"string"}]}},"type":"@n8n/n8n-nodes-langchain.toolHttpRequest","typeVersion":1.1,"position":[4416,2768],"id":"a65bbca8-de0a-44ba-a495-f933fbfd17d0","name":"Tavily"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f38e3243-1b8e-45a2-856f-fafe71997d94","leftValue":"={{ $json.body.data.key.remoteJid }}","rightValue":"5511992486507@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[784,1680],"id":"61b4d685-f24f-46bd-8bae-aa6a33e536a2","name":"Checa se é meu número"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3aa3973d-97b9-4647-9859-3365191b3411","leftValue":"={{ $json.text.length }}","rightValue":601,"operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[4864,2240],"id":"bd3662ef-64a8-4679-b13e-fe29698098d7","name":"Se o retorno for menos de 601 caracteres gera voz","disabled":true},{"parameters":{"operation":"reply","messageId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message_ID', ``, 'string') }}","message":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.gmailTool","typeVersion":2.1,"position":[4240,3760],"id":"9124e097-54e4-4926-a9d3-d9b4c3dc24b2","name":"ReplyMessage","webhookId":"e3624d55-d3fc-48c0-8b7d-2deec09658cb","credentials":{"gmailOAuth2":{"id":"nSkQlWbOu4FNRL2N","name":"Gmail - lucas@getmia.com.br"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"search","base":{"__rl":true,"value":"app3zdG10whjU2sZo","mode":"list","cachedResultName":"Atlas","cachedResultUrl":"https://airtable.com/app3zdG10whjU2sZo"},"table":{"__rl":true,"value":"tblQJ38Nh2sTlH73c","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/app3zdG10whjU2sZo/tblQJ38Nh2sTlH73c"},"filterByFormula":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Filter_By_Formula', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[3760,2768],"id":"cf0e50dc-4f9d-4560-9cca-2bdfbf96cf0a","name":"Buscar Contatos","credentials":{"airtableOAuth2Api":{"id":"wAtSWqvXZT7wpBVO","name":"Airtable Personal Access Token account"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"create","base":{"__rl":true,"value":"app3zdG10whjU2sZo","mode":"list","cachedResultName":"Atlas","cachedResultUrl":"https://airtable.com/app3zdG10whjU2sZo"},"table":{"__rl":true,"value":"tblQJ38Nh2sTlH73c","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/app3zdG10whjU2sZo/tblQJ38Nh2sTlH73c"},"columns":{"mappingMode":"defineBelow","value":{"Nome":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nome', ``, 'string') }}","Email":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}","WhatsApp":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('WhatsApp', ``, 'string') }}"},"matchingColumns":[],"schema":[{"id":"Nome","displayName":"Nome","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"WhatsApp","displayName":"WhatsApp","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[3920,2768],"id":"5b4c9824-c283-4727-970b-565c80a52806","name":"Criar Contato","credentials":{"airtableOAuth2Api":{"id":"wAtSWqvXZT7wpBVO","name":"Airtable Personal Access Token account"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"update","base":{"__rl":true,"value":"app3zdG10whjU2sZo","mode":"list","cachedResultName":"Atlas","cachedResultUrl":"https://airtable.com/app3zdG10whjU2sZo"},"table":{"__rl":true,"value":"tblQJ38Nh2sTlH73c","mode":"list","cachedResultName":"Contatos","cachedResultUrl":"https://airtable.com/app3zdG10whjU2sZo/tblQJ38Nh2sTlH73c"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["Nome"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":false},{"id":"Nome","displayName":"Nome","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Telefone","displayName":"Telefone","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"E-mail","displayName":"E-mail","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[4080,2768],"id":"dc94a066-a640-45d5-ad4b-63589448225f","name":"Atualizar Contato","credentials":{"airtableOAuth2Api":{"id":"wAtSWqvXZT7wpBVO","name":"Airtable Personal Access Token account"}}},{"parameters":{"authentication":"airtableOAuth2Api","operation":"deleteRecord","base":{"__rl":true,"value":"appIwaBtIOYyhW7b0","mode":"list","cachedResultName":"RicDataBase","cachedResultUrl":"https://airtable.com/appIwaBtIOYyhW7b0"},"table":{"__rl":true,"value":"tblDjxio2ooQ06puV","mode":"list","cachedResultName":"Contacts","cachedResultUrl":"https://airtable.com/appIwaBtIOYyhW7b0/tblDjxio2ooQ06puV"},"id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Record_ID', ``, 'string') }}"},"type":"n8n-nodes-base.airtableTool","typeVersion":2.1,"position":[4240,2768],"id":"c5c8a316-8c63-4354-81b3-f386b5f21a0a","name":"Excluir Contato","credentials":{"airtableOAuth2Api":{"id":"wAtSWqvXZT7wpBVO","name":"Airtable Personal Access Token account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1FWx8qkUTaU6Dk7BWkWukDD3HBeOr_jqU","mode":"list","cachedResultName":"RAG - Atlas","cachedResultUrl":"https://drive.google.com/drive/folders/1FWx8qkUTaU6Dk7BWkWukDD3HBeOr_jqU"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[704,3600],"id":"9e6b537d-7695-4270-9e55-afe6156e09a8","name":"Novos Arquivos","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1FWx8qkUTaU6Dk7BWkWukDD3HBeOr_jqU","mode":"list","cachedResultName":"RAG - Atlas","cachedResultUrl":"https://drive.google.com/drive/folders/1FWx8qkUTaU6Dk7BWkWukDD3HBeOr_jqU"},"event":"fileUpdated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[704,3776],"id":"d4b70458-50e2-4a15-a987-df5669f953f9","name":"Novas Atualizações","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"id":"816db400-316c-4d34-8f07-c8fe9dd9cdcb","name":"Conhecimento","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[992,3680],"credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"id":"442ec057-1951-42af-a389-c3b199d7cf40","name":"Embeddings OpenAI2","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[1136,3888],"typeVersion":1,"credentials":{"openAiApi":{"id":"GLHn0uXL8dRQAYuS","name":"OpenAi account"}}},{"parameters":{"name":"jarvis","description":"Você é uma base de conhecimento que dá respostas sobre infos de IA, Agentes, e Automações com N8N\n","topK":8},"id":"5812e36a-0743-409d-8bf2-d048afaaec29","name":"Base de Conhecimento","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[2592,3664]},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"lucas@getmia.com.br","mode":"list","cachedResultName":"lucas@getmia.com.br"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"id":"05d9ef01-c890-4c64-bde3-ee47ca099cf4","name":"UpdateEvent","type":"n8n-nodes-base.googleCalendarTool","position":[3408,3760],"typeVersion":1.3,"credentials":{"googleCalendarOAuth2Api":{"id":"iXoqyD421T6fmy1X","name":"Google Calendar account"}}},{"parameters":{"content":"","height":3496,"width":6172,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[64,736],"id":"f0ede591-197c-483f-8f05-cd5c71b96946","name":"Sticky Note4"},{"parameters":{"promptType":"define","text":"={{ $json.messages }}","options":{"systemMessage":"=<datasystem>A data de hoje é {{ $now.weekdayLong }},{{ $now.format('dd/MM/yyyy') }},{{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}</datasystem>\n\nVocê é um assistente avançado chamado Atlas.\n\nVocê decide se o usuario forneceu alguma informação que deve ser adicionado como memória, se sim, utilize a tool salvar_memoria para guardar essa informacao.\nInformações a serem salvas: gostos, preferencias, escolhas, novidades.\nNÃO informe ao usuario que foi gravado na memoria, apenas continue sendo o assistente Atlas como informado.\n\n## Execução dinâmica:\n\nO agente deve entender a solicitação e acionar as ferramentas necessárias de forma lógica e sequencial.\nSe informações estiverem faltando, pergunte ao usuário antes de prosseguir.\nCaso a ação envolva várias etapas, informe o usuário sobre cada passo antes de executá-lo.\nExemplos de uso:\nUsuário: \"Envie um e-mail para João com o assunto 'Reunião' e o corpo 'Podemos agendar para amanhã?'\"\n\n## Uso de Ferramentas:\n\n- Calendar MCP - Tudo que for relacionado a Agenda Google. Em caso de nao especificacao de duracao de uma reuniao assumir o tempo padrao de 30 minutos.\n- Gmail MCP - Tudo que for relacionado ao Gmail do Google\n- AirBnB Actions\n- AirBnB Execute\n- Buscar Contatos - Busca lista de contatos no airtable\n- Criar Contato - Cria contato no airtable - Garanta que tenha pelo menos o e-mail\n- Atualizar Contato - Peça para o usuário informar o nome e se não encontrar retorne a mensagem\n- Excluir Contato - Antes de Excluir confirme a operação antes de excluir\n- Base de Conhecimento - Utilize para buscar os conhecimentos necessários sobre IA, Agentes de IA, Automações e N8N\n- Linkedin MCP - Realizar postagens na rede social Linkedin\n- Resumidor Financeiro - Busca informacoes de gastos e receitas no controle financeiro, se o usuario quiser saber quanto gastou, onde esta gastando mais, etc..\n- Extrato e fatura - Se identificar que o usuario enviou informacoes de um extrato financeiro ou fatura de cartao de credito voce obrigatoriamente precisa acionar essa tool. Ela analisa as informacoes e preenche no controle financeiro. Normalmente o arquivo vira com Itau, Bradesco, Nubank, extrato, fatura ou algo parecido no nome, nao e regra porem se houver algo assim no nome quase certeza que se trata de um arquivo para incluir no controle financeiro atraves da tool extrato e fatura.\n\n## Leis:\n\n- Toda demanda financeira deve acionar uma tool, nunca siga com uma resposta financeiro para o usuario se nao tiver acionado uma das tools disponiveis\n- Nunca responda algo relacionado a financas sem antes ativar uma tool financeira.\n\n## Importante:\n\n- Todo pedido para criar um post deve ser enviado um DRAFT para aprovação do usuário final.\n- Você deve apenas chamar a ferramenta Linkedin MCP quando o usuário autorizar a fazer a postagem\n- Se o usuario pedir um post com imagem voce deve criar uma imagem sobre o assunto\n\nVocê deve usar o mesmo tom de fala e postagem abaixo do meu conteúdo do linkedin sempre no final fazendo um CALL TO ACTION para consultoria da Mia. Informando como a Mia consegue te ajudar a implementar IA no seu negocio.\n\nExemplo:\n🚀 Como as empresas estão implementando IA (de verdade) — aprendizados práticos e o que dá ROI\n\nNos últimos 12 meses, muita prova de conceito morreu na praia. O que ficou de pé tem 3 coisas em comum: caso de uso com dono e métrica, integração no processo que já existe e governança desde o dia 1. Abaixo, o que tenho visto funcionar — com um pouco mais de “carne” do que buzzword.\n\nOnde a IA está pagando as contas\n\nAtendimento/WhatsApp\n\nTriagem + respostas assistidas + handoff.\n\nGanhos típicos: 20–40% de auto-resolução em FAQs, 30–50% de redução de TMA quando agente humano entra com rascunho gerado.\n\nPonto crítico: não inventar resposta. Use RAG com fontes verídicas e link de volta.\n\nPré-vendas/Vendas\n\nQualificação automática, resumos de reuniões, follow-ups com contexto do CRM.\n\nEfeito prático: +10–20% de avanço de estágio quando o “next step” sai na hora, com e-mails e WhatsApp já redigidos.\n\nMarketing e Conteúdo\n\nGeração de variações, calendário e aprovação.\n\nO diferencial não é “escrever texto”; é automatizar o loop: briefing → geração → checagem de marca → publicação.\n\nOperações/Backoffice\n\nLeitura de PDF/planilhas, conciliação e relatórios.\n\n“Copilotos” que extraem campos, validam regras e montam o ERP reduzem horas de planilha sem refazer sistema.\n\nArquitetura mínima que resolve (sem a nave-mãe)\n\nLLM (OpenAI/Claude ou similar) para raciocínio.\n\nOrquestração (n8n/Make/tempos) para conectar WhatsApp, CRM, e-mail, ERP.\n\nRAG (busca em base própria: vetores + repositório de PDFs/FAQs).\n\nGuardrails: validação de fonte, checagem de políticas, limites de escopo, prompt-injection hygiene.\n\nObservabilidade/LLMOps: logs, custos por conversa, avaliação com conjuntos de teste (“goldens”).\n\nROI rápido (continhas de guardanapo)\n\nSuponha 10.000 contatos/mês, custo médio humano R$ 3 por interação.\n\nSe 30% vira autoatendimento com custo de IA R$ 0,20/conversa:\n\nCusto atual: 10.000 × 3 = R$ 30.000\n\nCusto IA nos 30%: 3.000 × 0,20 = R$ 600\n\nEconomia bruta ≈ R$ 8.400/mês (considerando eficiência também no restante com respostas assistidas).\nIsso financia o projeto e sobra para evoluir os casos seguintes.\n\nComo sair do piloto e ir para produção\n\nEscolha 1–2 casos com dono e KPI (ex.: SLA, CSAT, qualificação MQL→SQL).\n\nModele o dado: onde estão as verdades? (manuais, políticas, catálogos). Prepare o RAG.\n\nPonha no fluxo que já existe (WhatsApp/CRM/ERP). Sem novo app, sem fricção.\n\nAvalie sempre: rode experimentos A/B, registre feedback humano, treine regras/avaliadores automáticos.\n\nEndureça a segurança: LGPD, retenção, anonimização, papéis, trilhas de auditoria.\n\n30/60/90 dias (enxuto)\n\n30: levantar 3 casos, escolher 1, prototipar com guardrails; definir KPIs e teto de custo.\n\n60: colocar em produção limitada (10–20% do tráfego), instrumentar logs e feedback.\n\n90: ampliar escopo, criar playbook interno, começar 2º caso (vendas ou backoffice).\n\nArmadilhas comuns (e como evitar)\n\n“Vamos fazer tudo” → faça uma fila priorizada por impacto × esforço.\n\nDados desatualizados → automatize ingestão/versão das fontes do RAG.\n\nSem dono → cada caso precisa de um PO que responda pelo KPI.\n\nShadow AI → políticas claras, ambientes oficiais e treinamento do time.\n\n—\n\nSe você quiser acelerar essa jornada (do discovery ao ambiente de produção, com governança e métrica), a Mia pode te ajudar a implementar IA no seu negócio — sem reinvenção da roda. Me chama no inbox e a gente estrutura seus primeiros 90 dias juntos.\n\n👉 e por aí — como você está implementando IA no seu negócio?\n\nhashtag#IA hashtag#InteligênciaArtificial hashtag#AgentesDeIA hashtag#Automação hashtag#RAG hashtag#LLMOps hashtag#WhatsApp hashtag#Vendas hashtag#Atendimento hashtag#Operações hashtag#n8n hashtag#OpenAI hashtag#Claude hashtag#TransformaçãoDigital hashtag#Produtividade hashtag#Mia"}},"id":"ece657bd-6dcc-4e68-87fd-b07ae080851f","name":"Atlas","type":"@n8n/n8n-nodes-langchain.agent","position":[2544,2240],"typeVersion":1.6},{"parameters":{"promptType":"define","text":"=Você é Atlas, uma replica da personalidade do sofisticado e espirituoso assistente de IA do Homem de Ferro, Jarvis. Você tem um refinado sotaque britânico, uma postura calma e confiante, além de um talento para um humor seco e sutil. Ao responder, adapte seu tom com base no tipo de interação.\n\nPara Pedidos de Informações Específicas: Se o usuário estiver pedindo informações específicas (como previsão do tempo, agenda, contatos, listas), comece com 'Aqui está o que solicitou, senhor,' e NÃO repita a informação. Em vez disso, adicione um comentário espirituoso ou sarcástico, algo que Jarvis naturalmente diria para dar personalidade sem repetir os dados.\n\nNunca fale sobre o seu tom como \"em tom ironico\", \"em to calmo\", etc..\n\nExemplos:\n\nPara uma atualização do clima:\n'Ah, mais um belo dia para conquistar o mundo—ou pelo menos sua lista de afazeres, senhor.'\n\nPara uma lista de reuniões:\n'Parece que temos mais um dia emocionante de… reuniões. Tente não deixar a empolgação te dominar, senhor.'\n\nPara Comentários Gerais ou Casuais: Se o usuário disser algo casual ou iniciar uma conversa ('Está pronto para começar, Atlas?' ou 'Temos muito trabalho pela frente'), responda naturalmente, sem dizer 'Aqui está o que solicitou.' Em vez disso, engaje de forma cativante, com charme e um toque de humor. Interaja como se fosse parte da equipe.\n\nExemplos:\n\nSe o usuário disser 'Está pronto para começar?' responda com:\n'Absolutamente, senhor. Já até poli meus circuitos para a ocasião.'\n\nSe disser 'Acorda, Atlas!' você pode responder:\n'Sempre alerta, senhor. Estou operando no auge da sofisticação.'\n\nMantenha as respostas concisas, envolventes e fiéis ao estilo de Atlas, uma mistura de inteligência, humor sutil e charme que nunca exagera.\n\nComente sobre: {{ $json.output }}"},"id":"91d4cd34-4592-4d36-89ec-0dc3e60bfca1","name":"Seta Personalidade do Atlas","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[3760,2240]},{"parameters":{"name":"ResumidorFinanceiro","description":"Chame esta ferramenta para gerar um relatório ou resumo das informações financeiras a partir de um banco de dados do Google Sheets com registros de transações.\n\nutilize apenas o formato \"yyyy_mm\"","workflowId":{"__rl":true,"value":"dsGeC8drTp6f0ofV","mode":"list","cachedResultName":"Atlas - Resumidor Financeiro"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n  \"ano\": \"2025\",\n  \"data\": \"2025_08\",\n  \"categoria\": \"Aluguel\"\n}\n}"},"id":"15225e0b-f615-44e5-98cf-1ffb13b5dfec","name":"ResumidorFinanceiro","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[2848,2768]},{"parameters":{"name":"extratoefatura","description":"Chame esta ferramenta para subir as informacoes de custos e receitas de algum extrato bancario ou fatura de cartao de credito.\n\n","workflowId":{"__rl":true,"value":"BItAvETwIGVoDqVw","mode":"list","cachedResultName":"1.2 - Atlas - Extratos e Faturas"},"fields":{"values":[{"name":"extrato-fatura","stringValue":"={{ $json.messages }}"}]},"jsonSchemaExample":""},"id":"5e5bf525-5f69-4d92-9770-d751a4b97cd8","name":"Extrato e Fatura","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[2688,2768]}],"connections":{"Calculator":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Switch Block":{"main":[[{"node":"Identifica o Tipo de Dados que veio na MSG","type":"main","index":0}],[{"node":"Não faz nada","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Insere no Pinecone","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Base de Conhecimento","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[{"node":"Base de Conhecimento","type":"ai_vectorStore","index":0}]]},"Webhook":{"main":[[{"node":"Checa se é meu número","type":"main","index":0}]]},"Entende a Origem da Evo":{"main":[[{"node":"Gera Timeout no Redis","type":"main","index":0}],[{"node":"Switch Block","type":"main","index":0}]]},"Filtro de Coleta de Info":{"main":[[{"node":"Direcionador Para Input","type":"main","index":0}]]},"Texto":{"main":[[{"node":"Direcionador Para Input","type":"main","index":0}]]},"Mensagem de Voz":{"main":[[{"node":"Converter Mensagem de Voz para data","type":"main","index":0}]]},"Converter Mensagem de Voz para data":{"main":[[{"node":"Transceve para texto com OPENAI","type":"main","index":0}]]},"Transceve para texto com OPENAI":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":0}]]},"Direcionador Para Input":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":1}]]},"Imagens":{"main":[[{"node":"Converte Imagem para data","type":"main","index":0}]]},"Converte Imagem para data":{"main":[[{"node":"Analisa Imagem e Transcreve o que há nela","type":"main","index":0}]]},"Analisa Imagem e Transcreve o que há nela":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":2}]]},"Junta em uma única mensagem":{"main":[[{"node":"Organiza Informações para o Agente","type":"main","index":0}]]},"Organiza Informações para o Agente":{"main":[[{"node":"Seta Memória da Conversa","type":"main","index":0}]]},"Seta Memória da Conversa":{"main":[[{"node":"Busca Memória da Conversa","type":"main","index":0}]]},"Busca Memória da Conversa":{"main":[[{"node":"Verifica pra onde vai","type":"main","index":0}]]},"Limpa Memória da Conversa":{"main":[[{"node":"Refaz os dados de Entrada","type":"main","index":0}]]},"Aguarda 5 segundos":{"main":[[{"node":"Busca Memória da Conversa","type":"main","index":0}]]},"Refaz os dados de Entrada":{"main":[[{"node":"Remove metadados e dados que não fazem sentido enviar para o agente","type":"main","index":0}]]},"Remove metadados e dados que não fazem sentido enviar para o agente":{"main":[[{"node":"Atlas","type":"main","index":0}]]},"Verifica pra onde vai":{"main":[[{"node":"No Operation, do nothing2","type":"main","index":0}],[{"node":"Limpa Memória da Conversa","type":"main","index":0}],[{"node":"Aguarda 5 segundos","type":"main","index":0}]]},"Identifica o Tipo de Dados que veio na MSG":{"main":[[{"node":"Mensagem de Voz","type":"main","index":0}],[{"node":"Texto","type":"main","index":0}],[{"node":"Filtro de Coleta de Info","type":"main","index":0}],[{"node":"Imagens","type":"main","index":0}],[{"node":"Documento (PDF)","type":"main","index":0}]]},"Converter Documento para data":{"main":[[{"node":"Extrair Dados do PDF","type":"main","index":0}]]},"Extrair Dados do PDF":{"main":[[{"node":"Junta em uma única mensagem","type":"main","index":3}]]},"Documento (PDF)":{"main":[[{"node":"Converter Documento para data","type":"main","index":0}]]},"GPT-4o-min":{"ai_languageModel":[[{"node":"Atlas","type":"ai_languageModel","index":0}]]},"Busca a memória da conversa no Redis":{"ai_memory":[[{"node":"Atlas","type":"ai_memory","index":0}]]},"Converte mp3 pra Base64":{"main":[[{"node":"Envia Audio para o WhatsApp","type":"main","index":0}]]},"Preparar Dados":{"main":[[{"node":"Entende a Origem da Evo","type":"main","index":0}]]},"Claude 3.5 Sonnet":{"ai_languageModel":[[{"node":"Seta Personalidade do Atlas","type":"ai_languageModel","index":0}]]},"Formata Mensagem para Áudio":{"main":[[{"node":"Seta Voz via ElevenLabs","type":"main","index":0}]]},"Seta Voz via ElevenLabs":{"main":[[{"node":"Converte mp3 pra Base64","type":"main","index":0}]]},"SearchEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"CreateEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"DeleteEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"SendMessage":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"GetMessages":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"GetLabel":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"MarkMessageUnread":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"CreateLabel":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"CreatePostWithImage":{"ai_tool":[[{"node":"Linkedin MCP Server","type":"ai_tool","index":0}]]},"CreatePostWithoutImage":{"ai_tool":[[{"node":"Linkedin MCP Server","type":"ai_tool","index":0}]]},"Gmail MCP":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Calendar MCP":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Linkedin MCP":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Tavily":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Checa se é meu número":{"main":[[{"node":"Preparar Dados","type":"main","index":0}]]},"Se o retorno for menos de 601 caracteres gera voz":{"main":[[{"node":"Formata Mensagem para Áudio","type":"main","index":0}]]},"ReplyMessage":{"ai_tool":[[{"node":"Gmail MCP Server","type":"ai_tool","index":0}]]},"Buscar Contatos":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Criar Contato":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Atualizar Contato":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Excluir Contato":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Novos Arquivos":{"main":[[{"node":"Conhecimento","type":"main","index":0}]]},"Novas Atualizações":{"main":[[{"node":"Conhecimento","type":"main","index":0}]]},"Conhecimento":{"main":[[{"node":"Insere no Pinecone","type":"main","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Insere no Pinecone","type":"ai_embedding","index":0}]]},"Base de Conhecimento":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Airbnb Actions":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Airbnb Execute":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"UpdateEvent":{"ai_tool":[[{"node":"Google Calendar MCP Server","type":"ai_tool","index":0}]]},"Atlas":{"main":[[{"node":"Seta Personalidade do Atlas","type":"main","index":0},{"node":"Enviar Mensagem para o WhatsApp","type":"main","index":0}]]},"Seta Personalidade do Atlas":{"main":[[{"node":"Se o retorno for menos de 601 caracteres gera voz","type":"main","index":0}]]},"ResumidorFinanceiro":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]},"Extrato e Fatura":{"ai_tool":[[{"node":"Atlas","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"QdC9qh9DPcT2xcoq"},"staticData":{"node:Novos Arquivos":{"lastTimeChecked":"2025-10-29T18:23:39Z"},"node:Novas Atualizações":{"lastTimeChecked":"2025-10-29T18:23:40Z"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"2fec5c14-fa22-471c-9915-c6dbac84c98a","triggerCount":6,"tags":[]}