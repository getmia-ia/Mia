{"createdAt":"2025-08-04T21:20:55.047Z","updatedAt":"2025-08-22T16:00:15.353Z","id":"OJSi1UJOTvkCsAhn","name":"ZP - Social Media - Journal - Resumo Di√°rio","active":false,"isArchived":true,"nodes":[{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[2352,752],"id":"9460890e-7b3e-432a-905a-e9a6195d8d88","name":"Loop Over Items"},{"parameters":{"resource":"messages-api","operation":"send-image","instanceName":"social-media-radarcorretor","remoteJid":"120363418028617728@g.us","media":"={{ $json.base64Image }}","caption":"={{ $item(0).$node[\"AI Agent1\"].json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[2592,768],"id":"d603f3dd-a2e0-493e-a0c8-accdbcc66d26","name":"Envio do post - Whatsapp","credentials":{"evolutionApi":{"id":"vDN1jxL85cL5Mz2G","name":"Evolution - Radar Corretor"}},"onError":"continueRegularOutput"},{"parameters":{"rule":{"interval":[{"triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[448,752],"id":"67c6a929-2a1a-4b1a-ae68-57677710f62f","name":"Schedule Trigger1"},{"parameters":{"documentId":{"__rl":true,"value":"1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek","mode":"list","cachedResultName":"Controle Radar do Corretor","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Ze1MFqVlu21qakfTTE5ECfAu4iFOoeQMygOCjPW5nek/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"base","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"data_processamento","lookupValue":"={{ $json.data_processamento }}"},{"lookupColumn":"status","lookupValue":"postado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[864,752],"id":"9b35e318-0fbb-4afe-9363-a829a7c206ca","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"const ontem = new Date();\nontem.setDate(ontem.getDate() - 1);\n\nconst dia = String(ontem.getDate()).padStart(2, '0');\nconst mes = String(ontem.getMonth() + 1).padStart(2, '0');\nconst ano = ontem.getFullYear();\n\nreturn {\n  data_processamento: `${dia}/${mes}/${ano}`\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[656,752],"id":"59279ae8-1358-4da9-b102-1e2a29c05920","name":"Code"},{"parameters":{"promptType":"define","text":"={{ $json.prompt }}","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[1296,752],"id":"d5336c96-94ab-4ae8-987c-4859a816b8e1","name":"AI Agent1","executeOnce":true,"onError":"continueRegularOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1296,976],"id":"e6900cee-fcf7-45b9-8804-81736d4a8f95","name":"OpenRouter Chat Model1","credentials":{"openRouterApi":{"id":"o1ywdYlH64cgqSMT","name":"OpenRouter account"}}},{"parameters":{"jsCode":"const items = $input.all();\nif (!items.length) {\n  return [{ json: { prompt: \"Nenhuma not√≠cia foi processada.\" } }];\n}\n\nconst data = items[0]?.json?.data_processamento || \"DATA_N√ÉO_ENCONTRADA\";\n\n// Contexto curto para guiar o modelo (sem ficar gigantesco)\nconst MAX = 500;\nconst cut = s => (s || '').trim().slice(0, MAX);\nconst contexto = items.map(it => `‚Ä¢ ${(it.json.titulo||'').trim()}\\n${cut(it.json.legenda)}`).join(\"\\n\\n\");\n\n// Linhas FIXAS (n√£o alterar)\nconst header1 = `*Bom dia comunidade Radar Corretor!* üì∞\\n\\n`;\nconst header2 = `Segue resumo de not√≠cias do dia *${data}*:\\n\\n`;\nconst header3 = `Acompanhe a nossa p√°gina no Instagram:\\nhttps://www.instagram.com/radarcorretor\\n\\n`;\nconst footer  = `*Boas vendas para todos!* üöÄ\\n\\n`;\n\nconst prompt = `\nVoc√™ √© editor do briefing matinal da comunidade Radar Corretor (WhatsApp).\nProduza UMA mensagem concisa, did√°tica e **visual**, com base nas not√≠cias de *${data}*.\nN√£o liste not√≠cia por not√≠cia. N√£o inclua links (al√©m do Instagram j√° fornecido). N√£o invente fatos.\n\nBASE (refer√™ncia; n√£o copie literalmente):\n${contexto}\n\nFORMATO EXATO DA SA√çDA (mantenha as linhas fixas e a ordem):\n${header1}${header2}${header3}[RESUMO CONECTADO EM BLOCOS]\n- Estruture em **2 a 3 blocos**, cada um com **t√≠tulo em negrito + emoji** na mesma linha (ex.: **üìà Economia**, **üè† Imobili√°rio**,  **ü§ñ Tech/Empresas**).\n- Cada bloco deve ter **2 a 3 frases curtas**, explicando *o que aconteceu* e *por que importa para o corretor*.\n- Use **1 emoji no t√≠tulo**. Separe os blocos com uma linha em branco.\n\n*O que muda para o corretor:*\n- üéØ Bullet pr√°tico 1 (atendimento/argumenta√ß√£o)\n- üí≥ Bullet pr√°tico 2 (cr√©dito/financiamento/taxas)\n- ‚è±Ô∏è Bullet pr√°tico 3 (timing/capta√ß√£o/precifica√ß√£o)\n\n*Manchetes do dia:*\n- T√≠tulo 1\n- T√≠tulo 2\n- T√≠tulo 3\n- T√≠tulo 4\n\n[INSIRA AQUI uma √öNICA linha com **uma frase motivacional de vendas em it√°lico** com autor, formato exato: _\"frase\" ‚Äî Autor_]\n\n${footer}\n\nREGRAS:\n- PT-BR, claro e objetivo; sem jarg√£o.\n- Priorize n√∫meros/dados quando existirem; se faltarem, n√£o invente.\n- **Obrigat√≥rio**: a cita√ß√£o deve vir em *it√°lico* (use sublinhados do WhatsApp: _texto_).\n- N√£o adicione se√ß√µes al√©m das especificadas.\n`.trim();\n\nreturn [{ json: { prompt } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1072,752],"id":"d3874e1f-b308-4b06-96d1-780838dd7689","name":"Code1"},{"parameters":{"content":"# Fluxo de Envio do Resumo Di√°rio para comunidade Whatsapp\n### Esse fluxo roda todo dia de manh√£ as 08am\n### Envia um resumo das not√≠cias processadas no dia anterior","height":640,"width":2432,"color":3},"type":"n8n-nodes-base.stickyNote","position":[384,528],"typeVersion":1,"id":"4a8f790f-da90-4c8d-a94b-5d2688b183e1","name":"Sticky Note15"},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"1etDnHoDaidl2KZmBpw4Z9RAs8FO18kCq","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1808,592],"id":"4ad99cda-396b-45d9-b01a-f88a06d62bb0","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"ZkmaJh5Y8Zdz8ju7","name":"Google Drive - lucas@getmia.com.br"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// n8n Code node ‚Äì pega o base64 do arquivo baixado no \"Download file\"\n\nconst binAll = $input.item.binary || {};\n\n// tenta 'imagem_final', depois 'data', depois a 1¬™ chave dispon√≠vel\nconst key =\n  binAll.imagem_final ? 'imagem_final' :\n  (binAll.data ? 'data' : Object.keys(binAll)[0]);\n\nif (!key) throw new Error('Nenhum bin√°rio encontrado no item.');\n\nconst bin = binAll[key];\nif (!bin?.data) throw new Error(`Bin√°rio na chave \"${key}\" n√£o possui .data.`);\n\n// j√° vem em base64; n√£o reconverta\nconst base64 = bin.data;\n\nreturn {\n  json: {\n    base64Image: base64,                          // use isto no Evolution (media)\n    mimeType: bin.mimeType || 'application/octet-stream',\n    fileName: bin.fileName || 'arquivo'\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2016,592],"id":"9d59e61b-e5e6-44b1-946e-bf691c701f72","name":"Code2"}],"connections":{"Loop Over Items":{"main":[[],[{"node":"Envio do post - Whatsapp","type":"main","index":0}]]},"Envio do post - Whatsapp":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Code1","type":"main","index":0}]]},"OpenRouter Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Code1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Download file":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"errorWorkflow":"UldWpZHcKTrRMFpI"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Google Sheets Trigger":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"},"node:Schedule Trigger1":{"recurrenceRules":[]},"node:Trigger nova noticia no sheets":{"documentId":"1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0","sheetId":0,"lastRevision":271,"lastRevisionLink":"https://docs.google.com/spreadsheets/export?id=1fWo0JNzTrseQubx5O31tEJ5Yd4jHKUCGp_9xZMPfec0&revision=271&exportFormat=xlsx"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"34da2052-e175-49d2-855c-97dfa6608b78","triggerCount":1,"tags":[]}