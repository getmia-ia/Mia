{"createdAt":"2025-11-04T17:47:41.646Z","updatedAt":"2025-11-07T18:39:06.484Z","id":"snjcgai5XDkoGHJw","name":"Mia - 1.4 - Journal - Post X","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1040,368],"id":"43f5d0cc-0492-4380-aaa4-373ed2612ffb","name":"Schedule Trigger"},{"parameters":{"documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"status_X","lookupValue":"aprovado"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-864,368],"id":"6e28fac2-8b20-4240-8209-0799b98f7c14","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"jsCode":"// Garante 1 por execução (pega a primeira \"aprovado\")\nconst rows = items.map(i => i.json);\n\nconst isApproved = (v) =>\n  String(v || '').trim().toLowerCase() === 'aprovado';\n\nconst first = rows.find(r =>\n  isApproved(r.status_X) &&\n  r.noticia_id &&\n  (r.imagem_url || r.imagem) &&\n  r.legenda_x\n);\n\nif (!first) return []; // nada a postar neste horário\n\nconst out = { ...first };\nout.imagem_url = first.imagem_url || first.imagem;\nreturn [{ json: out }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-672,368],"id":"75e54718-c9c7-4346-92cc-1ece59d1b07f","name":"Code"},{"parameters":{"assignments":{"assignments":[{"id":"68b89233-2740-4afd-a95c-72ed537d12e5","name":"noticia_id","value":"={{ $json.noticia_id }}","type":"string"},{"id":"225df266-bf29-4415-b04c-2750cef4506a","name":"image_url","type":"string","value":"={{ $json.imagem_url }}"},{"id":"42e44a66-490d-453f-8746-87e201e58f6c","name":"image_url2","value":"={{ $json.imagem_url2 }}","type":"string"},{"id":"f64af4b7-c2de-4003-9076-51df6440cf84","name":"image_url3","value":"={{ $json.imagem_url3 }}","type":"string"},{"id":"f35e3093-1bff-4cc6-a6c4-909dca314cc7","name":"x_post_caption","type":"string","value":"={{ $json.legenda_x }}"}]},"options":{}},"id":"84d9c99f-e3c4-4fee-a37e-be9e1cf4bd8f","name":"X parametros","type":"n8n-nodes-base.set","position":[-288,352],"typeVersion":3.4},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM","mode":"list","cachedResultName":"Controle Posts - Mia","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"instagram_journal","cachedResultUrl":"https://docs.google.com/spreadsheets/d/17qGLzzHXcFcZ7eZaKkH5wPrkEYSeri6iqFA7bjs9CbM/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{},"matchingColumns":["noticia_id"],"schema":[{"id":"data_processamento","displayName":"data_processamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"noticia_id","displayName":"noticia_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"titulo","displayName":"titulo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda","displayName":"legenda","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"legenda_x","displayName":"legenda_x","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fonte","displayName":"fonte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem","displayName":"imagem","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo_base64","displayName":"arquivo_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo2_base64","displayName":"arquivo2_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"arquivo3_base64","displayName":"arquivo3_base64","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url","displayName":"imagem_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url2","displayName":"imagem_url2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"imagem_url3","displayName":"imagem_url3","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status_Instagram","displayName":"status_Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status_X","displayName":"status_X","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nota","displayName":"nota","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"justificativa","displayName":"justificativa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"status_WhatsApp","displayName":"status_WhatsApp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1712,336],"id":"11ab7b13-71dd-4864-9a8f-d9f2de476a9f","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"de8CYZ2v6bGWBjAX","name":"Google Sheets - lucas@getmia.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"f2c98e3a-ba6b-4df7-a0c9-96994c91a690","name":"noticia_id","value":"={{ $('X parametros').item.json.noticia_id }}","type":"string"},{"id":"a95682ad-ea9c-4d88-a370-0ffad2b3eea5","name":"status_X","value":"postado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1504,336],"id":"44834e52-7753-487a-880b-22d7e7e9a73f","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"conditions":[{"id":"0304efee-33b2-499e-bad1-9238c1fc2999","operator":{"type":"string","operation":"notEmpty","singleValue":true},"leftValue":"={{ $json.data && $json.data.id }}","rightValue":"PUBLISHED"}],"combinator":"or"},"options":{}},"id":"be8d3d76-3895-4a70-82c1-493d5d34bd6a","name":"If media status is finished","type":"n8n-nodes-base.if","position":[1264,352],"typeVersion":2.2},{"parameters":{"url":"={{ $('X parametros').item.json.image_url }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-64,144],"id":"93eeec8f-92d2-4f2f-9c59-68405d34bb38","name":"Baixar imagem1"},{"parameters":{"url":"={{ $('X parametros').item.json.image_url2 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-64,352],"id":"57ef69cf-a9b0-4a31-acc6-8c8812560134","name":"Baixar imagem2"},{"parameters":{"url":"={{ $('X parametros').item.json.image_url3 }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-64,576],"id":"627744fc-c233-4b36-81db-22a16eb8a7db","name":"Baixar imagem3"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":3,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[464,336],"id":"e9e0d635-1f7e-4c29-ba66-20a9d8806252","name":"Merge1"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[672,352],"id":"e217736b-240e-4778-a5ac-cbce8adf15ac","name":"Wait","webhookId":"d8e25052-c339-4ec0-aeca-8a1bbca7dc5d"},{"parameters":{"method":"POST","url":"https://upload.twitter.com/1.1/media/upload.json","authentication":"predefinedCredentialType","nodeCredentialType":"twitterOAuth1Api","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"media","inputDataFieldName":"data"}]},"options":{}},"id":"d1634f9c-95e0-40c9-a7d9-aac1aaa5b121","name":"Sobe img 1 no X","type":"n8n-nodes-base.httpRequest","position":[176,144],"typeVersion":4.2,"credentials":{"twitterOAuth1Api":{"id":"dVKQI6WRC4tmve4d","name":"X OAuth - Mia"},"twitterOAuth2Api":{"id":"V9dCCc7cxgto1ZK5","name":"X OAuth2 - MIA"}}},{"parameters":{"method":"POST","url":"https://upload.twitter.com/1.1/media/upload.json","authentication":"predefinedCredentialType","nodeCredentialType":"twitterOAuth1Api","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"media","inputDataFieldName":"data"}]},"options":{}},"id":"07580580-75ac-43d1-8717-de8634e89431","name":"Sobe img 2 no X","type":"n8n-nodes-base.httpRequest","position":[176,352],"typeVersion":4.2,"credentials":{"twitterOAuth1Api":{"id":"dVKQI6WRC4tmve4d","name":"X OAuth - Mia"},"twitterOAuth2Api":{"id":"V9dCCc7cxgto1ZK5","name":"X OAuth2 - MIA"}}},{"parameters":{"method":"POST","url":"https://upload.twitter.com/1.1/media/upload.json","authentication":"predefinedCredentialType","nodeCredentialType":"twitterOAuth1Api","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"media","inputDataFieldName":"data"}]},"options":{}},"id":"8dfd9ebb-88fb-4911-ba0e-f47e656afcd7","name":"Sobe img 3 no X","type":"n8n-nodes-base.httpRequest","position":[176,576],"typeVersion":4.2,"credentials":{"twitterOAuth1Api":{"id":"dVKQI6WRC4tmve4d","name":"X OAuth - Mia"},"twitterOAuth2Api":{"id":"V9dCCc7cxgto1ZK5","name":"X OAuth2 - MIA"}}},{"parameters":{"resource":"messages-api","instanceName":"social-media-mia","remoteJid":"120363421402105782@g.us","messageText":"=Post no X da Mia falhou!","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1504,544],"id":"ae9f0d7e-972d-4d23-8d4f-63a3c139c595","name":"Envia log falha","retryOnFail":true,"credentials":{"evolutionApi":{"id":"MuW4REP1kIrolv7W","name":"social-media-mia"}}},{"parameters":{"resource":"messages-api","instanceName":"social-media-mia","remoteJid":"120363421402105782@g.us","messageText":"=Post no X da Mia deu certo!","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1920,336],"id":"09f2b1e5-45e7-402b-863d-c3130b97e3c4","name":"Envia log sucesso","retryOnFail":true,"credentials":{"evolutionApi":{"id":"MuW4REP1kIrolv7W","name":"social-media-mia"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"54fa4546-8262-4651-9b0e-ce3a2f66416f","leftValue":"={{ $json.status_X }}","rightValue":"aprovado","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-496,368],"id":"59993f7b-e441-4ad2-8b90-374d39afacbb","name":"Verifica se foi aprovada"},{"parameters":{"method":"POST","url":"https://api.x.com/2/tweets","authentication":"predefinedCredentialType","nodeCredentialType":"twitterOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1072,352],"id":"570c780d-362e-4568-a7c3-23bfb4d17fe1","name":"Publica tweet","credentials":{"twitterOAuth2Api":{"id":"V9dCCc7cxgto1ZK5","name":"X OAuth2 - MIA"}}},{"parameters":{"content":"## Preparação dos dados da notícia do post","height":672,"width":736},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-896,64],"id":"b21b65a7-2849-4a20-a2d2-f4313ecdef04","name":"Sticky Note"},{"parameters":{"content":"## Prepara as imagens para publicação (sobre com API do X OAuth)","height":672,"width":736,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-128,64],"id":"8ec6f95f-1a9b-473a-b5aa-dc98475f2098","name":"Sticky Note1"},{"parameters":{"content":"## Publica e atualiza o status na planilha","height":672,"width":1440,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[640,64],"id":"2d90c781-14da-4939-a235-565a457b1323","name":"Sticky Note2"},{"parameters":{"jsCode":"// Function Node - Versão simplificada\nconst caption = $('X parametros').item.json.x_post_caption;\n\nconst payload = {\n  text: caption,\n  media: {\n    media_ids: [\n      $('Sobe img 1 no X').item.json.media_id_string,\n      $('Sobe img 2 no X').item.json.media_id_string,\n      $('Sobe img 3 no X').item.json.media_id_string\n    ].filter(id => id) // Remove valores null/undefined\n  }\n};\n\n// Validação básica\nif (!payload.text) throw new Error('Texto é obrigatório');\nif (payload.media.media_ids.length === 0) throw new Error('Mídias são obrigatórias');\n\nreturn payload;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[880,352],"id":"f2e68d7f-afc9-4f4d-bb8f-0a6e707b60ed","name":"Prepara o JSON do Body do Call da API"}],"connections":{"Schedule Trigger":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Verifica se foi aprovada","type":"main","index":0}]]},"X parametros":{"main":[[{"node":"Baixar imagem1","type":"main","index":0},{"node":"Baixar imagem2","type":"main","index":0},{"node":"Baixar imagem3","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]},"If media status is finished":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Envia log falha","type":"main","index":0}]]},"Baixar imagem1":{"main":[[{"node":"Sobe img 1 no X","type":"main","index":0}]]},"Baixar imagem2":{"main":[[{"node":"Sobe img 2 no X","type":"main","index":0}]]},"Baixar imagem3":{"main":[[{"node":"Sobe img 3 no X","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Prepara o JSON do Body do Call da API","type":"main","index":0}]]},"Sobe img 1 no X":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Sobe img 2 no X":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Sobe img 3 no X":{"main":[[{"node":"Merge1","type":"main","index":2}]]},"Envia log sucesso":{"main":[[]]},"Verifica se foi aprovada":{"main":[[{"node":"X parametros","type":"main","index":0}]]},"Publica tweet":{"main":[[{"node":"If media status is finished","type":"main","index":0}]]},"Update row in sheet":{"main":[[{"node":"Envia log sucesso","type":"main","index":0}]]},"Prepara o JSON do Body do Call da API":{"main":[[{"node":"Publica tweet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"QdC9qh9DPcT2xcoq"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"4c0373ca-5dc2-41c8-b2eb-b580109123ca","triggerCount":1,"tags":[]}